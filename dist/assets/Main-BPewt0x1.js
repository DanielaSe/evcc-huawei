import{_ as v,f as C,c as o,w as N,a,v as K,n as y,t as c,F as I,r as A,b as f,d as P,e as m,o as s,h as g,i as T,j as V,k as w,l as Z,P as E,m as L,p as B,q as b,s as k,u as Y,x as F,M as q,y as O,z as Ye,C as de,A as fe,B as Q,D as Qe,S as Je,E as Xe,G as Oe,H as et,T as tt,I as j,J as U,K as Ue,L as Fe,N as ue,O as x,Q as ae,R as it,U as ge,V as qe,W as nt,X as at,Y as st,Z as ot,$ as oe,a0 as re,a1 as rt}from"./index-CN0w41DB.js";import{T as pe}from"./TopNavigation-BCd9W1gB.js";import{V as se,T as J,S as lt}from"./batterythreequarters-vx6TSM96.js";import{V as ve}from"./checkmark-LlNya1Qf.js";import{M as ct}from"./MultiSelect-ByDpfYrz.js";import{d as X}from"./deepEqual-DB6L2s-b.js";var dt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M6.586 30.586l2.828 2.828L24 18.828l14.586 14.586 2.828-2.828L24 13.172z"/></svg>';class ut extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=dt}}window.customElements.define("shopicon-regular-arrowup",ut);var ht='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M44.229 36.968L25.772 5.001a2 2 0 00-3.464 0L3.852 36.968a2 2 0 001.732 3h36.912a1.999 1.999 0 001.733-3zm-35.181-1L24.04 10.001l14.992 25.967H9.048z"/><path d="M21.973 16.01l4-.016.05 13-4 .015zM24.023 31.124a1.755 1.755 0 100 3.51 1.755 1.755 0 000-3.51z"/></svg>';class mt extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=ht}}window.customElements.define("shopicon-regular-exclamationtriangle",mt);const ft={name:"Notifications",mixins:[C],props:{notifications:Array,loadpointTitles:Array},computed:{iconVisible:function(){return this.notifications.length>0},iconClass:function(){return this.notifications.find(e=>e.level==="error")?"text-danger":"text-warning"}},created:function(){this.interval=setInterval(()=>{this.$forceUpdate()},10*1e3)},unmounted:function(){clearTimeout(this.interval)},methods:{message({message:e,lp:i}){const n=Array.isArray(e)?e:[e];return i&&(n[0]="".concat(this.loadpointTitles[i-1]||i,": ").concat(n[0])),n},clear:function(){var e;(e=window.app)==null||e.clear()}}},gt={href:"#","data-bs-toggle":"modal","data-bs-target":"#notificationModal",class:"btn btn-sm btn-link text-decoration-none link-light border-0 text-nowrap","data-testid":"notification-icon"},pt={id:"notificationModal",class:"modal fade text-dark",tabindex:"-1",role:"dialog","aria-hidden":"true","data-bs-backdrop":"true"},vt={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",role:"document"},bt={class:"modal-content"},yt={class:"modal-header"},_t={class:"modal-title"},St={class:"modal-body"},wt=["title"],Pt={class:"d-flex align-items-baseline"},Ct={class:"flex-grow-1 px-2 py-1 text-break"},Tt={key:0,class:"badge rounded-pill bg-secondary"},kt={class:"modal-footer d-flex justify-content-between gap-3"};function It(e,i,n,d,r,t){const l=m("router-link");return s(),o("div",null,[N(a("button",gt,[a("shopicon-regular-exclamationtriangle",{class:y(t.iconClass)},null,2)],512),[[K,t.iconVisible]]),a("div",pt,[a("div",vt,[a("div",bt,[a("div",yt,[a("h5",_t,c(e.$t("notifications.modalTitle")),1),i[1]||(i[1]=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),a("div",St,[(s(!0),o(I,null,A(n.notifications,(h,u)=>(s(),o("div",{key:u},[a("small",{class:"d-flex justify-content-end mt-3",title:e.fmtAbsoluteDate(h.time)},c(e.fmtTimeAgo(h.time-new Date)),9,wt),a("p",Pt,[a("shopicon-regular-exclamationtriangle",{class:y([{"text-danger":h.level==="error","text-warning":h.level==="warn"},"flex-grow-0 flex-shrink-0 d-block"])},null,2),a("span",Ct,[(s(!0),o(I,null,A(t.message(h),(p,S)=>(s(),o("span",{key:S,class:"d-block"},c(p),1))),128))]),h.count>1?(s(),o("span",Tt,c(h.count),1)):g("",!0)])]))),128))]),a("div",kt,[f(l,{to:"/log",class:"btn btn-outline-secondary"},{default:P(()=>[T(c(e.$t("notifications.logs")),1)]),_:1}),a("button",{type:"button","data-bs-dismiss":"modal","aria-label":"Close",class:"btn btn-secondary",onClick:i[0]||(i[0]=(...h)=>t.clear&&t.clear(...h))},c(e.$t("notifications.dismissAll")),1)])])])])])}const xt=v(ft,[["render",It]]);var Lt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><style></style><g id="Your_Icons"><path d="M0 0h48v48H0V0z" fill="none"/><path d="M7.981 40.019h32.038V7.981H7.981v32.038z" id="Shopicon_00000005233862153072290020000010038958663075050425_"/></g></svg>';class At extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Lt}}window.customElements.define("shopicon-filled-square",At);const Nt={name:"BatteryIcon",mixins:[V],props:{soc:{type:Number,default:0},hold:{type:Boolean,default:!1},gridCharge:{type:Boolean,default:!1}},computed:{socRect(){const e=(this.soc/4.545454545454546).toFixed(2);return"M30 38H18v-".concat(e,"h12v").concat(e,"z")}}},$t={key:0,fill:"currentColor",d:"M21.956,26.739l0,8.261l4.088,0l0,-8.261l3.066,3.033l2.89,-2.859l-8,-7.913l-8,7.913l2.89,2.859l3.066,-3.033Z"},Bt={key:1,fill:"currentColor",d:"M21.943,22.053l0,9.943l-3,0l0,-9.943l3,-0Zm7,-0l0,9.943l-3,-0l0,-9.943l3,-0Z"},Vt=["d"];function Mt(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 48 48"},[i[0]||(i[0]=a("path",{d:"M0-.004h48v48H0v-48z",fill:"none"},null,-1)),i[1]||(i[1]=a("path",{fill:"currentColor",d:"M35 9.996h-3v-4a2 2 0 00-2-2H18a2 2 0 00-2 2v4h-3a2 2 0 00-2 2v30a2 2 0 002 2h22a2 2 0 002-2v-30a2 2 0 00-2-2zm-15-2h8v2h-8v-2zm13 32H15v-26h18v26z"},null,-1)),n.gridCharge?(s(),o("path",$t)):n.hold?(s(),o("path",Bt)):(s(),o("path",{key:2,fill:"currentColor",d:t.socRect},null,8,Vt))],4)}const We=v(Nt,[["render",Mt]]),Et={name:"LabelBar",props:{value:{type:Number,default:0},hideIcon:{type:Boolean},top:{type:Boolean},bottom:{type:Boolean},first:{type:Boolean},last:{type:Boolean}}},Dt={class:"label-bar-scale"},Rt={class:"label-bar-icon"};function Ot(e,i,n,d,r,t){return s(),o("div",{class:y(["label-bar",{"label-bar--hide-icon":n.hideIcon,"label-bar--hidden":!n.value,"label-bar--top":n.top,"label-bar--bottom":n.bottom,"label-bar--first":n.first,"label-bar--last":n.last}])},[a("div",Dt,[a("div",Rt,[Z(e.$slots,"default",{},void 0,!0)])])],2)}const Ut=v(Et,[["render",Ot],["__scopeId","data-v-07ec7375"]]);var ne=function(){return ne=Object.assign||function(e){for(var i,n=1,d=arguments.length;n<d;n++)for(var r in i=arguments[n])Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);return e},ne.apply(this,arguments)},Ft=function(){function e(i,n,d){var r=this;this.endVal=n,this.options=d,this.version="2.8.0",this.defaults={startVal:0,decimalPlaces:0,duration:2,useEasing:!0,useGrouping:!0,useIndianSeparators:!1,smartEasingThreshold:999,smartEasingAmount:333,separator:",",decimal:".",prefix:"",suffix:"",enableScrollSpy:!1,scrollSpyDelay:200,scrollSpyOnce:!1},this.finalEndVal=null,this.useEasing=!0,this.countDown=!1,this.error="",this.startVal=0,this.paused=!0,this.once=!1,this.count=function(t){r.startTime||(r.startTime=t);var l=t-r.startTime;r.remaining=r.duration-l,r.useEasing?r.countDown?r.frameVal=r.startVal-r.easingFn(l,0,r.startVal-r.endVal,r.duration):r.frameVal=r.easingFn(l,r.startVal,r.endVal-r.startVal,r.duration):r.frameVal=r.startVal+(r.endVal-r.startVal)*(l/r.duration);var h=r.countDown?r.frameVal<r.endVal:r.frameVal>r.endVal;r.frameVal=h?r.endVal:r.frameVal,r.frameVal=Number(r.frameVal.toFixed(r.options.decimalPlaces)),r.printValue(r.frameVal),l<r.duration?r.rAF=requestAnimationFrame(r.count):r.finalEndVal!==null?r.update(r.finalEndVal):r.options.onCompleteCallback&&r.options.onCompleteCallback()},this.formatNumber=function(t){var l,h,u,p,S=t<0?"-":"";l=Math.abs(t).toFixed(r.options.decimalPlaces);var _=(l+="").split(".");if(h=_[0],u=_.length>1?r.options.decimal+_[1]:"",r.options.useGrouping){p="";for(var $=3,D=0,R=0,H=h.length;R<H;++R)r.options.useIndianSeparators&&R===4&&($=2,D=1),R!==0&&D%$==0&&(p=r.options.separator+p),D++,p=h[H-R-1]+p;h=p}return r.options.numerals&&r.options.numerals.length&&(h=h.replace(/[0-9]/g,function(G){return r.options.numerals[+G]}),u=u.replace(/[0-9]/g,function(G){return r.options.numerals[+G]})),S+r.options.prefix+h+u+r.options.suffix},this.easeOutExpo=function(t,l,h,u){return h*(1-Math.pow(2,-10*t/u))*1024/1023+l},this.options=ne(ne({},this.defaults),d),this.formattingFn=this.options.formattingFn?this.options.formattingFn:this.formatNumber,this.easingFn=this.options.easingFn?this.options.easingFn:this.easeOutExpo,this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.endVal=this.validateValue(n),this.options.decimalPlaces=Math.max(this.options.decimalPlaces),this.resetDuration(),this.options.separator=String(this.options.separator),this.useEasing=this.options.useEasing,this.options.separator===""&&(this.options.useGrouping=!1),this.el=typeof i=="string"?document.getElementById(i):i,this.el?this.printValue(this.startVal):this.error="[CountUp] target is null or undefined",typeof window<"u"&&this.options.enableScrollSpy&&(this.error?console.error(this.error,i):(window.onScrollFns=window.onScrollFns||[],window.onScrollFns.push(function(){return r.handleScroll(r)}),window.onscroll=function(){window.onScrollFns.forEach(function(t){return t()})},this.handleScroll(this)))}return e.prototype.handleScroll=function(i){if(i&&window&&!i.once){var n=window.innerHeight+window.scrollY,d=i.el.getBoundingClientRect(),r=d.top+window.pageYOffset,t=d.top+d.height+window.pageYOffset;t<n&&t>window.scrollY&&i.paused?(i.paused=!1,setTimeout(function(){return i.start()},i.options.scrollSpyDelay),i.options.scrollSpyOnce&&(i.once=!0)):(window.scrollY>t||r>n)&&!i.paused&&i.reset()}},e.prototype.determineDirectionAndSmartEasing=function(){var i=this.finalEndVal?this.finalEndVal:this.endVal;this.countDown=this.startVal>i;var n=i-this.startVal;if(Math.abs(n)>this.options.smartEasingThreshold&&this.options.useEasing){this.finalEndVal=i;var d=this.countDown?1:-1;this.endVal=i+d*this.options.smartEasingAmount,this.duration=this.duration/2}else this.endVal=i,this.finalEndVal=null;this.finalEndVal!==null?this.useEasing=!1:this.useEasing=this.options.useEasing},e.prototype.start=function(i){this.error||(this.options.onStartCallback&&this.options.onStartCallback(),i&&(this.options.onCompleteCallback=i),this.duration>0?(this.determineDirectionAndSmartEasing(),this.paused=!1,this.rAF=requestAnimationFrame(this.count)):this.printValue(this.endVal))},e.prototype.pauseResume=function(){this.paused?(this.startTime=null,this.duration=this.remaining,this.startVal=this.frameVal,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count)):cancelAnimationFrame(this.rAF),this.paused=!this.paused},e.prototype.reset=function(){cancelAnimationFrame(this.rAF),this.paused=!0,this.resetDuration(),this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.printValue(this.startVal)},e.prototype.update=function(i){cancelAnimationFrame(this.rAF),this.startTime=null,this.endVal=this.validateValue(i),this.endVal!==this.frameVal&&(this.startVal=this.frameVal,this.finalEndVal==null&&this.resetDuration(),this.finalEndVal=null,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count))},e.prototype.printValue=function(i){var n;if(this.el){var d=this.formattingFn(i);!((n=this.options.plugin)===null||n===void 0)&&n.render?this.options.plugin.render(this.el,d):this.el.tagName==="INPUT"?this.el.value=d:this.el.tagName==="text"||this.el.tagName==="tspan"?this.el.textContent=d:this.el.innerHTML=d}},e.prototype.ensureNumber=function(i){return typeof i=="number"&&!isNaN(i)},e.prototype.validateValue=function(i){var n=Number(i);return this.ensureNumber(n)?n:(this.error="[CountUp] invalid start or end value: ".concat(i),null)},e.prototype.resetDuration=function(){this.startTime=null,this.duration=1e3*Number(this.options.duration),this.remaining=this.duration},e}();const qt=.5,Wt={name:"AnimatedNumber",props:{to:{type:Number,default:0},format:{type:Function,required:!0},duration:{type:Number,default:qt}},data(){return{instance:null}},watch:{to(e){var i;(i=this.instance)==null||i.update(e)}},mounted(){this.instance||(this.instance=new Ft(this.$el,this.to,{startVal:this.to,formattingFn:this.format,duration:this.duration,decimalPlaces:3}),this.instance.error&&console.error(this.instance.error))},unmounted(){this.instance=null},methods:{forceUpdate(){var e,i;(e=this.instance)==null||e.reset(),(i=this.instance)==null||i.update(this.to)}}};function Ht(e,i,n,d,r,t){return s(),o("span")}const W=v(Wt,[["render",Ht]]),jt={name:"Question",mixins:[V]};function zt(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 32 32"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M16,24c0.467,0 0.861,-0.161 1.184,-0.484c0.323,-0.323 0.484,-0.717 0.483,-1.183c-0.001,-0.465 -0.163,-0.86 -0.484,-1.184c-0.322,-0.323 -0.716,-0.484 -1.183,-0.482c-0.467,0.001 -0.861,0.163 -1.184,0.484c-0.323,0.321 -0.484,0.715 -0.483,1.182c0.001,0.468 0.163,0.863 0.484,1.184c0.322,0.322 0.716,0.483 1.183,0.483m0,-13.733c0.578,-0 1.084,0.177 1.517,0.533c0.434,0.356 0.651,0.811 0.65,1.367c-0,0.511 -0.162,0.966 -0.484,1.366c-0.323,0.4 -0.673,0.767 -1.05,1.1c-0.577,0.511 -1.016,0.995 -1.316,1.451c-0.299,0.456 -0.472,1.006 -0.517,1.649c-0.022,0.311 0.089,0.584 0.333,0.818c0.245,0.233 0.534,0.35 0.867,0.349c0.311,0 0.595,-0.111 0.851,-0.333c0.256,-0.223 0.405,-0.5 0.449,-0.834c0.044,-0.377 0.178,-0.711 0.4,-1c0.222,-0.289 0.544,-0.644 0.967,-1.066c0.777,-0.778 1.294,-1.406 1.55,-1.883c0.256,-0.477 0.384,-1.05 0.383,-1.717c0,-1.2 -0.433,-2.178 -1.3,-2.934c-0.867,-0.755 -1.967,-1.133 -3.3,-1.133c-0.911,0 -1.728,0.206 -2.449,0.617c-0.722,0.412 -1.272,0.995 -1.651,1.75c-0.133,0.266 -0.139,0.539 -0.016,0.817c0.123,0.278 0.328,0.472 0.616,0.583c0.288,0.11 0.583,0.11 0.884,-0c0.301,-0.111 0.54,-0.288 0.716,-0.534c0.244,-0.311 0.528,-0.549 0.851,-0.716c0.322,-0.166 0.672,-0.249 1.049,-0.25"},null,-1)]),4)}const Gt=v(jt,[["render",zt]]),Kt={name:"Visualization",components:{BatteryIcon:We,LabelBar:Ut,AnimatedNumber:W,VehicleIcon:se,QuestionIcon:Gt},mixins:[C],props:{gridImport:{type:Number,default:0},selfPv:{type:Number,default:0},selfBattery:{type:Number,default:0},pvExport:{type:Number,default:0},loadpoints:{type:Array,default:()=>[]},batteryCharge:{type:Number,default:0},batteryDischarge:{type:Number,default:0},batteryHold:{type:Boolean,default:!1},batteryGridCharge:{type:Boolean,default:!1},pvProduction:{type:Number,default:0},homePower:{type:Number,default:0},batterySoc:{type:Number,default:0},powerUnit:{type:String,default:E.KW},inPower:{type:Number,default:0},outPower:{type:Number,default:0}},data:function(){return{width:0}},computed:{gridExport:function(){return this.applyThreshold(this.pvExport)},totalRaw:function(){return this.gridImport+this.selfPv+this.selfBattery+this.pvExport},gridImportAdjusted:function(){return this.applyThreshold(this.gridImport)},selfPvAdjusted:function(){return this.applyThreshold(this.selfPv)},selfBatteryAdjusted:function(){return this.applyThreshold(this.selfBattery)},pvExportAdjusted:function(){return this.applyThreshold(this.pvExport)},totalAdjusted:function(){return this.gridImportAdjusted+this.selfPvAdjusted+this.selfBatteryAdjusted+this.pvExportAdjusted},unknownImport:function(){return this.applyThreshold(Math.max(0,this.outPower-this.inPower),10)},unknownOutput:function(){return this.applyThreshold(Math.max(0,this.inPower-this.outPower),10)},unknownPower:function(){if(this.unknownImport||this.unknownOutput){const e=Math.max(this.inPower,this.outPower);return Math.abs(e-this.totalAdjusted)}return 0},visualizationReady:function(){return this.totalAdjusted>0&&this.width>0}},mounted:function(){this.$nextTick(function(){window.addEventListener("resize",this.updateElementWidth),this.updateElementWidth()})},beforeUnmount(){window.removeEventListener("resize",this.updateElementWidth)},methods:{widthTotal:function(e){return this.totalAdjusted===0||e===0?"0":100/this.totalAdjusted*e+"%"},fmtBarValue:function(e){if(!this.enoughSpaceForValue(e))return"";const i=this.enoughSpaceForUnit(e);return this.fmtW(e,this.powerUnit,i)},powerLabelAvailableSpace(e){if(this.totalAdjusted===0)return 0;const i=100/this.totalAdjusted*e;return this.width/100*i},enoughSpaceForValue(e){return this.powerLabelAvailableSpace(e)>40},enoughSpaceForUnit(e){return this.powerLabelAvailableSpace(e)>60},hideLabelIcon(e,i=32){if(this.totalAdjusted===0)return!0;const n=100/this.totalAdjusted*e;return this.width/100*n<i},applyThreshold(e,i=2){return 100/this.totalRaw*e<i?0:e},updateElementWidth(){this.width=this.$refs.site_progress.getBoundingClientRect().width},labelBarProps(e,i,n){const d=n===void 0?this[i]:n;return{value:d,hideIcon:this.hideLabelIcon(d,40),style:{"flex-basis":this.widthTotal(d)},[e]:!0}}}},Zt={class:"label-scale d-flex"},Yt={class:"d-flex justify-content-start flex-grow-1"},Qt={ref:"site_progress",class:"site-progress"},Jt={key:0,class:"site-progress-bar w-100 grid-import"},Xt={class:"label-scale d-flex"},ei={class:"d-flex justify-content-start flex-grow-1"};function ti(e,i,n,d,r,t){const l=m("LabelBar"),h=m("BatteryIcon"),u=m("QuestionIcon"),p=m("AnimatedNumber"),S=m("VehicleIcon");return s(),o("div",{"data-testid":"visualization",class:y(["visualization",{"visualization--ready":t.visualizationReady}])},[a("div",Zt,[a("div",Yt,[f(l,L(B(t.labelBarProps("top","pvProduction"))),{default:P(()=>i[0]||(i[0]=[a("shopicon-regular-sun",null,null,-1)])),_:1},16),f(l,L(B(t.labelBarProps("top","batteryDischarge"))),{default:P(()=>[f(h,{soc:n.batterySoc},null,8,["soc"])]),_:1},16),f(l,L(B(t.labelBarProps("top","gridImport"))),{default:P(()=>i[1]||(i[1]=[a("shopicon-regular-powersupply",null,null,-1)])),_:1},16),f(l,L(B(t.labelBarProps("top","unknownImport"))),{default:P(()=>[f(u)]),_:1},16)]),i[2]||(i[2]=a("div",{class:"label-scale-name"},"In",-1))]),a("div",Qt,[a("div",{class:"site-progress-bar self-pv",style:w({width:t.widthTotal(t.selfPvAdjusted)})},[n.selfPv&&t.visualizationReady?(s(),b(p,{key:0,class:"power",to:n.selfPv,format:t.fmtBarValue},null,8,["to","format"])):g("",!0)],4),a("div",{class:"site-progress-bar self-battery",style:w({width:t.widthTotal(t.selfBatteryAdjusted)})},[n.selfBattery&&t.visualizationReady?(s(),b(p,{key:0,class:"power",to:n.selfBattery,format:t.fmtBarValue},null,8,["to","format"])):g("",!0)],4),a("div",{class:"site-progress-bar grid-import",style:w({width:t.widthTotal(t.gridImportAdjusted)})},[n.gridImport&&t.visualizationReady?(s(),b(p,{key:0,class:"power",to:n.gridImport,format:t.fmtBarValue},null,8,["to","format"])):g("",!0)],4),a("div",{class:"site-progress-bar pv-export",style:w({width:t.widthTotal(t.pvExportAdjusted)})},[n.pvExport&&t.visualizationReady?(s(),b(p,{key:0,class:"power",to:n.pvExport,format:t.fmtBarValue},null,8,["to","format"])):g("",!0)],4),a("div",{class:"site-progress-bar unknown-power",style:w({width:t.widthTotal(t.unknownPower)})},[t.unknownPower&&t.visualizationReady?(s(),b(p,{key:0,class:"power",to:t.unknownPower,format:t.fmtBarValue},null,8,["to","format"])):g("",!0)],4),t.totalAdjusted<=0?(s(),o("div",Jt,[a("span",null,c(e.fmtW(0,e.POWER_UNIT.AUTO,!0)),1)])):g("",!0)],512),a("div",Xt,[a("div",ei,[f(l,L(B(t.labelBarProps("bottom","homePower"))),{default:P(()=>i[3]||(i[3]=[a("shopicon-regular-home",null,null,-1)])),_:1},16),(s(!0),o(I,null,A(n.loadpoints,(_,$)=>(s(),b(l,k({key:$,ref_for:!0},t.labelBarProps("bottom","loadpoints",_.power)),{default:P(()=>[f(S,{names:[_.icon]},null,8,["names"])]),_:2},1040))),128)),f(l,L(B(t.labelBarProps("bottom","batteryCharge"))),{default:P(()=>[f(h,{soc:n.batterySoc,gridCharge:n.batteryGridCharge},null,8,["soc","gridCharge"])]),_:1},16),f(l,L(B(t.labelBarProps("bottom","gridExport"))),{default:P(()=>i[4]||(i[4]=[a("shopicon-regular-powersupply",null,null,-1)])),_:1},16),f(l,L(B(t.labelBarProps("bottom","unknownOutput"))),{default:P(()=>[f(u)]),_:1},16)]),i[5]||(i[5]=a("div",{class:"label-scale-name"},"Out",-1))]),f(h,{hold:"",class:y(["battery-hold",{"battery-hold--active":n.batteryHold}])},null,8,["class"])],2)}const ii=v(Kt,[["render",ti],["__scopeId","data-v-809fd36d"]]),ni={name:"Forecast",mixins:[V]};function ai(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 48 48"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M5.78,31c1.791,-3.381 3.675,-6.042 5.643,-9.059c1.422,-2.18 2.889,-4.118 4.384,-5.67l2.881,2.774c-1.338,1.39 -2.642,3.13 -3.914,5.081c-1.523,2.335 -3,4.445 -4.418,6.874l-4.576,-0Zm32.023,0c-0.661,-1.3 -1.346,-2.567 -2.051,-3.781l3.458,-2.011c1.067,1.836 2.089,3.787 3.055,5.792l-4.462,0Zm-16.172,-14.32l-1.915,-3.512c1.409,-0.768 2.842,-1.169 4.286,-1.168c1.35,0.001 2.702,0.328 4.04,0.954l-1.696,3.623c-0.78,-0.365 -1.562,-0.576 -2.348,-0.577c-0.8,-0.001 -1.586,0.254 -2.367,0.68Zm7.78,2.072l2.729,-2.924c1.591,1.484 3.149,3.369 4.639,5.53l-3.292,2.271c-1.313,-1.902 -2.675,-3.57 -4.076,-4.877Z"},null,-1)]),4)}const si=v(ni,[["render",ai]]),oi={name:"EnergyflowEntry",components:{BatteryIcon:We,AnimatedNumber:W,VehicleIcon:se,ForecastIcon:si},mixins:[C],props:{name:{type:String},icon:{type:String},iconProps:{type:Object,default:()=>({})},power:{type:Number},powerTooltip:{type:Array},powerUnit:{type:String},details:{type:Number},detailsIcon:{type:String},detailsFmt:{type:Function},detailsTooltip:{type:Array},detailsClickable:{type:Boolean},detailsInactive:{type:Boolean}},emits:["details-clicked"],data(){return{powerTooltipInstance:null,detailsTooltipInstance:null}},computed:{active:function(){return this.power>10},isBattery:function(){return this.icon==="battery"},isVehicle:function(){return this.icon==="vehicle"}},watch:{powerTooltip(e,i){JSON.stringify(e)!==JSON.stringify(i)&&this.updatePowerTooltip()},detailsTooltip(e,i){JSON.stringify(e)!==JSON.stringify(i)&&this.updateDetailsTooltip()},powerInKw(e,i){e!==i&&this.$refs.powerNumber.forceUpdate()}},mounted:function(){this.updatePowerTooltip(),this.updateDetailsTooltip()},methods:{kw:function(e){return this.fmtW(e,this.powerUnit)},updatePowerTooltip(){this.powerTooltipInstance=this.updateTooltip(this.powerTooltipInstance,this.powerTooltip,this.$refs.power)},updateDetailsTooltip(){this.detailsTooltipInstance=this.updateTooltip(this.detailsTooltipInstance,this.detailsTooltip,this.$refs.details)},updateTooltip:function(e,i,n){if(!Array.isArray(i)||!i.length){e&&e.dispose();return}let d=e;d||(d=new J(n,{html:!0,title:" "}));const r='<div class="text-end">'.concat(i.join("<br/>"),"</div>");return d.setContent({".tooltip-inner":r}),d},powerClicked:function(e){this.powerTooltip&&e.stopPropagation()},detailsClicked:function(e){(this.detailsClickable||this.detailsTooltip)&&e.stopPropagation(),this.detailsClickable&&this.$emit("details-clicked"),setTimeout(()=>{var i;return(i=this.detailsTooltipInstance)==null?void 0:i.hide()},10)}}},ri={class:"d-flex justify-content-between"},li={class:"d-flex flex-nowrap"},ci={class:"d-block text-nowrap flex-grow-1 ms-3 text-truncate"},di={class:"text-end text-nowrap ps-1 fw-bold d-flex"},ui=["tabindex"],hi={key:0,class:"ms-4 ps-3"};function mi(e,i,n,d,r,t){const l=m("BatteryIcon"),h=m("VehicleIcon"),u=m("ForecastIcon"),p=m("AnimatedNumber");return s(),o("div",{class:y(["mb-2 entry",{"evcc-gray":!t.active}])},[a("div",ri,[a("span",li,[t.isBattery?(s(),b(l,L(k({key:0},n.iconProps)),null,16)):t.isVehicle?(s(),b(h,L(k({key:1},n.iconProps)),null,16)):(s(),b(Y("shopicon-regular-".concat(n.icon)),{key:2}))]),a("div",ci,c(n.name),1),a("span",di,[a("div",{ref:"details",class:y(["fw-normal",{"text-decoration-underline":n.detailsClickable,"evcc-gray":n.detailsInactive}]),"data-testid":"energyflow-entry-details","data-bs-toggle":"tooltip",tabindex:n.detailsClickable?0:void 0,onClick:i[0]||(i[0]=(...S)=>t.detailsClicked&&t.detailsClicked(...S))},[n.detailsIcon==="forecast"?(s(),b(u,{key:0,class:"ms-2 me-1 d-inline-block"})):g("",!0),isNaN(n.details)?g("",!0):(s(),b(p,{key:1,to:n.details,format:n.detailsFmt},null,8,["to","format"]))],10,ui),a("div",{ref:"power",class:"power","data-bs-toggle":"tooltip",onClick:i[1]||(i[1]=(...S)=>t.powerClicked&&t.powerClicked(...S))},[f(p,{ref:"powerNumber",to:n.power,format:t.kw},null,8,["to","format"])],512)])]),e.$slots.subline?(s(),o("div",hi,[Z(e.$slots,"subline",{},void 0,!0)])):g("",!0)],2)}const fi=v(oi,[["render",mi],["__scopeId","data-v-71b7e520"]]),gi={name:"Energyflow",components:{Visualization:ii,EnergyflowEntry:fi,AnimatedNumber:W},mixins:[C,F],props:{gridConfigured:Boolean,gridPower:{type:Number,default:0},homePower:{type:Number,default:0},pvConfigured:Boolean,pv:{type:Array},pvPower:{type:Number,default:0},loadpointsCompact:{type:Array,default:()=>[]},batteryConfigured:{type:Boolean},battery:{type:Array},batteryPower:{type:Number,default:0},batterySoc:{type:Number,default:0},batteryDischargeControl:{type:Boolean},batteryGridChargeLimit:{type:Number},batteryGridChargeActive:{type:Boolean},batteryMode:{type:String},tariffGrid:{type:Number},tariffFeedIn:{type:Number},tariffCo2:{type:Number},tariffPriceHome:{type:Number},tariffCo2Home:{type:Number},tariffPriceLoadpoints:{type:Number},tariffCo2Loadpoints:{type:Number},smartCostType:{type:String},currency:{type:String},prioritySoc:{type:Number},bufferSoc:{type:Number},bufferStartSoc:{type:Number},forecast:{type:Object,default:()=>({})}},data:()=>({detailsOpen:!1,detailsCompleteHeight:null,ready:!1}),computed:{gridImport:function(){return Math.max(0,this.gridPower)},pvProduction:function(){return Math.abs(this.pvPower)},batteryDischarge:function(){return this.dischargePower(this.batteryPower)},batteryCharge:function(){return this.chargePower(this.batteryPower)},batteryChargeLabel:function(){return this.$t("main.energyflow.battery".concat(this.batteryHold?"Hold":"Charge"))},batteryDischargeLabel:function(){return this.$t("main.energyflow.battery".concat(this.batteryHold?"Hold":"Discharge"))},batteryHold:function(){return this.batteryMode==="hold"},consumption:function(){return this.homePower+this.batteryCharge+this.loadpointsPower},selfPv:function(){return Math.min(this.pvProduction,this.consumption)},selfBattery:function(){return Math.min(this.batteryDischarge,this.consumption-this.selfPv)},activeLoadpoints:function(){return this.loadpointsCompact.filter(e=>e.charging)},activeLoadpointsCount:function(){return this.activeLoadpoints.length},vehicleIcons:function(){return this.activeLoadpointsCount>0?this.activeLoadpoints.map(e=>e.icon):["car"]},loadpointsPower:function(){return this.loadpointsCompact.reduce((e,i)=>e+(i.power||0),0)},pvExport:function(){return Math.max(0,this.gridPower*-1)},powerUnit:function(){const e=Math.max(this.gridImport,this.selfPv,this.selfBattery,this.pvExport);return e>=1e6?E.MW:e>=1e3?E.KW:E.W},inPower:function(){return this.gridImport+this.pvProduction+this.batteryDischarge},outPower:function(){return this.homePower+this.loadpointsPower+this.pvExport+this.batteryCharge},detailsHeight:function(){return this.detailsOpen?this.detailsCompleteHeight+"px":0},pvTooltip(){if(!(!Array.isArray(this.pv)||this.pv.length<=1))return this.pv.map(({power:e})=>this.fmtW(e,this.powerUnit))},batteryDischargeTooltip(){return this.batteryTooltip(!0)},batteryChargeTooltip(){return this.batteryTooltip(!1)},batteryFmt(){return e=>this.fmtPercentage(e,0)},co2Available(){return this.smartCostType===de},pvPossible(){return this.pvConfigured||this.gridConfigured},batteryGridChargeNow(){return this.co2Available?this.fmtCo2Short(this.tariffCo2):this.fmtPricePerKWh(this.tariffGrid,this.currency,!0)},batteryGridChargeLimitSet(){return this.batteryGridChargeLimit!==null&&this.batteryGridChargeLimit!==void 0},batteryGridChargeLimitFmt(){if(this.batteryGridChargeLimitSet)return this.co2Available?this.fmtCo2Short(this.batteryGridChargeLimit):this.fmtPricePerKWh(this.batteryGridChargeLimit,this.currency,!0)},solarForecast(){const e=this.forecast.solar||[];if(e.length!==0)return Ye(e,0)}},watch:{pvConfigured(){this.$nextTick(this.updateHeight)},gridConfigured(){this.$nextTick(this.updateHeight)},batteryConfigured(){this.$nextTick(this.updateHeight)},batteryMode(){this.$nextTick(this.updateHeight)}},mounted(){window.addEventListener("resize",this.updateHeight),O.energyflowDetails&&this.toggleDetails(),setTimeout(()=>this.ready=!0,200)},unmounted(){window.removeEventListener("resize",this.updateHeight)},methods:{detailsTooltip(e,i){const n=[];return i!==void 0&&n.push("".concat(this.fmtCo2Long(i))),e!==void 0&&n.push("".concat(this.fmtPricePerKWh(e,this.currency))),n},forecastTooltip(e){return e!==null?[this.$t("main.energyflow.forecastTooltip")]:[]},detailsValue(e,i){return this.co2Available?i:e},detailsFmt(e){return this.co2Available?this.fmtCo2Short(e):this.fmtPricePerKWh(e,this.currency,!0)},forecastFmt(e){return e===null?"":"".concat(this.fmtWh(e,E.KW))},kw:function(e){return this.fmtW(e,this.powerUnit)},toggleDetails:function(){this.updateHeight(),this.detailsOpen=!this.detailsOpen,O.energyflowDetails=this.detailsOpen},updateHeight:function(){this.detailsCompleteHeight=this.$refs.detailsInner.offsetHeight},openBatterySettingsModal(){q.getOrCreateInstance(document.getElementById("batterySettingsModal")).show()},openForecastModal(){q.getOrCreateInstance(document.getElementById("forecastModal")).show()},dischargePower(e){return Math.abs(Math.max(0,e))},chargePower(e){return Math.abs(Math.min(0,e)*-1)},batteryTooltip(e=!1){if(!(!Array.isArray(this.battery)||this.battery.length<=1))return this.battery.map(({power:i,soc:n})=>{const d=e?this.dischargePower(i):this.chargePower(i),r=this.fmtW(d,this.powerUnit),t=this.fmtPercentage(n,0);return"".concat(r," (").concat(t,")")})}}},pi={class:"row"},vi={ref:"detailsInner",class:"details-inner row"},bi={class:"col-12 d-flex justify-content-between pt-2 mb-4"},yi={class:"d-flex flex-nowrap align-items-center text-truncate"},_i={class:"me-2 legend-self"},Si={class:"text-nowrap text-truncate"},wi={key:0,class:"d-flex flex-nowrap align-items-center text-truncate"},Pi={class:"text-nowrap text-truncate"},Ci={key:1,class:"d-flex flex-nowrap align-items-center text-truncate"},Ti={class:"text-nowrap text-truncate"},ki={class:"col-12 col-md-6 pe-md-5 pb-4 d-flex flex-column justify-content-between"},Ii={class:"d-flex justify-content-between align-items-end mb-4"},xi={key:0,class:"fw-bold"},Li={class:"col-12 col-md-6 ps-md-5 pb-4 d-flex flex-column justify-content-between"},Ai={class:"d-flex justify-content-between align-items-end mb-4"},Ni={key:0,class:"fw-bold"},$i={key:0},Bi={class:"text-nowrap"},Vi={key:1},Mi={class:"text-nowrap"};function Ei(e,i,n,d,r,t){const l=m("Visualization"),h=m("AnimatedNumber"),u=m("EnergyflowEntry");return s(),o("div",{class:y(["energyflow cursor-pointer position-relative",{"energyflow--open":e.detailsOpen}]),"data-testid":"energyflow",onClick:i[1]||(i[1]=(...p)=>t.toggleDetails&&t.toggleDetails(...p))},[a("div",pi,[f(l,{class:"col-12 mb-3 mb-md-4",gridImport:t.gridImport,selfPv:t.selfPv,selfBattery:t.selfBattery,loadpoints:n.loadpointsCompact,pvExport:t.pvExport,batteryCharge:t.batteryCharge,batteryDischarge:t.batteryDischarge,batteryGridCharge:n.batteryGridChargeActive,batteryHold:t.batteryHold,pvProduction:t.pvProduction,homePower:n.homePower,batterySoc:n.batterySoc,powerUnit:t.powerUnit,vehicleIcons:t.vehicleIcons,inPower:t.inPower,outPower:t.outPower},null,8,["gridImport","selfPv","selfBattery","loadpoints","pvExport","batteryCharge","batteryDischarge","batteryGridCharge","batteryHold","pvProduction","homePower","batterySoc","powerUnit","vehicleIcons","inPower","outPower"])]),a("div",{class:y(["details",{"details--ready":e.ready}]),style:w({height:t.detailsHeight})},[a("div",vi,[a("div",bi,[a("div",yi,[a("span",_i,[i[2]||(i[2]=a("shopicon-filled-square",{class:"color-pv legend-pv"},null,-1)),t.selfBattery>0?(s(),o("shopicon-filled-square",{key:0,class:y("color-battery legend-battery legend-battery--".concat(t.selfPv>0?"mixed":"only"))},null,2)):g("",!0)]),a("span",Si,c(e.$t("main.energyflow.selfConsumption")),1)]),t.gridImport>0?(s(),o("div",wi,[a("span",Pi,c(e.$t("main.energyflow.gridImport")),1),i[3]||(i[3]=a("span",{class:"ms-2"},[a("shopicon-filled-square",{class:"legend-grid"})],-1))])):(s(),o("div",Ci,[a("span",Ti,c(e.$t("main.energyflow.pvExport")),1),i[4]||(i[4]=a("span",{class:"ms-2"},[a("shopicon-filled-square",{class:"legend-export"})],-1))]))]),a("div",ki,[a("div",Ii,[i[5]||(i[5]=a("h3",{class:"m-0"},"In",-1)),t.pvPossible?(s(),o("span",xi,[f(h,{to:t.inPower,format:t.kw},null,8,["to","format"])])):g("",!0)]),a("div",null,[t.pvPossible?(s(),b(u,{key:0,name:e.$t("main.energyflow.pvProduction"),icon:"sun",power:t.pvProduction,powerTooltip:t.pvTooltip,details:t.solarForecast,detailsFmt:t.forecastFmt,detailsTooltip:t.forecastTooltip(t.solarForecast),detailsInactive:t.solarForecast===0,detailsIcon:t.solarForecast!==void 0?"forecast":void 0,detailsClickable:t.solarForecast!==void 0,powerUnit:t.powerUnit,"data-testid":"energyflow-entry-production",onDetailsClicked:t.openForecastModal},null,8,["name","power","powerTooltip","details","detailsFmt","detailsTooltip","detailsInactive","detailsIcon","detailsClickable","powerUnit","onDetailsClicked"])):g("",!0),n.batteryConfigured?(s(),b(u,{key:1,name:t.batteryDischargeLabel,icon:"battery",power:t.batteryDischarge,powerTooltip:t.batteryDischargeTooltip,powerUnit:t.powerUnit,iconProps:{hold:t.batteryHold,soc:n.batterySoc,gridCharge:n.batteryGridChargeActive},details:n.batterySoc,detailsFmt:t.batteryFmt,detailsClickable:"","data-testid":"energyflow-entry-batterydischarge",onDetailsClicked:t.openBatterySettingsModal},fe({_:2},[t.batteryGridChargeLimitSet?{name:"subline",fn:P(()=>[i[6]||(i[6]=a("div",{class:"d-none d-md-block"}," ",-1))]),key:"0"}:void 0]),1032,["name","power","powerTooltip","powerUnit","iconProps","details","detailsFmt","onDetailsClicked"])):g("",!0),f(u,{name:e.$t("main.energyflow.gridImport"),icon:"powersupply",power:t.gridImport,powerUnit:t.powerUnit,details:t.detailsValue(n.tariffGrid,n.tariffCo2),detailsFmt:t.detailsFmt,detailsTooltip:t.detailsTooltip(n.tariffGrid,n.tariffCo2),"data-testid":"energyflow-entry-gridimport"},null,8,["name","power","powerUnit","details","detailsFmt","detailsTooltip"])])]),a("div",Li,[a("div",Ai,[i[7]||(i[7]=a("h3",{class:"m-0"},"Out",-1)),t.pvPossible?(s(),o("span",Ni,[f(h,{to:t.outPower,format:t.kw},null,8,["to","format"])])):g("",!0)]),a("div",null,[t.pvPossible?(s(),b(u,{key:0,name:e.$t("main.energyflow.homePower"),icon:"home",power:n.homePower,powerUnit:t.powerUnit,details:t.detailsValue(n.tariffPriceHome,n.tariffCo2Home),detailsFmt:t.detailsFmt,detailsTooltip:t.detailsTooltip(n.tariffPriceHome,n.tariffCo2Home),"data-testid":"energyflow-entry-home"},null,8,["name","power","powerUnit","details","detailsFmt","detailsTooltip"])):g("",!0),f(u,{name:e.$t("main.energyflow.loadpoints",t.activeLoadpointsCount,{count:t.activeLoadpointsCount}),icon:"vehicle",iconProps:{names:t.vehicleIcons},power:t.loadpointsPower,powerUnit:t.powerUnit,details:t.activeLoadpointsCount?t.detailsValue(n.tariffPriceLoadpoints,n.tariffCo2Loadpoints):void 0,detailsFmt:t.detailsFmt,detailsTooltip:t.detailsTooltip(n.tariffPriceLoadpoints,n.tariffCo2Loadpoints),"data-testid":"energyflow-entry-loadpoints"},null,8,["name","iconProps","power","powerUnit","details","detailsFmt","detailsTooltip"]),n.batteryConfigured?(s(),b(u,{key:1,name:t.batteryChargeLabel,icon:"battery",power:t.batteryCharge,powerTooltip:t.batteryChargeTooltip,powerUnit:t.powerUnit,iconProps:{hold:t.batteryHold,soc:n.batterySoc,gridCharge:n.batteryGridChargeActive},details:n.batterySoc,detailsFmt:t.batteryFmt,detailsClickable:"",onDetailsClicked:t.openBatterySettingsModal},fe({_:2},[t.batteryGridChargeLimitSet?{name:"subline",fn:P(()=>[a("button",{type:"button",class:"btn-reset d-flex justify-content-between text-start pe-4",onClick:i[0]||(i[0]=Q((...p)=>t.openBatterySettingsModal&&t.openBatterySettingsModal(...p),["stop"]))},[n.batteryGridChargeActive?(s(),o("span",$i,[T(c(e.$t("main.energyflow.batteryGridChargeActive"))+" ",1),a("span",Bi,[i[8]||(i[8]=T("(≤ ")),a("u",null,c(t.batteryGridChargeLimitFmt),1),i[9]||(i[9]=T(")"))])])):(s(),o("span",Vi,[T(c(e.$t("main.energyflow.batteryGridChargeLimit"))+" ",1),a("span",Mi,[i[10]||(i[10]=T("≤ ")),a("u",null,c(t.batteryGridChargeLimitFmt),1)])]))])]),key:"0"}:void 0]),1032,["name","power","powerTooltip","powerUnit","iconProps","details","detailsFmt","onDetailsClicked"])):g("",!0),t.pvPossible?(s(),b(u,{key:2,name:e.$t("main.energyflow.pvExport"),icon:"powersupply",power:t.pvExport,powerUnit:t.powerUnit,details:t.detailsValue(-n.tariffFeedIn),detailsFmt:t.detailsFmt,detailsTooltip:t.detailsTooltip(-n.tariffFeedIn),"data-testid":"energyflow-entry-gridexport"},null,8,["name","power","powerUnit","details","detailsFmt","detailsTooltip"])):g("",!0)])])],512)],6)],2)}const be=v(gi,[["render",Ei],["__scopeId","data-v-6d0fa24b"]]);var Di='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><style></style><g id="Your_Icons"><path d="M0 0h48v48H0z" fill="none"/><path d="M24 40c-8.822 0-16-7.178-16-16S15.178 8 24 8s16 7.178 16 16-7.178 16-16 16z"/></g></svg>';class Ri extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Di}}window.customElements.define("shopicon-filled-circle",Ri);var Oi='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><style></style><g id="Your_Icons"><path d="M0 0h48v48H0z" fill="none"/><path d="M24 40.5c-9.098 0-16.5-7.402-16.5-16.5S14.902 7.5 24 7.5c9.098 0 16.5 7.402 16.5 16.5S33.098 40.5 24 40.5zm0-28c-6.341 0-11.5 5.159-11.5 11.5S17.659 35.5 24 35.5 35.5 30.341 35.5 24 30.341 12.5 24 12.5z"/></g></svg>';class Ui extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Oi}}window.customElements.define("shopicon-bold-circle",Ui);var Fi='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><style></style><g id="Your_Icons"><path d="M0 0h48v48H0V0z" fill="none"/><path d="M24.788 4.065a2 2 0 00-2.25.956l-11.282 20.11a2 2 0 001.745 2.978h8.282V42a2 2 0 003.827.813 552.532 552.532 0 0010.037-24.088A2 2 0 0033.282 16h-7V6a2 2 0 00-1.494-1.935z" id="Shopicon"/></g></svg>';class qi extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Fi}}window.customElements.define("shopicon-filled-lightning",qi);const Wi={name:"Mode",props:{mode:String,pvPossible:Boolean,hasSmartCost:Boolean},emits:["updated"],computed:{modes:function(){return this.pvPossible?["off","pv","minpv","now"]:this.hasSmartCost?["off","pv","now"]:["off","now"]}},methods:{label:function(e){return e==="pv"&&!this.pvPossible&&this.hasSmartCost?this.$t("main.mode.smart"):this.$t("main.mode.".concat(e))},isActive:function(e){return this.mode===e},setTargetMode:function(e){this.$emit("updated",e)}}},Hi={class:"mode-group border d-inline-flex",role:"group","data-testid":"mode"},ji=["onClick"];function zi(e,i,n,d,r,t){return s(),o("div",Hi,[(s(!0),o(I,null,A(t.modes,l=>(s(),o("button",{key:l,type:"button",class:y(["btn flex-grow-1 flex-shrink-1",{active:t.isActive(l)}]),tabindex:"0",onClick:h=>t.setTargetMode(l)},c(t.label(l)),11,ji))),128))])}const ye=v(Wi,[["render",zi],["__scopeId","data-v-ef5515c5"]]),Gi={name:"LabelAndValue",components:{AnimatedNumber:W},props:{label:String,value:[Number,String],valueFmt:Function,extraValue:String,align:{type:String,default:"center"}},computed:{labelClass(){return"text-".concat(this.align)},valueClass(){return"justify-content-".concat(this.align)}}},Ki={class:"root"},Zi={key:1},Yi={key:2,class:"extraValue text-nowrap"};function Qi(e,i,n,d,r,t){const l=m("AnimatedNumber");return s(),o("div",Ki,[a("div",{class:y(["mb-2 label",t.labelClass])},[Z(e.$slots,"label",{},()=>[T(c(n.label),1)],!0)],2),Z(e.$slots,"default",{},()=>[a("h3",{class:y(["value m-0",t.valueClass])},[Z(e.$slots,"value",{},()=>[n.valueFmt?(s(),b(l,{key:0,to:n.value,format:n.valueFmt},null,8,["to","format"])):(s(),o("span",Zi,c(n.value),1)),n.extraValue!=null?(s(),o("div",Yi,c(n.extraValue||" "),1)):g("",!0)],!0)],2)],!0)])}const z=v(Gi,[["render",Qi],["__scopeId","data-v-668231f2"]]),Ji={name:"VehicleTitle",components:{VehicleOptions:ve,VehicleIcon:se,Sync:Je,CloudOffline:Qe},mixins:[F],props:{connected:Boolean,id:[String,Number],vehicleDetectionActive:Boolean,vehicleNotReachable:Boolean,icon:String,vehicleName:String,vehicles:{type:Array,default:()=>[]},title:String},emits:["change-vehicle","remove-vehicle"],data:function(){return{refreshTooltip:null,notReachableTooltip:null}},computed:{iconType(){return this.vehicleDetectionActive?"refresh":this.connected?"vehicle":null},name(){return this.title?this.title:this.connected?this.$t("main.vehicle.unknown"):this.$t("main.vehicle.none")},vehicleKnown(){return!!this.vehicleName},showOptions(){return this.vehicleKnown||this.vehicles.length},vehicleOptionsProps:function(){return this.collectProps(ve)}},watch:{iconType:function(){this.initTooltip()}},mounted:function(){this.initTooltip()},methods:{changeVehicle(e){this.$emit("change-vehicle",e)},removeVehicle(){this.$emit("remove-vehicle")},initTooltip(){this.$nextTick(()=>{var e,i;(e=this.refreshTooltip)==null||e.dispose(),(i=this.notReachableTooltip)==null||i.dispose(),this.$refs.refresh&&(this.refreshTooltip=new J(this.$refs.refresh)),this.$refs.notReachable&&(this.notReachableTooltip=new J(this.$refs.notReachable))})},openHelpModal(){q.getOrCreateInstance(document.getElementById("helpModal")).show(),this.initTooltip()}}},Xi={class:"d-flex justify-content-between mb-3 align-items-center","data-testid":"vehicle-title"},en={class:"d-flex align-items-center m-0 flex-grow-1 overflow-hidden"},tn=["title"],nn={key:2,class:"me-2 flex-shrink-0"},an={class:"flex-grow-1 text-truncate vehicle-name","data-testid":"vehicle-name"},sn={key:4,class:"flex-grow-1 text-truncate vehicle-name","data-testid":"vehicle-name"},on=["title"];function rn(e,i,n,d,r,t){const l=m("Sync"),h=m("VehicleIcon"),u=m("VehicleOptions"),p=m("CloudOffline");return s(),o("div",Xi,[a("h4",en,[t.iconType==="refresh"?(s(),o("div",{key:0,ref:"refresh",class:"me-2 flex-shrink-0 spin",title:e.$t("main.vehicle.detectionActive"),"data-bs-toggle":"tooltip"},[f(l)],8,tn)):t.iconType==="vehicle"?(s(),b(h,{key:1,name:n.icon,class:"me-2 flex-shrink-0"},null,8,["name"])):(s(),o("shopicon-regular-cablecharge",nn)),t.showOptions?(s(),b(u,k({key:3},t.vehicleOptionsProps,{id:n.id,class:"options",selected:n.vehicleName,onChangeVehicle:t.changeVehicle,onRemoveVehicle:t.removeVehicle}),{default:P(()=>[a("span",an,c(t.name),1)]),_:1},16,["id","selected","onChangeVehicle","onRemoveVehicle"])):(s(),o("span",sn,c(t.name),1)),n.vehicleNotReachable?(s(),o("button",{key:5,ref:"notReachable",class:"ms-2 btn-neutral","data-bs-toggle":"tooltip",title:e.$t("main.vehicle.notReachable"),type:"button","data-testid":"vehicle-not-reachable-icon",onClick:i[0]||(i[0]=(...S)=>t.openHelpModal&&t.openHelpModal(...S))},[f(p,{class:"evcc-gray"})],8,on)):g("",!0)])])}const _e=v(Ji,[["render",rn],["__scopeId","data-v-c114fed5"]]),ln={name:"VehicleSoc",mixins:[C],props:{connected:Boolean,vehicleSoc:Number,vehicleLimitSoc:Number,enabled:Boolean,charging:Boolean,heating:Boolean,minSoc:Number,effectivePlanSoc:Number,effectiveLimitSoc:Number,limitEnergy:Number,planEnergy:Number,chargedEnergy:Number,socBasedCharging:Boolean,socBasedPlanning:Boolean},emits:["limit-soc-drag","limit-soc-updated","plan-clicked"],data:function(){return{selectedLimitSoc:null,interactionStartScreenY:null,tooltip:null,dragging:!1}},computed:{step:function(){return this.heating?1:5},vehicleSocDisplayWidth:function(){return this.socBasedCharging?this.vehicleSoc>=0?this.vehicleSoc:100:this.maxEnergy?100/this.maxEnergy*(this.chargedEnergy/1e3):100},transition:function(){return this.dragging?{transition:"none"}:{transition:"width var(--evcc-transition-fast) linear"}},maxEnergy:function(){return Math.max(this.planEnergy,this.limitEnergy,this.chargedEnergy/1e3)},vehicleLimitSocActive:function(){return this.vehicleLimitSoc>0&&this.vehicleLimitSoc>this.vehicleSoc},planMarkerPosition:function(){if(this.socBasedPlanning)return this.effectivePlanSoc;const e=Math.max(this.planEnergy,this.limitEnergy);return e?100/e*this.planEnergy:0},planMarkerAvailable:function(){return this.socBasedCharging&&!this.socBasedPlanning?!1:this.planMarkerPosition>0},energyLimitMarkerPosition:function(){return this.socBasedCharging?null:this.limitEnergy?100/this.maxEnergy*this.limitEnergy:100},energyLimitMarkerActive:function(){return this.socBasedCharging?!1:this.planEnergy?this.limitEnergy>=this.planEnergy:!0},sliderActive:function(){const e=this.visibleLimitSoc<=(this.vehicleLimitSoc||100),i=this.visibleLimitSoc>=(this.effectivePlanSoc||0);return e&&i},progressColor:function(){return this.minSocActive?"bg-danger":"bg-primary"},minSocActive:function(){return this.minSoc>0&&this.vehicleSoc<this.minSoc},remainingSocWidth:function(){if(this.socBasedCharging){if(this.vehicleSocDisplayWidth===100)return null;if(this.minSocActive)return this.minSoc-this.vehicleSoc;const e=Math.min(this.vehicleLimitSoc||100,Math.max(this.visibleLimitSoc,this.effectivePlanSoc||0));if(e>this.vehicleSoc)return e-this.vehicleSoc}else return 100-this.vehicleSocDisplayWidth;return null},visibleLimitSoc:function(){return Number(this.selectedLimitSoc||this.effectiveLimitSoc)}},watch:{effectiveLimitSoc:function(){this.selectedLimitSoc=this.effectiveLimitSoc},vehicleLimitSoc:function(){this.updateTooltip()}},mounted:function(){this.updateTooltip()},methods:{changeLimitSocStart:function(e){this.dragging=!0,e.stopPropagation()},changeLimitSocEnd:function(e){this.dragging=!1;const i=parseInt(e.target.value,10);i!==this.effectiveLimitSoc&&this.$emit("limit-soc-updated",i)},movedLimitSoc:function(e){const i=parseInt(e.target.value,10);e.stopPropagation();const n=20;return i<n?(e.target.value=n,this.selectedLimitSoc=i,e.preventDefault(),!1):(this.selectedLimitSoc=i,this.$emit("limit-soc-drag",this.selectedLimitSoc),!0)},updateTooltip:function(){this.tooltip||(this.tooltip=new J(this.$refs.vehicleLimitSoc));const e=this.vehicleLimitSoc,i=this.$t("main.vehicleSoc.vehicleLimit",{soc:this.fmtPercentage(e)});this.tooltip.setContent({".tooltip-inner":i})}}},cn={class:"vehicle-soc"},dn={class:"progress"},un={class:"target"},hn=["step","value"];function mn(e,i,n,d,r,t){return s(),o("div",cn,[a("div",dn,[n.connected?(s(),o("div",{key:0,class:y(["progress-bar",{[t.progressColor]:!0,"progress-bar-striped":n.charging,"progress-bar-animated":n.charging}]),role:"progressbar",style:w({width:"".concat(t.vehicleSocDisplayWidth,"%"),...t.transition})},null,6)):g("",!0),t.remainingSocWidth>0&&n.enabled&&n.connected?(s(),o("div",{key:1,class:y(["progress-bar bg-muted",t.progressColor]),role:"progressbar",style:w({width:"".concat(t.remainingSocWidth,"%"),...t.transition})},null,6)):g("",!0),N(a("div",{ref:"vehicleLimitSoc",class:y(["vehicle-limit-soc",{"vehicle-limit-soc--active":t.vehicleLimitSocActive}]),"data-bs-toggle":"tooltip",title:" ",style:w({left:"".concat(n.vehicleLimitSoc,"%")})},null,6),[[K,n.vehicleLimitSoc]]),N(a("div",{class:y(["energy-limit-marker",{"energy-limit-marker--active":t.energyLimitMarkerActive,"energy-limit-marker--visible":t.energyLimitMarkerPosition<100}]),"data-bs-toggle":"tooltip",style:w({left:"".concat(t.energyLimitMarkerPosition,"%")})},null,6),[[K,t.energyLimitMarkerPosition]]),N(a("div",{class:"plan-marker","data-bs-toggle":"tooltip",style:w({left:"".concat(t.planMarkerPosition,"%")}),"data-testid":"plan-marker",onClick:i[0]||(i[0]=l=>e.$emit("plan-clicked"))},i[6]||(i[6]=[a("shopicon-regular-clock",null,null,-1)]),4),[[K,t.planMarkerAvailable]])]),a("div",un,[n.socBasedCharging&&n.connected?(s(),o("input",{key:0,type:"range",min:"0",max:"100",step:t.step,value:t.visibleLimitSoc,class:y(["slider",{"slider--active":t.sliderActive}]),onMousedown:i[1]||(i[1]=(...l)=>t.changeLimitSocStart&&t.changeLimitSocStart(...l)),onTouchstart:i[2]||(i[2]=(...l)=>t.changeLimitSocStart&&t.changeLimitSocStart(...l)),onInput:i[3]||(i[3]=(...l)=>t.movedLimitSoc&&t.movedLimitSoc(...l)),onMouseup:i[4]||(i[4]=(...l)=>t.changeLimitSocEnd&&t.changeLimitSocEnd(...l)),onTouchend:i[5]||(i[5]=(...l)=>t.changeLimitSocEnd&&t.changeLimitSocEnd(...l))},null,42,hn)):g("",!0)])])}const Se=v(ln,[["render",mn],["__scopeId","data-v-00c44b1b"]]),fn={name:"Climater",mixins:[V]};function gn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 24 24"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M10.6 22q-1.275 0-1.937-.763T8 19.5q0-.65.288-1.263t.887-1.012q.55-.35.888-.9t.462-1.175l-.3-.15q-.15-.075-.275-.175l-2.3.825q-.425.15-.825.25T6 16q-1.575 0-2.788-1.375T2 10.6q0-1.275.763-1.937T4.475 8q.65 0 1.275.288t1.025.887q.35.55.9.887t1.175.463l.15-.3q.075-.15.175-.275l-.825-2.3q-.15-.425-.25-.825t-.1-.8q0-1.6 1.375-2.813T13.4 2q1.275 0 1.938.763T16 4.475q0 .65-.288 1.275t-.887 1.025q-.55.35-.887.9t-.463 1.175l.3.15q.15.075.275.175l2.3-.85q.425-.15.813-.237T17.975 8Q20 8 21 9.675t1 3.725q0 1.275-.8 1.938T19.425 16q-.625 0-1.213-.288t-.987-.887q-.35-.55-.9-.887t-1.175-.463l-.15.3q-.075.15-.175.275l.825 2.3q.15.4.25.763t.1.762q.025 1.625-1.35 2.875T10.6 22m1.4-8.5q.625 0 1.062-.437T13.5 12t-.437-1.062T12 10.5t-1.062.438T10.5 12t.438 1.063T12 13.5m-1.15-4.8q.15-.05.313-.088t.312-.062q.2-1.05.763-1.95t1.487-1.5q.125-.1.2-.25T14 4.475q0-.2-.15-.337T13.4 4q-.95 0-2.15.413T10 6.025q0 .225.063.425t.112.375zM6 14q.35 0 .825-.175L8.7 13.15q-.05-.15-.088-.313t-.062-.312q-1.05-.2-1.95-.763t-1.5-1.487q-.1-.125-.262-.2T4.475 10q-.225 0-.35.15T4 10.6q0 1.35.513 2.375T6 14m4.6 6q1.175 0 2.313-.475T14 17.875q0-.2-.062-.375t-.113-.325L13.15 15.3q-.15.05-.312.088t-.313.062q-.2 1.05-.763 1.95t-1.487 1.5q-.125.1-.213.263T10 19.5q.025.2.15.35t.45.15m8.825-6q.225 0 .4-.125T20 13.4q0-.95-.4-2.162T17.975 10q-.225 0-.425.05t-.375.1l-1.875.7q.05.15.088.313t.062.312q1.05.2 1.95.763t1.5 1.487q.075.125.225.2t.3.075m-6.9 1.45"},null,-1)]),4)}const pn=v(fn,[["render",gn]]),vn={name:"PlanStart",mixins:[V]};function bn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 24 24"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M3 18q-.425 0-.712-.288T2 17V7q0-.425.288-.712T3 6t.713.288T4 7v10q0 .425-.288.713T3 18m15.175-5H7q-.425 0-.712-.288T6 12t.288-.712T7 11h11.175L15.3 8.1q-.275-.275-.288-.687T15.3 6.7q.275-.275.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.687.275T15.3 17.3q-.3-.3-.3-.712t.3-.713z"},null,-1)]),4)}const yn=v(vn,[["render",bn]]),_n={name:"Reconnect",mixins:[V]};function Sn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 32 32"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M5.505,24.609c-0.595,-0.935 -0.94,-2.041 -0.94,-3.222c-0,-1.632 0.661,-3.198 1.831,-4.336l1.995,-1.994c0.52,-0.521 1.364,-0.521 1.885,0l0.391,0.391l1.724,-1.724c0.52,-0.52 1.365,-0.52 1.885,-0c0.52,0.52 0.52,1.365 0,1.885l-1.724,1.724l2.115,2.115l1.724,-1.724c0.52,-0.52 1.365,-0.52 1.885,-0c0.52,0.52 0.52,1.365 0,1.885l-1.724,1.724l0.391,0.391c0.521,0.521 0.521,1.365 -0,1.885c-0,0 -1.994,1.995 -1.994,1.995c-1.138,1.17 -2.704,1.831 -4.336,1.831c-1.181,0 -2.287,-0.345 -3.222,-0.94l-2.448,2.448c-0.521,0.52 -1.365,0.52 -1.886,-0c-0.52,-0.521 -0.52,-1.365 0,-1.886l2.448,-2.448Zm4.219,-6.333l-0.391,-0.39l-1.057,1.057c-0.005,0.005 -0.01,0.01 -0.015,0.015c-0.658,0.637 -1.03,1.514 -1.03,2.429c0,0.797 0.282,1.533 0.75,2.114c0.106,0.059 0.205,0.133 0.295,0.223c0.09,0.09 0.164,0.189 0.223,0.295c0.581,0.468 1.317,0.75 2.114,0.75c0.915,-0 1.792,-0.372 2.429,-1.03c0.005,-0.005 0.01,-0.01 0.015,-0.015c0,-0 1.057,-1.057 1.057,-1.057l-4.39,-4.391Zm14.885,-12.771l2.448,-2.448c0.521,-0.52 1.365,-0.52 1.886,0c0.52,0.521 0.52,1.365 -0,1.886l-2.448,2.448c0.595,0.935 0.94,2.041 0.94,3.222c0,1.632 -0.661,3.198 -1.831,4.336l-1.995,1.994c-0.52,0.521 -1.364,0.521 -1.885,-0l-6.667,-6.667c-0.521,-0.521 -0.521,-1.365 0,-1.885c0,-0 1.994,-1.995 1.994,-1.995c1.138,-1.17 2.704,-1.831 4.336,-1.831c1.181,-0 2.287,0.345 3.222,0.94Zm-0.59,2.994c-0.106,-0.059 -0.205,-0.133 -0.295,-0.223c-0.09,-0.09 -0.164,-0.189 -0.223,-0.295c-0.581,-0.468 -1.317,-0.75 -2.114,-0.75c-0.915,0 -1.792,0.372 -2.429,1.03c-0.005,0.005 -0.01,0.01 -0.015,0.015c-0,0 -1.057,1.057 -1.057,1.057l4.781,4.781l1.057,-1.057c0.005,-0.005 0.01,-0.01 0.015,-0.015c0.658,-0.637 1.03,-1.514 1.03,-2.429c-0,-0.797 -0.282,-1.533 -0.75,-2.114Z"},null,-1),a("path",{fill:"currentColor",d:"M25.333,20l0.781,-0l-0.39,-0.391c-0.52,-0.52 -0.52,-1.365 -0,-1.885c0.52,-0.52 1.365,-0.52 1.885,-0l2.667,2.667c0.387,0.386 0.492,0.962 0.289,1.453c-0.066,0.161 -0.164,0.308 -0.289,0.432l-2.667,2.667c-0.52,0.52 -1.365,0.52 -1.885,-0c-0.52,-0.521 -0.52,-1.365 -0,-1.886l0.39,-0.39l-0.781,-0c-1.463,-0 -2.666,1.203 -2.666,2.666c-0,1.463 1.203,2.667 2.666,2.667c0.656,-0 1.289,-0.242 1.778,-0.679c0.549,-0.491 1.392,-0.444 1.883,0.105c0.49,0.548 0.443,1.392 -0.105,1.882c-0.978,0.875 -2.244,1.359 -3.556,1.359c-2.926,-0 -5.333,-2.408 -5.333,-5.334c-0,-2.925 2.408,-5.333 5.333,-5.333Z"},null,-1)]),4)}const wn=v(_n,[["render",Sn]]),Pn={name:"RfidWait",mixins:[V]};function Cn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 32 32"},i[0]||(i[0]=[a("path",{d:"M26.667,26.667l-5.4,-0c-0.378,-0 -0.695,-0.128 -0.95,-0.384c-0.255,-0.256 -0.383,-0.573 -0.384,-0.95c-0.001,-0.377 0.127,-0.693 0.384,-0.949c0.257,-0.256 0.574,-0.384 0.95,-0.384l5.4,0l-0,-5.333c-0,-0.378 0.128,-0.695 0.384,-0.95c0.256,-0.255 0.572,-0.383 0.949,-0.384c0.377,-0.001 0.694,0.127 0.951,0.384c0.257,0.257 0.384,0.574 0.382,0.95l0,5.333c0,0.733 -0.261,1.361 -0.782,1.884c-0.522,0.523 -1.15,0.784 -1.884,0.783m-22.667,-17.134c-0.378,0 -0.694,-0.128 -0.949,-0.384c-0.255,-0.256 -0.383,-0.572 -0.384,-0.949l-0,-0.2c-0,-0.733 0.261,-1.361 0.784,-1.883c0.522,-0.521 1.15,-0.783 1.882,-0.784l8,0c0.378,0 0.695,0.128 0.951,0.384c0.256,0.256 0.384,0.573 0.383,0.95c-0.001,0.377 -0.129,0.693 -0.384,0.95c-0.255,0.257 -0.572,0.385 -0.95,0.383l-8,-0l0,0.2c0,0.378 -0.128,0.695 -0.384,0.951c-0.256,0.256 -0.572,0.383 -0.949,0.382m0.667,17.134c-0.556,-0 -1.028,-0.195 -1.416,-0.583c-0.389,-0.388 -0.583,-0.861 -0.584,-1.417c-0.001,-0.557 0.193,-1.029 0.584,-1.416c0.39,-0.388 0.862,-0.583 1.416,-0.584c0.553,-0.002 1.026,0.193 1.417,0.584c0.391,0.391 0.585,0.863 0.583,1.416c-0.003,0.553 -0.197,1.025 -0.583,1.417c-0.386,0.392 -0.858,0.586 -1.417,0.583m6,-0c-0.356,-0 -0.667,-0.106 -0.934,-0.318c-0.266,-0.211 -0.433,-0.494 -0.5,-0.849c-0.244,-1.4 -0.872,-2.589 -1.882,-3.567c-1.011,-0.977 -2.217,-1.589 -3.618,-1.833c-0.333,-0.044 -0.594,-0.205 -0.782,-0.483c-0.189,-0.277 -0.283,-0.594 -0.284,-0.95c-0,-0.378 0.117,-0.695 0.35,-0.95c0.234,-0.255 0.517,-0.361 0.85,-0.317c2.089,0.267 3.877,1.144 5.366,2.633c1.489,1.489 2.378,3.278 2.667,5.367c0.044,0.356 -0.056,0.656 -0.3,0.9c-0.244,0.244 -0.556,0.367 -0.933,0.367m5.333,-0c-0.378,-0 -0.694,-0.123 -0.949,-0.367c-0.255,-0.244 -0.406,-0.556 -0.451,-0.933c-0.311,-2.845 -1.472,-5.256 -3.483,-7.234c-2.01,-1.977 -4.438,-3.111 -7.284,-3.4c-0.355,-0.044 -0.639,-0.2 -0.85,-0.466c-0.212,-0.267 -0.317,-0.578 -0.316,-0.934c-0,-0.377 0.117,-0.7 0.35,-0.966c0.234,-0.267 0.517,-0.378 0.85,-0.334c3.577,0.289 6.622,1.684 9.133,4.184c2.511,2.501 3.933,5.528 4.267,9.083c0.044,0.378 -0.061,0.7 -0.316,0.967c-0.255,0.266 -0.572,0.4 -0.951,0.4",fill:"currentColor"},null,-1),a("path",{d:"M23.989,14.594c-1.844,-0 -3.416,-0.651 -4.716,-1.951c-1.3,-1.3 -1.95,-2.872 -1.951,-4.716c-0.001,-1.844 0.65,-3.416 1.951,-4.716c1.301,-1.3 2.873,-1.951 4.716,-1.951c1.843,0 3.415,0.651 4.717,1.951c1.303,1.3 1.952,2.872 1.95,4.716c-0.003,1.844 -0.653,3.416 -1.951,4.717c-1.298,1.302 -2.87,1.951 -4.716,1.95m0.667,-6.934l-0,-3.066c-0,-0.178 -0.067,-0.334 -0.2,-0.467c-0.134,-0.133 -0.289,-0.2 -0.467,-0.2c-0.178,-0 -0.333,0.067 -0.467,0.2c-0.133,0.133 -0.2,0.289 -0.2,0.467l0,3.033c0,0.178 0.034,0.35 0.1,0.517c0.067,0.167 0.167,0.317 0.3,0.45l2,2c0.134,0.133 0.289,0.2 0.467,0.2c0.178,-0 0.333,-0.067 0.467,-0.2c0.133,-0.134 0.2,-0.289 0.2,-0.467c-0,-0.178 -0.067,-0.333 -0.2,-0.467l-2,-2Z",fill:"currentColor"},null,-1)]),4)}const Tn=v(Pn,[["render",Cn]]),kn={name:"SunDown",mixins:[V]};function In(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 48 48"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M14.216 26.071A9.953 9.953 0 0 1 14 24c0-5.514 4.486-10 10-10s10 4.486 10 10c0 .71-.074 1.403-.216 2.071h-4.152A6.006 6.006 0 0 0 24 18a6.006 6.006 0 0 0-5.632 8.071h-4.152ZM22 4h4v6h-4zM4 22h6v4H4zM38 22h6v4h-6zM15.732 5.68l3 5.196-3.464 2-3-5.196 3.464-2ZM40.321 12.269l2 3.466-5.196 2.999-2-3.465 5.196-3ZM7.679 12.267l5.197 2.999-2 3.466-5.197-3 2-3.465ZM32.269 5.68l3.465 2.001-3 5.195-3.465-2.001 3-5.195Z"},null,-1),a("path",{fill:"currentColor",d:"M26.044 36.261V28h-4.088v8.261l-3.066-3.033L16 36.087 24 44l8-7.913-2.89-2.859-3.066 3.033Z",style:{"fill-rule":"nonzero"}},null,-1)]),4)}const xn=v(kn,[["render",In]]),Ln={name:"SunUp",mixins:[V]};function An(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 48 48"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M14.216 26.071A9.953 9.953 0 0 1 14 24c0-5.514 4.486-10 10-10s10 4.486 10 10c0 .71-.074 1.403-.216 2.071h-4.152A6.006 6.006 0 0 0 24 18a6.006 6.006 0 0 0-5.632 8.071h-4.152ZM22 4h4v6h-4zM4 22h6v4H4zM38 22h6v4h-6zM15.732 5.68l3 5.196-3.464 2-3-5.196 3.464-2ZM40.321 12.269l2 3.466-5.196 2.999-2-3.465 5.196-3ZM7.679 12.267l5.197 2.999-2 3.466-5.197-3 2-3.465ZM32.269 5.68l3.465 2.001-3 5.195-3.465-2.001 3-5.195Z"},null,-1),a("path",{fill:"currentColor",d:"M21.956 35.739V44h4.088v-8.261l3.066 3.033L32 35.913 24 28l-8 7.913 2.89 2.859 3.066-3.033Z",style:{"fill-rule":"nonzero"}},null,-1)]),4)}const He=v(Ln,[["render",An]]),Nn={name:"VehicleLimit",mixins:[V]};function $n(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 24 24"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M6 19v1q0 .425-.288.713T5 21H4q-.425 0-.712-.288T3 20v-8l2.1-6q.15-.45.538-.725T6.5 5h11q.475 0 .863.275T18.9 6l2.1 6v8q0 .425-.287.713T20 21h-1q-.425 0-.712-.288T18 20v-1zm-.2-9h12.4l-1.05-3H6.85zM5 12v5zm2.5 4q.625 0 1.063-.437T9 14.5t-.437-1.062T7.5 13t-1.062.438T6 14.5t.438 1.063T7.5 16m9 0q.625 0 1.063-.437T18 14.5t-.437-1.062T16.5 13t-1.062.438T15 14.5t.438 1.063T16.5 16M5 17h14v-5H5z"},null,-1)]),4)}const we=v(Nn,[["render",$n]]),Bn={name:"VehicleLimitReached",mixins:[V]};function Vn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 32 32"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M5.333,24l18.667,0l0,-5.433c0.467,-0.067 0.922,-0.167 1.367,-0.3c0.444,-0.134 0.877,-0.3 1.3,-0.5l-0,10.233c-0,0.378 -0.128,0.695 -0.384,0.951c-0.256,0.256 -0.573,0.383 -0.95,0.382l-1.333,0c-0.378,0 -0.694,-0.128 -0.949,-0.384c-0.255,-0.256 -0.383,-0.572 -0.384,-0.949l-0,-1.333l-16,-0l-0,1.333c-0,0.378 -0.128,0.695 -0.384,0.951c-0.256,0.256 -0.573,0.383 -0.95,0.382l-1.333,0c-0.378,0 -0.694,-0.128 -0.949,-0.384c-0.255,-0.256 -0.383,-0.572 -0.384,-0.949l-0,-10.667l2.8,-8c0.133,-0.4 0.372,-0.722 0.717,-0.966c0.345,-0.245 0.728,-0.367 1.149,-0.367l6.1,0c-0.066,0.444 -0.1,0.889 -0.1,1.333c0,0.445 0.034,0.889 0.1,1.334l-5.633,-0l-1.4,4l8.633,-0c0.378,0.533 0.8,1.028 1.267,1.484c0.467,0.456 0.989,0.85 1.567,1.182l-12.534,0l0,6.667Zm15.334,-1.333c-0.552,0.003 -1.024,-0.191 -1.416,-0.583c-0.392,-0.392 -0.587,-0.864 -0.584,-1.417c0.002,-0.553 0.197,-1.025 0.584,-1.416c0.386,-0.391 0.858,-0.586 1.416,-0.584c0.557,0.001 1.029,0.196 1.417,0.584c0.388,0.387 0.582,0.859 0.583,1.416c0.001,0.556 -0.194,1.029 -0.583,1.417c-0.389,0.388 -0.862,0.583 -1.417,0.583Zm-12,-0c-0.552,0.003 -1.024,-0.191 -1.416,-0.583c-0.392,-0.392 -0.587,-0.864 -0.584,-1.417c0.002,-0.553 0.197,-1.025 0.584,-1.416c0.386,-0.391 0.858,-0.586 1.416,-0.584c0.557,0.001 1.029,0.196 1.417,0.584c0.388,0.387 0.582,0.859 0.583,1.416c0.001,0.556 -0.194,1.029 -0.583,1.417c-0.389,0.388 -0.862,0.583 -1.417,0.583Zm13.968,-20.009c1.844,-0 3.417,0.65 4.717,1.95c1.301,1.301 1.95,2.873 1.949,4.716c-0,1.844 -0.651,3.416 -1.95,4.718c-1.3,1.301 -2.872,1.951 -4.716,1.949c-1.845,-0.002 -3.417,-0.652 -4.716,-1.951c-1.3,-1.298 -1.95,-2.87 -1.951,-4.716c-0.001,-1.845 0.649,-3.417 1.951,-4.716c1.301,-1.298 2.873,-1.948 4.716,-1.95Zm-0.934,9.666l4.734,-4.733l-1,-1l-3.734,3.733l-1.866,-1.866l-1,1l2.866,2.866Z"},null,-1)]),4)}const Mn=v(Bn,[["render",Vn]]),En={name:"VehicleLimitWarning",mixins:[V]};function Dn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 24 24"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M4 18v-5zm-2-5l2.1-6q.15-.45.538-.725T5.5 6h4.575Q10 6.5 10 7t.075 1H5.85L4.8 11h6.475q.425.6.95 1.113T13.4 13H4v5h14v-4.075q.525-.075 1.025-.225t.975-.375V21q0 .425-.288.713T19 22h-1q-.425 0-.712-.288T17 21v-1H5v1q0 .425-.288.713T4 22H3q-.425 0-.712-.288T2 21zm13.5 4q.625 0 1.063-.437T17 15.5t-.437-1.062T15.5 14t-1.062.438T14 15.5t.438 1.063T15.5 17m-9 0q.625 0 1.063-.437T8 15.5t-.437-1.062T6.5 14t-1.062.438T5 15.5t.438 1.063T6.5 17M17 12q-2.075 0-3.537-1.463T12 7q0-2.05 1.45-3.525T17 2q2.075 0 3.538 1.462T22 7t-1.463 3.538T17 12m-.5-4h1V4h-1zm.5 2q.2 0 .35-.15t.15-.35t-.15-.35T17 9t-.35.15t-.15.35t.15.35t.35.15"},null,-1)]),4)}const Rn=v(En,[["render",Dn]]),On={name:"VehicleMinSoc",mixins:[V]};function Un(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 32 32"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M8,20.167l0,0.666c0,0.556 -0.194,1.028 -0.583,1.418c-0.388,0.389 -0.861,0.583 -1.417,0.582c-0.556,-0.001 -1.028,-0.195 -1.416,-0.582c-0.388,-0.388 -0.582,-0.86 -0.584,-1.418l0,-9.533c0,-0.156 0.011,-0.311 0.033,-0.467c0.023,-0.155 0.056,-0.3 0.1,-0.433l2.5,-7.1c0.178,-0.533 0.5,-0.967 0.967,-1.3c0.467,-0.333 0.989,-0.5 1.567,-0.5l13.666,-0c0.578,-0 1.1,0.167 1.567,0.5c0.467,0.333 0.789,0.767 0.967,1.3l2.5,7.1c0.044,0.133 0.077,0.278 0.1,0.433c0.022,0.156 0.033,0.311 0.033,0.467l0,9.533c0,0.556 -0.194,1.028 -0.583,1.418c-0.388,0.389 -0.861,0.583 -1.417,0.582c-0.556,-0.001 -1.028,-0.195 -1.416,-0.582c-0.388,-0.388 -0.582,-0.86 -0.584,-1.418l0,-0.666l-16,-0Zm-0.267,-12l16.534,-0l-1.4,-4l-13.734,-0l-1.4,4Zm-1.066,2.666l-0,6.667l-0,-6.667Zm3.333,5.334c0.556,-0 1.028,-0.195 1.417,-0.583c0.39,-0.388 0.584,-0.861 0.583,-1.417c-0.001,-0.557 -0.195,-1.029 -0.583,-1.416c-0.387,-0.388 -0.86,-0.583 -1.417,-0.584c-0.557,-0.002 -1.029,0.193 -1.416,0.584c-0.387,0.391 -0.581,0.863 -0.584,1.416c-0.003,0.553 0.192,1.025 0.584,1.417c0.392,0.392 0.864,0.586 1.416,0.583m12,-0c0.556,-0 1.028,-0.195 1.417,-0.583c0.39,-0.388 0.584,-0.861 0.583,-1.417c-0.001,-0.557 -0.195,-1.029 -0.583,-1.416c-0.387,-0.388 -0.86,-0.583 -1.417,-0.584c-0.557,-0.002 -1.029,0.193 -1.416,0.584c-0.387,0.391 -0.581,0.863 -0.584,1.416c-0.003,0.553 0.192,1.025 0.584,1.417c0.392,0.392 0.864,0.586 1.416,0.583m-15.333,1.333l18.666,0l0,-6.667l-18.666,0l-0,6.667Z",style:{"fill-rule":"nonzero"}},null,-1),a("path",{fill:"currentColor",d:"M23.267,25.167l0.666,-0c0.178,-0 0.334,0.066 0.467,0.2c0.133,0.133 0.2,0.289 0.2,0.466l0,1.334c0,0.177 -0.067,0.333 -0.2,0.466c-0.133,0.134 -0.289,0.2 -0.467,0.2l-0.666,0l-0,1.334c-0,0.377 -0.128,0.694 -0.384,0.95c-0.256,0.256 -0.573,0.384 -0.95,0.383l-12,-0c-0.377,-0 -0.694,-0.128 -0.95,-0.384c-0.256,-0.256 -0.384,-0.572 -0.383,-0.949l0,-5.334c0,-0.377 0.128,-0.694 0.384,-0.949c0.256,-0.255 0.572,-0.383 0.949,-0.384l12,-0c0.378,-0 0.695,0.128 0.95,0.384c0.255,0.256 0.383,0.572 0.384,0.949l-0,1.334Zm-12,-0l-0,2.666l-0,-2.666Zm1.54,-0l-0,2.666l7.793,0l0,-2.666l-7.793,-0Z",style:{"fill-rule":"nonzero"}},null,-1)]),4)}const Fn=v(On,[["render",Un]]),qn={name:"Welcome",mixins:[V]};function Wn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 24 24"},i[0]||(i[0]=[a("path",{fill:"currentColor",d:"M11.875 20q.1 0 .2-.05t.15-.1l8.2-8.2q.3-.3.438-.675t.137-.75q0-.4-.137-.763t-.438-.637l-4.25-4.25q-.275-.3-.638-.437T14.776 4q-.375 0-.75.138t-.675.437l-.275.275l1.85 1.875q.375.35.55.8t.175.95q0 1.05-.712 1.763t-1.763.712q-.5 0-.962-.175t-.813-.525L9.525 8.4L5.15 12.775q-.075.075-.112.163T5 13.125q0 .2.15.363t.35.162q.1 0 .2-.05t.15-.1l3.4-3.4l1.4 1.4l-3.375 3.4q-.075.075-.112.163t-.038.187q0 .2.15.35t.35.15q.1 0 .2-.05t.15-.1l3.4-3.375l1.4 1.4l-3.375 3.4q-.075.05-.112.15t-.038.2q0 .2.15.35t.35.15q.1 0 .188-.038t.162-.112l3.4-3.375l1.4 1.4l-3.4 3.4q-.075.075-.112.162t-.038.188q0 .2.163.35t.362.15m-.025 2q-.925 0-1.637-.612t-.838-1.538q-.85-.125-1.425-.7t-.7-1.425q-.85-.125-1.412-.712T5.15 15.6q-.95-.125-1.55-.825t-.6-1.65q0-.5.188-.962t.537-.813l5.8-5.775L12.8 8.85q.05.075.15.113t.2.037q.225 0 .375-.137t.15-.363q0-.1-.038-.2t-.112-.15L9.95 4.575q-.275-.3-.637-.437T8.55 4q-.375 0-.75.138t-.675.437L3.6 8.125q-.225.225-.375.525t-.2.6t0 .613t.2.587l-1.45 1.45q-.425-.575-.625-1.262T1 9.25t.35-1.362t.825-1.188L5.7 3.175Q6.3 2.6 7.038 2.3T8.55 2t1.513.3t1.312.875l.275.275l.275-.275q.6-.575 1.338-.875t1.512-.3t1.513.3t1.312.875L21.825 7.4q.575.575.875 1.325t.3 1.525t-.3 1.513t-.875 1.312l-8.2 8.175q-.35.35-.812.55t-.963.2M9.375 8"},null,-1)]),4)}const Hn=v(qn,[["render",Wn]]),jn={name:"BatteryBoost",mixins:[V]};function zn(e,i,n,d,r,t){return s(),o("svg",{style:w(e.svgStyle),viewBox:"0 0 48 48"},i[0]||(i[0]=[a("g",null,[a("path",{fill:"currentColor",d:"M35,9.996l-3,0l0,-4c0,-1.097 -0.903,-2 -2,-2l-12,0c-1.097,0 -2,0.903 -2,2l0,4l-3,0c-1.097,0 -2,0.903 -2,2l0,30c0,1.097 0.903,2 2,2l22,0c1.097,0 2,-0.903 2,-2l0,-30c0,-1.097 -0.903,-2 -2,-2Zm-15,-2l8,-0l0,2l-8,-0l0,-2Zm13,32l-18,0l0,-26l18,0l0,26Z"}),a("path",{fill:"currentColor",d:"M24.741,18.029c-0.395,-0.103 -0.812,0.073 -1.012,0.43l-5.077,9.05c-0.157,0.278 -0.154,0.619 0.008,0.895c0.162,0.275 0.458,0.445 0.777,0.445l3.727,-0l-0,6.251c-0,0.425 0.297,0.792 0.712,0.88c0.063,0.014 0.126,0.02 0.188,0.02c0.349,-0 0.675,-0.204 0.822,-0.534c0.966,-2.174 1.917,-4.395 2.823,-6.603c0.571,-1.394 1.142,-2.82 1.693,-4.237c0.108,-0.277 0.072,-0.589 -0.096,-0.834c-0.167,-0.245 -0.445,-0.392 -0.742,-0.392l-3.15,-0l-0,-4.5c-0,-0.41 -0.277,-0.767 -0.673,-0.871Z"})],-1)]),4)}const je=v(jn,[["render",zn]]),Gn="waitingforauthorization",Kn="disconnectrequired",Zn={name:"VehicleStatus",components:{ClimaterIcon:pn,DynamicPriceIcon:Oe,PlanEndIcon:Xe,PlanStartIcon:yn,ReconnectIcon:wn,RfidWaitIcon:Tn,SunDownIcon:xn,SunUpIcon:He,VehicleLimitIcon:we,VehicleMinSocIcon:Fn,WelcomeIcon:Hn,BatteryBoostIcon:je},mixins:[C],props:{vehicleSoc:Number,batteryBoostActive:Boolean,charging:Boolean,chargingPlanDisabled:Boolean,chargerStatusReason:String,connected:Boolean,currency:String,effectiveLimitSoc:Number,effectivePlanSoc:Number,effectivePlanTime:String,enabled:Boolean,heating:Boolean,minSoc:Number,phaseAction:String,phaseRemainingInterpolated:Number,planActive:Boolean,planOverrun:Number,planProjectedEnd:String,planProjectedStart:String,planTimeUnreachable:Boolean,pvAction:String,pvRemainingInterpolated:Number,smartCostActive:Boolean,smartCostDisabled:Boolean,smartCostLimit:{type:Number,default:null},smartCostNextStart:String,smartCostType:String,tariffCo2:Number,tariffGrid:Number,vehicleClimaterActive:Boolean,vehicleWelcomeActive:Boolean,vehicleLimitSoc:Number},emits:["open-loadpoint-settings","open-minsoc-settings","open-plan-modal"],data(){return{pvTooltip:null,phaseTooltip:null,planStartTooltip:null,planActiveTooltip:null,minSocTooltip:null,vehicleClimaterTooltip:null,vehicleWelcomeTooltip:null,smartCostTooltip:null,vehicleLimitTooltip:null,awaitingAuthorizationTooltip:null,disconnectRequiredTooltip:null,batteryBoostTooltip:null,interval:null,planProjectedEndDuration:null,smartCostNextStartDuration:null,planProjectedStartDuration:null}},computed:{phaseTimerActive(){return this.phaseRemainingInterpolated>0&&["scale1p","scale3p"].includes(this.phaseAction)},pvTimerActive(){return this.pvRemainingInterpolated>0&&["enable","disable"].includes(this.pvAction)},pvTimerVisible(){return this.pvTimerActive},pvTimerContent(){if(!this.pvTimerVisible)return"";const e=this.pvAction==="enable"?"pvEnable":"pvDisable";return this.$t("main.vehicleStatus.".concat(e))},phaseTimerVisible(){return!this.pvTimerActive&&this.charging&&this.phaseTimerActive},phaseIconClass(){return this.phaseAction==="scale1p"?"phaseUp":"phaseDown"},phaseTimerContent(){return this.phaseTimerVisible?this.$t("main.vehicleStatus.".concat(this.phaseAction)):""},vehicleLimitVisible(){const e=this.effectiveLimitSoc||100;return this.connected&&this.vehicleLimitSoc>0&&this.vehicleLimitSoc<e},awaitingAuthorizationVisible(){return this.chargerStatusReason===Gn},awaitingAuthorizationTooltipContent(){return this.awaitingAuthorizationVisible?this.$t("main.vehicleStatus.awaitingAuthorization"):""},disconnectRequiredVisible(){return this.chargerStatusReason===Kn},disconnectRequiredTooltipContent(){return this.disconnectRequiredVisible?this.$t("main.vehicleStatus.disconnectRequired"):""},vehicleLimitTooltipContent(){return this.vehicleLimitVisible?this.vehicleLimitReached?this.$t("main.vehicleStatus.vehicleLimitReached"):this.vehicleLimitWarning?this.$t("main.targetCharge.targetIsAboveVehicleLimit"):this.$t("main.vehicleStatus.vehicleLimit"):""},minSocVisible(){return this.connected&&this.minSoc>0&&this.vehicleSoc<this.minSoc},minSocTooltipContent(){return this.minSocVisible?this.$t("main.vehicleStatus.minCharge",{soc:this.fmtPercentage(this.minSoc)}):""},vehicleLimitReached(){return!this.charging&&this.vehicleSoc&&this.vehicleLimitSoc&&this.vehicleSoc>=this.vehicleLimitSoc-1},vehicleLimitWarning(){return this.effectivePlanSoc>this.vehicleLimitSoc},vehicleLimitClass(){return this.vehicleLimitWarning?"text-warning":""},vehicleLimitIconComponent(){return this.vehicleLimitReached?Mn:this.vehicleLimitWarning?Rn:we},planStartVisible(){return this.planProjectedStart&&!this.planActive&&!this.chargingPlanDisabled},batteryBoostVisible(){return this.batteryBoostActive},batteryBoostTooltipContent(){return this.batteryBoostVisible?this.$t("main.vehicleStatus.batteryBoost"):""},planStartTooltipContent(){return this.planStartVisible?this.$t("main.vehicleStatus.targetChargePlanned",{duration:this.planProjectedStartDuration}):""},planActiveVisible(){return this.planProjectedEnd&&this.planActive&&!this.chargingPlanDisabled},planActiveClass(){return this.planTimeUnreachable?"text-warning":"text-primary"},planActiveTooltipContent(){return this.planActiveVisible?this.planTimeUnreachable?this.$t("main.targetCharge.notReachableInTime",{overrun:this.fmtDuration(this.planOverrun,!0,"h")}):this.$t("main.vehicleStatus.targetChargeActive",{duration:this.planProjectedEndDuration}):""},smartCostVisible(){return this.smartCostLimit!==null},smartCostTooltipContent(){if(!this.smartCostVisible)return"";const e="main.vehicleStatus.".concat(this.smartCostPrice?"cheap":"clean");return this.smartCostNowVisible?this.$t("".concat(e,"EnergyCharging")):this.smartCostNextStart?this.$t("".concat(e,"EnergyNextStart"),{duration:this.smartCostNextStartDuration}):this.$t("".concat(e,"EnergySet"))},smartCostPrice(){return this.smartCostType!==de},smartCostNowVisible(){return this.smartCostPrice?this.tariffGrid<=this.smartCostLimit:this.tariffCo2<=this.smartCostLimit},smartCostNow(){return this.smartCostPrice?this.fmtPricePerKWh(this.tariffGrid,this.currency,!0):this.fmtCo2Short(this.tariffCo2)},smartCostLimitFmt(){return this.smartCostPrice?this.fmtPricePerKWh(this.smartCostLimit,this.currency,!0):this.fmtCo2Short(this.smartCostLimit)},smartCostClass(){return this.smartCostDisabled?"opacity-25":this.smartCostActive?"text-primary":""},vehicleClimaterTooltipContent(){return this.vehicleClimaterActive?this.$t("main.vehicleStatus.climating"):""},vehicleWelcomeTooltipContent(){return this.vehicleWelcomeActive?this.$t("main.vehicleStatus.welcome"):""},chargerStatus(){const e=(i,n)=>{if(this.heating){const d="main.heatingStatus.".concat(i);if(this.$te(d,et))return this.$t(d,n)}return this.$t("main.vehicleStatus.".concat(i),n)};return this.connected?this.enabled&&!this.charging?this.vehicleLimitReached?e("finished"):e("waitForVehicle"):this.charging?e("charging"):e("connected"):e("disconnected")}},watch:{planActiveTooltipContent(){this.$nextTick(this.updatePlanActiveTooltip)},planStartTooltipContent(){this.$nextTick(this.updatePlanStartTooltip)},minSocTooltipContent(){this.$nextTick(this.updateMinSocTooltip)},phaseTimerContent(){this.$nextTick(this.updatePhaseTooltip)},pvTimerContent(){this.$nextTick(this.updatePvTooltip)},vehicleClimaterTooltipContent(){this.$nextTick(this.updateVehicleClimaterTooltip)},vehicleWelcomeTooltipContent(){this.$nextTick(this.updateVehicleWelcomeTooltip)},smartCostTooltipContent(){this.$nextTick(this.updateSmartCostTooltip)},vehicleLimitTooltipContent(){this.$nextTick(this.updateVehicleLimitTooltip)},awaitingAuthorizationTooltipContent(){this.$nextTick(this.updateAwaitingAuthorizationTooltip)},disconnectRequiredTooltipContent(){this.$nextTick(this.updateDisconnectRequiredTooltip)},batteryBoostTooltipContent(){this.$nextTick(this.updateBatteryBoostTooltip)},planProjectedStart(){this.updateDurations()},planProjectedEnd(){this.updateDurations()},smartCostNextStart(){this.updateDurations()}},mounted(){this.updatePlanStartTooltip(),this.updatePlanActiveTooltip(),this.updateMinSocTooltip(),this.updatePhaseTooltip(),this.updatePvTooltip(),this.updateVehicleClimaterTooltip(),this.updateVehicleWelcomeTooltip(),this.updateSmartCostTooltip(),this.updateVehicleLimitTooltip(),this.updateAwaitingAuthorizationTooltip(),this.updateDisconnectRequiredTooltip(),this.updateDurations(),this.interval=setInterval(this.updateDurations,1e3*60),this.updateBatteryBoostTooltip()},beforeUnmount(){clearInterval(this.interval)},methods:{updateDurations(){this.planProjectedStart&&(this.planProjectedStartDuration=this.fmtDurationToTime(new Date(this.planProjectedStart))),this.planProjectedEnd&&(this.planProjectedEndDuration=this.fmtDurationToTime(new Date(this.planProjectedEnd))),this.smartCostNextStart&&(this.smartCostNextStartDuration=this.fmtDurationToTime(new Date(this.smartCostNextStart)))},openLoadpointSettings(){this.$emit("open-loadpoint-settings")},openMinSocSettings(){var e;(e=this.minSocTooltip)==null||e.hide(),this.$emit("open-minsoc-settings")},planStartClicked(){var e;(e=this.planStartTooltip)==null||e.hide(),this.$emit("open-plan-modal")},planActiveClicked(){var e;(e=this.planActiveTooltip)==null||e.hide(),this.$emit("open-plan-modal")},vehicleLimitClicked(){var e;this.vehicleLimitWarning&&((e=this.vehicleLimitTooltip)==null||e.hide(),this.$emit("open-plan-modal"))},smartCostClicked(){var e;this.openLoadpointSettings(),(e=this.smartCostTooltip)==null||e.hide()},batteryBoostClicked(){var e;(e=this.batteryBoostTooltip)==null||e.hide(),this.openLoadpointSettings()},updatePvTooltip(){this.pvTooltip=this.updateTooltip(this.pvTooltip,this.pvTimerContent,this.$refs.pvTimer)},updatePhaseTooltip(){this.phaseTooltip=this.updateTooltip(this.phaseTooltip,this.phaseTimerContent,this.$refs.phaseTimer)},updatePlanStartTooltip(){this.planStartTooltip=this.updateTooltip(this.planStartTooltip,this.planStartTooltipContent,this.$refs.planStart,!0)},updatePlanActiveTooltip(){this.planActiveTooltip=this.updateTooltip(this.planActiveTooltip,this.planActiveTooltipContent,this.$refs.planActive,!0)},updateMinSocTooltip(){this.minSocTooltip=this.updateTooltip(this.minSocTooltip,this.minSocTooltipContent,this.$refs.minSoc,!0)},updateVehicleClimaterTooltip(){this.vehicleClimaterTooltip=this.updateTooltip(this.vehicleClimaterTooltip,this.vehicleClimaterTooltipContent,this.$refs.vehicleClimater)},updateBatteryBoostTooltip(){this.batteryBoostTooltip=this.updateTooltip(this.batteryBoostTooltip,this.batteryBoostTooltipContent,this.$refs.batteryBoost)},updateVehicleWelcomeTooltip(){this.vehicleWelcomeTooltip=this.updateTooltip(this.vehicleWelcomeTooltip,this.vehicleWelcomeTooltipContent,this.$refs.vehicleWelcome)},updateSmartCostTooltip(){this.smartCostTooltip=this.updateTooltip(this.smartCostTooltip,this.smartCostTooltipContent,this.$refs.smartCost,!0)},updateVehicleLimitTooltip(){this.vehicleLimitTooltip=this.updateTooltip(this.vehicleLimitTooltip,this.vehicleLimitTooltipContent,this.$refs.vehicleLimit,!0)},updateAwaitingAuthorizationTooltip(){this.awaitingAuthorizationTooltip=this.updateTooltip(this.awaitingAuthorizationTooltip,this.awaitingAuthorizationTooltipContent,this.$refs.awaitingAuthorization)},updateDisconnectRequiredTooltip(){this.updateTooltip(this.disconnectRequiredTooltip,this.disconnectRequiredTooltipContent,this.$refs.disconnectRequired)},updateTooltip:function(e,i,n,d=!1){if(!i||!n){e&&e.dispose();return}let r=e;if(!r){const t=d?"hover":"hover focus";r=new J(n,{title:" ",trigger:t})}return r.setContent({".tooltip-inner":i}),r}}},Yn={class:"d-flex justify-content-between gap-3 evcc-gray align-items-start flex-wrap",style:{"min-height":"24px"},"data-testid":"vehicle-status"},Qn={class:"charger-status","data-testid":"vehicle-status-charger"},Jn={class:"d-flex flex-wrap justify-content-end gap-3 flex-grow-1"},Xn={key:0,ref:"pvTimer",class:"entry","data-testid":"vehicle-status-pvtimer","data-bs-toggle":"tooltip"},ea={class:"tabular"},ta={key:1,ref:"phaseTimer",class:"entry","data-testid":"vehicle-status-phasetimer","data-bs-toggle":"tooltip"},ia={class:"tabular"},na=["role"],aa={key:4,ref:"vehicleClimater","data-bs-toggle":"tooltip",class:"entry","data-testid":"vehicle-status-climater"},sa={key:5,ref:"vehicleWelcome","data-bs-toggle":"tooltip",class:"entry","data-testid":"vehicle-status-welcome"},oa={key:6,ref:"awaitingAuthorization","data-bs-toggle":"tooltip",class:"entry","data-testid":"vehicle-status-awaiting-authorization"},ra={key:7,ref:"disconnectRequired",class:"entry text-warning","data-bs-toggle":"tooltip","data-testid":"vehicle-status-disconnect-required"},la={key:1},ca={key:0},da={class:"text-decoration-underline"},ua={key:1};function ha(e,i,n,d,r,t){const l=m("SunUpIcon"),h=m("SunDownIcon"),u=m("VehicleMinSocIcon"),p=m("ClimaterIcon"),S=m("WelcomeIcon"),_=m("RfidWaitIcon"),$=m("ReconnectIcon"),D=m("DynamicPriceIcon"),R=m("BatteryBoostIcon"),H=m("PlanEndIcon"),G=m("PlanStartIcon");return s(),o("div",Yn,[a("div",Qn,c(t.chargerStatus),1),a("div",Jn,[t.pvTimerVisible?(s(),o("div",Xn,[n.pvAction==="enable"?(s(),b(l,{key:0})):(s(),b(h,{key:1})),a("div",ea,c(e.fmtDuration(n.pvRemainingInterpolated)),1)],512)):t.phaseTimerVisible?(s(),o("div",ta,[a("shopicon-regular-angledoublerightsmall",{class:y(t.phaseIconClass)},null,2),a("div",ia,c(e.fmtDuration(n.phaseRemainingInterpolated)),1)],512)):g("",!0),t.minSocVisible?(s(),o("button",{key:2,ref:"minSoc",type:"button",class:"entry text-danger text-decoration-underline","data-testid":"vehicle-status-minsoc","data-bs-toggle":"tooltip",onClick:i[0]||(i[0]=(...M)=>t.openMinSocSettings&&t.openMinSocSettings(...M))},[f(u),T(" "+c(e.fmtPercentage(n.minSoc)),1)],512)):t.vehicleLimitVisible?(s(),o("div",{key:3,ref:"vehicleLimit",class:y(["entry",t.vehicleLimitClass]),"data-bs-toggle":"tooltip","data-testid":"vehicle-status-limit",role:t.vehicleLimitWarning?"button":null,onClick:i[1]||(i[1]=(...M)=>t.vehicleLimitClicked&&t.vehicleLimitClicked(...M))},[(s(),b(Y(t.vehicleLimitIconComponent))),T(" "+c(e.fmtPercentage(n.vehicleLimitSoc)),1)],10,na)):g("",!0),n.vehicleClimaterActive?(s(),o("div",aa,[f(p)],512)):g("",!0),n.vehicleWelcomeActive?(s(),o("div",sa,[f(S)],512)):g("",!0),t.awaitingAuthorizationVisible?(s(),o("div",oa,[f(_)],512)):g("",!0),t.disconnectRequiredVisible?(s(),o("div",ra,[f($)],512)):g("",!0),t.smartCostVisible?(s(),o("button",{key:8,ref:"smartCost",type:"button",class:y(["entry",t.smartCostClass]),"data-testid":"vehicle-status-smartcost","data-bs-toggle":"tooltip","data-bs-trigger":"hover",onClick:i[2]||(i[2]=(...M)=>t.smartCostClicked&&t.smartCostClicked(...M))},[t.smartCostPrice?(s(),b(D,{key:0})):(s(),o("shopicon-regular-eco1",la)),a("div",null,[t.smartCostNowVisible?(s(),o("span",ca,c(t.smartCostNow),1)):g("",!0),i[6]||(i[6]=T(" ≤ ")),a("span",da,c(t.smartCostLimitFmt),1),n.smartCostNextStart?(s(),o("span",ua," ("+c(e.fmtAbsoluteDate(new Date(n.smartCostNextStart)))+") ",1)):g("",!0)])],2)):g("",!0),t.batteryBoostVisible?(s(),o("button",{key:9,ref:"batteryBoost",type:"button",class:"entry","data-testid":"vehicle-status-batteryboost","data-bs-toggle":"tooltip",onClick:i[3]||(i[3]=(...M)=>t.batteryBoostClicked&&t.batteryBoostClicked(...M))},[f(R)],512)):g("",!0),t.planActiveVisible?(s(),o("button",{key:10,ref:"planActive",type:"button",class:y(["entry",t.planActiveClass]),"data-testid":"vehicle-status-planactive","data-bs-toggle":"tooltip",onClick:i[4]||(i[4]=(...M)=>t.planActiveClicked&&t.planActiveClicked(...M))},[f(H),a("span",null,c(e.fmtAbsoluteDate(new Date(n.planProjectedEnd))),1)],2)):t.planStartVisible?(s(),o("button",{key:11,ref:"planStart",type:"button",class:"entry","data-testid":"vehicle-status-planstart","data-bs-toggle":"tooltip",onClick:i[5]||(i[5]=(...M)=>t.planStartClicked&&t.planStartClicked(...M))},[f(G),T(" "+c(e.fmtAbsoluteDate(new Date(n.planProjectedStart))),1)],512)):g("",!0)])])}const Pe=v(Zn,[["render",ha],["__scopeId","data-v-94e003cd"]]),ma={name:"ChargingPlanPreview",components:{TariffChart:tt},mixins:[C],props:{duration:Number,power:Number,rates:Array,plan:Array,smartCostType:String,targetTime:Date,currency:String},data(){return{activeIndex:null,startTime:new Date}},computed:{endTime(){var i;if(!((i=this.plan)!=null&&i.length))return null;const e=this.plan[this.plan.length-1].end;return e?new Date(e):null},timeWarning(){return this.targetTime&&this.endTime?this.targetTime<this.endTime:!1},planDuration(){return this.fmtDuration(this.duration)},fmtPower(){return this.duration>0&&this.power>0?"@ ".concat(this.fmtW(this.power)):null},isCo2(){return this.smartCostType===de},hasTariff(){var e;return((e=this.rates)==null?void 0:e.length)>1},avgPrice(){let e=0,i=0;return this.convertDates(this.plan).forEach(n=>{const d=(n.end.getTime()-n.start.getTime())/36e5;n.price&&(e+=d,i+=d*n.price)}),e?i/e:void 0},fmtAvgPrice(){if(!this.targetTime||this.duration===0)return"—";const e=this.activeSlot?this.activeSlot.price:this.avgPrice;return e===void 0?this.$t("main.targetChargePlan.unknownPrice"):this.isCo2?this.fmtCo2Medium(e):this.fmtPricePerKWh(e,this.currency)},activeSlot(){return this.slots[this.activeIndex]},activeSlotName(){if(this.activeSlot){const{day:e,startHour:i,endHour:n}=this.activeSlot,d="".concat(i,"–").concat(n);return this.$t("main.targetChargePlan.timeRange",{day:e,range:d})}return null},targetHourOffset(){if(!this.targetTime)return null;const e=new Date(this.startTime);return e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),(this.targetTime.getTime()-e.getTime())/(60*60*1e3)},targetText(){return this.targetTime?this.fmtWeekdayTime(this.targetTime):null},slots(){var r;const e=[],i=this.convertDates(this.rates),n=this.convertDates(this.plan),d=60*60*1e3;for(let t=0;t<39;t++){const l=new Date(this.startTime.getTime()+d*t),h=l.getHours();l.setMinutes(0),l.setSeconds(0),l.setMilliseconds(0);const u=new Date(l.getTime());u.setHours(h+1);const p=u.getHours(),S=this.weekdayShort(l),_=this.targetTime&&this.targetTime<=l,$=(r=this.findSlotInRange(l,u,i))==null?void 0:r.price,D=l<=this.targetTime&&u>this.targetTime,R=this.findSlotInRange(l,u,n)!=null,H=R&&this.targetTime&&u>this.targetTime&&this.targetTime<this.endTime;e.push({day:S,price:$,startHour:h,endHour:p,charging:R,toLate:_,warning:H,isTarget:D})}return e}},watch:{rates(){this.startTime=new Date}},methods:{convertDates(e){return e!=null&&e.length?e.map(i=>({start:new Date(i.start),end:new Date(i.end),price:i.price})):[]},findSlotInRange(e,i,n){return n.find(d=>d.start.getTime()<e.getTime()?d.end.getTime()>e.getTime():d.start.getTime()<i.getTime())},slotHovered(e){this.activeIndex=e}}},fa={class:"plan"},ga={class:"justify-content-between mb-2 d-flex justify-content-between"},pa={class:"text-start"},va={class:"label"},ba={key:0,class:"extraValue text-nowrap ms-sm-1"},ya={key:0,class:"text-end"},_a={class:"label"},Sa={key:0},wa={key:1},Pa={key:2},Ca={class:"value text-primary"};function Ta(e,i,n,d,r,t){const l=m("TariffChart");return s(),o("div",fa,[a("div",ga,[a("div",pa,[a("div",va,c(e.$t("main.targetChargePlan.chargeDuration")),1),a("div",{class:y("value  d-sm-flex align-items-baseline ".concat(t.timeWarning?"text-warning":"text-primary"))},[a("div",null,c(t.planDuration),1),t.fmtPower?(s(),o("div",ba,c(t.fmtPower),1)):g("",!0)],2)]),t.hasTariff?(s(),o("div",ya,[a("div",_a,[t.activeSlot?(s(),o("span",Sa,c(t.activeSlotName),1)):t.isCo2?(s(),o("span",wa,c(e.$t("main.targetChargePlan.co2Label")),1)):(s(),o("span",Pa,c(e.$t("main.targetChargePlan.priceLabel")),1))]),a("div",Ca,c(t.fmtAvgPrice),1)])):g("",!0)]),f(l,{slots:t.slots,"target-text":t.targetText,"target-offset":t.targetHourOffset,onSlotHovered:t.slotHovered},null,8,["slots","target-text","target-offset","onSlotHovered"])])}const ka=v(ma,[["render",Ta],["__scopeId","data-v-f1cf5626"]]);function he(e){return e<.1?.005:e<1?.05:e<2?.1:e<5?.25:e<10?.5:e<25?1:e<50?2:5}function me(e,i,n,d){if(e===0)return d;const r=i>=.1,t=r&&i<1?1:0;return n(e*1e3,r?E.KW:E.W,!0,t)}function ze(e,i){return i?Math.round(e*i):null}function Ge(e,i,n,d,r,t){const l=he(i),h=[];for(let u=0;u<=i;u+=l){let p=me(u,l,d,t);const S=u<e/1e3&&u!==0,_=ze(u,n);_&&(p+=" (+".concat(r(_),")"));const $=u.toFixed(3)*1;h.push({energy:$,text:p,disabled:S})}return h}const Ce="last_target_time",Te="last_soc_goal",ke="last_energy_goal",Ia="7:00",xa={name:"ChargingPlanStaticSettings",mixins:[C],props:{id:String,soc:Number,energy:Number,time:String,rangePerSoc:Number,socPerKwh:Number,capacity:Number,socBasedPlanning:Boolean,multiplePlans:Boolean},emits:["static-plan-updated","static-plan-removed","plan-preview"],data:function(){return{selectedDay:null,selectedTime:null,selectedSoc:this.soc,selectedEnergy:this.energy,active:!1}},computed:{selectedDate:function(){return new Date("".concat(this.selectedDay,"T").concat(this.selectedTime||"00:00"))},socOptions:function(){return Array.from(Array(20).keys()).map(e=>5+e*5).map(this.socOption)},energyOptions:function(){return Ge(0,this.capacity||100,this.socPerKwh,this.fmtWh,this.fmtPercentage,"-").slice(1)},originalData:function(){return this.isNew?{}:{soc:this.soc,energy:this.energy,day:this.fmtDayString(new Date(this.time)),time:this.fmtTimeString(new Date(this.time))}},dataChanged:function(){const e=this.originalData.day!=this.selectedDay||this.originalData.time!=this.selectedTime,i=this.socBasedPlanning?this.originalData.soc!=this.selectedSoc:this.originalData.energy!=this.selectedEnergy;return e||i},isNew:function(){return!this.time&&(!this.soc||!this.energy)},timeInThePast:function(){return new Date>=this.selectedDate}},watch:{time(){this.initInputFields()},soc(){this.soc&&(this.selectedSoc=this.soc)},energy(){this.energy&&(this.selectedEnergy=this.energy)},isNew(e){this.active=!e}},mounted(){this.initInputFields(),this.preview()},methods:{formId:function(e){return"chargingplan-".concat(this.id,"-").concat(e)},socOption:function(e){const i=this.fmtSocOption(e,this.rangePerSoc,j());return{value:e,name:i}},initInputFields:function(){this.selectedSoc||(this.selectedSoc=window.localStorage[Te]||100),this.selectedEnergy||(this.selectedEnergy=window.localStorage[ke]||this.capacity||10);let e=this.time;if(!e){if(this.selectedDay&&this.selectedTime)return;e=this.defaultTime()}const i=new Date(e);this.selectedDay=this.fmtDayString(i),this.selectedTime=this.fmtTimeString(i)},dayOptions:function(){var d,r;const e=[],i=new Date,n=[this.$t("main.targetCharge.today"),this.$t("main.targetCharge.tomorrow")];for(let t=0;t<7;t++){const l=i.toLocaleDateString((d=this.$i18n)==null?void 0:d.locale,{day:"numeric",month:"short"}),h=n[t]||i.toLocaleDateString((r=this.$i18n)==null?void 0:r.locale,{weekday:"short"});e.push({value:this.fmtDayString(i),name:"".concat(l," (").concat(h,")")}),i.setDate(i.getDate()+1)}return e},update:function(){try{const e=this.selectedDate.getHours(),i=this.selectedDate.getMinutes();window.localStorage[Ce]="".concat(e,":").concat(i),this.selectedSoc&&(window.localStorage[Te]=this.selectedSoc),this.selectedEnergy&&(window.localStorage[ke]=this.selectedEnergy)}catch(e){console.warn(e)}this.$emit("static-plan-updated",{time:this.selectedDate,soc:this.selectedSoc,energy:this.selectedEnergy})},preview:function(e=!1){if(!this.isNew&&!e)return!1;this.$emit("plan-preview",{time:this.selectedDate,soc:this.selectedSoc,energy:this.selectedEnergy})},toggle:function(e){const{checked:i}=e.target;i?this.update():(this.$emit("static-plan-removed"),this.preview(!0)),this.active=i},defaultTime:function(){const[e,i]=(window.localStorage[Ce]||Ia).split(":"),n=new Date;return n.setSeconds(0),n.setMinutes(i),n.setHours(e),n<new Date&&n.setDate(n.getDate()+1),n}}},La={class:"mb-5 mb-lg-4","data-testid":"plan-entry"},Aa={key:0,class:"d-flex gap-3 align-items-baseline d-lg-none mb-4 fw-normal evcc-gray","data-testid":"repeating-plan-title"},Na={class:"text-uppercase fs-6"},$a={class:"row d-none d-lg-flex mb-2"},Ba={key:0,class:"plan-id d-none d-lg-flex"},Va=["for"],Ma={class:"col-6 col-lg-2"},Ea=["for"],Da={class:"col-6 col-lg-3"},Ra=["for"],Oa={class:"col-6 col-lg-1"},Ua=["for"],Fa={class:"row"},qa={key:0,class:"plan-id d-none d-lg-flex align-items-center justify-content-start fs-6"},Wa={class:"col-5 d-lg-none col-form-label"},Ha=["for"],ja=["id"],za=["value"],Ga={class:"col-5 d-lg-none col-form-label"},Ka=["for"],Za={class:"col-7 col-lg-2 mb-2 mb-lg-0"},Ya=["id"],Qa={class:"col-5 d-lg-none col-form-label"},Ja=["for"],Xa={class:"col-7 col-lg-3 mb-2 mb-lg-0"},es=["id"],ts=["value"],is=["id"],ns=["value"],as={class:"col-5 d-lg-none col-form-label"},ss=["for"],os={class:"col-2 col-lg-1 d-flex align-items-center"},rs={class:"form-check form-switch"},ls=["id","checked","disabled"],cs={class:"col-5 col-lg-2 d-flex align-items-center"},ds=["disabled"],us={class:"mb-0","data-testid":"plan-entry-warnings"},hs={key:0,class:"d-block text-danger my-2"};function ms(e,i,n,d,r,t){return s(),o("div",La,[n.multiplePlans?(s(),o("h5",Aa,[a("span",Na,c("".concat(e.$t("main.chargingPlan.planNumber",{number:"#1"}))),1)])):g("",!0),a("div",$a,[n.multiplePlans?(s(),o("div",Ba)):g("",!0),a("div",{class:y(["col-6",n.multiplePlans?"col-lg-3":"col-lg-4"])},[a("label",{for:t.formId("day")},c(e.$t("main.chargingPlan.day")),9,Va)],2),a("div",Ma,[a("label",{for:t.formId("time")},c(e.$t("main.chargingPlan.time")),9,Ea)]),a("div",Da,[a("label",{for:t.formId("goal")},c(e.$t("main.chargingPlan.goal")),9,Ra)]),a("div",Oa,[a("label",{for:t.formId("active")},c(e.$t("main.chargingPlan.active")),9,Ua)])]),a("div",Fa,[n.multiplePlans?(s(),o("div",qa," #1 ")):g("",!0),a("div",Wa,[a("label",{for:t.formId("day")},c(e.$t("main.chargingPlan.day")),9,Ha)]),a("div",{class:y(["col-7",n.multiplePlans?"col-lg-3":"col-lg-4","mb-2","mb-lg-0"])},[N(a("select",{id:t.formId("day"),"onUpdate:modelValue":i[0]||(i[0]=l=>e.selectedDay=l),class:"form-select me-2","data-testid":"static-plan-day",onChange:i[1]||(i[1]=l=>t.preview())},[(s(!0),o(I,null,A(t.dayOptions(),l=>(s(),o("option",{key:l.value,value:l.value},c(l.name),9,za))),128))],40,ja),[[U,e.selectedDay]])],2),a("div",Ga,[a("label",{for:t.formId("day")},c(e.$t("main.chargingPlan.time")),9,Ka)]),a("div",Za,[N(a("input",{id:t.formId("time"),"onUpdate:modelValue":i[2]||(i[2]=l=>e.selectedTime=l),type:"time",class:"form-control mx-0",step:60*5,"data-testid":"static-plan-time",required:"",onChange:i[3]||(i[3]=l=>t.preview())},null,40,Ya),[[Ue,e.selectedTime]])]),a("div",Qa,[a("label",{for:t.formId("goal")},c(e.$t("main.chargingPlan.goal")),9,Ja)]),a("div",Xa,[n.socBasedPlanning?N((s(),o("select",{key:0,id:t.formId("goal"),"onUpdate:modelValue":i[4]||(i[4]=l=>e.selectedSoc=l),class:"form-select mx-0","data-testid":"static-plan-soc",onChange:i[5]||(i[5]=l=>t.preview())},[(s(!0),o(I,null,A(t.socOptions,l=>(s(),o("option",{key:l.value,value:l.value},c(l.name),9,ts))),128))],40,es)),[[U,e.selectedSoc]]):N((s(),o("select",{key:1,id:t.formId("goal"),"onUpdate:modelValue":i[6]||(i[6]=l=>e.selectedEnergy=l),class:"form-select mx-0","data-testid":"static-plan-energy",onChange:i[7]||(i[7]=l=>t.preview())},[(s(!0),o(I,null,A(t.energyOptions,l=>(s(),o("option",{key:l.energy,value:l.energy},c(l.text),9,ns))),128))],40,is)),[[U,e.selectedEnergy]])]),a("div",as,[a("label",{for:t.formId("active")},c(e.$t("main.chargingPlan.active")),9,ss)]),a("div",os,[a("div",rs,[a("input",{id:t.formId("active"),class:"form-check-input",type:"checkbox",role:"switch","data-testid":"static-plan-active",checked:!t.isNew,disabled:t.timeInThePast,tabindex:"0",onChange:i[8]||(i[8]=(...l)=>t.toggle&&t.toggle(...l))},null,40,ls)])]),a("div",cs,[t.dataChanged&&!t.isNew?(s(),o("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary border-0 text-decoration-underline","data-testid":"static-plan-apply",disabled:t.timeInThePast,tabindex:"0",onClick:i[9]||(i[9]=(...l)=>t.update&&t.update(...l))},c(e.$t("main.chargingPlan.update")),9,ds)):g("",!0)])]),a("p",us,[t.timeInThePast?(s(),o("span",hs,c(e.$t("main.targetCharge.targetIsInThePast")),1)):g("",!0)])])}const fs=v(xa,[["render",ms],["__scopeId","data-v-ad0df20e"]]);var gs='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M18 20h4v16h-4zM26 20h4v16h-4z"/><path d="M42 12h-8V8c0-2.2-1.8-4-4-4H18c-2.2 0-4 1.8-4 4v4H6v4h4v24c0 2.2 1.8 4 4 4h20c2.2 0 4-1.8 4-4V16h4v-4zM18 8h12v4H18V8zm16 32H14V16h20v24z"/></svg>';class ps extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=gs}}window.customElements.define("shopicon-regular-trash",ps);const vs={name:"ChargingPlanRepeatingSettings",components:{MultiSelect:ct},mixins:[C],props:{number:Number,weekdays:{type:Array,default:()=>[]},time:String,tz:String,soc:Number,showHeader:Boolean,active:Boolean,rangePerSoc:Number,formIdPrefix:String},emits:["updated","removed"],data:function(){return{selectedWeekdays:this.weekdays,selectedTime:this.time,selectedSoc:this.soc,selectedActive:this.active}},computed:{dataChanged:function(){return!X(this.weekdays,this.selectedWeekdays)||this.time!==this.selectedTime||this.soc!==this.selectedSoc||this.active!==this.selectedActive},showApply:function(){return this.dataChanged&&this.selectedActive},weekdaysLabel:function(){return this.getShortenedWeekdaysLabel(this.selectedWeekdays)},socOptions:function(){return Array.from(Array(20).keys()).map(e=>5+e*5).map(this.socOption)},dayOptions:function(){return this.getWeekdaysList("long")}},watch:{weekdays(e,i){X(e,i)||(this.selectedWeekdays=e)},time(e){this.selectedTime=e},soc(e){this.selectedSoc=e},active(e){this.selectedActive=e}},methods:{changeSelectedWeekdays:function(e){this.selectedWeekdays=e,this.update()},formId:function(e){return"".concat(this.formIdPrefix,"-").concat(this.number,"-").concat(e)},socOption:function(e){const i=this.fmtSocOption(e,this.rangePerSoc,j());return{value:e,name:i}},update:function(e=!1){const i={weekdays:this.selectedWeekdays,time:this.selectedTime,soc:this.selectedSoc,tz:this.tz,active:this.selectedActive};(e||!this.selectedActive)&&this.$emit("updated",i)}}},bs={class:"d-flex gap-3 align-items-baseline d-lg-none mb-4 fw-normal evcc-gray","data-testid":"repeating-plan-title"},ys={class:"text-uppercase fs-6"},_s={key:0,class:"row d-none d-lg-flex mb-2"},Ss={class:"col-6 col-lg-3"},ws=["for"],Ps={class:"col-6 col-lg-2"},Cs=["for"],Ts={class:"col-6 col-lg-3"},ks=["for"],Is={class:"col-6 col-lg-1"},xs=["for"],Ls={class:"row"},As={class:"plan-id d-none d-lg-flex align-items-center justify-content-start fs-6"},Ns={class:"col-5 d-lg-none col-form-label"},$s=["for"],Bs={class:"col-7 col-lg-3 mb-2 mb-lg-0"},Vs={class:"col-5 d-lg-none col-form-label"},Ms=["for"],Es={class:"col-7 col-lg-2 mb-2 mb-lg-0"},Ds=["id"],Rs={class:"col-5 d-lg-none col-form-label"},Os=["for"],Us={class:"col-7 col-lg-3 mb-2 mb-lg-0"},Fs=["id"],qs=["value"],Ws={class:"col-5 d-lg-none col-form-label"},Hs=["for"],js={class:"col-2 col-lg-1 d-flex align-items-center"},zs={class:"form-check form-switch"},Gs=["id","checked"],Ks={class:"col-5 col-lg-2 d-flex align-items-center"};function Zs(e,i,n,d,r,t){const l=m("MultiSelect");return s(),o("div",null,[a("h5",bs,[a("span",ys,c("".concat(e.$t("main.chargingPlan.planNumber",{number:"#".concat(n.number)}))),1),a("small",null,c(e.$t("main.chargingPlan.repeating")),1)]),n.showHeader?(s(),o("div",_s,[i[8]||(i[8]=a("div",{class:"plan-id d-none d-lg-flex"},null,-1)),a("div",Ss,[a("label",{for:t.formId("weekdays")},c(e.$t("main.chargingPlan.weekdays")),9,ws)]),a("div",Ps,[a("label",{for:t.formId("time")},c(e.$t("main.chargingPlan.time")),9,Cs)]),a("div",Ts,[a("label",{for:t.formId("goal")},c(e.$t("main.chargingPlan.goal")),9,ks)]),a("div",Is,[a("label",{for:t.formId("active")},c(e.$t("main.chargingPlan.active")),9,xs)])])):g("",!0),a("div",Ls,[a("div",As," #"+c(n.number),1),a("div",Ns,[a("label",{for:t.formId("weekdays")},c(e.$t("main.chargingPlan.weekdays")),9,$s)]),a("div",Bs,[f(l,{id:t.formId("weekdays"),value:e.selectedWeekdays,options:t.dayOptions,selectAllLabel:e.$t("main.chargingPlan.selectAll"),"data-testid":"repeating-plan-weekdays","onUpdate:modelValue":t.changeSelectedWeekdays},{default:P(()=>[T(c(t.weekdaysLabel),1)]),_:1},8,["id","value","options","selectAllLabel","onUpdate:modelValue"])]),a("div",Vs,[a("label",{for:t.formId("time")},c(e.$t("main.chargingPlan.time")),9,Ms)]),a("div",Es,[N(a("input",{id:t.formId("time"),"onUpdate:modelValue":i[0]||(i[0]=h=>e.selectedTime=h),type:"time",class:"form-control mx-0 text-start",step:60*5,"data-testid":"repeating-plan-time",required:"",onChange:i[1]||(i[1]=h=>t.update())},null,40,Ds),[[Ue,e.selectedTime]])]),a("div",Rs,[a("label",{for:t.formId("goal")},c(e.$t("main.chargingPlan.goal")),9,Os)]),a("div",Us,[N(a("select",{id:t.formId("goal"),"onUpdate:modelValue":i[2]||(i[2]=h=>e.selectedSoc=h),class:"form-select mx-0","data-testid":"repeating-plan-soc",onChange:i[3]||(i[3]=h=>t.update())},[(s(!0),o(I,null,A(t.socOptions,h=>(s(),o("option",{key:h.value,value:h.value},c(h.name),9,qs))),128))],40,Fs),[[U,e.selectedSoc]])]),a("div",Ws,[a("label",{for:t.formId("active")},c(e.$t("main.chargingPlan.active")),9,Hs)]),a("div",js,[a("div",zs,[N(a("input",{id:t.formId("active"),"onUpdate:modelValue":i[4]||(i[4]=h=>e.selectedActive=h),class:"form-check-input",type:"checkbox",role:"switch","data-testid":"repeating-plan-active",checked:e.selectedActive,tabindex:"0",onChange:i[5]||(i[5]=h=>t.update(!0))},null,40,Gs),[[Fe,e.selectedActive]])])]),a("div",Ks,[t.showApply?(s(),o("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary border-0 text-decoration-underline","data-testid":"repeating-plan-apply",tabindex:"0",onClick:i[6]||(i[6]=h=>t.update(!0))},c(e.$t("main.chargingPlan.update")),1)):(s(),o("button",{key:1,type:"button",class:"btn btn-sm btn-outline-secondary border-0","aria-label":"Remove",tabindex:"0",onClick:i[7]||(i[7]=h=>e.$emit("removed",e.id))},i[9]||(i[9]=[a("shopicon-regular-trash",{size:"s",class:"flex-shrink-0"},null,-1)])))])])])}const Ys=v(vs,[["render",Zs],["__scopeId","data-v-34b92d47"]]),Qs=[1,2,3,4,5],Js="07:00",Xs=80,eo={name:"ChargingPlansRepeatingSettings",components:{ChargingPlanRepeatingSettings:Ys},mixins:[C],props:{id:Number,rangePerSoc:Number,plans:{type:Array,default:()=>[]}},emits:["updated"],computed:{formIdPrefix:function(){return"chargingplan-lp".concat(this.id)}},methods:{deepEqual:X,addPlan:function(){const e={weekdays:Qs,time:Js,soc:Xs,active:!1,tz:this.timezone()},i=[...this.plans];i.push(e),this.updatePlans(i)},updatePlan:function(e,i){const n=[...this.plans];n.splice(e,1,i),this.updatePlans(n)},updatePlans:function(e){this.$emit("updated",e)},removePlan:function(e){const i=[...this.plans];i.splice(e,1),this.updatePlans(i)}}},to={class:"d-flex align-items-center pb-4"};function io(e,i,n,d,r,t){const l=m("ChargingPlanRepeatingSettings");return s(),o(I,null,[(s(!0),o(I,null,A(n.plans,(h,u)=>(s(),o("div",{key:u,"data-testid":"plan-entry"},[a("div",null,[f(l,k({showHeader:u===0,number:u+2,class:"mb-5 mb-lg-4",formIdPrefix:t.formIdPrefix,ref_for:!0},h,{rangePerSoc:n.rangePerSoc,onUpdated:p=>t.updatePlan(u,p),onSaved:p=>e.savePlan(u,p),onRemoved:p=>t.removePlan(u)}),null,16,["showHeader","number","formIdPrefix","rangePerSoc","onUpdated","onSaved","onRemoved"])])]))),128)),a("div",to,[a("button",{type:"button",class:"d-flex btn btn-sm btn-outline-secondary border-0 align-items-center gap-2 evcc-gray","data-testid":"repeating-plan-add",tabindex:"0",onClick:i[0]||(i[0]=(...h)=>t.addPlan&&t.addPlan(...h))},[i[1]||(i[1]=a("shopicon-regular-plus",{size:"s",class:"flex-shrink-0"},null,-1)),T(" "+c(e.$t("main.chargingPlan.addRepeatingPlan")),1)])])],64)}const no=v(eo,[["render",io],["__scopeId","data-v-0d9f4be9"]]),ao={name:"ChargingPlanWarnings",mixins:[C],props:{id:[String,Number],effectiveLimitSoc:Number,effectivePlanTime:String,effectivePlanSoc:Number,planEnergy:Number,limitEnergy:Number,socBasedPlanning:Boolean,socPerKwh:Number,rangePerSoc:Number,mode:String,tariff:Object,plan:Object,vehicleLimitSoc:Number,planOverrun:Number},computed:{endTime:function(){var i,n;if(!((n=(i=this.plan)==null?void 0:i.plan)!=null&&n.length))return null;const{plan:e}=this.plan;return e[e.length-1].end},overrunFmt:function(){return this.planOverrun?this.fmtDuration(this.planOverrun,!0,"m"):""},timeTooFarInTheFuture:function(){var e;if(!this.effectivePlanTime)return!1;if((e=this.tariff)!=null&&e.rates){const i=this.tariff.rates[this.tariff.rates.length-1];if(i!=null&&i.end){const n=new Date(i.end);return new Date(this.effectivePlanTime)>=n}}return!1},notReachableInTime:function(){const{planTime:e}=this.plan||{};if(e&&this.endTime){const i=new Date(e);return new Date(this.endTime)-i>60*1e3}return!1},targetIsAboveLimit:function(){return this.socBasedPlanning?this.effectivePlanSoc>this.effectiveLimitSoc:this.limitEnergy&&this.planEnergy>this.limitEnergy},targetIsAboveVehicleLimit:function(){return this.socBasedPlanning?this.effectivePlanSoc>(this.vehicleLimitSoc||100):!1},limitFmt:function(){return this.socBasedPlanning?this.fmtSoc(this.effectiveLimitSoc):this.fmtWh(this.limitEnergy*1e3)},goalFmt:function(){return this.socBasedPlanning?this.fmtSoc(this.effectivePlanSoc):this.fmtWh(this.planEnergy*1e3)}},methods:{fmtSoc(e){return this.fmtPercentage(e)}}},so={class:"mb-3 root","data-testid":"plan-warnings"},oo={key:0,class:"d-block evcc-gray mb-1"},ro={key:1,class:"d-block evcc-gray mb-1"},lo={key:2,class:"d-block evcc-gray mb-1"},co={key:3,class:"d-block text-warning mb-1"},uo={key:4,class:"d-block text-warning mb-1"};function ho(e,i,n,d,r,t){return s(),o("p",so,[t.targetIsAboveLimit?(s(),o("span",oo,c(e.$t("main.targetCharge.targetIsAboveLimit",{limit:t.limitFmt})),1)):g("",!0),["off","now"].includes(n.mode)?(s(),o("span",ro,c(e.$t("main.targetCharge.onlyInPvMode")),1)):g("",!0),t.timeTooFarInTheFuture?(s(),o("span",lo,c(e.$t("main.targetCharge.targetIsTooFarInTheFuture")),1)):g("",!0),t.notReachableInTime?(s(),o("span",co,c(e.$t("main.targetCharge.notReachableInTime",{overrun:t.overrunFmt})),1)):g("",!0),t.targetIsAboveVehicleLimit?(s(),o("span",uo,c(e.$t("main.targetCharge.targetIsAboveVehicleLimit")),1)):g("",!0)])}const Ie=v(ao,[["render",ho],["__scopeId","data-v-0c41476e"]]),mo=3e5,fo={name:"ChargingPlansSettings",components:{ChargingPlanPreview:ka,ChargingPlanStaticSettings:fs,ChargingPlansRepeatingSettings:no,ChargingPlanWarnings:Ie,CustomSelect:ue},mixins:[C,F],props:{id:[String,Number],staticPlan:Object,repeatingPlans:{type:Array,default:()=>[]},effectiveLimitSoc:Number,effectivePlanTime:String,effectivePlanSoc:Number,planEnergy:Number,limitEnergy:Number,socBasedPlanning:Boolean,socPerKwh:Number,rangePerSoc:Number,smartCostType:String,currency:String,mode:String,capacity:Number,vehicle:Object,vehicleLimitSoc:Number,planOverrun:Number},emits:["static-plan-removed","static-plan-updated","repeating-plans-updated"],data:function(){return{staticPlanPreview:{},tariff:{},plan:{},activeTab:"time",debounceTimer:null,selectedPreviewId:1,nextPlanId:0}},computed:{noActivePlan:function(){return!this.staticPlan&&this.repeatingPlans.every(e=>!e.active)},multiplePlans:function(){return this.repeatingPlans.length!==0},selectedPreviewPlanTitle:function(){var e;return(e=this.previewPlanOptions[this.selectedPreviewId-1])==null?void 0:e.name},chargingPlanWarningsProps:function(){return this.collectProps(Ie)},chargingPlanPreviewProps:function(){const{rates:e}=this.tariff,{duration:i,plan:n,power:d,planTime:r}=this.plan,t=r?new Date(r):null,{currency:l,smartCostType:h}=this;return e?{duration:i,plan:n,power:d,rates:e,targetTime:t,currency:l,smartCostType:h}:null},previewPlanOptions:function(){const e=n=>"".concat(this.$t("main.targetCharge.preview")," #").concat(n),i=[{value:1,name:e(1)}];return this.repeatingPlans.forEach((n,d)=>{const r=d+2;i.push({value:r,name:e(r),disabled:!n.weekdays.length})}),i},nextPlanTitle:function(){return"".concat(this.$t("main.targetCharge.nextPlan")," #").concat(this.nextPlanId)}},watch:{effectivePlanTime(e){e!==null&&this.fetchPlanDebounced()},staticPlan:{deep:!0,handler:function(e,i){X(e,i)||this.fetchPlanDebounced()}},repeatingPlans:{deep:!0,handler:function(e,i){X(e,i)||(this.adjustPreviewId(),this.fetchPlanDebounced())}}},mounted(){this.fetchPlanDebounced()},methods:{selectPreviewPlan:function(e){this.selectedPreviewId=e,this.fetchPlanPreviewDebounced()},fetchPlanDebounced:async function(){this.noActivePlan?await this.fetchPlanPreviewDebounced():await this.fetchActivePlanDebounced()},adjustPreviewId:function(){this.selectedPreviewId>this.previewPlanOptions.length&&(this.selectedPreviewId=this.previewPlanOptions.length)},fetchActivePlan:async function(){try{const e=await this.apiFetchPlan("loadpoints/".concat(this.id,"/plan"));this.plan=e.data.result,this.nextPlanId=this.plan.planId}catch(e){console.error(e)}await this.updateTariff()},fetchStaticPreviewSoc:async function(e,i){const n=i.toISOString();return await this.apiFetchPlan("loadpoints/".concat(this.id,"/plan/static/preview/soc/").concat(e,"/").concat(n))},fetchRepeatingPreview:async function(e,i,n,d){return await this.apiFetchPlan("loadpoints/".concat(this.id,"/plan/repeating/preview/").concat(i,"/").concat(e,"/").concat(n,"/").concat(encodeURIComponent(d)))},fetchStaticPreviewEnergy:async function(e,i){const n=i.toISOString();return await this.apiFetchPlan("loadpoints/".concat(this.id,"/plan/static/preview/energy/").concat(e,"/").concat(n))},apiFetchPlan:async function(e){try{const i=await x.get(e,{validateStatus:n=>[200,404].includes(n)});return i.status===404?{data:{result:{}}}:i}catch(i){console.error(i)}},fetchPreviewPlan:async function(){if(this.noActivePlan)try{let e;if(this.selectedPreviewId<2&&this.staticPlanPreview){const{soc:i,energy:n,time:d}=this.staticPlanPreview;this.socBasedPlanning?e=await this.fetchStaticPreviewSoc(i,new Date(d)):e=await this.fetchStaticPreviewEnergy(n,new Date(d))}else{const i=this.repeatingPlans[this.selectedPreviewId-2];if(!i)return;const{weekdays:n,soc:d,time:r,tz:t}=i;if(n.length===0)return;e=await this.fetchRepeatingPreview(n,d,r,t)}this.plan=e.data.result,await this.updateTariff()}catch(e){console.error(e)}},updateTariff:async function(){var i;if((i=this.tariff)!=null&&i.lastUpdate&&Date.now()-this.tariff.lastUpdate.getTime()<=mo)return;const e=await x.get("tariff/planner",{validateStatus:function(n){return n>=200&&n<500}});e.status===404?this.tariff={rates:[]}:(this.tariff=e.data.result,this.tariff.lastUpdate=new Date)},fetchPlanPreviewDebounced:async function(){if(!this.debounceTimer){await this.fetchPreviewPlan();return}clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(async()=>await this.fetchPreviewPlan(),1e3)},fetchActivePlanDebounced:async function(){if(!this.debounceTimer){await this.fetchActivePlan();return}clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(async()=>await this.fetchActivePlan(),1e3)},removeStaticPlan:function(e){this.$emit("static-plan-removed",e)},updateStaticPlan:function(e){this.$emit("static-plan-updated",e)},updateRepeatingPlans:function(e){this.$emit("repeating-plans-updated",e)},previewStaticPlan:function(e){this.staticPlanPreview=e,this.fetchPlanPreviewDebounced()}}},go={class:"mt-4"},po={class:"form-group d-lg-flex align-items-baseline justify-content-between"},vo={class:"container px-0"},bo={key:0},yo={key:0,class:"d-none d-lg-block"},_o={class:"inner mb-3","data-testid":"repeating-plan-title"},So={class:"inner","data-testid":"plan-preview-title"},wo={key:0},Po={class:"text-decoration-underline"},Co={key:2};function To(e,i,n,d,r,t){const l=m("ChargingPlanStaticSettings"),h=m("ChargingPlansRepeatingSettings"),u=m("CustomSelect"),p=m("ChargingPlanWarnings"),S=m("ChargingPlanPreview");return s(),o("div",go,[a("div",po,[a("div",vo,[f(l,k({id:"lp".concat(n.id,"-1"),class:"mb-2"},n.staticPlan||{},{capacity:n.capacity,"range-per-soc":n.rangePerSoc,"soc-per-kwh":n.socPerKwh,"soc-based-planning":n.socBasedPlanning,multiplePlans:t.multiplePlans,onStaticPlanUpdated:i[0]||(i[0]=_=>t.updateStaticPlan({index:0,..._})),onStaticPlanRemoved:i[1]||(i[1]=()=>t.removeStaticPlan(0)),onPlanPreview:t.previewStaticPlan}),null,16,["id","capacity","range-per-soc","soc-per-kwh","soc-based-planning","multiplePlans","onPlanPreview"]),n.socBasedPlanning?(s(),o("div",bo,[t.multiplePlans?(s(),o("div",yo,[i[3]||(i[3]=a("hr",{class:"mt-5"},null,-1)),a("h5",null,[a("div",_o,c(e.$t("main.chargingPlan.repeatingPlans")),1)])])):g("",!0),f(h,{id:n.id,rangePerSoc:n.rangePerSoc,plans:n.repeatingPlans,onUpdated:t.updateRepeatingPlans},null,8,["id","rangePerSoc","plans","onUpdated"])])):g("",!0)])]),i[4]||(i[4]=a("hr",null,null,-1)),a("h5",null,[a("div",So,[t.multiplePlans?t.noActivePlan?(s(),b(u,{key:1,options:t.previewPlanOptions,selected:e.selectedPreviewId,"data-testid":"preview-plan-select",onChange:i[2]||(i[2]=_=>t.selectPreviewPlan(_.target.value))},{default:P(()=>[a("span",Po,c(t.selectedPreviewPlanTitle),1)]),_:1},8,["options","selected"])):(s(),o("span",Co,c(t.nextPlanTitle),1)):(s(),o("span",wo,c(e.$t("main.targetCharge.".concat(t.noActivePlan?"preview":"currentPlan"))),1))])]),f(p,L(B(t.chargingPlanWarningsProps)),null,16),f(S,L(B(t.chargingPlanPreviewProps)),null,16)])}const xe=v(fo,[["render",To],["__scopeId","data-v-985c6fc7"]]),ko={name:"ChargingPlanArrival",mixins:[C],props:{id:[String,Number],minSoc:{type:Number,default:0},limitSoc:{type:Number,default:0},vehicleName:String,socBasedCharging:Boolean,rangePerSoc:Number},emits:["minsoc-updated","limitsoc-updated"],data:function(){return{selectedMinSoc:this.minSoc,selectedLimitSoc:this.limitSoc}},computed:{minSocOptions(){return Array.from(Array(20).keys()).map(e=>e*5).map(this.socOption)},limitSocOptions(){return Array.from(Array(21).keys()).map(e=>e*5).map(this.socOption)}},watch:{minSoc:function(e){this.selectedMinSoc=e},limitSoc:function(e){this.selectedLimitSoc=e}},methods:{socOption:function(e){return{value:e,name:e===0?"---":this.fmtSocOption(e,this.rangePerSoc,j())}},formId:function(e){return"chargingplan_".concat(this.id,"_").concat(e)},changeMinSoc:function(){this.$emit("minsoc-updated",this.selectedMinSoc)},changeLimitSoc:function(){this.$emit("limitsoc-updated",this.selectedLimitSoc)}}},Io={class:"mt-4 container"},xo={class:"row"},Lo={class:"col-6 col-lg-3 col-form-label"},Ao=["for"],No={class:"col-6 col-lg-3"},$o=["id","disabled"],Bo=["value"],Vo={class:"col-12 col-lg-6 ps-lg-4 col-form-label mb-4"},Mo={class:"row"},Eo={class:"col-6 col-lg-3 col-form-label"},Do=["for"],Ro={class:"col-6 col-lg-3"},Oo=["id","disabled"],Uo=["value"],Fo={class:"col-12 col-lg-6 ps-lg-4 col-form-label mb-4"},qo={key:0,class:"mx-2 small text-muted"},Wo={class:"text-evcc"};function Ho(e,i,n,d,r,t){return s(),o(I,null,[a("div",Io,[a("div",xo,[a("div",Lo,[a("label",{for:t.formId("minsoc")},c(e.$t("main.loadpointSettings.minSoc.label")),9,Ao)]),a("div",No,[N(a("select",{id:t.formId("minsoc"),"onUpdate:modelValue":i[0]||(i[0]=l=>e.selectedMinSoc=l),class:"form-select mb-2",disabled:!n.socBasedCharging,onChange:i[1]||(i[1]=(...l)=>t.changeMinSoc&&t.changeMinSoc(...l))},[(s(!0),o(I,null,A(t.minSocOptions,l=>(s(),o("option",{key:l.value,value:l.value},c(l.name),9,Bo))),128))],40,$o),[[U,e.selectedMinSoc,void 0,{number:!0}]])]),a("small",Vo,c(e.$t("main.loadpointSettings.minSoc.description",[e.selectedMinSoc?e.fmtPercentage(e.selectedMinSoc):"x"])),1)]),a("div",Mo,[a("div",Eo,[a("label",{for:t.formId("limitsoc")},c(e.$t("main.loadpointSettings.limitSoc.label")),9,Do)]),a("div",Ro,[N(a("select",{id:t.formId("limitsoc"),"onUpdate:modelValue":i[2]||(i[2]=l=>e.selectedLimitSoc=l),class:"form-select mb-2",disabled:!n.socBasedCharging,onChange:i[3]||(i[3]=(...l)=>t.changeLimitSoc&&t.changeLimitSoc(...l))},[(s(!0),o(I,null,A(t.limitSocOptions,l=>(s(),o("option",{key:l.value,value:l.value},c(l.name),9,Uo))),128))],40,Oo),[[U,e.selectedLimitSoc,void 0,{number:!0}]])]),a("small",Fo,c(e.$t("main.loadpointSettings.limitSoc.description")),1)])]),n.socBasedCharging?g("",!0):(s(),o("div",qo,[a("strong",Wo,c(e.$t("main.loadpointSettings.disclaimerHint")),1),T(" "+c(e.$t("main.loadpointSettings.onlyForSocBasedCharging")),1)]))],64)}const Le=v(ko,[["render",Ho]]),jo=60*1e3,zo={name:"ChargingPlan",components:{LabelAndValue:z,ChargingPlansSettings:xe,ChargingPlanArrival:Le},mixins:[C,F],props:{currency:String,disabled:Boolean,effectiveLimitSoc:Number,effectivePlanSoc:Number,effectivePlanTime:String,id:[String,Number],limitEnergy:Number,mode:String,planActive:Boolean,planEnergy:Number,planTime:String,planTimeUnreachable:Boolean,planOverrun:Number,rangePerSoc:Number,smartCostType:String,socBasedPlanning:Boolean,socBasedCharging:Boolean,socPerKwh:Number,vehicle:Object,capacity:Number,vehicleSoc:Number,vehicleLimitSoc:Number},data:function(){return{modal:null,isModalVisible:!1,activeTab:"departure",targetTimeLabel:"",interval:null}},computed:{buttonColor:function(){return this.planTimeUnreachable?"text-warning":this.enabled?"evcc-default-text":"text-gray"},minSoc:function(){var e;return(e=this.vehicle)==null?void 0:e.minSoc},limitSoc:function(){var e;return(e=this.vehicle)==null?void 0:e.limitSoc},staticPlan:function(){var e;return this.socBasedPlanning?(e=this.vehicle)==null?void 0:e.plan:this.planEnergy&&this.planTime?{energy:this.planEnergy,time:this.planTime}:null},repeatingPlans:function(){var e;return((e=this.vehicle)==null?void 0:e.repeatingPlans.length)>0?[...this.vehicle.repeatingPlans]:[]},enabled:function(){return this.effectivePlanTime},modalId:function(){return"chargingPlanModal_".concat(this.id)},departureTabActive:function(){return this.activeTab==="departure"},arrivalTabActive:function(){return this.activeTab==="arrival"},chargingPlansSettingsProps:function(){return this.collectProps(xe)},chargingPlanArrival:function(){return this.collectProps(Le)},targetSocLabel:function(){return this.socBasedPlanning?this.fmtPercentage(this.effectivePlanSoc):me(this.planEnergy,he(this.capacity||100),this.fmtWh,this.$t("main.targetEnergy.noLimit"))},apiVehicle:function(){var e;return"vehicles/".concat((e=this.vehicle)==null?void 0:e.name,"/")},apiLoadpoint:function(){return"loadpoints/".concat(this.id,"/")}},watch:{effectivePlanTime(){this.updateTargetTimeLabel()},"$i18n.locale":{handler(){this.updateTargetTimeLabel()}}},mounted(){this.modal=q.getOrCreateInstance(this.$refs.modal),this.$refs.modal.addEventListener("show.bs.modal",this.modalVisible),this.$refs.modal.addEventListener("hidden.bs.modal",this.modalInvisible),this.$refs.modal.addEventListener("hide.bs.modal",this.checkUnsavedOnClose),this.interval=setInterval(this.updateTargetTimeLabel,jo),this.updateTargetTimeLabel()},unmounted(){var e,i,n;(e=this.$refs.modal)==null||e.removeEventListener("show.bs.modal",this.modalVisible),(i=this.$refs.modal)==null||i.removeEventListener("hidden.bs.modal",this.modalInvisible),(n=this.$refs.modal)==null||n.removeEventListener("hide.bs.modal",this.checkUnsavedOnClose),clearInterval(this.interval)},methods:{checkUnsavedOnClose:function(){const e=this.$refs.modal.querySelector("[data-testid=plan-apply]");e&&confirm(this.$t("main.chargingPlan.unsavedChanges"))&&e.click()},modalVisible:function(){this.isModalVisible=!0},modalInvisible:function(){this.isModalVisible=!1},openModal(){this.showDeatureTab(),this.modal.show()},openPlanModal(e=!1){e?this.showArrivalTab():this.showDeatureTab(),this.modal.show()},updateTargetTimeLabel:function(){if(!this.effectivePlanTime)return"";const e=new Date(this.effectivePlanTime);this.targetTimeLabel=this.fmtAbsoluteDate(e)},showDeatureTab:function(){this.activeTab="departure"},showArrivalTab:function(){this.activeTab="arrival"},updateStaticPlan:function({soc:e,time:i,energy:n}){const d=i.toISOString();this.socBasedPlanning?x.post("".concat(this.apiVehicle,"plan/soc/").concat(e,"/").concat(d)):x.post("".concat(this.apiLoadpoint,"plan/energy/").concat(n,"/").concat(d))},removeStaticPlan:function(){this.socBasedPlanning?x.delete("".concat(this.apiVehicle,"plan/soc")):x.delete("".concat(this.apiLoadpoint,"plan/energy"))},updateRepeatingPlans:function(e){x.post("".concat(this.apiVehicle,"plan/repeating"),{plans:e})},setMinSoc:function(e){x.post("".concat(this.apiVehicle,"minsoc/").concat(e))},setLimitSoc:function(e){x.post("".concat(this.apiVehicle,"limitsoc/").concat(e))}}},Go={class:"text-center"},Ko={class:"value m-0 d-block align-items-baseline justify-content-center"},Zo={key:0},Yo={class:"targetTimeLabel"},Qo={key:1,class:"text-decoration-underline"},Jo=["id"],Xo={class:"modal-dialog modal-dialog-centered",role:"document"},er={class:"modal-content"},tr={class:"modal-header"},ir={class:"modal-title"},nr={key:0},ar={class:"modal-body pt-2"},sr={class:"nav nav-tabs"},or={class:"nav-item"},rr={class:"nav-item"},lr={key:0};function cr(e,i,n,d,r,t){const l=m("LabelAndValue"),h=m("ChargingPlansSettings"),u=m("ChargingPlanArrival");return s(),o("div",Go,[f(l,{class:y(["root flex-grow-1",n.disabled?"opacity-25":"opacity-100"]),label:e.$t("main.chargingPlan.title"),"data-testid":"charging-plan"},{default:P(()=>[a("div",Ko,[a("button",{class:y(["value-button p-0",t.buttonColor]),"data-testid":"charging-plan-button",onClick:i[0]||(i[0]=(...p)=>t.openModal&&t.openModal(...p))},[t.enabled?(s(),o("strong",Zo,[a("span",Yo,c(e.targetTimeLabel),1),a("div",{class:y(["extraValue text-nowrap",{"text-warning":n.planTimeUnreachable}])},c(t.targetSocLabel),3)])):(s(),o("span",Qo,c(e.$t("main.chargingPlan.none")),1))],2)])]),_:1},8,["label","class"]),(s(),b(ae,{to:"body"},[a("div",{id:t.modalId,ref:"modal",class:"modal fade text-dark modal-xl","data-bs-backdrop":"true",tabindex:"-1",role:"dialog","aria-hidden":"true","data-testid":"charging-plan-modal"},[a("div",Xo,[a("div",er,[a("div",tr,[a("h5",ir,[T(c(e.$t("main.chargingPlan.modalTitle")),1),n.socBasedPlanning&&n.vehicle?(s(),o("span",nr,": "+c(n.vehicle.title),1)):g("",!0)]),i[3]||(i[3]=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),a("div",ar,[a("ul",sr,[a("li",or,[a("a",{class:y(["nav-link",{active:t.departureTabActive}]),href:"#",onClick:i[1]||(i[1]=Q((...p)=>t.showDeatureTab&&t.showDeatureTab(...p),["prevent"]))},c(e.$t("main.chargingPlan.departureTab")),3)]),a("li",rr,[a("a",{class:y(["nav-link",{active:t.arrivalTabActive}]),href:"#",onClick:i[2]||(i[2]=Q((...p)=>t.showArrivalTab&&t.showArrivalTab(...p),["prevent"]))},c(e.$t("main.chargingPlan.arrivalTab")),3)])]),e.isModalVisible?(s(),o("div",lr,[t.departureTabActive?(s(),b(h,k({key:0},t.chargingPlansSettingsProps,{onStaticPlanUpdated:t.updateStaticPlan,onStaticPlanRemoved:t.removeStaticPlan,onRepeatingPlansUpdated:t.updateRepeatingPlans}),null,16,["onStaticPlanUpdated","onStaticPlanRemoved","onRepeatingPlansUpdated"])):g("",!0),t.arrivalTabActive?(s(),b(u,k({key:1},t.chargingPlanArrival,{onMinsocUpdated:t.setMinSoc,onLimitsocUpdated:t.setLimitSoc}),null,16,["onMinsocUpdated","onLimitsocUpdated"])):g("",!0)])):g("",!0)])])])],8,Jo)]))])}const Ae=v(zo,[["render",cr],["__scopeId","data-v-4fbfedfb"]]),dr={name:"LimitSocSelect",components:{LabelAndValue:z,AnimatedNumber:W},mixins:[C],props:{limitSoc:Number,rangePerSoc:Number,heating:Boolean},emits:["limit-soc-updated"],computed:{options:function(){const e=[];for(let i=20;i<=100;i+=this.step){const n=this.fmtSocOption(i,this.rangePerSoc,j(),this.heating);e.push({soc:i,text:n})}return e},step:function(){return this.heating?1:5},title:function(){return this.heating?this.$t("main.vehicle.tempLimit"):this.$t("main.vehicle.targetSoc")},estimatedTargetRange:function(){return this.estimatedRange(this.limitSoc)}},methods:{change:function(e){return this.$emit("limit-soc-updated",parseInt(e.target.value,10))},estimatedRange:function(e){return this.rangePerSoc?Math.round(e*this.rangePerSoc):null},formatSoc:function(e){return this.heating?this.fmtTemperature(e):this.fmtPercentage(e)},formatKm:function(e){return"".concat(this.fmtNumber(e,0)," ").concat(j())}}},ur={class:"value m-0"},hr={class:"position-relative",role:"button"},mr=["value"],fr=["value"],gr={class:"text-decoration-underline","data-testid":"limit-soc-value"},pr={key:0,class:"extraValue text-nowrap"};function vr(e,i,n,d,r,t){const l=m("AnimatedNumber"),h=m("LabelAndValue");return s(),b(h,{class:"flex-grow-1",label:t.title,align:"end","data-testid":"limit-soc"},{default:P(()=>[a("h3",ur,[a("label",hr,[a("select",{value:n.limitSoc,class:"custom-select",onChange:i[0]||(i[0]=(...u)=>t.change&&t.change(...u))},[(s(!0),o(I,null,A(t.options,({soc:u,text:p})=>(s(),o("option",{key:u,value:u},c(p),9,fr))),128))],40,mr),a("span",gr,[f(l,{to:n.limitSoc,format:t.formatSoc},null,8,["to","format"])])]),t.estimatedTargetRange?(s(),o("div",pr,[f(l,{to:t.estimatedTargetRange,format:t.formatKm},null,8,["to","format"])])):g("",!0)])]),_:1},8,["label"])}const br=v(dr,[["render",vr],["__scopeId","data-v-182f339e"]]),yr={name:"LimitEnergySelect",components:{LabelAndValue:z,AnimatedNumber:W},mixins:[C],props:{limitEnergy:Number,socPerKwh:Number,chargedEnergy:Number,capacity:Number},emits:["limit-energy-updated"],computed:{options:function(){return Ge(this.chargedEnergy,this.capacity||100,this.socPerKwh,this.fmtWh,this.fmtPercentage,this.$t("main.targetEnergy.noLimit"))},step(){return he(this.capacity||100)},estimated:function(){return ze(this.limitEnergy,this.socPerKwh)}},methods:{change:function(e){return this.$emit("limit-energy-updated",parseFloat(e.target.value))},fmtEnergy:function(e){return me(e,this.step,this.fmtWh,this.$t("main.targetEnergy.noLimit"))},fmtSoc:function(e){return"+".concat(this.fmtPercentage(e))}}},_r={class:"value m-0"},Sr={class:"position-relative",role:"button"},wr=["value"],Pr=["value","disabled"],Cr={key:0,class:"extraValue text-nowrap"};function Tr(e,i,n,d,r,t){const l=m("AnimatedNumber"),h=m("LabelAndValue");return s(),b(h,{class:"flex-grow-1",label:e.$t("main.targetEnergy.label"),align:"end","data-testid":"limit-energy"},{default:P(()=>[a("h3",_r,[a("label",Sr,[a("select",{value:n.limitEnergy,class:"custom-select",onChange:i[0]||(i[0]=(...u)=>t.change&&t.change(...u))},[(s(!0),o(I,null,A(t.options,({energy:u,text:p,disabled:S})=>(s(),o("option",{key:u,value:u,disabled:S},c(p),9,Pr))),128))],40,wr),a("span",{class:y(["text-decoration-underline",{"text-gray fw-normal":!n.limitEnergy}]),"data-testid":"limit-energy-value"},[f(l,{to:n.limitEnergy,format:t.fmtEnergy},null,8,["to","format"])],2)]),t.estimated?(s(),o("div",Cr,[f(l,{to:t.estimated,format:t.fmtSoc},null,8,["to","format"])])):g("",!0)])]),_:1},8,["label"])}const kr=v(yr,[["render",Tr],["__scopeId","data-v-4632b117"]]),Ir={name:"Vehicle",components:{VehicleTitle:_e,VehicleSoc:Se,VehicleStatus:Pe,LabelAndValue:z,ChargingPlan:Ae,LimitSocSelect:br,LimitEnergySelect:kr},mixins:[F,C],props:{chargedEnergy:Number,charging:Boolean,vehicleClimaterActive:Boolean,vehicleWelcomeActive:Boolean,connected:Boolean,currency:String,effectiveLimitSoc:Number,effectivePlanSoc:Number,effectivePlanTime:String,batteryBoostActive:Boolean,enabled:Boolean,heating:Boolean,id:[String,Number],integratedDevice:Boolean,limitEnergy:Number,mode:String,chargerStatusReason:String,phaseAction:String,phaseRemainingInterpolated:Number,planActive:Boolean,planEnergy:Number,planProjectedStart:String,planProjectedEnd:String,planTime:String,planTimeUnreachable:Boolean,planOverrun:Number,pvAction:String,pvRemainingInterpolated:Number,sessionSolarPercentage:Number,smartCostActive:Boolean,smartCostNextStart:String,smartCostLimit:Number,smartCostType:String,socBasedCharging:Boolean,socBasedPlanning:Boolean,tariffCo2:Number,tariffGrid:Number,vehicle:Object,vehicleDetectionActive:Boolean,vehicleName:String,vehicleRange:Number,vehicles:Array,vehicleSoc:Number,vehicleLimitSoc:Number,vehicleNotReachable:Boolean},emits:["limit-soc-updated","limit-energy-updated","change-vehicle","remove-vehicle","open-loadpoint-settings"],data(){return{displayLimitSoc:this.effectiveLimitSoc}},computed:{title:function(){var e;return((e=this.vehicle)==null?void 0:e.title)||""},capacity:function(){var e;return((e=this.vehicle)==null?void 0:e.capacity)||0},icon:function(){var e;return((e=this.vehicle)==null?void 0:e.icon)||""},minSoc:function(){var e;return((e=this.vehicle)==null?void 0:e.minSoc)||0},vehicleSocProps:function(){return this.collectProps(Se)},vehicleStatus:function(){return this.collectProps(Pe)},vehicleTitleProps:function(){return this.collectProps(_e)},chargingPlan:function(){return this.collectProps(Ae)},formattedSoc:function(){return this.vehicleSoc?this.heating?this.fmtTemperature(this.vehicleSoc):this.fmtPercentage(this.vehicleSoc):"--"},vehicleSocTitle:function(){return this.heating?this.$t("main.vehicle.temp"):this.$t("main.vehicle.vehicleSoc")},range:function(){return it(this.vehicleRange)},rangeUnit:function(){return j()},rangePerSoc:function(){return this.vehicleSoc>10&&this.range?Math.round(this.range/this.vehicleSoc*100)/100:null},socPerKwh:function(){return this.capacity>0?100/this.capacity:null},chargedSoc:function(){const e=this.socPerKwh*(this.chargedEnergy/1e3);return e>1?"+".concat(this.fmtPercentage(e)):null},chargingPlanDisabled:function(){return["off","now"].includes(this.mode)},smartCostDisabled:function(){return["off","now"].includes(this.mode)}},watch:{effectiveLimitSoc:function(){this.displayLimitSoc=this.effectiveLimitSoc}},methods:{limitSocDrag:function(e){this.displayLimitSoc=e},limitSocUpdated:function(e){this.displayLimitSoc=e,this.$emit("limit-soc-updated",e)},limitEnergyUpdated:function(e){this.$emit("limit-energy-updated",e)},changeVehicle(e){this.$emit("change-vehicle",e)},removeVehicle(){this.$emit("remove-vehicle")},fmtEnergy(e){return this.fmtWh(e,e==0?E.KW:E.AUTO)},openPlanModal(){this.$refs.chargingPlan.openPlanModal()},openMinSocSettings(){this.$refs.chargingPlan.openPlanModal(!0)}}},xr={class:"vehicle pt-4"},Lr={class:"details d-flex flex-wrap justify-content-between"};function Ar(e,i,n,d,r,t){const l=m("VehicleTitle"),h=m("VehicleStatus"),u=m("VehicleSoc"),p=m("LabelAndValue"),S=m("ChargingPlan"),_=m("LimitSocSelect"),$=m("LimitEnergySelect");return s(),o("div",xr,[n.integratedDevice?g("",!0):(s(),b(l,k({key:0},t.vehicleTitleProps,{onChangeVehicle:t.changeVehicle,onRemoveVehicle:t.removeVehicle}),null,16,["onChangeVehicle","onRemoveVehicle"])),f(h,k(t.vehicleStatus,{class:"mb-2",onOpenLoadpointSettings:i[0]||(i[0]=D=>e.$emit("open-loadpoint-settings")),onOpenMinsocSettings:t.openMinSocSettings,onOpenPlanModal:t.openPlanModal}),null,16,["onOpenMinsocSettings","onOpenPlanModal"]),f(u,k(t.vehicleSocProps,{class:"mt-2 mb-4",onLimitSocUpdated:t.limitSocUpdated,onLimitSocDrag:t.limitSocDrag,onPlanClicked:t.openPlanModal}),null,16,["onLimitSocUpdated","onLimitSocDrag","onPlanClicked"]),a("div",Lr,[n.socBasedCharging?(s(),b(p,{key:0,class:"flex-grow-1",label:t.vehicleSocTitle,value:t.formattedSoc,extraValue:t.range?"".concat(e.fmtNumber(t.range,0)," ").concat(t.rangeUnit):"","data-testid":"current-soc",align:"start"},null,8,["label","value","extraValue"])):(s(),b(p,{key:1,class:"flex-grow-1",label:e.$t("main.loadpoint.charged"),value:t.fmtEnergy(n.chargedEnergy),extraValue:t.chargedSoc||"","data-testid":"current-energy",align:"start"},null,8,["label","value","extraValue"])),n.heating?g("",!0):(s(),b(S,k({key:2,ref:"chargingPlan",class:"flex-grow-1 target-charge"},t.chargingPlan,{disabled:t.chargingPlanDisabled}),null,16,["disabled"])),n.socBasedCharging?(s(),b(_,{key:3,class:"flex-grow-1 text-end","limit-soc":r.displayLimitSoc,"range-per-soc":t.rangePerSoc,heating:n.heating,onLimitSocUpdated:t.limitSocUpdated},null,8,["limit-soc","range-per-soc","heating","onLimitSocUpdated"])):(s(),b($,{key:4,class:"flex-grow-1 text-end","limit-energy":n.limitEnergy,"soc-per-kwh":t.socPerKwh,"charged-energy":n.chargedEnergy,capacity:t.capacity,onLimitEnergyUpdated:t.limitEnergyUpdated},null,8,["limit-energy","soc-per-kwh","charged-energy","capacity","onLimitEnergyUpdated"]))])])}const Ne=v(Ir,[["render",Ar],["__scopeId","data-v-ddceed21"]]),$e=1,Nr={name:"Phases",props:{chargeCurrent:{type:Number},chargeCurrents:{type:Array},phasesActive:{type:Number},minCurrent:{type:Number},maxCurrent:{type:Number}},computed:{chargeCurrentsActive(){var e;return((e=this.chargeCurrents)==null?void 0:e.filter(i=>i>=$e).length)>0}},methods:{targetWidth(){const e=Math.min(Math.max(this.minCurrent,this.chargeCurrent),this.maxCurrent);return 100/this.maxCurrent*e},realWidth(e){if(this.chargeCurrents){const i=this.chargeCurrents[e-1]||0;return 100/this.maxCurrent*i}return this.targetWidth()},isPhaseActive(e){return this.chargeCurrentsActive?this.chargeCurrents[e-1]>=$e:e<=this.phasesActive}}},$r={class:y("phases d-flex justify-content-between")};function Br(e,i,n,d,r,t){return s(),o("div",$r,[(s(),o(I,null,A([1,2,3],l=>a("div",{key:l,class:y(["phase me-1",{"phase-inactive":!t.isPhaseActive(l)}])},[a("div",{class:"target",style:w({width:"".concat(t.targetWidth(),"%")})},null,4),a("div",{class:"real",style:w({width:"".concat(t.realWidth(l),"%")})},null,4)],2)),64))])}const Be=v(Nr,[["render",Br],["__scopeId","data-v-c08337bb"]]),Vr={name:"LoadpointSettingsButton",props:{id:[String,Number]}},Mr={type:"button",class:"btn btn-sm btn-outline-secondary position-relative border-0 p-2 evcc-gray","data-testid":"loadpoint-settings-button"};function Er(e,i,n,d,r,t){return s(),o("button",Mr,i[0]||(i[0]=[a("shopicon-regular-adjust",{size:"s"},null,-1)]))}const Dr=v(Vr,[["render",Er]]),Rr={mixins:[C],props:{formId:Function,mode:String,batteryBoost:Boolean},emits:["batteryboost-updated"],data(){return{selectedEnabled:this.batteryBoost}},computed:{disabled(){return["off","now"].includes(this.mode)}},watch:{batteryBoost(e){this.selectedEnabled=e}},methods:{handleEnabledChange(){this.$emit("batteryboost-updated",this.selectedEnabled)}}},Or={class:"mb-3 row","data-testid":"battery-boost"},Ur=["for"],Fr={class:"col-sm-8 pe-0"},qr={class:"form-check form-switch my-1"},Wr=["id","disabled"],Hr=["for"],jr={key:0,class:"d-block text-primary"},zr={key:1,class:"d-block"};function Gr(e,i,n,d,r,t){return s(),o("div",null,[a("h6",null,c(e.$t("main.loadpointSettings.batteryUsage")),1),a("div",Or,[a("label",{for:n.formId("batteryBoost"),class:"col-sm-4 col-form-label pt-0 pt-sm-2"},c(e.$t("main.loadpointSettings.batteryBoost.label"))+" 🧪 ",9,Ur),a("div",Fr,[a("div",qr,[N(a("input",{id:n.formId("batteryBoost"),"onUpdate:modelValue":i[0]||(i[0]=l=>r.selectedEnabled=l),class:"form-check-input",type:"checkbox",role:"switch",disabled:t.disabled,"data-testid":"battery-boost-checkbox",onChange:i[1]||(i[1]=(...l)=>t.handleEnabledChange&&t.handleEnabledChange(...l))},null,40,Wr),[[Fe,r.selectedEnabled]]),a("label",{for:n.formId("batteryBoost"),class:"form-check-label"},[a("div",null,c(e.$t("main.loadpointSettings.batteryBoost.description")),1),r.selectedEnabled&&!t.disabled?(s(),o("span",jr,c(e.$t("main.loadpointSettings.batteryBoost.once")),1)):g("",!0),t.disabled?(s(),o("small",zr,c(e.$t("main.loadpointSettings.batteryBoost.mode")),1)):g("",!0)],8,Hr)])])])])}const Ve=v(Rr,[["render",Gr]]),ee=230,le=0,te=1,ie=3,Me=(e,i,n=-1)=>Array.from({length:(i-e)/n+1},(d,r)=>e+r*n),Ee=(e,i)=>{const n=new Set(e);return n.add(i),[...n].sort((d,r)=>r-d)},Kr={name:"LoadpointSettingsModal",components:{SmartCostLimit:ge,LoadpointSettingsBatteryBoost:Ve},mixins:[C,F],props:{id:[String,Number],phasesConfigured:Number,chargerPhases1p3p:Boolean,chargerSinglePhase:Boolean,batteryBoost:Boolean,batteryBoostAvailable:Boolean,mode:String,minSoc:Number,maxCurrent:Number,minCurrent:Number,title:String,smartCostLimit:Number,smartCostType:String,tariffGrid:Number,currency:String,multipleLoadpoints:Boolean},emits:["phasesconfigured-updated","maxcurrent-updated","mincurrent-updated","batteryboost-updated"],data(){return{selectedMaxCurrent:this.maxCurrent,selectedMinCurrent:this.minCurrent,selectedPhases:this.phasesConfigured,isModalVisible:!1}},computed:{phasesOptions(){return this.chargerSinglePhase?[]:this.chargerPhases1p3p?[le,ie,te]:[ie,te]},batteryBoostProps(){return this.collectProps(Ve)},maxPower(){if(this.chargerPhases1p3p){if(this.phasesConfigured===le)return this.maxPowerPhases(3);if([ie,te].includes(this.phasesConfigured))return this.maxPowerPhases(this.phasesConfigured)}return this.fmtW(this.maxCurrent*ee*this.phasesConfigured)},minPower(){if(this.chargerPhases1p3p){if(this.phasesConfigured===le)return this.minPowerPhases(1);if([ie,te].includes(this.phasesConfigured))return this.minPowerPhases(this.phasesConfigured)}return this.fmtW(this.minCurrent*ee*this.phasesConfigured)},minCurrentOptions(){const e=[...Me(Math.floor(this.maxCurrent),1),.5,.25,.125];return Ee(e,this.minCurrent).map(n=>this.currentOption(n,n===6))},maxCurrentOptions(){const e=Me(32,Math.ceil(this.minCurrent));return Ee(e,this.maxCurrent).map(n=>this.currentOption(n,n===16))},smartCostLimitProps(){return this.collectProps(ge)},loadpointId(){return this.id},smartCostAvailable(){return qe(this.smartCostType)}},watch:{maxCurrent(e){this.selectedMaxCurrent=e},minCurrent(e){this.selectedMinCurrent=e},phasesConfigured(e){this.selectedPhases=e},minSoc(e){this.selectedMinSoc=e}},mounted(){this.$refs.modal.addEventListener("show.bs.modal",this.modalVisible),this.$refs.modal.addEventListener("hidden.bs.modal",this.modalInvisible)},unmounted(){var e,i;(e=this.$refs.modal)==null||e.removeEventListener("show.bs.modal",this.modalVisible),(i=this.$refs.modal)==null||i.removeEventListener("hidden.bs.modal",this.modalInvisible)},methods:{maxPowerPhases(e){return this.fmtW(this.maxCurrent*ee*e)},minPowerPhases(e){return this.fmtW(this.minCurrent*ee*e)},formId(e){return"loadpoint_".concat(this.id,"_").concat(e)},changeMaxCurrent(){this.$emit("maxcurrent-updated",this.selectedMaxCurrent)},changeMinCurrent(){this.$emit("mincurrent-updated",this.selectedMinCurrent)},changePhasesConfigured(){this.$emit("phasesconfigured-updated",this.selectedPhases)},currentOption(e,i){let n="".concat(this.fmtNumber(e)," A");return i&&(n+=" (".concat(this.$t("main.loadpointSettings.default"),")")),{value:e,name:n}},modalVisible(){this.isModalVisible=!0},modalInvisible(){this.isModalVisible=!1},changeBatteryBoost(e){this.$emit("batteryboost-updated",e)}}},Zr=["id"],Yr={class:"modal-dialog modal-dialog-centered",role:"document"},Qr={class:"modal-content"},Jr={class:"modal-header"},Xr={class:"modal-title"},el={class:"modal-body"},tl={class:"container"},il={key:2,class:"mb-3 row"},nl=["for"],al={class:"col-sm-8 pe-0"},sl={key:0,class:"mt-0 mb-2"},ol=["id","name","value"],rl=["for"],ll={key:0},cl={class:"mb-3 row"},dl=["for"],ul={class:"col-sm-8 pe-0 d-flex align-items-center"},hl=["id"],ml=["value"],fl={class:"ms-3"},gl={class:"mb-3 row"},pl=["for"],vl={class:"col-sm-8 pe-0 d-flex align-items-center"},bl=["id"],yl=["value"],_l={class:"ms-3"};function Sl(e,i,n,d,r,t){const l=m("SmartCostLimit"),h=m("LoadpointSettingsBatteryBoost");return s(),b(ae,{to:"body"},[a("div",{id:"loadpointSettingsModal_".concat(n.id),ref:"modal",class:"modal fade text-dark modal-xl","data-bs-backdrop":"true",tabindex:"-1",role:"dialog","aria-hidden":"true","data-testid":"loadpoint-settings-modal"},[a("div",Yr,[a("div",Qr,[a("div",Jr,[a("h5",Xr,c(e.$t("main.loadpointSettings.title",[n.title])),1),i[6]||(i[6]=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),a("div",el,[a("div",tl,[r.isModalVisible&&t.smartCostAvailable?(s(),b(l,k({key:0},t.smartCostLimitProps,{class:"mt-2"}),null,16)):g("",!0),n.batteryBoostAvailable?(s(),b(h,k({key:1},t.batteryBoostProps,{class:"mt-2",onBatteryboostUpdated:t.changeBatteryBoost}),null,16,["onBatteryboostUpdated"])):g("",!0),a("h6",null,c(e.$t("main.loadpointSettings.currents")),1),t.phasesOptions.length?(s(),o("div",il,[a("label",{for:t.formId("phases_".concat(t.phasesOptions[0])),class:"col-sm-4 col-form-label pt-0"},c(e.$t("main.loadpointSettings.phasesConfigured.label")),9,nl),a("div",al,[n.chargerPhases1p3p?g("",!0):(s(),o("p",sl,[a("small",null,c(e.$t("main.loadpointSettings.phasesConfigured.no1p3pSupport")),1)])),(s(!0),o(I,null,A(t.phasesOptions,u=>(s(),o("div",{key:u,class:"form-check"},[N(a("input",{id:t.formId("phases_".concat(u)),"onUpdate:modelValue":i[0]||(i[0]=p=>r.selectedPhases=p),class:"form-check-input",type:"radio",name:t.formId("phases"),value:u,onChange:i[1]||(i[1]=(...p)=>t.changePhasesConfigured&&t.changePhasesConfigured(...p))},null,40,ol),[[nt,r.selectedPhases,void 0,{number:!0}]]),a("label",{class:"form-check-label",for:t.formId("phases_".concat(u))},[T(c(e.$t("main.loadpointSettings.phasesConfigured.phases_".concat(u)))+" ",1),u>0?(s(),o("small",ll,c(e.$t("main.loadpointSettings.phasesConfigured.phases_".concat(u,"_hint"),{min:t.minPowerPhases(u),max:t.maxPowerPhases(u)})),1)):g("",!0)],8,rl)]))),128))])])):g("",!0),a("div",cl,[a("label",{for:t.formId("maxcurrent"),class:"col-sm-4 col-form-label pt-0 pt-sm-2"},c(e.$t("main.loadpointSettings.maxCurrent.label")),9,dl),a("div",ul,[N(a("select",{id:t.formId("maxcurrent"),"onUpdate:modelValue":i[2]||(i[2]=u=>r.selectedMaxCurrent=u),class:"form-select form-select-sm w-50",onChange:i[3]||(i[3]=(...u)=>t.changeMaxCurrent&&t.changeMaxCurrent(...u))},[(s(!0),o(I,null,A(t.maxCurrentOptions,({value:u,name:p})=>(s(),o("option",{key:u,value:u},c(p),9,ml))),128))],40,hl),[[U,r.selectedMaxCurrent,void 0,{number:!0}]]),a("small",fl,"~ "+c(t.maxPower),1)])]),a("div",gl,[a("label",{for:t.formId("mincurrent"),class:"col-sm-4 col-form-label pt-0 pt-sm-2"},c(e.$t("main.loadpointSettings.minCurrent.label")),9,pl),a("div",vl,[N(a("select",{id:t.formId("mincurrent"),"onUpdate:modelValue":i[4]||(i[4]=u=>r.selectedMinCurrent=u),class:"form-select form-select-sm w-50",onChange:i[5]||(i[5]=(...u)=>t.changeMinCurrent&&t.changeMinCurrent(...u))},[(s(!0),o(I,null,A(t.minCurrentOptions,({value:u,name:p})=>(s(),o("option",{key:u,value:u},c(p),9,yl))),128))],40,bl),[[U,r.selectedMinCurrent,void 0,{number:!0}]]),a("small",_l,"~ "+c(t.minPower),1)])])])])])])],8,Zr)])}const De=v(Kr,[["render",Sl],["__scopeId","data-v-dccd6b68"]]);function wl(e,i){return O.sessionInfo[e-1]||i}function Pl(e,i){const n=[...O.sessionInfo];n[e-1]=i,n.map(d=>d||""),O.sessionInfo=n}const Cl={name:"LoadpointSessionInfo",components:{LabelAndValue:z,CustomSelect:ue},mixins:[C],props:{id:Number,sessionCo2PerKWh:{type:Number,default:0},sessionPricePerKWh:{type:Number,default:0},sessionPrice:{type:Number,default:0},currency:String,sessionSolarPercentage:{type:Number,default:0},chargeRemainingDurationInterpolated:Number,chargeDurationInterpolated:Number,tariffCo2:Number,tariffGrid:Number},data(){return{selectedKey:wl(this.id)}},computed:{options:function(){return[{key:"remaining",value:this.fmtDuration(this.chargeRemainingDurationInterpolated),available:this.chargeRemainingDurationInterpolated>0},{key:"duration",value:this.fmtDuration(this.chargeDurationInterpolated)},{key:"solar",value:this.solarFormatted},{key:"avgPrice",value:this.fmtAvgPrice(this.sessionPricePerKWh),valueSm:this.fmtAvgPriceShort(this.sessionPricePerKWh),available:this.tariffGrid!==void 0},{key:"price",value:this.priceFormatted,available:this.tariffGrid!==void 0},{key:"co2",value:this.fmtCo2Medium(this.sessionCo2PerKWh),valueSm:this.fmtCo2Short(this.sessionCo2PerKWh),available:this.tariffCo2!==void 0}].filter(({available:i})=>i===void 0||i)},optionKeys(){return this.options.map(e=>e.key)},selectOptions(){return this.optionKeys.map(e=>({name:this.$t("main.loadpoint.".concat(e)),value:e}))},selectedOption(){return this.options.find(e=>e.key===this.selectedKey)||this.options[0]},label(){return this.$t("main.loadpoint.".concat(this.selectedOption.key))},value(){return this.selectedOption.value},valueSm(){return this.selectedOption.valueSm},showSm(){return this.valueSm!==void 0},solarFormatted(){return this.fmtPercentage(this.sessionSolarPercentage,1)},priceFormatted(){return"".concat(this.fmtMoney(this.sessionPrice,this.currency)," ").concat(this.fmtCurrencySymbol(this.currency))}},methods:{fmtAvgPrice(e){return this.fmtPricePerKWh(e,this.currency,!1)},fmtAvgPriceShort(e){return this.fmtPricePerKWh(e,this.currency,!0)},nextSessionInfo(){const e=this.optionKeys.indexOf(this.selectedKey);this.selectedKey=this.optionKeys[e+1]||this.optionKeys[0],this.presist()},selectOption(e){this.selectedKey=e,this.presist()},presist(){Pl(this.id,this.selectedKey)}}},Tl={class:"sessionInfo"},kl={class:"text-decoration-underline","data-testid":"sessionInfoLabel"},Il={key:0,class:"d-block d-sm-none"};function xl(e,i,n,d,r,t){const l=m("CustomSelect"),h=m("LabelAndValue");return s(),o("div",Tl,[f(h,{class:"d-block",align:"end"},{label:P(()=>[f(l,{selected:r.selectedKey,options:t.selectOptions,"data-testid":"sessionInfoSelect",onChange:i[0]||(i[0]=u=>t.selectOption(u.target.value))},{default:P(()=>[a("span",kl,c(t.label),1)]),_:1},8,["selected","options"])]),value:P(()=>[a("div",{class:"value","data-testid":"sessionInfoValue",onClick:i[1]||(i[1]=(...u)=>t.nextSessionInfo&&t.nextSessionInfo(...u))},[a("div",{class:y({"d-none d-sm-block":t.showSm})},c(t.value),3),t.showSm?(s(),o("div",Il,c(t.valueSm),1)):g("",!0)])]),_:1})])}const Re=v(Cl,[["render",xl],["__scopeId","data-v-4d673aeb"]]),Ll={name:"Loadpoint",components:{Mode:ye,Vehicle:Ne,Phases:Be,LabelAndValue:z,LoadpointSettingsButton:Dr,LoadpointSettingsModal:De,LoadpointSessionInfo:Re,VehicleIcon:se},mixins:[C,F],props:{id:Number,single:Boolean,title:String,mode:String,effectiveLimitSoc:Number,limitEnergy:Number,remoteDisabled:Boolean,remoteDisabledSource:String,chargeDuration:Number,charging:Boolean,batteryBoost:Boolean,batteryConfigured:Boolean,sessionEnergy:Number,sessionCo2PerKWh:Number,sessionPricePerKWh:Number,sessionPrice:Number,sessionSolarPercentage:Number,chargerStatusReason:String,chargerFeatureIntegratedDevice:Boolean,chargerFeatureHeating:Boolean,chargerIcon:String,connected:Boolean,enabled:Boolean,vehicleDetectionActive:Boolean,vehicleRange:Number,vehicleSoc:Number,vehicleName:String,vehicleIcon:String,vehicleLimitSoc:Number,vehicles:Array,planActive:Boolean,planProjectedStart:String,planProjectedEnd:String,planOverrun:Number,planEnergy:Number,planTime:String,effectivePlanTime:String,effectivePlanSoc:Number,vehicleProviderLoggedIn:Boolean,vehicleProviderLoginPath:String,vehicleProviderLogoutPath:String,vehicleClimaterActive:Boolean,vehicleWelcomeActive:Boolean,chargePower:Number,chargedEnergy:Number,chargeRemainingDuration:Number,phasesConfigured:Number,phasesActive:Number,chargerPhases1p3p:Boolean,chargerSinglePhase:Boolean,minCurrent:Number,maxCurrent:Number,chargeCurrent:Number,connectedDuration:Number,chargeCurrents:Array,chargeRemainingEnergy:Number,phaseAction:String,phaseRemaining:Number,pvRemaining:Number,pvAction:String,smartCostLimit:{type:Number,default:null},smartCostType:String,smartCostActive:Boolean,smartCostNextStart:String,tariffGrid:Number,tariffCo2:Number,currency:String,multipleLoadpoints:Boolean,gridConfigured:Boolean,pvConfigured:Boolean},data(){return{tickerHandler:null,phaseRemainingInterpolated:this.phaseRemaining,pvRemainingInterpolated:this.pvRemaining,chargeDurationInterpolated:this.chargeDuration,chargeRemainingDurationInterpolated:this.chargeRemainingDuration}},computed:{vehicle:function(){var e;return(e=this.vehicles)==null?void 0:e.find(i=>i.name===this.vehicleName)},vehicleTitle:function(){var e;return(e=this.vehicle)==null?void 0:e.title},loadpointTitle:function(){return this.title||this.$t("main.loadpoint.fallbackName")},integratedDevice:function(){return this.chargerFeatureIntegratedDevice},heating:function(){return this.chargerFeatureHeating},phasesProps:function(){return this.collectProps(Be)},modeProps:function(){return this.collectProps(ye)},sessionInfoProps:function(){return this.collectProps(Re)},settingsModal:function(){return this.collectProps(De)},vehicleProps:function(){return this.collectProps(Ne)},showChargingIndicator:function(){return this.charging&&this.chargePower>0},vehicleKnown:function(){return!!this.vehicleName},vehicleHasSoc:function(){var e,i;return this.vehicleKnown&&!((i=(e=this.vehicle)==null?void 0:e.features)!=null&&i.includes("Offline"))},vehicleNotReachable:function(){var i;const e=((i=this.vehicle)==null?void 0:i.features)||[];return e.includes("Offline")&&e.includes("Retryable")},planTimeUnreachable:function(){return this.planOverrun>60},socBasedCharging:function(){return this.vehicleHasSoc||this.vehicleSoc>0},socBasedPlanning:function(){var e;return this.socBasedCharging&&((e=this.vehicle)==null?void 0:e.capacity)>0},pvPossible:function(){return this.pvConfigured||this.gridConfigured},hasSmartCost:function(){return qe(this.smartCostType)},batteryBoostAvailable:function(){return this.batteryConfigured&&this.$hiddenFeatures()},batteryBoostActive:function(){return this.batteryBoost&&this.charging&&!["off","now"].includes(this.mode)}},watch:{phaseRemaining(){this.phaseRemainingInterpolated=this.phaseRemaining},pvRemaining(){this.pvRemainingInterpolated=this.pvRemaining},chargeDuration(){this.chargeDurationInterpolated=this.chargeDuration},chargeRemainingDuration(){this.chargeRemainingDurationInterpolated=this.chargeRemainingDuration}},mounted(){this.tickerHandler=setInterval(this.tick,1e3)},unmounted(){clearInterval(this.tickerHandler)},methods:{tick(){this.phaseRemainingInterpolated>0&&this.phaseRemainingInterpolated--,this.pvRemainingInterpolated>0&&this.pvRemainingInterpolated--,this.chargeDurationInterpolated>0&&this.charging&&this.chargeDurationInterpolated++,this.chargeRemainingDurationInterpolated>0&&this.charging&&this.chargeRemainingDurationInterpolated--},apiPath:function(e){return"loadpoints/"+this.id+"/"+e},setTargetMode:function(e){x.post(this.apiPath("mode")+"/"+e)},setLimitSoc:function(e){x.post(this.apiPath("limitsoc")+"/"+e)},setLimitEnergy:function(e){x.post(this.apiPath("limitenergy")+"/"+e)},setMaxCurrent:function(e){x.post(this.apiPath("maxcurrent")+"/"+e)},setMinCurrent:function(e){x.post(this.apiPath("mincurrent")+"/"+e)},setPhasesConfigured:function(e){x.post(this.apiPath("phases")+"/"+e)},changeVehicle(e){x.post(this.apiPath("vehicle")+"/".concat(e))},removeVehicle(){x.delete(this.apiPath("vehicle"))},setBatteryBoost:function(e){x.post(this.apiPath("batteryboost")+"/".concat(e?"1":"0"))},fmtPower(e){return this.fmtW(e,E.AUTO)},fmtEnergy(e){return this.fmtWh(e,E.AUTO)},openSettingsModal(){q.getOrCreateInstance(document.getElementById("loadpointSettingsModal_".concat(this.id))).show()}}},Al={class:"loadpoint d-flex flex-column pt-4 pb-2 px-3 px-sm-4 mx-2 mx-sm-0"},Nl={class:"d-block d-sm-flex justify-content-between align-items-center mb-3"},$l={class:"d-flex justify-content-between align-items-center mb-3 text-truncate"},Bl={class:"me-2 mb-0 text-truncate d-flex"},Vl={class:"text-truncate"},Ml={class:"mb-3 d-flex align-items-center"},El={class:"details d-flex align-items-start mb-2"},Dl={class:"d-flex align-items-center"};function Rl(e,i,n,d,r,t){const l=m("VehicleIcon"),h=m("LoadpointSettingsButton"),u=m("Mode"),p=m("LoadpointSettingsModal"),S=m("LabelAndValue"),_=m("Phases"),$=m("LoadpointSessionInfo"),D=m("Vehicle");return s(),o("div",Al,[a("div",Nl,[a("div",$l,[a("h3",Bl,[n.chargerIcon?(s(),b(l,{key:0,name:n.chargerIcon,class:"me-2 flex-shrink-0"},null,8,["name"])):g("",!0),a("div",Vl,c(t.loadpointTitle),1)]),f(h,{class:"d-block d-sm-none",onClick:t.openSettingsModal},null,8,["onClick"])]),a("div",Ml,[f(u,k({class:"flex-grow-1"},t.modeProps,{onUpdated:t.setTargetMode}),null,16,["onUpdated"]),f(h,{id:n.id,class:"d-none d-sm-block ms-2",onClick:t.openSettingsModal},null,8,["id","onClick"])])]),f(p,k(t.settingsModal,{onMaxcurrentUpdated:t.setMaxCurrent,onMincurrentUpdated:t.setMinCurrent,onPhasesconfiguredUpdated:t.setPhasesConfigured,onBatteryboostUpdated:t.setBatteryBoost}),null,16,["onMaxcurrentUpdated","onMincurrentUpdated","onPhasesconfiguredUpdated","onBatteryboostUpdated"]),n.remoteDisabled?(s(),o("div",{key:0,class:y(["alert alert-warning my-4 py-2","".concat(n.remoteDisabled==="hard"?"alert-danger":"alert-warning")]),role:"alert"},c(e.$t(n.remoteDisabled==="hard"?"main.loadpoint.remoteDisabledHard":"main.loadpoint.remoteDisabledSoft",{source:n.remoteDisabledSource})),3)):g("",!0),a("div",El,[a("div",null,[a("div",Dl,[f(S,{label:e.$t("main.loadpoint.power"),value:n.chargePower,valueFmt:t.fmtPower,class:"mb-2 text-nowrap",align:"start"},null,8,["label","value","valueFmt"]),a("shopicon-regular-lightning",{class:y(["text-evcc opacity-transiton","opacity-".concat(t.showChargingIndicator?"100":"0")]),size:"m"},null,2)]),f(_,k(t.phasesProps,{class:["opacity-transiton","opacity-".concat(t.showChargingIndicator?"100":"0")]}),null,16,["class"])]),N(f(S,{label:e.$t("main.loadpoint.charged"),value:t.fmtEnergy(n.chargedEnergy),align:"center"},null,8,["label","value"]),[[K,t.socBasedCharging]]),f($,L(B(t.sessionInfoProps)),null,16)]),i[0]||(i[0]=a("hr",{class:"divider"},null,-1)),f(D,k({class:"flex-grow-1 d-flex flex-column justify-content-end"},t.vehicleProps,{onLimitSocUpdated:t.setLimitSoc,onLimitEnergyUpdated:t.setLimitEnergy,onChangeVehicle:t.changeVehicle,onRemoveVehicle:t.removeVehicle,onOpenLoadpointSettings:t.openSettingsModal}),null,16,["onLimitSocUpdated","onLimitEnergyUpdated","onChangeVehicle","onRemoveVehicle","onOpenLoadpointSettings"])])}const Ol=v(Ll,[["render",Rl],["__scopeId","data-v-f4d67e94"]]),Ul={name:"Loadpoints",components:{Loadpoint:Ol},props:{loadpoints:Array,vehicles:Array,smartCostType:String,tariffGrid:Number,tariffCo2:Number,currency:String,selectedIndex:Number,gridConfigured:Boolean,pvConfigured:Boolean,batteryConfigured:Boolean},emits:["index-changed"],data(){return{snapTimeout:null,scrollTimeout:null,highlightedIndex:0}},watch:{selectedIndex:function(e){this.scrollTo(e)}},mounted(){this.selectedIndex>0&&this.$refs.carousel.scrollTo({top:0,left:this.left(this.selectedIndex)}),this.$refs.carousel.addEventListener("scroll",this.handleCarouselScroll)},unmounted(){this.$refs.carousel&&this.$refs.carousel.removeEventListener("scroll",this.handleCarouselScroll)},methods:{handleCarouselScroll(){const{scrollLeft:e}=this.$refs.carousel,{offsetWidth:i}=this.$refs.carousel.children[0];this.highlightedIndex=Math.round((e-7.5)/i),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.highlightedIndex!==this.selectedIndex&&this.$emit("index-changed",this.highlightedIndex)},2e3)},goTo(e){this.$emit("index-changed",e)},isCharging(e){return e.charging&&e.chargePower>0},selected(e){return this.highlightedIndex===e},left(e){return this.$refs.carousel.children[0].offsetWidth*e},scrollTo(e){this.highlightedIndex=e;const i=this.$refs.carousel;i.style.scrollSnapType="none",i.scrollTo({top:0,left:this.left(e),behavior:"smooth"}),clearTimeout(this.snapTimeout),this.snapTimeout=setTimeout(()=>{this.$refs.carousel.style.scrollSnapType="x mandatory"},1e3)}}},Fl={class:"container container--loadpoint px-0 mb-md-2 d-flex flex-column justify-content-center"},ql={key:0,class:"d-flex d-lg-none justify-content-center"},Wl=["onClick"],Hl={key:0,class:"indicator-icon"},jl={key:1,class:"indicator-icon"},zl={key:2,class:"indicator-icon"};function Gl(e,i,n,d,r,t){const l=m("Loadpoint");return s(),o("div",Fl,[a("div",{ref:"carousel",class:y(["carousel d-lg-flex flex-wrap","carousel--".concat(n.loadpoints.length)])},[(s(!0),o(I,null,A(n.loadpoints,(h,u)=>(s(),o("div",{key:u,class:"flex-grow-1 mb-3 m-lg-0 p-lg-0"},[f(l,k({ref_for:!0},h,{id:u+1,"data-testid":"loadpoint",vehicles:n.vehicles,smartCostType:n.smartCostType,tariffGrid:n.tariffGrid,tariffCo2:n.tariffCo2,currency:n.currency,multipleLoadpoints:n.loadpoints.length>1,gridConfigured:n.gridConfigured,pvConfigured:n.pvConfigured,batteryConfigured:n.batteryConfigured,class:["h-100",{"loadpoint-unselected":!t.selected(u)}],onClick:p=>t.goTo(u)}),null,16,["id","vehicles","smartCostType","tariffGrid","tariffCo2","currency","multipleLoadpoints","gridConfigured","pvConfigured","batteryConfigured","class","onClick"])]))),128))],2),n.loadpoints.length>1?(s(),o("div",ql,[(s(!0),o(I,null,A(n.loadpoints,(h,u)=>(s(),o("button",{key:u,class:y(["btn btn-sm btn-link p-0 mx-1 indicator d-flex justify-content-center align-items-center evcc-default-text",{"indicator--selected":t.selected(u)}]),onClick:p=>t.goTo(u)},[t.isCharging(h)?(s(),o("shopicon-filled-lightning",Hl)):h.connected?(s(),o("shopicon-filled-circle",jl)):(s(),o("shopicon-bold-circle",zl))],10,Wl))),128))])):g("",!0)])}const Kl=v(Ul,[["render",Gl],["__scopeId","data-v-b91b635c"]]);var Zl='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><style></style><g id="Your_Icons"><path d="M0 .008h48v48H0z" fill="none"/><path d="M39.114 34.332C37.38 31.449 32.326 23.487 31 21.402V10h1a2 2 0 000-4H16a2 2 0 000 4h1v11.402c-1.326 2.085-6.38 10.047-8.114 12.93-.512.852-.772 1.749-.772 2.668 0 2.757 2.243 5 4.999 5h21.773c2.757 0 5-2.243 5-5 0-.919-.26-1.816-.772-2.668zM20.688 23.059c.204-.322.312-.694.312-1.075V10.003h6v11.981a2 2 0 00.312 1.074c.031.049 1.55 2.435 3.325 5.244l-15.434 3.43c2.495-3.976 5.441-8.605 5.485-8.673z"/></g></svg>';class Yl extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Zl}}window.customElements.define("shopicon-filled-testtube",Yl);const Ql={name:"Logo"},Jl={viewBox:"0 0 122 35",xmlns:"http://www.w3.org/2000/svg","fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"};function Xl(e,i,n,d,r,t){return s(),o("svg",Jl,i[0]||(i[0]=[a("path",{d:"M13.082 29.071a12.384 12.384 0 01-9-3.42 12.192 12.192 0 01-3.54-9.12v-.64a15.394 15.394 0 011.47-6.83 10.825 10.825 0 014.17-4.64 11.64 11.64 0 016.15-1.63 10.45 10.45 0 018.21 3.26c2 2.194 3 5.297 3 9.31v2.76H7.382a6.348 6.348 0 002 4 5.997 5.997 0 004.16 1.49 7.305 7.305 0 006.1-2.84l3.31 3.73a10 10 0 01-4.13 3.39 13.309 13.309 0 01-5.74 1.18zm-.77-20.84a4.216 4.216 0 00-3.26 1.37 7.141 7.141 0 00-1.6 3.91h9.39v-.55a5.005 5.005 0 00-1.22-3.49 4.304 4.304 0 00-3.31-1.24zM36.452 20.331l4.7-17.09h7l-8.48 25.36h-6.44l-8.52-25.36h7l4.74 17.09zM85.542 23.611a4.444 4.444 0 003-1 3.638 3.638 0 001.22-2.75h6.32a8.668 8.668 0 01-1.4 4.73 9.145 9.145 0 01-3.79 3.3 11.736 11.736 0 01-5.29 1.19 10.912 10.912 0 01-8.54-3.46c-2.087-2.3-3.13-5.483-3.13-9.55v-.45c0-3.9 1.033-7.016 3.1-9.35a10.868 10.868 0 018.51-3.5c2.791-.134 5.524.84 7.6 2.71a9.626 9.626 0 012.9 7.21h-6.3a4.663 4.663 0 00-1.2-3.22 4.005 4.005 0 00-3.08-1.24 4.068 4.068 0 00-3.56 1.73c-.8 1.15-1.2 3-1.2 5.6v.7c0 2.61.39 4.49 1.19 5.63a4.092 4.092 0 003.65 1.72zM110.422 23.611a4.454 4.454 0 003-1 3.63 3.63 0 001.21-2.75h6.33a8.668 8.668 0 01-1.4 4.73 9.143 9.143 0 01-3.73 3.3 11.76 11.76 0 01-5.29 1.18 10.912 10.912 0 01-8.54-3.46c-2.087-2.3-3.13-5.483-3.13-9.55v-.45c0-3.9 1.033-7.016 3.1-9.35a10.85 10.85 0 018.57-3.49 10.575 10.575 0 017.6 2.71 9.598 9.598 0 012.91 7.21h-6.33a4.651 4.651 0 00-1.21-3.22 4.492 4.492 0 00-6.64.49c-.8 1.15-1.21 3-1.21 5.6v.7c0 2.607.4 4.484 1.2 5.63a4.09 4.09 0 003.56 1.72z",fill:"#fff",class:"letter","fill-rule":"nonzero"},null,-1),a("path",{d:"M58.462.751h9.22l-6.14 12.3h6.15l-11.53 21.51 2.3-15.36h-7.68l7.68-18.45z",fill:"#0fdd42","fill-rule":"nonzero"},null,-1),a("path",{fill:"none",d:"M-24.458-22.109h170v76h-170z"},null,-1)]))}const ec=v(Ql,[["render",Xl],["__scopeId","data-v-239c7b9a"]]),tc={name:"Version",components:{Logo:ec},props:{installed:String,available:String,releaseNotes:String,commit:String,hasUpdater:Boolean,uploadMessage:String,uploadProgress:Number},data:function(){return{updateStarted:!1,updateStatus:""}},computed:{githubHashUrl:function(){return"https://github.com/evcc-io/evcc/commit/".concat(this.commit)},newVersionAvailable:function(){return this.available&&this.installed!="[[.Version]]"&&this.installed!="0.0.0"&&this.available!=this.installed}},methods:{update:async function(){try{await x.post("update"),this.updateStatus=this.$t("footer.version.modalUpdateStatusStart"),this.updateStarted=!0}catch(e){this.updateStatus="".concat(this.$t("footer.version.modalUpdateStatusStart")," ").concat(e)}},releaseNotesUrl:function(e){return e=="0.0.0"?"https://github.com/evcc-io/evcc/releases":"https://github.com/evcc-io/evcc/releases/tag/".concat(e)},openModal(){q.getOrCreateInstance(document.getElementById("updateModal")).show()}}},ic={class:"text-truncate"},nc=["href"],ac={class:"text-decoration-underline text-truncate"},sc={class:"text-decoration-underline text-truncate"},oc={class:"ms-2 d-none d-sm-block text-gray-medium text-decoration-underline"},rc=["href"],lc={class:"text-decoration-underline text-truncate"},cc={id:"updateModal",class:"modal fade text-dark",tabindex:"-1",role:"dialog","aria-hidden":"true"},dc={class:"modal-dialog modal-dialog-centered",role:"document"},uc={class:"modal-content"},hc={class:"modal-header"},mc={class:"modal-title"},fc={class:"modal-body"},gc={key:0},pc={class:"progress my-3"},vc={key:1},bc=["innerHTML"],yc={key:1},_c=["href"],Sc={class:"modal-footer d-flex justify-content-between"},wc=["disabled"],Pc=["disabled"],Cc={key:0},Tc={key:1},kc=["href"];function Ic(e,i,n,d,r,t){const l=m("Logo");return s(),o("div",ic,[n.commit?(s(),o("a",{key:0,href:t.githubHashUrl,target:"_blank",class:"btn btn-link ps-0 text-decoration-none evcc-default-text text-nowrap d-flex align-items-end"},[f(l,{class:"logo me-2 flex-shrink-0"}),a("span",ac,"v"+c(n.installed),1),i[2]||(i[2]=a("shopicon-regular-moonstars",{class:"ms-2 text-gray-light flex-shrink-0"},null,-1))],8,nc)):t.newVersionAvailable?(s(),o("button",{key:1,href:"#",class:"btn btn-link ps-0 text-decoration-none evcc-default-text text-nowrap d-flex align-items-end",onClick:i[0]||(i[0]=(...h)=>t.openModal&&t.openModal(...h))},[i[3]||(i[3]=a("shopicon-regular-gift",{class:"me-2"},null,-1)),a("span",sc,"v"+c(n.installed),1),a("span",oc,c(e.$t("footer.version.availableLong")),1)])):(s(),o("a",{key:2,href:t.releaseNotesUrl(n.installed),target:"_blank",class:"btn btn-link evcc-default-text ps-0 text-decoration-none text-nowrap d-flex align-items-end"},[f(l,{class:"logo me-2 flex-shrink-0"}),a("span",lc,"v"+c(n.installed),1)],8,rc)),(s(),b(ae,{to:"body"},[a("div",cc,[a("div",dc,[a("div",uc,[a("div",hc,[a("h5",mc,c(e.$t("footer.version.modalTitle")),1),i[4]||(i[4]=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),a("div",fc,[e.updateStarted?(s(),o("div",gc,[a("p",null,c(e.$t("footer.version.modalUpdateStarted")),1),a("div",pc,[a("div",{class:"progress-bar progress-bar-striped progress-bar-animated",role:"progressbar",style:w({width:n.uploadProgress+"%"})},null,4)]),a("p",null,c(e.updateStatus)+" "+c(n.uploadMessage),1)])):(s(),o("div",vc,[a("p",null,[a("small",null,c(e.$t("footer.version.modalInstalledVersion"))+": "+c(n.installed),1)]),n.releaseNotes?(s(),o("div",{key:0,innerHTML:n.releaseNotes},null,8,bc)):(s(),o("p",yc,[T(c(e.$t("footer.version.modalNoReleaseNotes"))+" ",1),a("a",{href:t.releaseNotesUrl(n.available)},"GitHub",8,_c),i[5]||(i[5]=T(". "))]))]))]),a("div",Sc,[a("button",{type:"button",class:"btn btn-outline-secondary",disabled:e.updateStarted,"data-bs-dismiss":"modal"},c(e.$t("footer.version.modalCancel")),9,wc),a("div",null,[n.hasUpdater?(s(),o("button",{key:0,type:"button",class:"btn btn-primary",disabled:e.updateStarted,onClick:i[1]||(i[1]=(...h)=>t.update&&t.update(...h))},[e.updateStarted?(s(),o("span",Cc,[i[6]||(i[6]=a("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),T(" "+c(e.$t("footer.version.modalUpdate")),1)])):(s(),o("span",Tc,c(e.$t("footer.version.modalUpdateNow")),1))],8,Pc)):(s(),o("a",{key:1,href:t.releaseNotesUrl(n.available),class:"btn btn-primary"},c(e.$t("footer.version.modalDownload")),9,kc))])])])])])]))])}const xc=v(tc,[["render",Ic],["__scopeId","data-v-8faa8aea"]]),Lc={name:"SavingsTile",components:{AnimatedNumber:W},mixins:[C],props:{title:String,icon:String,value:[String,Number],valueFmt:Function,unit:String,sub1:String,sub2:String},computed:{leadingUnit(){return this.unit==="%"&&this.hasLeadingPercentageSign()}}},Ac={class:"flex-shrink-1 d-flex mb-4 mb-lg-0 align-items-center align-items-lg-start"},Nc={key:0,class:"tile-icon"},$c={key:1,class:"tile-icon"},Bc={key:2,class:"tile-icon"},Vc={key:3,class:"tile-icon"},Mc={key:4,class:"tile-icon"},Ec={class:"ms-3 d-flex flex-grow-1 d-lg-block align-items-center justify-content-between"},Dc={class:"my-0 fw-bold text-truncate"},Rc={class:"d-flex align-items-baseline lh-sm"},Oc={class:"fs-1 value order-1"},Uc={key:1},Fc={class:"d-block mt-0 ms-3 ms-lg-0 text-end text-lg-start"};function qc(e,i,n,d,r,t){const l=m("AnimatedNumber");return s(),o("div",Ac,[n.icon==="sun"?(s(),o("shopicon-regular-sun",Nc)):g("",!0),n.icon==="lightning"?(s(),o("shopicon-regular-lightning",$c)):g("",!0),n.icon==="receivepayment"?(s(),o("shopicon-regular-receivepayment",Bc)):g("",!0),n.icon==="car"?(s(),o("shopicon-regular-car3",Vc)):g("",!0),n.icon==="eco"?(s(),o("shopicon-regular-eco1",Mc)):g("",!0),a("div",Ec,[a("div",null,[a("p",Dc,c(n.title),1),a("strong",Rc,[a("span",Oc,[n.valueFmt?(s(),b(l,{key:0,to:n.value,format:n.valueFmt},null,8,["to","format"])):(s(),o("span",Uc,c(n.value),1))]),a("span",{class:y(["unit",t.leadingUnit?"order-0 me-1":"order-2 ms-1"])},c(n.unit),3)])]),a("small",Fc,[T(c(n.sub1)+" ",1),i[0]||(i[0]=a("br",null,null,-1)),T(" "+c(n.sub2),1)])])])}const Ke=v(Lc,[["render",qc],["__scopeId","data-v-60d56bd3"]]),Ze=at.create({baseURL:"https://api.evcc.io/v1/",headers:{Accept:"application/json"}});Ze.interceptors.response.use(e=>e,e=>{const i=e.config.baseURL+e.config.url,n="".concat(e.message,": API request failed ").concat(i);return window.app.raise({message:n}),Promise.reject(e)});const Wc=10,Hc={name:"LiveCommunity",components:{SavingsTile:Ke},mixins:[C],props:{},data(){return{refresh:null,result:{}}},computed:{totalClients(){return this.result.totalClients},activeClients(){return this.result.activeClients},chargePower(){const{chargePower:e=0}=this.result;return e<1e6?{value:e/1e3,unit:"kW"}:e<1e9?{value:e/1e6,unit:"MW"}:e<1e12?{value:e/1e9,unit:"GW"}:{value:e/1e12,unit:"TW"}},greenShare(){const{chargePower:e,greenPower:i}=this.result;return e?100/e*i:0},greenEnergy(){const{greenEnergy:e=0}=this.result;return e<1e3?{value:e,unit:"kWh"}:e<1e6?{value:e/1e3,unit:"MWh"}:e<1e9?{value:e/1e6,unit:"GWh"}:{value:e/1e9,unit:"TWh"}}},async mounted(){this.refresh=setInterval(this.update,Wc*1e3),await this.update()},unmounted(){clearInterval(this.refresh)},methods:{async update(){try{const e=await Ze.get("total");this.result=e.data||{}}catch(e){console.error(e)}},fmtAnimation(e){let i=0;return e<100&&(i=1),e<10&&(i=2),this.fmtNumber(e,i)}}},jc={class:"d-block d-lg-flex mb-2 justify-content-between"};function zc(e,i,n,d,r,t){const l=m("SavingsTile");return s(),o("div",jc,[f(l,{class:"text-accent2",icon:"car",title:e.$t("footer.community.power"),value:t.chargePower.value,valueFmt:t.fmtAnimation,unit:t.chargePower.unit,sub1:e.$t("footer.community.powerSub1",{totalClients:t.totalClients,activeClients:t.activeClients}),sub2:e.$t("footer.community.powerSub2")},null,8,["title","value","valueFmt","unit","sub1","sub2"]),f(l,{class:"text-accent1",icon:"sun",title:e.$t("footer.community.greenShare"),value:t.greenShare,valueFmt:t.fmtAnimation,unit:"%",sub1:e.$t("footer.community.greenShareSub1"),sub2:e.$t("footer.community.greenShareSub2")},null,8,["title","value","valueFmt","sub1","sub2"]),f(l,{class:"text-accent3",icon:"lightning",title:e.$t("footer.community.greenEnergy"),value:t.greenEnergy.value,valueFmt:t.fmtAnimation,unit:t.greenEnergy.unit,sub1:e.$t("footer.community.greenEnergySub1"),sub2:e.$t("footer.community.greenEnergySub2")},null,8,["title","value","valueFmt","unit","sub1","sub2"])])}const Gc=v(Hc,[["render",zc]]),Kc=[{name:"Australia",co2:503},{name:"Austria",co2:158},{name:"Canada",co2:128},{name:"Czech Republic",co2:415},{name:"Denmark",co2:181},{name:"Estonia",co2:464},{name:"Europe",co2:278},{name:"Finland",co2:131},{name:"France",co2:85},{name:"Germany",co2:385},{name:"Netherlands",co2:356},{name:"Norway",co2:29},{name:"Poland",co2:635},{name:"Sweden",co2:45},{name:"Switzerland",co2:46},{name:"United Kingdom",co2:257},{name:"United States",co2:367},{name:"World",co2:436}],ce={regions:Kc},Zc={name:"Savings",components:{Sponsor:lt,SavingsTile:Ke,LiveCommunity:Gc,TelemetrySettings:st,CustomSelect:ue},mixins:[C],props:{statistics:{type:Object,default:()=>({})},co2Configured:Boolean,sponsor:Object,currency:String},data(){return{communityView:!1,telemetryEnabled:!1,period:O.savingsPeriod||"30d",selectedRegion:O.savingsRegion||"Germany",referenceGrid:void 0}},computed:{tariffLink(){return"".concat(ot(),"/docs/reference/configuration/tariffs")},percent(){return this.fmtPercentage(this.solarPercentage||0)},regionOptions(){return ce.regions.map(e=>({value:e.name,name:"".concat(e.name," (").concat(this.fmtCo2Short(e.co2),")")}))},region(){if(this.selectedRegion){const e=ce.regions.find(i=>i.name===this.selectedRegion);if(e)return e}return ce.regions[0]},periodOptions(){return["30d","365d","thisYear","total"].map(e=>({value:e,name:this.$t("footer.savings.period.".concat(e))}))},avgPriceFormatted(){const e=this.fmtPricePerKWh(this.currentStatistics.avgPrice,this.currency,!1,!1),i=this.pricePerKWhUnit(this.currency);return{value:e,unit:i}},currentStatistics(){return this.statistics[this.period]||{}},totalCharged(){return this.currentStatistics.chargedKWh},solarPercentage(){return this.currentStatistics.solarPercentage},solarCharged(){return this.solarPercentage/100*this.totalCharged},gridCharged(){return this.totalCharged-this.solarCharged},avgPrice(){return this.currentStatistics.avgPrice},avgCo2(){return this.currentStatistics.avgCo2},priceConfigured(){return this.referenceGrid!==void 0}},methods:{showCommunity(){this.communityView=!0},showMyData(){this.communityView=!1},openModal(){q.getOrCreateInstance(document.getElementById("savingsModal")).show(),this.updateReferenceGrid()},selectPeriod(e){this.period=e,O.savingsPeriod=e},selectRegion(e){this.selectedRegion=e,O.savingsRegion=e},updateReferenceGrid:async function(){try{const e=await x.get("tariff/grid",{validateStatus:n=>n>=200&&n<500}),{rates:i}=e.data.result;this.referenceGrid=i.reduce((n,d)=>n+d.price,0)/i.length}catch(e){this.referenceGrid=void 0,console.error(e)}}}},Yc={class:"d-inline d-sm-none text-decoration-underline"},Qc={class:"d-none d-sm-inline text-decoration-underline"},Jc={id:"savingsModal",ref:"modal",class:"modal fade text-dark","data-bs-backdrop":"true",tabindex:"-1",role:"dialog","aria-hidden":"true","data-testid":"savings-modal"},Xc={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},ed={class:"modal-content"},td={class:"modal-header"},id={class:"modal-title"},nd={class:"modal-body"},ad={class:"nav nav-tabs"},sd={class:"nav-item"},od={class:"nav-item"},rd={key:0,class:"my-4"},ld={class:"d-block d-lg-flex mb-2 justify-content-between"},cd={class:"my-3 lh-2"},dd={class:"d-flex"},ud={for:"savingsPeriod",class:"me-1"},hd={class:"text-decoration-underline evcc-gray"},md={key:0,class:"d-flex flex-wrap","data-testid":"savings-reference"},fd={class:"me-1"},gd={class:"evcc-gray me-1"},pd={class:"evcc-gray d-flex"},vd={class:"me-1"},bd={class:"text-decoration-underline"},yd={key:1},_d=["href"],Sd={key:1,class:"my-4"};function wd(e,i,n,d,r,t){const l=m("SavingsTile"),h=m("CustomSelect"),u=m("LiveCommunity"),p=m("TelemetrySettings"),S=m("Sponsor");return s(),o("div",null,[a("button",{class:"btn btn-link pe-0 text-decoration-none evcc-default-text text-nowrap d-flex align-items-end","data-testid":"savings-button",onClick:i[0]||(i[0]=(..._)=>t.openModal&&t.openModal(..._))},[a("span",Yc,c(e.$t("footer.savings.footerShort",{percent:t.percent})),1),a("span",Qc,c(e.$t("footer.savings.footerLong",{percent:t.percent})),1),i[5]||(i[5]=a("shopicon-regular-sun",{class:"ms-2 text-evcc"},null,-1))]),(s(),b(ae,{to:"body"},[a("div",Jc,[a("div",Xc,[a("div",ed,[a("div",td,[a("h5",id,c(e.$t("footer.savings.modalTitle")),1),i[6]||(i[6]=a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),a("div",nd,[a("ul",ad,[a("li",sd,[a("a",{class:y(["nav-link",{active:!r.communityView}]),href:"#",onClick:i[1]||(i[1]=Q((..._)=>t.showMyData&&t.showMyData(..._),["prevent"]))},c(e.$t("footer.savings.tabTitle")),3)]),a("li",od,[a("a",{class:y(["nav-link",{active:r.communityView}]),href:"#",onClick:i[2]||(i[2]=Q((..._)=>t.showCommunity&&t.showCommunity(..._),["prevent"]))},c(e.$t("footer.community.tabTitle")),3)])]),r.communityView?(s(),o("div",Sd,[f(u),f(p,{sponsorActive:!!n.sponsor.name},null,8,["sponsorActive"])])):(s(),o("div",rd,[a("div",ld,[f(l,{class:"text-accent1",icon:"sun","data-testid":"savings-tile-solar",title:e.$t("footer.savings.percentTitle"),value:e.fmtNumber(t.solarPercentage,1),unit:"%",sub1:e.$t("footer.savings.percentSelf",{self:e.fmtW(t.solarCharged*1e3,e.POWER_UNIT.KW,!1,0)}),sub2:e.$t("footer.savings.percentGrid",{grid:e.fmtW(t.gridCharged*1e3,e.POWER_UNIT.KW,!1,0)})},null,8,["title","value","sub1","sub2"]),f(l,{class:"text-accent2",icon:"receivepayment","data-testid":"savings-tile-price",title:e.$t("footer.savings.priceTitle"),value:t.priceConfigured?t.avgPriceFormatted.value:"__",unit:t.avgPriceFormatted.unit,sub1:t.priceConfigured?"".concat(e.fmtMoney((r.referenceGrid-t.avgPrice)*t.totalCharged,n.currency,!1)," ").concat(e.fmtCurrencySymbol(n.currency)," ").concat(e.$t("footer.savings.moneySaved")):""},null,8,["title","value","unit","sub1"]),f(l,{class:"text-accent3",icon:"eco","data-testid":"savings-tile-co2",title:e.$t("footer.savings.co2Title"),value:n.co2Configured?e.fmtNumber(t.avgCo2,0):"__",unit:"g/kWh",sub1:t.region&&n.co2Configured?"".concat(e.fmtNumber((t.region.co2-t.avgCo2)*t.totalCharged/1e3,0,"kilogram")," ").concat(e.$t("footer.savings.co2Saved")):""},null,8,["title","value","sub1"])]),a("div",cd,[a("div",dd,[a("label",ud,c(e.$t("footer.savings.periodLabel")),1),f(h,{id:"savingsPeriod",selected:r.period,options:t.periodOptions,"data-testid":"savings-period-select",onChange:i[3]||(i[3]=_=>t.selectPeriod(_.target.value))},{default:P(()=>[a("span",hd,c(e.$t("footer.savings.period.".concat(r.period))),1)]),_:1},8,["selected","options"])]),t.region?(s(),o("div",md,[a("div",fd,c(e.$t("footer.savings.referenceLabel")),1),a("div",gd,c(t.priceConfigured?e.fmtPricePerKWh(r.referenceGrid,n.currency):"___")+" ("+c(e.$t("footer.savings.referenceGrid"))+"), ",1),a("div",pd,[a("div",vd,"⌀ "+c(e.fmtCo2Medium(t.region.co2)),1),f(h,{class:"me-1 evcc-gray",selected:t.region.name,options:t.regionOptions,"data-testid":"savings-region-select",onChange:i[4]||(i[4]=_=>t.selectRegion(_.target.value))},{default:P(()=>[i[7]||(i[7]=T(" (")),a("span",bd,c(t.region.name),1),i[8]||(i[8]=T(") "))]),_:1},8,["selected","options"])])])):g("",!0),!t.priceConfigured||!n.co2Configured?(s(),o("div",yd,[a("a",{href:t.tariffLink,class:"evcc-gray",target:"_blank"},c(e.$t("footer.savings.configurePriceCo2")),9,_d)])):g("",!0)])])),f(S,L(B(n.sponsor)),null,16)])])])],512)]))])}const Pd=v(Zc,[["render",wd]]),Cd={name:"Footer",components:{Version:xc,Savings:Pd},props:{version:Object,savings:Object}},Td={class:"footer"},kd={class:"container py-2"},Id={class:"d-flex justify-content-between"};function xd(e,i,n,d,r,t){const l=m("Version"),h=m("Savings");return s(),o("footer",Td,[a("div",kd,[a("div",Id,[f(l,L(B(n.version)),null,16),f(h,L(B(n.savings)),null,16)])])])}const Ld=v(Cd,[["render",xd]]),Ad={data(){return{leftIconIndex:2,centerIconIndex:6,rightIconIndex:10,updatePosition:0,icons:["shopicon-regular-batterythreequarters","shopicon-regular-cablecharge","shopicon-regular-car3","shopicon-regular-eco1","shopicon-regular-heart","shopicon-regular-home","shopicon-regular-lightning","shopicon-regular-moonstars","shopicon-regular-powersupply","shopicon-regular-receivepayment","shopicon-regular-sun","shopicon-regular-clock","shopicon-regular-car1",oe(je),oe(He),oe(Oe)],interval:null}},computed:{leftIcon(){return this.icons[this.leftIconIndex]},centerIcon(){return this.icons[this.centerIconIndex]},rightIcon(){return this.icons[this.rightIconIndex]}},mounted(){this.interval=setInterval(this.rotateIcons,3e3)},unmounted(){clearInterval(this.interval)},methods:{getRandomIcon(e){const i=Array.from(Array(this.icons.length).keys()).filter(d=>!e.includes(d)),n=Math.floor(Math.random()*i.length);return i[n]},rotateIcons(){const e=[this.leftIconIndex,this.centerIconIndex,this.rightIconIndex];switch(this.updatePosition){case 0:this.leftIconIndex=this.getRandomIcon(e);break;case 1:this.centerIconIndex=this.getRandomIcon(e);break;case 2:this.rightIconIndex=this.getRandomIcon(e);break}this.updatePosition=(this.updatePosition+Math.ceil(Math.random()*2))%3}}},Nd={class:"d-flex justify-content-center gap-4 my-5 color-transition"};function $d(e,i,n,d,r,t){return s(),o("div",Nd,[f(re,{name:"fade",mode:"out-in"},{default:P(()=>[(s(),b(Y(t.leftIcon),{key:r.leftIconIndex,class:"animated-icon"}))]),_:1}),f(re,{name:"fade",mode:"out-in"},{default:P(()=>[(s(),b(Y(t.centerIcon),{key:r.centerIconIndex,class:"animated-icon"}))]),_:1}),f(re,{name:"fade",mode:"out-in"},{default:P(()=>[(s(),b(Y(t.rightIcon),{key:r.rightIconIndex,class:"animated-icon"}))]),_:1})])}const Bd=v(Ad,[["render",$d],["__scopeId","data-v-4d4f9d3a"]]),Vd={name:"Site",components:{Loadpoints:Kl,Energyflow:be,Footer:Ld,Notifications:xt,TopNavigation:pe,WelcomeIcons:Bd},mixins:[C,F],props:{loadpoints:Array,selectedLoadpointIndex:Number,notifications:Array,offline:Boolean,gridConfigured:Boolean,grid:Object,homePower:Number,pvPower:Number,pv:Array,batteryPower:Number,batterySoc:Number,batteryDischargeControl:Boolean,batteryGridChargeLimit:{type:Number,default:null},batteryGridChargeActive:Boolean,batteryMode:String,battery:Array,gridCurrents:Array,prioritySoc:Number,bufferSoc:Number,bufferStartSoc:Number,siteTitle:String,vehicles:Object,auth:Object,currency:String,statistics:Object,tariffFeedIn:Number,tariffGrid:Number,tariffCo2:Number,tariffPriceHome:Number,tariffCo2Home:Number,tariffPriceLoadpoints:Number,tariffCo2Loadpoints:Number,availableVersion:String,releaseNotes:String,hasUpdater:Boolean,uploadMessage:String,uploadProgress:Number,sponsor:{type:Object,default:()=>({})},smartCostType:String,fatal:Object,forecast:Object},computed:{batteryConfigured:function(){var e;return((e=this.battery)==null?void 0:e.length)>0},pvConfigured:function(){var e;return((e=this.pv)==null?void 0:e.length)>0},gridPower:function(){var e;return((e=this.grid)==null?void 0:e.power)||0},energyflow:function(){return this.collectProps(be)},loadpointTitles:function(){return this.loadpoints.map(e=>e.title)},loadpointsCompact:function(){return this.loadpoints.map(e=>{var t,l;const i=(l=(t=this.vehicles)==null?void 0:t[e.vehicleName])==null?void 0:l.icon,n=e.chargerIcon||i||"car",d=e.charging,r=e.chargePower||0;return{icon:n,charging:d,power:r}})},vehicleList:function(){const e=this.vehicles||{};return Object.entries(e).map(([i,n])=>({name:i,...n}))},topNavigation:function(){return{vehicleLogins:this.auth?this.auth.vehicles:{},...this.collectProps(pe)}},showParkingLot:function(){return!1},isInitialSetup:function(){return this.loadpoints.length===0},footer:function(){return{version:{installed:window.evcc.version,commit:window.evcc.commit,available:this.availableVersion,releaseNotes:this.releaseNotes,hasUpdater:this.hasUpdater,uploadMessage:this.uploadMessage,uploadProgress:this.uploadProgress},savings:{sponsor:this.sponsor,statistics:this.statistics,co2Configured:this.tariffCo2!==void 0,priceConfigured:this.tariffGrid!==void 0,currency:this.currency}}}},methods:{selectedLoadpointChanged(e){this.$router.push({query:{lp:e+1}})}}},Md={class:"d-flex flex-column site safe-area-inset"},Ed={class:"container px-4 top-area"},Dd={class:"d-flex justify-content-between align-items-center my-3 my-md-4"},Rd={class:"d-block my-0"},Od={key:0},Ud={class:"d-flex"},Fd={class:"d-flex flex-column justify-content-between content-area"},qd={key:0,class:"flex-grow-1 align-items-center d-flex justify-content-center"},Wd={class:"mb-5 text-gray fs-4"},Hd={key:1,class:"flex-grow-1 d-flex align-items-center justify-content-center p-3"},jd={class:"welcome d-flex align-items-center flex-column justify-content-center text-center"},zd={class:"mb-0 fs-4 d-flex align-items-center gap-2"};function Gd(e,i,n,d,r,t){const l=m("Notifications"),h=m("TopNavigation"),u=m("Energyflow"),p=m("WelcomeIcons"),S=m("router-link"),_=m("Loadpoints"),$=m("Footer");return s(),o("div",Md,[a("div",Ed,[a("div",Dd,[a("h1",Rd,[t.isInitialSetup?g("",!0):(s(),o("span",Od,c(n.siteTitle||"evcc"),1))]),a("div",Ud,[f(l,{notifications:n.notifications,loadpointTitles:t.loadpointTitles,class:"me-2"},null,8,["notifications","loadpointTitles"]),f(h,L(B(t.topNavigation)),null,16)])]),n.loadpoints.length>0?(s(),b(u,L(k({key:0},t.energyflow)),null,16)):g("",!0)]),a("div",Fd,[n.fatal?(s(),o("div",qd,[a("h1",Wd,c(e.$t("startupError.title")),1)])):t.isInitialSetup?(s(),o("div",Hd,[a("div",jd,[a("h1",zd,c(e.$t("main.welcome")),1),f(p,{class:"welcome-icons"}),f(S,{class:"btn btn-lg btn-outline-primary configure-button",to:"/config"},{default:P(()=>[T(c(e.$t("main.startConfiguration")),1)]),_:1})])])):n.loadpoints.length>0?(s(),b(_,{key:2,class:"mt-1 mt-sm-2 flex-grow-1",loadpoints:n.loadpoints,vehicles:t.vehicleList,smartCostType:n.smartCostType,tariffGrid:n.tariffGrid,tariffCo2:n.tariffCo2,currency:n.currency,gridConfigured:n.gridConfigured,pvConfigured:t.pvConfigured,batteryConfigured:t.batteryConfigured,batterySoc:n.batterySoc,selectedIndex:n.selectedLoadpointIndex,onIndexChanged:t.selectedLoadpointChanged},null,8,["loadpoints","vehicles","smartCostType","tariffGrid","tariffCo2","currency","gridConfigured","pvConfigured","batteryConfigured","batterySoc","selectedIndex","onIndexChanged"])):g("",!0),f($,L(B(t.footer)),null,16)])])}const Kd=v(Vd,[["render",Gd],["__scopeId","data-v-e1fddd6b"]]),Zd={name:"Main",components:{Site:Kd},props:{notifications:Array,selectedLoadpointIndex:Number},data:function(){return rt}};function Yd(e,i,n,d,r,t){const l=m("Site");return s(),b(l,k({notifications:n.notifications},e.state,{"selected-loadpoint-index":n.selectedLoadpointIndex}),null,16,["notifications","selected-loadpoint-index"])}const nu=v(Zd,[["render",Yd]]);export{nu as default};
