System.register(["./index-legacy-C3BDSfGU.js","./batterythreequarters-legacy-CnUIOvQq.js","./deepEqual-legacy-nmvg_8Jh.js","./TopHeader-legacy-IVHoAQla.js","./TopNavigation-legacy-DyfmuRER.js"],(function(e,t){"use strict";var a,n,o,i,l,r,s,d,c,u,p,m,h,g,f,v,b,y,w,k,C,M,$,x,T,V,P,S,q,I,O,N,U,D,_,E,L,R,A,j,B,F,z,H,Y,W,G,K,J,Q,Z,X,ee,te,ae,ne,oe,ie,le;return{setters:[e=>{a=e._,n=e.c,o=e.a,i=e.i,l=e.t,r=e.o,s=e.Z,d=e.h,c=e.l,u=e.b,p=e.e,m=e.f,h=e.a2,g=e.q,f=e.w,v=e.a3,b=e.n,y=e.F,w=e.r,k=e.B,C=e.J,M=e.K,$=e.v,x=e.W,T=e.d,V=e.j,P=e.k,S=e.a0,q=e.P,I=e.a4,O=e.M,N=e.a5,U=e.O,D=e.s,_=e.A,E=e.a6,L=e.a7,R=e.a8,A=e.a9,j=e.aa,B=e.ab,F=e.ac,z=e.ad,H=e.a1,Y=e.y,W=e.L,G=e.m,K=e.p,J=e.x,Q=e.ae,Z=e.af,X=e.ag},e=>{ee=e.V,te=e.T,ae=e.a,ne=e.S,oe=e.b},e=>{ie=e.d},e=>{le=e.T},null],execute:function(){var t=document.createElement("style");t.textContent='.root[data-v-fd1f8c73]{padding:0;display:block;list-style-type:none;min-height:9rem;border-radius:1rem;border:1px solid var(--evcc-gray-50);padding:1rem 1rem .5rem;transition:border-color var(--evcc-transition-fast) linear}.root[data-v-fd1f8c73]:hover,.root[data-v-fd1f8c73]:focus-within{border-color:var(--evcc-default-text);color:var(--evcc-default-text)}button[data-v-fd1f8c73]{border-radius:1rem;background:none;border:none;height:100%;width:100%;color:inherit}button[data-v-fd1f8c73]:focus{outline:none}input[type=number]{-webkit-appearance:textfield;appearance:textfield}input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.w-min-100{min-width:min(100px,100%)}.w-min-150{min-width:min(150px,100%)}.w-min-200{min-width:min(200px,100%)}.icon[data-v-ddacac93]{transform:rotate(0);transition:transform var(--evcc-transition-medium) ease}.iconUp[data-v-ddacac93]{transform:rotate(-180deg)}.v-enter-active[data-v-ddacac93],.v-leave-active[data-v-ddacac93]{transition:transform var(--evcc-transition-medium) ease,opacity var(--evcc-transition-medium) ease;transform:translateY(0)}.v-enter-from[data-v-ddacac93],.v-leave-to[data-v-ddacac93]{opacity:0;transform:translateY(-.5rem)}.tags[data-v-91ffaca1]{display:grid;grid-template-columns:1fr;grid-gap:.5rem}.label[data-v-91ffaca1]{min-width:4rem}.value[data-v-91ffaca1]{font-weight:700;color:var(--bs-primary)}.value[data-v-91ffaca1]:empty:after{color:var(--evcc-gray);content:"–"}.value--error[data-v-91ffaca1]{color:var(--bs-danger)}.value--warning[data-v-91ffaca1]{color:var(--bs-warning)}.value--muted[data-v-91ffaca1]{color:var(--evcc-gray)!important}.test-result[data-v-2fa2572e]{border:1px solid var(--bs-border-color);border-radius:var(--bs-border-radius)}.divider[data-v-2fa2572e]{border-top-color:1px solid var(--bs-border-color);margin-left:-1.5rem;margin-right:-1.5rem}.container[data-v-f3f02713]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.addButton[data-v-f3f02713]{min-height:auto}.monaco-editor{--vscode-editor-background: var(--evcc-box) !important;--vscode-editorGutter-background: var(--evcc-box-border) !important}.error{background-color:var(--bs-danger-50)!important}.editor[data-v-158c9e5a]{border:1px solid var(--bs-border-color)}.container[data-v-01f84cbd]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.editor-container[data-v-01f84cbd]{margin:0 -1rem 0 -1.25rem}@media (min-width: 992px){.editor-container[data-v-01f84cbd]{margin:0}}.container[data-v-c72e310b]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.root[data-v-2cb3110d]{display:block;list-style-type:none;border-radius:1rem;padding:1rem 1.5rem;min-height:8rem}.icon[data-v-2cb3110d]:empty{display:none}.divide[data-v-2cb3110d]{margin-left:-1.5rem;margin-right:-1.5rem}button[data-v-2cb3110d]:disabled{pointer-events:auto}.container[data-v-79654f92]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.group[data-v-8b3deadf]{display:grid;grid-template-columns:repeat(auto-fill,minmax(225px,1fr));grid-gap:2rem 5rem;margin-bottom:5rem;align-items:start}.wip[data-v-8b3deadf]{opacity:.2}.config-entry[data-v-8b3deadf]{display:flex;flex-wrap:nowrap;justify-content:space-between;align-items:center;gap:.5rem}.config-label[data-v-8b3deadf]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1;flex-grow:0}.config-text[data-v-8b3deadf]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1;flex-grow:1;text-align:right}.config-button[data-v-8b3deadf]{margin-right:-1rem;flex-shrink:0;color:var(--evcc-text-default)}.container[data-v-92baecd5]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.addButton[data-v-92baecd5]{min-height:auto}h6[data-v-92baecd5]{margin-top:4rem}.container[data-v-bc5c1b6f]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.addButton[data-v-bc5c1b6f]{min-height:auto}textarea[data-v-f3aebc69]{font-family:var(--bs-font-monospace)}.container[data-v-83eff06e]{margin-left:calc(var(--bs-gutter-x) * -.5);margin-right:calc(var(--bs-gutter-x) * -.5);padding-right:0}.config-list[data-v-4b00b2be]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));grid-gap:2rem;margin-bottom:5rem}.wip[data-v-4b00b2be]{opacity:.2!important;display:none!important}\n/*$vite$:1*/',document.head.appendChild(t);const re={class:"root"},se=a({name:"NewDeviceButton",props:{title:String},emits:["click"]},[["render",function(e,t,a,s,d,c){return r(),n("li",re,[o("button",{class:"d-flex align-items-center justify-content-center p-3",tabindex:"0",onClick:t[0]||(t[0]=t=>e.$emit("click"))},[t[1]||(t[1]=o("shopicon-regular-plus",{class:"me-1"},null,-1)),i(" "+l(a.title),1)])])}],["__scopeId","data-v-fd1f8c73"]]);var de={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function ce(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function ue(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function pe(e,t){var a,n,o,i,l,r=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,s=[],d="",c=t||{},u=0;function p(e){var t=de[e[1]||""],a=s[s.length-1]==e;return t?t[1]?(a?s.pop():s.push(e),t[0|a]):t[0]:e}function m(){for(var e="";s.length;)e+=p(s[s.length-1]);return e}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,(function(e,t,a){return c[t.toLowerCase()]=a,""})).replace(/^\n+|\n+$/g,"");o=r.exec(e);)n=e.substring(u,o.index),u=r.lastIndex,a=o[0],n.match(/[^\\](\\\\)*\\$/)||((l=o[3]||o[4])?a='<pre class="code '+(o[4]?"poetry":o[2].toLowerCase())+'"><code'+(o[2]?' class="language-'+o[2].toLowerCase()+'"':"")+">"+ce(ue(l).replace(/^\n+|\n+$/g,""))+"</code></pre>":(l=o[6])?(l.match(/\./)&&(o[5]=o[5].replace(/^\d+/gm,"")),i=pe(ce(o[5].replace(/^\s*[>*+.-]/gm,""))),">"==l?l="blockquote":(l=l.match(/\./)?"ol":"ul",i=i.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),a="<"+l+">"+i+"</"+l+">"):o[8]?a='<img src="'+ue(o[8])+'" alt="'+ue(o[7])+'">':o[10]?(d=d.replace("<a>",'<a href="'+ue(o[11]||c[n.toLowerCase()])+'">'),a=m()+"</a>"):o[9]?a="<a>":o[12]||o[14]?a="<"+(l="h"+(o[14]?o[14].length:o[13]>"="?1:2))+">"+pe(o[12]||o[15],c)+"</"+l+">":o[16]?a="<code>"+ue(o[16])+"</code>":(o[17]||o[1])&&(a=p(o[17]||"--"))),d+=n,d+=a;return(d+e.substring(u)+m()).replace(/^\n+|\n+$/g,"")}const me=["innerHTML"],he=a({name:"MarkdownRenderer",props:{markdown:String},computed:{compiledMarkdown(){return pe(this.markdown)}}},[["render",function(e,t,a,o,i,l){return r(),n("div",{innerHTML:l.compiledMarkdown},null,8,me)}]]),ge={name:"FormRow",components:{Markdown:he},props:{id:String,label:String,help:String,optional:Boolean,deprecated:Boolean,example:String,docsLink:String},computed:{link(){return this.docsLink?`${s()}${this.docsLink}`:null}}},fe={class:"mb-4"},ve=["for"],be={class:"form-label"},ye={key:0,class:"evcc-gray"},we={key:1,class:"evcc-gray"},ke={class:"w-100"},Ce={class:"form-text evcc-gray"},Me={key:0,class:"hyphenate"},$e={key:1,class:"d-flex gap-1"},xe=["href"],Te=a(ge,[["render",function(e,t,a,s,m,h){const g=p("Markdown");return r(),n("div",fe,[o("label",{for:a.id},[o("div",be,[i(l(a.label)+" ",1),a.deprecated?(r(),n("small",ye,l(e.$t("config.form.deprecated")),1)):a.optional?(r(),n("small",we,l(e.$t("config.form.optional")),1)):d("",!0)])],8,ve),o("div",ke,[c(e.$slots,"default")]),o("div",Ce,[a.example?(r(),n("div",Me,l(e.$t("config.form.example"))+": "+l(a.example),1)):d("",!0),a.help?(r(),n("div",$e,[u(g,{markdown:a.help,class:"text-gray hyphenate"},null,8,["markdown"]),h.link?(r(),n("a",{key:0,class:"text-gray",href:h.link,target:"_blank"},l(e.$t("config.general.docsLink")),9,xe)):d("",!0)])):d("",!0)])])}]]);class Ve extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M8 22h32v4H8z"/></svg>'}}window.customElements.define("shopicon-regular-minus",Ve);const Pe=1e9,Se={name:"PropertyField",components:{VehicleIcon:ee,SelectGroup:h},mixins:[m],props:{id:String,property:String,masked:Boolean,placeholder:String,type:String,unit:String,size:String,scale:Number,required:Boolean,choice:{type:Array,default:()=>[]},modelValue:[String,Number,Boolean,Object]},emits:["update:modelValue"],data:()=>({selectMode:!1}),computed:{inputType(){return this.masked?"password":["Int","Float","Duration"].includes(this.type)?"number":"text"},sizeClass(){return this.size?this.size:["Int","Float","Duration"].includes(this.type)?"w-50 w-min-200":""},endAlign(){return["Int","Float","Duration"].includes(this.type)},step(){return"Float"===this.type||"Duration"===this.type?"any":null},unitValue(){return"Duration"===this.type?this.fmtDurationUnit(this.value,this.unit):this.unit?this.unit:"capacity"===this.property?"kWh":null},icons(){return"icon"===this.property},textarea(){return["accessToken","refreshToken","identifiers"].includes(this.property)},boolean(){return"Bool"===this.type},array(){return"List"===this.type},select(){return this.choice.length>0},durationFactor(){return"minute"===this.unit?60:1},selectOptions(){if("object"==typeof this.choice[0])return this.choice;let e=[...this.choice];return this.icons&&!this.required&&(e=["",...e]),e.map((e=>({key:e,name:this.$t(`config.options.${this.property}.${e||"none"}`)})))},value:{get(){return this.selectOptions.length>0&&!this.modelValue?this.required?this.selectOptions[0].key:"":this.scale?this.modelValue*this.scale:this.boolean?!0===this.modelValue:this.array?Array.isArray(this.modelValue)?this.modelValue.join("\n"):"":"Duration"===this.type&&"number"==typeof this.modelValue?this.modelValue/this.durationFactor/Pe:this.modelValue},set(e){let t=e;this.scale&&(t=e/this.scale),this.array&&(t=e?e.split("\n"):[]),"Duration"===this.type&&"number"==typeof t&&(t=t*this.durationFactor*Pe),this.$emit("update:modelValue",t)}}},methods:{toggleSelectMode(){this.$nextTick((()=>{this.selectMode=!this.selectMode}))}}},qe=["id","type","step","placeholder","required","aria-describedby"],Ie=["id"],Oe={key:1,class:"d-flex flex-wrap"},Ne=["id","name","value"],Ue=["for","aria-label"],De={key:1},_e={key:0,class:"me-2 mb-2 d-flex align-items-end"},Ee=["id"],Le=["id"],Re={key:0,value:""},Ae=["value"],je=["id","type","placeholder","required"],Be=["id","type","step","placeholder","required","autocomplete"],Fe=a(Se,[["render",function(e,t,a,i,s,c){const u=p("VehicleIcon"),m=p("SelectGroup");return c.unitValue?(r(),n("div",{key:0,class:b(["input-group",c.sizeClass])},[f(o("input",{id:a.id,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),type:c.inputType,step:c.step,placeholder:a.placeholder,required:a.required,"aria-describedby":a.id+"_unit",class:b(["form-control",{"text-end":c.endAlign}])},null,10,qe),[[v,c.value]]),o("span",{id:a.id+"_unit",class:"input-group-text"},l(c.unitValue),9,Ie)],2)):c.icons?(r(),n("div",Oe,[(r(!0),n(y,null,w(c.selectOptions,(({key:i})=>f((r(),n("div",{key:i,class:"me-2 mb-2"},[f(o("input",{id:`icon_${i}`,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),type:"radio",class:b(e.selectMode?"btn-check":"d-none"),name:a.property,value:i,onClick:t[2]||(t[2]=(...e)=>c.toggleSelectMode&&c.toggleSelectMode(...e))},null,10,Ne),[[x,c.value]]),o("label",{class:b(["btn btn-outline-secondary",i===c.value?"active":""]),for:`icon_${i}`,"aria-label":i},[i?(r(),g(u,{key:0,name:i},null,8,["name"])):(r(),n("shopicon-regular-minus",De))],10,Ue)])),[[$,i===c.value||e.selectMode]]))),128)),e.selectMode?d("",!0):(r(),n("div",_e,[o("a",{id:a.id,class:"text-muted",href:"#",onClick:t[3]||(t[3]=k(((...e)=>c.toggleSelectMode&&c.toggleSelectMode(...e)),["prevent"]))},"change",8,Ee)]))])):c.boolean?(r(),g(m,{key:2,id:a.id,modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=e=>c.value=e),class:"w-50","equal-width":"",transparent:"",options:[{value:!1,name:e.$t("config.options.boolean.no")},{value:!0,name:e.$t("config.options.boolean.yes")}]},null,8,["id","modelValue","options"])):c.select?f((r(),n("select",{key:3,id:a.id,"onUpdate:modelValue":t[5]||(t[5]=e=>c.value=e),class:b(["form-select",c.sizeClass])},[a.required?d("",!0):(r(),n("option",Re,"---")),(r(!0),n(y,null,w(c.selectOptions,(({key:e,name:t},a)=>(r(),n(y,null,[null!==e&&null!==t?(r(),n("option",{key:e,value:e},l(t),9,Ae)):(r(),n("hr",{key:a}))],64)))),256))],10,Le)),[[C,c.value]]):c.textarea?f((r(),n("textarea",{key:4,id:a.id,"onUpdate:modelValue":t[6]||(t[6]=e=>c.value=e),class:b(["form-control",c.sizeClass]),type:c.inputType,placeholder:a.placeholder,required:a.required,rows:"4"},null,10,je)),[[M,c.value]]):f((r(),n("input",{key:5,id:a.id,"onUpdate:modelValue":t[7]||(t[7]=e=>c.value=e),class:b(["form-control",c.sizeClass]),type:c.inputType,step:c.step,placeholder:a.placeholder,required:a.required,autocomplete:a.masked?"off":null},null,10,Be)),[[v,c.value]])}]]),ze={name:"PropertyEntry",components:{FormRow:Te,PropertyField:Fe},props:{id:String,Name:String,Required:Boolean,Deprecated:Boolean,Description:String,Help:String,Example:String,Type:String,Mask:Boolean,Choice:Array,modelValue:[String,Number,Boolean,Object]},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},He=a(ze,[["render",function(e,t,a,n,o,i){const l=p("PropertyField"),s=p("FormRow");return r(),g(s,{id:a.id,optional:!a.Required,deprecated:a.Deprecated,label:a.Description||`[${a.Name}]`,help:a.Description===a.Help?void 0:a.Help,example:a.Example},{default:T((()=>[u(l,{id:a.id,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),masked:a.Mask,property:a.Name,type:a.Type,class:"me-2",required:a.Required,choice:a.Choice},null,8,["id","modelValue","masked","property","type","required","choice"])])),_:1},8,["id","optional","deprecated","label","help","example"])}]]),Ye={key:0},We={key:0},Ge={key:1},Ke={key:0,class:"pt-2"},Je={key:0,class:"my-5"},Qe=a({name:"PropertyCollapsible",components:{DropdownIcon:a({name:"Dropdown",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M11.475 14.475L7.85 10.85q-.075-.075-.112-.162T7.7 10.5q0-.2.138-.35T8.2 10h7.6q.225 0 .363.15t.137.35q0 .05-.15.35l-3.625 3.625q-.125.125-.25.175T12 14.7t-.275-.05t-.25-.175"},null,-1)]),4)}]])},data:()=>({open:!1}),methods:{toggle(){this.open=!this.open}}},[["render",function(e,t,a,i,s,m){const h=p("DropdownIcon");return e.$slots.advanced||e.$slots.more?(r(),n("div",Ye,[o("button",{class:b(["btn btn-link btn-sm text-gray px-0 border-0 d-flex align-items-center mb-2",s.open?"text-primary":""]),type:"button",tabindex:"0",onClick:t[0]||(t[0]=(...e)=>m.toggle&&m.toggle(...e))},[s.open?(r(),n("span",We,l(e.$t("config.general.hideAdvancedSettings")),1)):(r(),n("span",Ge,l(e.$t("config.general.showAdvancedSettings")),1)),u(h,{class:b(["icon",{iconUp:s.open}])},null,8,["class"])],2),u(S,null,{default:T((()=>[s.open?(r(),n("div",Ke,[c(e.$slots,"advanced",{},void 0,!0),e.$slots.advanced&&e.$slots.more?(r(),n("hr",Je)):d("",!0),c(e.$slots,"more",{},void 0,!0)])):d("",!0)])),_:3})])):d("",!0)}],["__scopeId","data-v-ddacac93"]]),Ze=["phasePowers","phaseVoltages","phaseCurrents"],Xe={key:0,class:"tags"},et=["data-testid"],tt={class:"label overflow-hidden text-truncate flex-shrink-1 flex-grow-1"},at=a({name:"DeviceTags",mixins:[m],props:{tags:Object},computed:{entries(){return Object.entries(this.tags).map((([e,{value:t,error:a,warning:n,muted:o,options:i}])=>({name:e,value:t,error:a,warning:n,muted:o,options:i})))}},methods:{fmtDeviceValue(e){const{name:t,value:a,options:n={}}=e;if(null==a)return"";switch(t){case"power":return this.fmtW(a);case"energy":case"capacity":case"chargedEnergy":return this.fmtWh(1e3*a);case"soc":case"vehicleLimitSoc":return this.fmtPercentage(a,1);case"temp":return this.fmtTemperature(a);case"odometer":case"range":return`${this.fmtNumber(a,0)} km`;case"phaseCurrents":return a.map((e=>this.fmtNumber(e,1))).join(" · ")+" A";case"phaseVoltages":return a.map((e=>this.fmtNumber(e,0))).join(" · ")+" V";case"phasePowers":return a.map((e=>this.fmtW(e,q.KW,!1))).join(" · ")+" kW";case"chargeStatus":return this.$t(`config.deviceValue.chargeStatus${a}`);case"gridPrice":case"feedinPrice":return this.fmtPricePerKWh(a,n.currency,!0);case"co2":return this.fmtCo2Short(a);case"powerRange":return`${this.fmtW(a[0])} / ${this.fmtW(a[1])}`;case"currentRange":return`${this.fmtNumber(a[0],1)} A / ${this.fmtNumber(a[1],1)} A`;case"controllable":case"phases1p3p":case"singlePhase":case"enabled":case"configured":return a?this.$t("config.deviceValue.yes"):this.$t("config.deviceValue.no")}return a},allowTruncate:e=>!Ze.includes(e)}},[["render",function(e,t,a,i,s,c){return a.tags?(r(),n("div",Xe,[(r(!0),n(y,null,w(c.entries,((t,a)=>(r(),n("span",{key:a,"data-testid":`device-tag-${t.name}`,class:"d-flex gap-2 overflow-hidden text-truncate"},[o("div",tt,l(e.$t(`config.deviceValue.${t.name}`)),1),o("div",{class:b(["value overflow-hidden",{"value--error":!!t.error,"value--warning":t.warning,"value--muted":t.muted||!1===t.value,"text-truncate":c.allowTruncate(t.name),"flex-shrink-0":!c.allowTruncate(t.name)}])},l(c.fmtDeviceValue(t)),3)],8,et)))),128))])):d("",!0)}],["__scopeId","data-v-91ffaca1"]]),nt={name:"TestResult",components:{DeviceTags:at},props:{success:Boolean,failed:Boolean,unknown:Boolean,running:Boolean,result:Object,error:String},emits:["test"]},ot={class:"test-result my-4 p-4"},it={class:"d-flex justify-content-between align-items-center"},lt={key:0},rt={key:1},st={key:2,class:"text-success"},dt={key:3,class:"text-danger"},ct={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ut={key:0,class:"divider"},pt={key:1,class:"text-danger"},mt={key:2,class:"divider"},ht={key:3},gt=a(nt,[["render",function(e,t,a,i,s,c){const m=p("DeviceTags");return r(),n("div",ot,[o("div",it,[o("strong",null,[o("span",null,l(e.$t("config.validation.label"))+": ",1),a.unknown?(r(),n("span",lt,l(e.$t("config.validation.unknown")),1)):d("",!0),a.running?(r(),n("span",rt,l(e.$t("config.validation.running")),1)):d("",!0),a.success?(r(),n("span",st,l(e.$t("config.validation.success")),1)):d("",!0),a.failed?(r(),n("span",dt,l(e.$t("config.validation.failed")),1)):d("",!0)]),a.running?(r(),n("span",ct)):(r(),n("a",{key:1,href:"#",class:"alert-link",tabindex:"0",onClick:t[0]||(t[0]=k((t=>e.$emit("test")),["prevent"]))},l(e.$t("config.validation.validate")),1))]),a.error?(r(),n("hr",ut)):d("",!0),a.error?(r(),n("div",pt,l(a.error),1)):d("",!0),a.result?(r(),n("hr",mt)):d("",!0),a.result?(r(),n("div",ht,[u(m,{tags:a.result,class:"success-values"},null,8,["tags"])])):d("",!0)])}],["__scopeId","data-v-2fa2572e"]]),ft="unknown",vt="success",bt="failed",yt="running",wt={data:()=>({testState:ft,testError:null,testResult:null}),computed:{testRunning(){return this.testState===yt},testSuccess(){return this.testState===vt},testFailed(){return this.testState===bt},testUnknown(){return this.testState===ft}},methods:{resetTest(){this.testState=ft,this.testError=null,this.testResult=null},async test(e){if(!this.$refs.form.reportValidity())return!1;this.testState=yt;try{const t=await e();for(const[e,{error:a}]of Object.entries(t.data.result))if(a)return this.testState=bt,this.testResult=null,this.testError=`${e}: ${a}`,!1;return this.testResult=t.data.result,this.testError=null,this.testState=vt,!0}catch(de){console.error(de),this.testState=bt,this.testResult=null,this.testError=de.response?.data?.error||de.message}return!1}}},kt=I({name:"Modbus",components:{FormRow:Te,PropertyField:Fe},props:{capabilities:{type:Array,default:()=>[]},modbus:String,host:String,port:[Number,String],id:[Number,String],baudrate:[Number,String],comset:String,device:String,defaultPort:Number,defaultId:Number,defaultComset:String,defaultBaudrate:Number},emits:["update:modbus","update:id","update:host","update:port","update:device","update:baudrate","update:comset"],data:()=>({connection:"tcpip",protocol:"tcp"}),computed:{selectedModbus(){return"serial"===this.connection?"rs485serial":"rtu"===this.protocol?"rs485tcpip":"tcpip"},showConnectionOptions(){return this.capabilities.includes("rs485")},showProtocolOptions(){return"tcpip"===this.connection&&this.capabilities.includes("rs485")},comsetOptions:()=>["8N1","8E1"].map((e=>({key:e,name:e}))),baudrateOptions:()=>[1200,9600,19200,38400,57600,115200].map((e=>({key:e,name:`${e}`})))},watch:{selectedModbus(e){this.$emit("update:modbus",e)},options(e){this.setProtocolByCapabilities(e),this.$emit("update:modbus",this.selectedModbus)},modbus(e){e&&this.setConnectionAndProtocolByModbus(e)}},mounted(){this.setConnectionAndProtocolByModbus(this.modbus),this.$emit("update:modbus",this.selectedModbus)},methods:{setProtocolByCapabilities(e){this.protocol=e.includes("tcpip")?"tcp":"rtu"},setConnectionAndProtocolByModbus(e){switch(e){case"rs485serial":this.connection="serial",this.protocol="rtu";break;case"rs485tcpip":this.connection="tcpip",this.protocol="rtu";break;case"tcpip":this.connection="tcpip",this.protocol="tcp"}}}}),Ct={class:"btn-group",role:"group"},Mt={key:1},$t={class:"btn-group",role:"group"},xt={key:2},Tt=a(kt,[["render",function(e,t,a,i,l,s){const c=p("FormRow"),m=p("PropertyField");return r(),n(y,null,[e.showConnectionOptions?(r(),g(c,{key:0,id:"modbusTcpIp",label:"Modbus Connection",help:"tcpip"===e.connection?"The device is addressable from evcc via LAN/Wifi.":"The device is diretly connected to evcc via a RS485 interface."},{default:T((()=>[o("div",Ct,[f(o("input",{id:"modbusTcpIp","onUpdate:modelValue":t[0]||(t[0]=t=>e.connection=t),type:"radio",class:"btn-check",name:"modbusConnection",value:"tcpip",tabindex:"0",autocomplete:"off"},null,512),[[x,e.connection]]),t[10]||(t[10]=o("label",{class:"btn btn-outline-primary",for:"modbusTcpIp"},"Network",-1)),f(o("input",{id:"modbusSerial","onUpdate:modelValue":t[1]||(t[1]=t=>e.connection=t),type:"radio",class:"btn-check",name:"modbusConnection",value:"serial",tabindex:"0",autocomplete:"off"},null,512),[[x,e.connection]]),t[11]||(t[11]=o("label",{class:"btn btn-outline-primary",for:"modbusSerial"},"Serial / USB",-1))])])),_:1},8,["help"])):d("",!0),u(c,{id:"modbusId",label:"Modbus ID"},{default:T((()=>[u(m,{id:"modbusId",property:"id",type:"Int",class:"me-2",required:"","model-value":e.id||e.defaultId||1,onChange:t[2]||(t[2]=t=>e.$emit("update:id",t.target.value))},null,8,["model-value"])])),_:1}),"tcpip"===e.connection?(r(),n("div",Mt,[u(c,{id:"modbusHost",label:"IP address or hostname",help:"Example: 192.0.2.2"},{default:T((()=>[u(m,{id:"modbusHost",property:"host",type:"String",class:"me-2",required:"","model-value":e.host,onChange:t[3]||(t[3]=t=>e.$emit("update:host",t.target.value))},null,8,["model-value"])])),_:1}),u(c,{id:"modbusPort",label:"Port"},{default:T((()=>[u(m,{id:"modbusPort",property:"port",type:"Int",class:"me-2 w-50",required:"","model-value":e.port||e.defaultPort||502,onChange:t[4]||(t[4]=t=>e.$emit("update:port",t.target.value))},null,8,["model-value"])])),_:1}),e.showProtocolOptions?(r(),g(c,{key:0,id:"modbusTcp",label:"Modbus Protocol",help:"tcp"===e.protocol?"Device has native LAN/Wifi support or is connected through a RS485 to Ethernet adapter with protocol translation.":"Connection through a RS485 to Ethernet adapter without protocol translation."},{default:T((()=>[o("div",$t,[f(o("input",{id:"modbusTcp","onUpdate:modelValue":t[5]||(t[5]=t=>e.protocol=t),type:"radio",class:"btn-check",name:"modbusProtocol",value:"tcp",tabindex:"0",autocomplete:"off"},null,512),[[x,e.protocol]]),t[12]||(t[12]=o("label",{class:"btn btn-outline-primary",for:"modbusTcp"},"TCP",-1)),f(o("input",{id:"modbusRtu","onUpdate:modelValue":t[6]||(t[6]=t=>e.protocol=t),type:"radio",class:"btn-check",name:"modbusProtocol",value:"rtu",tabindex:"0",autocomplete:"off"},null,512),[[x,e.protocol]]),t[13]||(t[13]=o("label",{class:"btn btn-outline-primary",for:"modbusRtu"},"RTU",-1))])])),_:1},8,["help"])):d("",!0)])):(r(),n("div",xt,[u(c,{id:"modbusDevice",label:"Device name",help:"Example: /dev/ttyUSB0"},{default:T((()=>[u(m,{id:"modbusDevice",property:"device",type:"String",class:"me-2",required:"","model-value":e.device,onChange:t[7]||(t[7]=t=>e.$emit("update:device",t.target.value))},null,8,["model-value"])])),_:1}),u(c,{id:"modbusBaudrate",label:"Baudrate"},{default:T((()=>[u(m,{id:"modbusBaudrate",property:"baudrate",type:"Choice",class:"me-2 w-50",choice:e.baudrateOptions,required:"","model-value":e.baudrate||e.defaultBaudrate,onChange:t[8]||(t[8]=t=>e.$emit("update:baudrate",t.target.value))},null,8,["choice","model-value"])])),_:1}),u(c,{id:"modbusComset",label:"ComSet"},{default:T((()=>[u(m,{id:"modbusComset",property:"comset",type:"Choice",class:"me-2 w-50",choice:e.comsetOptions,required:"","model-value":e.comset||e.defaultComset||"8N1",onChange:t[9]||(t[9]=t=>e.$emit("update:comset",t.target.value))},null,8,["choice","model-value"])])),_:1})]))],64)}]]),Vt={class:"alert alert-warning my-4"},Pt={type:"template"};function St(e){return new Promise((t=>setTimeout(t,e)))}const qt=["modbus"],It={name:"ChargerModal",components:{FormRow:Te,PropertyEntry:He,GenericModal:N,Modbus:Tt,TestResult:gt,PropertyCollapsible:Qe,Markdown:he,SponsorTokenRequired:a({name:"SponsorTokenRequired",methods:{openModal(){O.getOrCreateInstance(document.getElementById("sponsorModal")).show()}}},[["render",function(e,t,a,s,d,c){return r(),n("div",Vt,[i(l(e.$t("config.sponsor.tokenRequired"))+" ",1),o("a",{href:"#",role:"button",class:"text-warning",onClick:t[0]||(t[0]=k(((...e)=>c.openModal&&c.openModal(...e)),["prevent"]))},l(e.$t("config.sponsor.tokenRequiredLearnMore")),1)])}]])},mixins:[wt],props:{id:Number,name:String,fade:String,isSponsor:Boolean},emits:["added","updated","removed","close"],data:()=>({isModalVisible:!1,templates:[],products:[],templateName:null,template:null,saving:!1,selectedType:null,loadingTemplate:!1,values:{...Pt}}),computed:{modalTitle(){return this.isNew?this.$t("config.charger.titleAdd"):this.$t("config.charger.titleEdit")},chargerOptions(){return this.products.filter((e=>!e.group))},genericOptions(){return this.products.filter((e=>"generic"===e.group))},switchSocketOptions(){return this.products.filter((e=>"switchsockets"===e.group))},templateParams(){return(this.template?.Params||[]).filter((e=>!qt.includes(e.Name)))},normalParams(){return this.templateParams.filter((e=>!e.Advanced))},advancedParams(){return this.templateParams.filter((e=>e.Advanced))},modbus(){return(this.template?.Params||[]).find((e=>"modbus"===e.Name))},modbusCapabilities(){return this.modbus?.Choice||[]},ocppUrl(){return this.templateParams.some((e=>"connector"===e.Name))&&this.templateParams.some((e=>"stationid"===e.Name))?`ws://${window.location.hostname}:8887`:null},modbusDefaults(){const{ID:e,Comset:t,Baudrate:a,Port:n}=this.modbus||{};return{id:e,comset:t,baudrate:a,port:n}},description(){return this.template?.Requirements?.Description},sponsorTokenRequired(){return(this.template?.Requirements?.EVCC||[]).includes("sponsorship")&&!this.isSponsor},apiData(){return{template:this.templateName,...this.modbusDefaults,...this.values}},isNew(){return void 0===this.id},isDeletable(){return!this.isNew}},watch:{isModalVisible(e){e&&(this.templateName=null,this.reset(),this.loadProducts(),void 0!==this.id&&this.loadConfiguration())},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},methods:{reset(){this.values={...Pt},this.resetTest()},async loadConfiguration(){try{const e=(await U.get(`config/devices/charger/${this.id}`)).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(de){console.error(de)}},async loadProducts(){if(this.isModalVisible)try{const e={params:{lang:this.$i18n?.locale}};this.products=(await U.get("config/products/charger",e)).data.result}catch(de){console.error(de)}},async loadTemplate(){this.template=null,this.loadingTemplate=!0;try{const e={params:{lang:this.$i18n?.locale,name:this.templateName}},t=await U.get("config/templates/charger",e);this.template=t.data.result,this.applyDefaultsFromTemplate()}catch(de){console.error(de)}this.loadingTemplate=!1},applyDefaultsFromTemplate(){(this.template?.Params||[]).filter((e=>e.Default&&!this.values[e.Name])).forEach((e=>{this.values[e.Name]=e.Default}))},async create(){if(this.testUnknown){if(!(await this.test(this.testCharger)))return;await St(100)}this.saving=!0;try{const e=await U.post("config/devices/charger",this.apiData),{name:t}=e.data.result;this.$emit("added",t),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testCharger)},async testCharger(){let e="config/test/charger";return this.isNew||(e+=`/merge/${this.id}`),await U.post(e,this.apiData)},async update(){if(this.testUnknown){if(!(await this.test(this.testCharger)))return;await St(250)}this.saving=!0;try{await U.put(`config/devices/charger/${this.id}`,this.apiData),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("update failed")}this.saving=!1},async remove(){try{await U.delete(`config/devices/charger/${this.id}`),this.$emit("removed",this.name),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("delete failed")}},open(){this.isModalVisible=!0},close(){this.$emit("close"),this.isModalVisible=!1},templateChanged(){this.reset()}}},Ot={ref:"form",class:"container mx-0 px-0"},Nt=["disabled"],Ut=["label"],Dt=["value"],_t=["label"],Et=["value"],Lt=["label"],Rt=["value"],At={key:0},jt=["value"],Bt={key:6,class:"my-4 d-flex justify-content-between"},Ft={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal",tabindex:"0"},zt=["disabled"],Ht={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Yt=a(It,[["render",function(e,t,a,s,c,m){const h=p("FormRow"),v=p("SponsorTokenRequired"),b=p("Markdown"),M=p("Modbus"),$=p("PropertyEntry"),x=p("PropertyCollapsible"),V=p("TestResult"),P=p("GenericModal");return r(),g(P,{id:"chargerModal",title:m.modalTitle,"data-testid":"charger-modal",fade:a.fade,onOpen:m.open,onClose:m.close},{default:T((()=>[o("form",Ot,[u(h,{id:"chargerTemplate",label:e.$t("config.charger.template")},{default:T((()=>[f(o("select",{id:"chargerTemplate","onUpdate:modelValue":t[0]||(t[0]=e=>c.templateName=e),disabled:!m.isNew,class:"form-select w-100",onChange:t[1]||(t[1]=(...e)=>m.templateChanged&&m.templateChanged(...e))},[t[11]||(t[11]=o("option",{value:""},"---",-1)),o("optgroup",{label:e.$t("config.charger.generic")},[(r(!0),n(y,null,w(m.genericOptions,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Dt)))),128))],8,Ut),o("optgroup",{label:e.$t("config.charger.chargers")},[(r(!0),n(y,null,w(m.chargerOptions,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Et)))),128))],8,_t),o("optgroup",{label:e.$t("config.charger.switchsocket")},[(r(!0),n(y,null,w(m.switchSocketOptions,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Rt)))),128))],8,Lt)],40,Nt),[[C,c.templateName]])])),_:1},8,["label"]),c.loadingTemplate?(r(),n("p",At,"Loading ...")):d("",!0),m.sponsorTokenRequired?(r(),g(v,{key:1})):d("",!0),m.description?(r(),g(b,{key:2,markdown:m.description,class:"my-4"},null,8,["markdown"])):d("",!0),m.ocppUrl?(r(),g(h,{key:3,id:"chargerOcppUrl",label:e.$t("config.charger.ocppLabel"),help:e.$t("config.charger.ocppHelp")},{default:T((()=>[o("input",{type:"text",class:"form-control border",value:m.ocppUrl,readonly:""},null,8,jt)])),_:1},8,["label","help"])):d("",!0),m.modbus?(r(),g(M,{key:4,modbus:c.values.modbus,"onUpdate:modbus":t[2]||(t[2]=e=>c.values.modbus=e),id:c.values.id,"onUpdate:id":t[3]||(t[3]=e=>c.values.id=e),host:c.values.host,"onUpdate:host":t[4]||(t[4]=e=>c.values.host=e),port:c.values.port,"onUpdate:port":t[5]||(t[5]=e=>c.values.port=e),device:c.values.device,"onUpdate:device":t[6]||(t[6]=e=>c.values.device=e),baudrate:c.values.baudrate,"onUpdate:baudrate":t[7]||(t[7]=e=>c.values.baudrate=e),comset:c.values.comset,"onUpdate:comset":t[8]||(t[8]=e=>c.values.comset=e),defaultId:m.modbus.ID,defaultComset:m.modbus.Comset,defaultBaudrate:m.modbus.Baudrate,defaultPort:m.modbus.Port,capabilities:m.modbusCapabilities},null,8,["modbus","id","host","port","device","baudrate","comset","defaultId","defaultComset","defaultBaudrate","defaultPort","capabilities"])):d("",!0),(r(!0),n(y,null,w(m.normalParams,(e=>(r(),g($,D({id:`chargerParam${e.Name}`,key:e.Name,ref_for:!0},e,{modelValue:c.values[e.Name],"onUpdate:modelValue":t=>c.values[e.Name]=t}),null,16,["id","modelValue","onUpdate:modelValue"])))),128)),u(x,null,_({_:2},[m.advancedParams.length?{name:"advanced",fn:T((()=>[(r(!0),n(y,null,w(m.advancedParams,(e=>(r(),g($,D({id:`chargerParam${e.Name}`,key:e.Name,ref_for:!0},e,{modelValue:c.values[e.Name],"onUpdate:modelValue":t=>c.values[e.Name]=t}),null,16,["id","modelValue","onUpdate:modelValue"])))),128))])),key:"0"}:void 0]),1024),c.templateName?(r(),g(V,{key:5,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:m.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):d("",!0),c.templateName?(r(),n("div",Bt,[m.isDeletable?(r(),n("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[9]||(t[9]=k(((...e)=>m.remove&&m.remove(...e)),["prevent"]))},l(e.$t("config.general.delete")),1)):(r(),n("button",Ft,l(e.$t("config.general.cancel")),1)),o("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||c.saving||m.sponsorTokenRequired,tabindex:"0",onClick:t[10]||(t[10]=k((e=>m.isNew?m.create():m.update()),["prevent"]))},[c.saving?(r(),n("span",Ht)):d("",!0),i(" "+l(e.testUnknown?e.$t("config.general.validateSave"):e.$t("config.general.save")),1)],8,zt)])):d("",!0)],512)])),_:1},8,["title","fade","onOpen","onClose"])}],["__scopeId","data-v-f3f02713"]]),Wt=a({name:"Circuits",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M4 21q-1.25 0-2.125-.875T1 18t.875-2.125T4 15q.225 0 .438.038t.412.087L8.9 9.55q-.425-.525-.663-1.175T8 7q0-1.65 1.175-2.825T12 3t2.825 1.175T16 7q0 .725-.25 1.375t-.675 1.175l4.075 5.575q.2-.05.413-.088T20 15q1.25 0 2.125.875T23 18t-.875 2.125T20 21t-2.125-.875T17 18q0-.475.138-.913t.387-.787l-4.05-5.575q-.125.05-.237.075t-.238.075v4.3q.875.3 1.438 1.075T15 18q0 1.25-.875 2.125T12 21t-2.125-.875T9 18q0-.975.563-1.737T11 15.174v-4.3q-.125-.05-.238-.075t-.237-.075L6.475 16.3q.25.35.388.788T7 18q0 1.25-.875 2.125T4 21m0-2q.425 0 .713-.288T5 18t-.288-.712T4 17t-.712.288T3 18t.288.713T4 19m8 0q.425 0 .713-.288T13 18t-.288-.712T12 17t-.712.288T11 18t.288.713T12 19m8 0q.425 0 .713-.288T21 18t-.288-.712T20 17t-.712.288T19 18t.288.713T20 19M12 9q.825 0 1.413-.587T14 7t-.587-1.412T12 5t-1.412.588T10 7t.588 1.413T12 9"},null,-1)]),4)}]]);function Gt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Kt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Jt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(a),!0).forEach((function(t){Gt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Kt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Qt(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Xt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ea(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ta(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ea(Object(a),!0).forEach((function(t){Xt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ea(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function aa(e){return function t(){for(var a=this,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return o.length>=e.length?e.apply(this,o):function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.apply(a,[].concat(o,n))}}}function na(e){return{}.toString.call(e).includes("Object")}function oa(e){return"function"==typeof e}var ia=aa((function(e,t){throw new Error(e[t]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),la={changes:function(e,t){return na(t)||ia("changeType"),Object.keys(t).some((function(t){return a=e,n=t,!Object.prototype.hasOwnProperty.call(a,n);var a,n}))&&ia("changeField"),t},selector:function(e){oa(e)||ia("selectorType")},handler:function(e){oa(e)||na(e)||ia("handlerType"),na(e)&&Object.values(e).some((function(e){return!oa(e)}))&&ia("handlersType")},initial:function(e){var t;e||ia("initialIsRequired"),na(e)||ia("initialType"),t=e,Object.keys(t).length||ia("initialContent")}};function ra(e,t){return oa(t)?t(e.current):t}function sa(e,t){return e.current=ta(ta({},e.current),t),t}function da(e,t,a){return oa(t)?t(e.current):Object.keys(a).forEach((function(a){var n;return null===(n=t[a])||void 0===n?void 0:n.call(t,e.current[a])})),a}var ca,ua={create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};la.initial(e),la.handler(t);var a={current:e},n=aa(da)(a,t),o=aa(sa)(a),i=aa(la.changes)(e),l=aa(ra)(a);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return la.selector(e),e(a.current)},function(e){!function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}(n,o,i,l)(e)}]}},pa={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},ma=(ca=function(e,t){throw new Error(e[t]||e.default)},function e(){for(var t=this,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return n.length>=ca.length?ca.apply(this,n):function(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return e.apply(t,[].concat(n,o))}})(pa),ha={config:function(e){var t;return e||ma("configIsRequired"),t=e,{}.toString.call(t).includes("Object")||ma("configType"),e.urls?(console.warn(pa.deprecation),{paths:{vs:e.urls.monacoBase}}):e}};function ga(e,t){return Object.keys(t).forEach((function(a){t[a]instanceof Object&&e[a]&&Object.assign(t[a],ga(e[a],t[a]))})),Jt(Jt({},e),t)}var fa={type:"cancelation",msg:"operation is manually canceled"};function va(e){var t=!1,a=new Promise((function(a,n){e.then((function(e){return t?n(fa):a(e)})),e.catch(n)}));return a.cancel=function(){return t=!0},a}var ba,ya,wa=ua.create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}),ka=(ya=2,function(e){if(Array.isArray(e))return e}(ba=wa)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],n=!0,o=!1,i=void 0;try{for(var l,r=e[Symbol.iterator]();!(n=(l=r.next()).done)&&(a.push(l.value),!t||a.length!==t);n=!0);}catch(s){o=!0,i=s}finally{try{n||null==r.return||r.return()}finally{if(o)throw i}}return a}}(ba,ya)||function(e,t){if(e){if("string"==typeof e)return Zt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Zt(e,t):void 0}}(ba,ya)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),Ca=ka[0],Ma=ka[1];function $a(e){return document.body.appendChild(e)}function xa(e){var t,a,n=Ca((function(e){return{config:e.config,reject:e.reject}})),o=(t="".concat(n.config.paths.vs,"/loader.js"),a=document.createElement("script"),t&&(a.src=t),a);return o.onload=function(){return e()},o.onerror=n.reject,o}function Ta(){var e=Ca((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],(function(t){Va(t),e.resolve(t)}),(function(t){e.reject(t)}))}function Va(e){Ca().monaco||Ma({monaco:e})}var Pa=new Promise((function(e,t){return Ma({resolve:e,reject:t})})),Sa={config:function(e){var t=ha.config(e),a=t.monaco,n=Qt(t,["monaco"]);Ma((function(e){return{config:ga(e.config,n),monaco:a}}))},init:function(){var e=Ca((function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}}));if(!e.isInitialized){if(Ma({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),va(Pa);if(window.monaco&&window.monaco.editor)return Va(window.monaco),e.resolve(window.monaco),va(Pa);!function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}($a,xa)(Ta)}return va(Pa)},__getMonacoInstance:function(){return Ca((function(e){return e.monaco}))}},qa=Object.defineProperty,Ia=Object.defineProperties,Oa=Object.getOwnPropertyDescriptors,Na=Object.getOwnPropertySymbols,Ua=Object.prototype.hasOwnProperty,Da=Object.prototype.propertyIsEnumerable,_a=(e,t,a)=>t in e?qa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ea=(e,t)=>{for(var a in t||(t={}))Ua.call(t,a)&&_a(e,a,t[a]);if(Na)for(var a of Na(t))Da.call(t,a)&&_a(e,a,t[a]);return e};const La={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function Ra(e,t){return{wrapperStyle:R((()=>{const{width:t,height:a}=e;return n=Ea({},La.wrapper),Ia(n,Oa({width:t,height:a}));var n})),containerStyle:R((()=>Ea(Ea({},La.fullWidth),!t.value&&La.hide)))}}function Aa(e){return"function"==typeof e?e():e}function ja(e){return void 0===e}function Ba(e,t,a,n){return function(e,t){return e.editor.getModel(Fa(e,t))}(e,n)||function(e,t,a,n){return e.editor.createModel(t,a,n?Fa(e,n):void 0)}(e,t,a,n)}function Fa(e,t){return e.Uri.parse(t)}var za=Object.defineProperty,Ha=Object.getOwnPropertySymbols,Ya=Object.prototype.hasOwnProperty,Wa=Object.prototype.propertyIsEnumerable,Ga=(e,t,a)=>t in e?za(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;const Ka={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var Ja=I({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const a=new Map,n=L(null),{monacoRef:o,unload:i,isLoadFailed:l}=function(){const e=L(Sa.__getMonacoInstance()),t=B(!1);let a;return F((()=>{e.value||(a=Sa.init(),a.then((t=>e.value=t)).catch((e=>{"cancelation"!==(null==e?void 0:e.type)&&(t.value=!0,console.error("Monaco initialization error:",e))})))})),{monacoRef:e,unload:()=>null==a?void 0:a.cancel(),isLoadFailed:t}}(),{editorRef:r}=function({emit:e},t,a,n){const o=L(null);function i(){var i;if(!n.value||!a.value||o.value)return;e("beforeMount",a.value);const l=t.path||t.defaultPath,r=Ba(a.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",l||"");o.value=a.value.editor.create(n.value,((e,t)=>{for(var a in t||(t={}))Ya.call(t,a)&&Ga(e,a,t[a]);if(Ha)for(var a of Ha(t))Wa.call(t,a)&&Ga(e,a,t[a]);return e})({model:r,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),null==(i=o.value)||i.onDidChangeModelContent((a=>{const n=o.value.getValue();n!==t.value&&(e("update:value",n),e("change",n,a))})),o.value&&!ja(t.line)&&o.value.revealLine(t.line),e("mount",o.value,a.value)}return F((()=>{const e=j(a,(()=>{n.value&&a.value&&(z((()=>e())),i())}),{immediate:!0})})),{editorRef:o}}(t,e,o,n),{disposeValidator:s}=function({emit:e},t,a,n){const o=B(null),i=j([a,n],(()=>{if(a.value&&n.value){z((()=>i()));const t=a.value.editor.onDidChangeMarkers((t=>{var o,i;const l=null==(i=null==(o=n.value)?void 0:o.getModel())?void 0:i.uri;if(l&&t.find((e=>e.path===l.path))){const t=a.value.editor.getModelMarkers({resource:l});e("validate",t)}}));o.value=()=>null==t?void 0:t.dispose()}}));return{disposeValidator:o}}(t,0,o,r),d=R((()=>!!o.value&&!!r.value)),{wrapperStyle:c,containerStyle:u}=Ra(e,d);return A((()=>{var e,t;null==(e=s.value)||e.call(s),r.value?(null==(t=r.value.getModel())||t.dispose(),r.value.dispose()):i()})),j([()=>e.path,()=>e.value,()=>e.language,()=>e.line],(([t,n,i,l],[s,c,u,p])=>{if(d.value){if(t!==s){const d=Ba(o.value,n||e.defaultValue||"",i||e.defaultLanguage||"",t||e.defaultPath||"");return e.saveViewState&&a.set(s,r.value.saveViewState()),r.value.setModel(d),e.saveViewState&&r.value.restoreViewState(a.get(t)),void(ja(l)||r.value.revealLine(l))}r.value.getValue()!==n&&r.value.setValue(n),i!==u&&o.value.editor.setModelLanguage(r.value.getModel(),i),ja(l)||l===p||r.value.revealLine(l)}})),j((()=>e.options),(e=>r.value&&r.value.updateOptions(e)),{deep:!0}),j((()=>e.theme),(e=>o.value&&o.value.editor.setTheme(e))),{containerRef:n,isEditorReady:d,isLoadFailed:l,wrapperStyle:c,containerStyle:u}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:a,wrapperStyle:n,containerStyle:o,className:i}=this;return E("div",{style:n},[!t&&E("div",{style:Ka},a?e.failure?Aa(e.failure):"load failed":e.default?Aa(e.default):"loading..."),E("div",{ref:"containerRef",key:"monaco_editor_container",style:o,class:i})])}});function Qa(e,t){if(!t)return e;const a=[],n=t+":",o=e.split("\n");for(;o[0].startsWith("#");)o.shift();const[i,...l]=o;if(!i.startsWith(n))return e;{const e=i.slice(n.length).trim();e&&a.push(e)}if(l.length>0){const e=l[0].match(/^(\s+)/)?.[0]||"";l.map((t=>t.startsWith(e)?t.slice(e.length):t)).map((e=>e.trimEnd())).forEach((e=>a.push(e)))}return a.join("\n")}const Za=document.querySelector("html"),Xa={name:"YamlEditor",components:{VueMonacoEditor:Ja},props:{modelValue:String,errorLine:Number,removeKey:String,disabled:Boolean},emits:["update:modelValue"],data:()=>({theme:"vs",defaultOptions:{automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,minimap:{enabled:!1},showFoldingControls:"always",scrollBeyondLastLine:!1,wordWrap:"off",wrappingStrategy:"advanced",overviewRulerLanes:0},active:!0,pasteDisposable:null}),computed:{options(){return{...this.defaultOptions,readOnly:this.disabled}},lines(){return(this.modelValue||"").split("\n").length}},watch:{errorLine(){this.active=!1,this.$nextTick((()=>this.active=!0))}},mounted(){this.updateTheme(),Za.addEventListener("themechange",this.updateTheme)},beforeMount(){Sa.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.50.0/min/vs"}}),Sa.init()},unmounted(){Za.removeEventListener("themechange",this.updateTheme),this.pasteDisposable?.dispose()},methods:{updateTheme(){this.theme=Za.classList.contains("dark")?"vs-dark":"vs"},ready(e,t){const a=e.onDidPaste((async()=>{if(!this.removeKey)return;await this.$nextTick();const t=e.getModel(),a=Qa(t.getValue(),this.removeKey);t.setValue(a)}));this.pasteDisposable=a;let n=null;const o=()=>{n?.clear(),this.errorLine&&(n=e.createDecorationsCollection([{range:new t.Range(this.errorLine,1,this.errorLine,1),options:{isWholeLine:!0,className:"error",lineNumberClassName:"error",marginClassName:"error"}}]))};e.onDidChangeModelContent((()=>o())),o()}}},en=["rows","value","disabled"],tn={name:"YamlModal",components:{GenericModal:N,YamlEditor:a(Xa,[["render",function(e,t,a,n,s,c){const u=p("VueMonacoEditor");return s.active?(r(),g(u,{key:0,ref:"editor",class:"editor",language:"yaml",theme:s.theme,options:c.options,value:a.modelValue,"onUpdate:value":t[1]||(t[1]=t=>e.$emit("update:modelValue",t)),onMount:c.ready},{default:T((()=>[i(l(e.$t("config.editor.loading")),1)])),failure:T((()=>[o("textarea",{class:"form-control",rows:c.lines,value:a.modelValue,disabled:a.disabled,onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value))},null,40,en)])),_:1},8,["theme","options","value","onMount"])):d("",!0)}],["__scopeId","data-v-158c9e5a"]])},props:{title:String,description:String,docs:String,endpoint:String,defaultYaml:String,removeKey:String,size:{type:String,default:"xl"}},emits:["changed"],data:()=>({saving:!1,error:"",errorLine:void 0,yaml:"",serverYaml:""}),computed:{docsLink(){return`${s()}${this.docs}`},height(){return Math.max(150,18*this.yaml.split("\n").length)+22+"px"},nothingChanged(){return this.yaml===this.serverYaml&&""!==this.yaml}},methods:{reset(){this.yaml="",this.serverYaml="",this.error="",this.saving=!1,this.errorLine=void 0},async open(){this.reset(),await this.load()},async load(){try{const{data:e}=await U.get(this.endpoint);this.serverYaml=e.result,this.yaml=e.result||this.defaultYaml}catch(de){console.error(de)}},async save(){this.saving=!0,this.error="",this.errorLine=void 0;try{const e=this.yaml===this.defaultYaml?"":this.yaml,t=await U.post(this.endpoint,e,{validateStatus:e=>[200,400].includes(e)});200===t.status&&(this.$emit("changed"),this.$refs.modal.close()),400===t.status&&(this.error=t.data.error,this.errorLine=t.data.line)}catch(de){console.error(de)}this.saving=!1}}},an={key:0},nn={key:0},on=["href"],ln={key:1,class:"text-danger","data-testid":"error"},rn={ref:"form",class:"container mx-0 px-0"},sn={class:"mt-4 d-flex justify-content-between"},dn={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},cn=["disabled"],un={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},pn=a(tn,[["render",function(e,t,a,s,c,m){const h=p("YamlEditor"),f=p("GenericModal");return r(),g(f,{ref:"modal",size:a.size,title:a.title,onOpen:m.open},{default:T((()=>[a.description||m.docsLink?(r(),n("p",an,[a.description?(r(),n("span",nn,l(a.description+" "),1)):d("",!0),m.docsLink?(r(),n("a",{key:1,href:m.docsLink,target:"_blank"},l(e.$t("config.general.docsLink")),9,on)):d("",!0)])):d("",!0),c.error?(r(),n("p",ln,l(c.error),1)):d("",!0),o("form",rn,[o("div",{class:"editor-container",style:P({height:m.height})},[u(h,{modelValue:c.yaml,"onUpdate:modelValue":t[0]||(t[0]=e=>c.yaml=e),class:"editor",errorLine:c.errorLine,removeKey:a.removeKey},null,8,["modelValue","errorLine","removeKey"])],4),o("div",sn,[o("button",dn,l(e.$t("config.general.cancel")),1),o("button",{type:"submit",class:"btn btn-primary",disabled:c.saving||m.nothingChanged,onClick:t[1]||(t[1]=k(((...e)=>m.save&&m.save(...e)),["prevent"]))},[c.saving?(r(),n("span",un)):d("",!0),i(" "+l(e.$t("config.general.save")),1)],8,cn)])],512)])),_:1},8,["size","title","onOpen"])}],["__scopeId","data-v-01f84cbd"]]),mn=a({name:"CircuitsModal",components:{YamlModal:pn},emits:["changed"],data:()=>({defaultYaml:"#- name: main # unique name, used as reference, e.g. as parent in other circuits\n#  title: Main Circuit # used in the UI\n#  maxcurrent: 63 # 63A main circuit breaker (optional)\n#  maxPower: 30000 # 30kW (optional)\n#  meter: grid # associated meter to monitor the power consumption (optional)\n#  parent: # no parent, this is the root circuit\n#- name: garage # unique name, used as reference, e.g. to associate loadpoints\n#  title: Garage # used in the UI\n#  maxcurrent: 24 # allow individual phase use up to 24A\n#  maxPower: 11000 # limit total power to 11kW\n#  meter: garage # dedicated meter for the garage\n#  parent: main # parent to the main circuit\n#- name: carport # unique name, used as reference, e.g. to associate loadpoints\n#  title: Carport # used in the UI\n#  maxCurrent: 32 # 32A circuit breaker\n#  maxPower: # no limit, only check current\n#  meter: # no meter, using data from loadpoints\n#  parent: main # parent to the main circuit\n".trim()})},[["render",function(e,t,a,n,o,i){const l=p("YamlModal");return r(),g(l,{id:"circuitsModal",title:e.$t("config.circuits.title"),description:e.$t("config.circuits.description"),docs:"/docs/features/loadmanagement",defaultYaml:o.defaultYaml,removeKey:"circuits",endpoint:"/config/circuits",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}]]),hn={name:"ControlModal",components:{FormRow:Te,GenericModal:N},emits:["changed"],data:()=>({saving:!1,error:"",values:{},serverValues:{}}),computed:{intervalChanged(){return this.values.interval!==this.serverValues.interval},residualPowerChanged(){return this.values.residualPower!==this.serverValues.residualPower},nothingChanged(){return!this.intervalChanged&&!this.residualPowerChanged}},methods:{reset(){const{interval:e,residualPower:t}=H?.state||{};this.saving=!1,this.error="",this.values={interval:e,residualPower:t},this.serverValues={...this.values}},async open(){this.reset()},async saveValue(e){let t="";"interval"===e?t=`/config/interval/${encodeURIComponent(this.values.interval)}`:"residualPower"===e&&(t=`/residualpower/${encodeURIComponent(this.values.residualPower)}`),await U.post(t)},async save(){this.saving=!0,this.error="";try{this.intervalChanged&&await this.saveValue("interval"),this.residualPowerChanged&&await this.saveValue("residualPower"),this.$emit("changed"),this.$refs.modal.close()}catch(de){this.error=de.message}this.saving=!1}}},gn={key:0,class:"text-danger"},fn={class:"input-group w-50 w-sm-25"},vn={class:"input-group w-50 w-sm-25"},bn={class:"mt-4 d-flex justify-content-between gap-2 flex-column flex-sm-row"},yn={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},wn=["disabled"],kn={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Cn=a(hn,[["render",function(e,t,a,s,c,m){const h=p("FormRow"),v=p("GenericModal");return r(),g(v,{id:"controlModal",ref:"modal",title:e.$t("config.control.title"),"data-testid":"control-modal",onOpen:m.open},{default:T((()=>[o("p",null,l(e.$t("config.control.description")),1),c.error?(r(),n("p",gn,l(c.error),1)):d("",!0),o("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[2]||(t[2]=k(((...e)=>m.save&&m.save(...e)),["prevent"]))},[u(h,{id:"controlInterval",label:e.$t("config.control.labelInterval"),help:e.$t("config.control.descriptionInterval"),example:"30 s",docsLink:"/docs/reference/configuration/interval"},{default:T((()=>[o("div",fn,[f(o("input",{id:"controlInterval","onUpdate:modelValue":t[0]||(t[0]=e=>c.values.interval=e),type:"number",step:"1",min:"1",required:"","aria-describedby":"controlIntervalUnit",class:"form-control text-end"},null,512),[[M,c.values.interval]]),t[3]||(t[3]=o("span",{id:"controlIntervalUnit",class:"input-group-text"},"s",-1))])])),_:1},8,["label","help"]),u(h,{id:"controlResidualPower",label:e.$t("config.control.labelResidualPower"),help:e.$t("config.control.descriptionResidualPower"),example:"100 W",docsLink:"/docs/reference/configuration/site#residualpower"},{default:T((()=>[o("div",vn,[f(o("input",{id:"controlResidualPower","onUpdate:modelValue":t[1]||(t[1]=e=>c.values.residualPower=e),type:"number",step:"1",required:"","aria-describedby":"controlResidualPowerUnit",class:"form-control text-end"},null,512),[[M,c.values.residualPower]]),t[4]||(t[4]=o("span",{id:"controlResidualPowerUnit",class:"input-group-text"},"W",-1))])])),_:1},8,["label","help"]),o("div",bn,[o("button",yn,l(e.$t("config.general.cancel")),1),o("button",{type:"submit",class:"btn btn-primary order-1 order-sm-2 flex-grow-1 flex-sm-grow-0 px-4",disabled:c.saving||m.nothingChanged},[c.saving?(r(),n("span",kn)):d("",!0),i(" "+l(e.$t("config.general.save")),1)],8,wn)])],544)])),_:1},8,["title","onOpen"])}],["__scopeId","data-v-c72e310b"]]);class Mn extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M6 44l9-4 9 4 9-4 9 4V4H6v40zm4-36h28v29.845l-3.375-1.5L33 35.623l-1.625.722L24 39.623l-7.375-3.278L15 35.623l-1.625.722-3.375 1.5V8z"/><path d="M14 12h20v4H14zM14 20h20v4H14zM14 28h12v4H14z"/></svg>'}}window.customElements.define("shopicon-regular-invoice",Mn);const $n={name:"DeviceCard",props:{name:String,title:String,editable:Boolean,error:Boolean},emits:["edit"],data:()=>({tooltip:null}),computed:{tooltipTitle(){if(!this.name)return"";let e=`${this.$t("config.main.name")}: <span class='font-monospace'>${this.name}</span>`;return this.editable||(e+=`<div class="mt-1">${this.$t("config.main.yaml")}</div>`),`<div class="text-start">${e}</div>`}},watch:{tooltipTitle(){this.initTooltip()}},mounted(){this.initTooltip()},methods:{edit(){this.editable&&(this.tooltip?.hide(),this.$emit("edit"))},initTooltip(){this.$nextTick((()=>{this.tooltip?.dispose(),this.$refs.tooltip&&(this.tooltip=new te(this.$refs.tooltip))}))}}},xn={class:"d-flex align-items-center mb-2"},Tn={class:"icon me-2"},Vn=["title"],Pn=["title","aria-label","disabled"],Sn=a($n,[["render",function(e,t,a,i,s,d){return r(),n("li",{class:b(["root round-box",{"round-box--error":a.error}])},[o("div",xn,[o("div",Tn,[c(e.$slots,"icon",{},void 0,!0)]),o("strong",{class:"flex-grow-1 text-nowrap text-truncate","data-bs-toggle":"tooltip",title:a.name},l(a.title),9,Vn),o("button",{ref:"tooltip",type:"button",class:b(["btn btn-sm btn-outline-secondary position-relative border-0 p-2",{"opacity-25":!a.editable}]),"data-bs-toggle":"tooltip","data-bs-html":"true",title:d.tooltipTitle,"aria-label":a.editable?e.$t("config.main.edit"):null,disabled:!a.editable,onClick:t[0]||(t[0]=(...e)=>d.edit&&d.edit(...e))},t[1]||(t[1]=[o("shopicon-regular-adjust",{size:"s"},null,-1)]),10,Pn)]),t[2]||(t[2]=o("hr",{class:"my-3 divide"},null,-1)),c(e.$slots,"tags",{},void 0,!0)],2)}],["__scopeId","data-v-2cb3110d"]]),qn=a({name:"Eebus",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 32 32"},t[0]||(t[0]=[o("path",{d:"M15.998,8.095c1.369,-0 2.669,0.219 3.902,0.657c1.232,0.438 2.349,1.04 3.352,1.807c0.365,0.273 0.553,0.634 0.562,1.081c0.01,0.448 -0.15,0.835 -0.48,1.163c-0.31,0.31 -0.693,0.47 -1.149,0.48c-0.456,0.009 -0.867,-0.114 -1.232,-0.37c-0.693,-0.475 -1.46,-0.849 -2.299,-1.123c-0.84,-0.273 -1.725,-0.41 -2.656,-0.41c-0.93,-0 -1.815,0.137 -2.655,0.41c-0.839,0.274 -1.606,0.648 -2.299,1.123c-0.365,0.255 -0.776,0.374 -1.232,0.356c-0.456,-0.019 -0.84,-0.183 -1.15,-0.493c-0.31,-0.329 -0.465,-0.716 -0.465,-1.163c-0,-0.447 0.182,-0.807 0.547,-1.082c1.004,-0.766 2.122,-1.364 3.354,-1.793c1.232,-0.43 2.532,-0.644 3.9,-0.643m0,-6.57c2.281,0 4.43,0.374 6.447,1.123c2.017,0.748 3.828,1.806 5.433,3.175c0.365,0.31 0.557,0.693 0.575,1.15c0.019,0.456 -0.137,0.848 -0.465,1.177c-0.31,0.31 -0.693,0.47 -1.15,0.479c-0.456,0.01 -0.867,-0.132 -1.232,-0.425c-1.313,-1.076 -2.787,-1.911 -4.42,-2.504c-1.633,-0.592 -3.362,-0.889 -5.188,-0.89c-1.825,-0.001 -3.554,0.296 -5.186,0.89c-1.633,0.595 -3.106,1.429 -4.422,2.504c-0.365,0.292 -0.775,0.434 -1.232,0.425c-0.456,-0.008 -0.839,-0.168 -1.149,-0.479c-0.329,-0.329 -0.484,-0.721 -0.466,-1.177c0.019,-0.457 0.21,-0.84 0.575,-1.15c1.606,-1.369 3.418,-2.427 5.434,-3.175c2.017,-0.749 4.166,-1.123 6.446,-1.123",fill:"currentColor"},null,-1),o("path",{d:"M15.992,23.961c-1.368,0 -2.669,-0.219 -3.901,-0.657c-1.232,-0.437 -2.35,-1.04 -3.353,-1.806c-0.365,-0.274 -0.552,-0.635 -0.561,-1.082c-0.01,-0.447 0.15,-0.835 0.479,-1.163c0.31,-0.31 0.694,-0.47 1.15,-0.479c0.456,-0.01 0.867,0.113 1.232,0.37c0.693,0.474 1.46,0.848 2.299,1.122c0.84,0.274 1.725,0.411 2.655,0.411c0.931,-0 1.816,-0.137 2.656,-0.411c0.839,-0.274 1.605,-0.648 2.299,-1.122c0.365,-0.256 0.776,-0.374 1.232,-0.356c0.456,0.018 0.839,0.182 1.149,0.493c0.311,0.328 0.466,0.716 0.466,1.162c-0,0.447 -0.183,0.808 -0.548,1.082c-1.003,0.767 -2.121,1.365 -3.353,1.794c-1.233,0.429 -2.533,0.643 -3.901,0.642m0,6.57c-2.281,0 -4.43,-0.374 -6.447,-1.122c-2.017,-0.748 -3.828,-1.807 -5.433,-3.176c-0.365,-0.31 -0.556,-0.693 -0.575,-1.149c-0.018,-0.456 0.137,-0.849 0.466,-1.177c0.31,-0.311 0.693,-0.47 1.149,-0.48c0.457,-0.009 0.867,0.132 1.232,0.425c1.314,1.077 2.788,1.911 4.421,2.504c1.632,0.593 3.362,0.89 5.187,0.89c1.826,0.001 3.555,-0.296 5.187,-0.89c1.632,-0.594 3.106,-1.429 4.421,-2.504c0.365,-0.292 0.776,-0.434 1.232,-0.425c0.456,0.009 0.84,0.169 1.15,0.48c0.328,0.328 0.484,0.721 0.465,1.177c-0.018,0.456 -0.21,0.839 -0.575,1.149c-1.605,1.369 -3.417,2.428 -5.434,3.176c-2.017,0.748 -4.165,1.122 -6.446,1.122",fill:"currentColor"},null,-1)]),4)}]]),In=a({name:"EebusModal",components:{YamlModal:pn},emits:["changed"],data:()=>({defaultYaml:"#shipid: EVCC-1234567890abcdef\n#interfaces:\n#  - eth0\n#certificate:\n#  public: |\n#    -----BEGIN CERTIFICATE-----\n#    1234567890abcdef==\n#    -----END CERTIFICATE-----\n#  private: |\n#    -----BEGIN EC PRIVATE KEY-----\n#    1234567890abcdef\n#    -----END EC PRIVATE KEY-----\n".trim()})},[["render",function(e,t,a,n,o,i){const l=p("YamlModal");return r(),g(l,{id:"eebusModal",title:e.$t("config.eebus.title"),description:e.$t("config.eebus.description"),docs:"/docs/reference/configuration/eebus",defaultYaml:o.defaultYaml,removeKey:"eebus",endpoint:"/config/eebus",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}]]),On={name:"JsonModal",components:{GenericModal:N},props:{title:String,description:String,errorMessage:String,docs:String,endpoint:String,disableRemove:Boolean,noButtons:Boolean,transformReadValues:Function,stateKey:String,saveMethod:{type:String,default:"post"}},emits:["changed","open"],data:()=>({saving:!1,removing:!1,error:"",values:{},serverValues:{}}),computed:{docsLink(){return this.docs?`${s()}${this.docs}`:null},nothingChanged(){return JSON.stringify(this.values)===JSON.stringify(this.serverValues)}},methods:{reset(){this.saving=!1,this.deleting=!1,this.error="",this.values="",this.serverValues=""},async open(){this.$emit("open"),this.reset(),await this.load()},async load(){this.serverValues=this.stateKey?H.state[this.stateKey]:H.state,this.transformReadValues&&(this.serverValues=this.transformReadValues(this.serverValues)),this.values={...this.serverValues}},async save(){this.saving=!0,this.error="";try{const e=await U[this.saveMethod](this.endpoint,this.values,{validateStatus:e=>[200,202,400].includes(e)});200!==e.status&&202!==e.status||(this.$emit("changed"),this.$refs.modal.close()),400===e.status&&(this.error=e.data.error)}catch(de){console.error(de)}this.saving=!1},async remove(){this.removing=!0,this.error="";try{const e=await U.delete(this.endpoint,{validateStatus:e=>[200,400].includes(e)});200===e.status&&(this.$emit("changed"),this.$refs.modal.close()),400===e.status&&(this.error=e.data.error)}catch(de){console.error(de)}this.removing=!1}}},Nn={key:0},Un={key:0},Dn=["href"],_n={key:1,class:"text-danger"},En={key:0,class:"d-block"},Ln={key:0,class:"mt-4 d-flex justify-content-between gap-2 flex-column flex-sm-row"},Rn={class:"d-flex justify-content-between order-2 order-sm-1 gap-2 flex-grow-1 flex-sm-grow-0"},An={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},jn=["disabled"],Bn={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Fn=["disabled"],zn={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Hn=a(On,[["render",function(e,t,a,s,u,m){const h=p("GenericModal");return r(),g(h,{ref:"modal",title:a.title,onOpen:m.open},{default:T((()=>[a.description||m.docsLink?(r(),n("p",Nn,[a.description?(r(),n("span",Un,l(a.description+" "),1)):d("",!0),m.docsLink?(r(),n("a",{key:1,href:m.docsLink,target:"_blank"},l(e.$t("config.general.docsLink")),9,Dn)):d("",!0)])):d("",!0),u.error?(r(),n("p",_n,[a.errorMessage?(r(),n("span",En,l(a.errorMessage),1)):d("",!0),i(" "+l(u.error),1)])):d("",!0),o("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[1]||(t[1]=k(((...e)=>m.save&&m.save(...e)),["prevent"]))},[c(e.$slots,"default",{values:u.values},void 0,!0),a.noButtons?d("",!0):(r(),n("div",Ln,[o("div",Rn,[o("button",An,l(e.$t("config.general.cancel")),1),a.disableRemove?d("",!0):(r(),n("button",{key:0,type:"button",class:"btn btn-link text-danger",disabled:u.removing,onClick:t[0]||(t[0]=(...e)=>m.remove&&m.remove(...e))},[u.removing?(r(),n("span",Bn)):d("",!0),i(" "+l(e.$t("config.general.remove")),1)],8,jn))]),o("button",{type:"submit",class:"btn btn-primary order-1 order-sm-2 flex-grow-1 flex-sm-grow-0 px-4",disabled:u.saving||m.nothingChanged},[u.saving?(r(),n("span",zn)):d("",!0),i(" "+l(e.$t("config.general.save")),1)],8,Fn)]))],544)])),_:3},8,["title","onOpen"])}],["__scopeId","data-v-79654f92"]]),Yn=["onUpdate:modelValue"],Wn=a({name:"TitleModal",components:{FormRow:Te,JsonModal:Hn},emits:["changed"],methods:{transformReadValues:e=>({title:e})}},[["render",function(e,t,a,n,i,l){const s=p("FormRow"),d=p("JsonModal");return r(),g(d,{id:"titleModal",title:e.$t("config.title.title"),endpoint:"/config/site","state-key":"siteTitle","save-method":"put","transform-read-values":l.transformReadValues,"data-testid":"title-modal","disable-remove":"",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},{default:T((({values:t})=>[u(s,{id:"siteTitle",label:e.$t("config.title.label"),help:e.$t("config.title.description")},{default:T((()=>[f(o("input",{id:"siteTitle","onUpdate:modelValue":e=>t.title=e,class:"form-control"},null,8,Yn),[[M,t.title]])])),_:2},1032,["label","help"])])),_:1},8,["title","transform-read-values"])}]]),Gn=a({name:"Edit",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M5 19h1.425L16.2 9.225L14.775 7.8L5 17.575zm-1 2q-.425 0-.712-.288T3 20v-2.425q0-.4.15-.763t.425-.637L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.437.65T21 6.4q0 .4-.138.763t-.437.662l-12.6 12.6q-.275.275-.638.425t-.762.15zM19 6.4L17.6 5zm-3.525 2.125l-.7-.725L16.2 9.225z"},null,-1)]),4)}]]),Kn={name:"GeneralConfig",components:{TitleModal:Wn,EditIcon:Gn},mixins:[m],emits:["site-changed"],data:()=>({title:""}),computed:{telemetryEnabled:()=>!0===Y.telemetry,hiddenFeatures:()=>!0===Y.hiddenFeatures,networkStatus(){const{host:e,port:t}=H.state?.network||{};return e?`${e}:${t}`:`${t||""}`},controlStatus(){const e=H.state?.interval;return e?this.fmtDuration(e):""},sponsorStatus(){const e=H.state?.sponsor||{},{name:t,expiresSoon:a}=e;let n="";return t&&(n=a?"text-warning":"text-primary"),{name:t,expiresSoon:a,cssClass:n}}},async mounted(){await this.load()},methods:{async changed(){this.$emit("site-changed"),this.load()},async load(){try{const e=await U.get("/config/site",{validateStatus:e=>[200,404].includes(e)});200===e.status?this.title=e.data.result.title:console.log("TODO: implement site endpoint in config error mode")}catch(de){console.error(de)}},todo(){alert("not implemented")},openModal(e){const t=document.getElementById(e);t?O.getOrCreateInstance(t).show():console.error(`modal ${e} not found`)}}},Jn={class:"group round-box p-4"},Qn={class:"config-entry","data-testid":"generalconfig-title"},Zn={class:"config-label"},Xn={class:"config-text"},eo=["title"],to={class:"config-entry","data-testid":"generalconfig-password"},ao={class:"config-label"},no=["title"],oo={class:"config-entry","data-testid":"generalconfig-telemetry"},io={class:"config-label"},lo={class:"config-text"},ro=["title"],so={class:"config-entry","data-testid":"generalconfig-experimental"},co={class:"config-label"},uo={class:"config-text"},po=["title"],mo={key:0,class:"config-entry","data-testid":"generalconfig-sponsoring"},ho={class:"config-label"},go={key:0,class:"d-inline-block me-1 p-1 rounded-circle bg-warning rounded-circle"},fo=["title"],vo={key:1,class:"config-entry","data-testid":"generalconfig-network"},bo={class:"config-label"},yo={class:"config-text"},wo=["title"],ko={key:2,class:"config-entry","data-testid":"generalconfig-control"},Co={class:"config-label"},Mo={class:"config-text"},$o=["title"],xo=a(Kn,[["render",function(e,t,a,s,c,m){const h=p("EditIcon"),g=p("TitleModal");return r(),n("div",Jn,[o("div",Qn,[o("strong",Zn,l(e.$t("config.general.title")),1),o("div",Xn,l(c.title||"---"),1),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[0]||(t[0]=k((e=>m.openModal("titleModal")),["prevent"]))},[u(h,{size:"xs"}),u(g,{ref:"titleModal",onChanged:m.load},null,8,["onChanged"])],8,eo)]),o("div",to,[o("strong",ao,l(e.$t("config.general.password")),1),t[7]||(t[7]=o("div",{class:"config-text"},"*******",-1)),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[1]||(t[1]=k((e=>m.openModal("passwordModal")),["prevent"]))},[u(h,{size:"xs"})],8,no)]),o("div",oo,[o("strong",io,l(e.$t("config.general.telemetry")),1),o("div",lo,l(e.$t("config.general."+(m.telemetryEnabled?"on":"off"))),1),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[2]||(t[2]=k((e=>m.openModal("globalSettingsModal")),["prevent"]))},[u(h,{size:"xs"})],8,ro)]),o("div",so,[o("strong",co,l(e.$t("config.general.experimental")),1),o("div",uo,l(e.$t("config.general."+(m.hiddenFeatures?"on":"off"))),1),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[3]||(t[3]=k((e=>m.openModal("globalSettingsModal")),["prevent"]))},[u(h,{size:"xs"})],8,po)]),e.$hiddenFeatures()?(r(),n("div",mo,[o("strong",ho,l(e.$t("config.sponsor.title"))+" 🧪",1),o("div",{class:b(["config-text",m.sponsorStatus.cssClass])},[m.sponsorStatus.expiresSoon&&m.sponsorStatus.name?(r(),n("span",go)):d("",!0),i(" "+l(m.sponsorStatus.name||"---"),1)],2),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[4]||(t[4]=k((e=>m.openModal("sponsorModal")),["prevent"]))},[u(h,{size:"xs"})],8,fo)])):d("",!0),e.$hiddenFeatures()?(r(),n("div",vo,[o("strong",bo,l(e.$t("config.network.title"))+" 🧪",1),o("div",yo,l(m.networkStatus),1),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[5]||(t[5]=k((e=>m.openModal("networkModal")),["prevent"]))},[u(h,{size:"xs"})],8,wo)])):d("",!0),e.$hiddenFeatures()?(r(),n("div",ko,[o("strong",Co,l(e.$t("config.control.title"))+" 🧪",1),o("div",Mo,l(m.controlStatus),1),o("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[6]||(t[6]=k((e=>m.openModal("controlModal")),["prevent"]))},[u(h,{size:"xs"})],8,$o)])):d("",!0)])}],["__scopeId","data-v-8b3deadf"]]),To=a({name:"Hems",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M3 11q0 1.8 1.15 3.175T7.075 15.9l-.775-.775q-.275-.275-.275-.687t.275-.713q.3-.3.713-.3t.712.3L10.3 16.3q.3.3.3.7t-.3.7l-2.6 2.6q-.275.275-.7.275t-.725-.3Q6 20 6 19.6t.275-.7l.9-.95q-2.65-.3-4.412-2.287T1 11q0-2.925 2.038-4.962T8 4h2q.425 0 .713.288T11 5t-.288.713T10 6H8Q5.925 6 4.463 7.463T3 11m11 9q-.425 0-.712-.288T13 19v-5q0-.425.288-.712T14 13h7q.425 0 .713.288T22 14v5q0 .425-.288.713T21 20zm0-9q-.425 0-.712-.288T13 10V5q0-.425.288-.712T14 4h7q.425 0 .713.288T22 5v5q0 .425-.288.713T21 11zm1-2h5V6h-5z"},null,-1)]),4)}]]),Vo=a({name:"HemsModal",components:{YamlModal:pn},emits:["changed"],data:()=>({defaultYaml:"#type: sma\n#allowcontrol: false\n#vendorid: AAAAAAAA\n#deviceid: BBBBBBBB\n".trim()})},[["render",function(e,t,a,n,o,i){const l=p("YamlModal");return r(),g(l,{id:"hemsModal",title:e.$t("config.hems.title"),description:e.$t("config.hems.description"),docs:"/docs/reference/configuration/hems",defaultYaml:o.defaultYaml,endpoint:"/config/hems",removeKey:"hems",size:"md",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}]]),Po=a({name:"Influx",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"m23.778 14.482l-2.287-9.959c-.13-.545-.624-1.09-1.169-1.248L9.87.051C9.74 0 9.584 0 9.426 0c-.443 0-.909.18-1.222.443L.716 7.412C.3 7.776.092 8.504.222 9.024l2.445 10.662c.13.545.624 1.092 1.169 1.248l9.775 3.015c.13.051.285.051.443.051c.443 0 .91-.18 1.223-.443l8.007-7.435c.418-.39.624-1.092.494-1.64M10.962 2.417l7.175 2.21c.285.08.285.21 0 .286l-3.77.858c-.285.08-.674-.05-.883-.26l-2.626-2.834c-.235-.232-.184-.336.104-.26m4.47 12.872c.079.286-.105.444-.39.365l-7.748-2.392c-.285-.079-.338-.313-.13-.52l5.93-5.514c.209-.209.443-.13.52.156zM2.667 8.267l6.293-5.85c.21-.209.545-.18.754.025L12.86 5.85c.209.21.18.545-.026.754l-6.293 5.85c-.21.21-.545.181-.754-.025L2.64 9.024a.536.536 0 0 1 .026-.757zm1.536 9.284L2.54 10.244c-.08-.285.05-.34.234-.13L5.4 12.949c.209.209.285.624.209.909L4.462 17.55c-.079.285-.208.285-.26 0zm9.202 4.264l-8.217-2.522a.547.547 0 0 1-.364-.675l1.378-4.421a.547.547 0 0 1 .675-.365l8.216 2.522c.285.079.443.39.364.675L14.08 21.45a.553.553 0 0 1-.674.365zm7.279-5.98L15.2 20.93c-.209.209-.31.13-.234-.155l1.144-3.694c.079-.285.39-.573.674-.624l3.77-.858c.288-.076.339.054.13.234zm.598-1.09l-4.523 1.039a.534.534 0 0 1-.65-.39l-1.922-8.372a.534.534 0 0 1 .39-.65L19.1 5.335a.534.534 0 0 1 .649.39l1.923 8.371c.079.31-.102.596-.39.65Z"},null,-1)]),4)}]]),So=["onUpdate:modelValue"],qo=["onUpdate:modelValue"],Io=["onUpdate:modelValue"],Oo=["onUpdate:modelValue"],No=["onUpdate:modelValue"],Uo=["onUpdate:modelValue"],Do={class:"d-flex"},_o=["onUpdate:modelValue"],Eo={class:"form-check-label ms-2",for:"influxInsecure"},Lo=["onClick"],Ro=["onClick"],Ao=a({name:"InfluxModal",components:{FormRow:Te,JsonModal:Hn},emits:["changed"],data:()=>({v1:!1}),methods:{showV1(e){return this.v1||e.user||e.password}}},[["render",function(e,t,a,i,s,c){const m=p("FormRow"),h=p("JsonModal");return r(),g(h,{id:"influxModal",title:e.$t("config.influx.title"),description:e.$t("config.influx.description"),docs:"/docs/reference/configuration/influx",endpoint:"/config/influx","state-key":"influx","data-testid":"influx-modal",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},{default:T((({values:t})=>[u(m,{id:"influxUrl",label:e.$t("config.influx.labelUrl"),example:"http://localhost:8086"},{default:T((()=>[f(o("input",{id:"influxUrl","onUpdate:modelValue":e=>t.url=e,type:"url",class:"form-control",required:""},null,8,So),[[M,t.url]])])),_:2},1032,["label"]),c.showV1(t)?d("",!0):(r(),g(m,{key:0,id:"influxOrg",label:e.$t("config.influx.labelOrg"),example:"home"},{default:T((()=>[f(o("input",{id:"influxOrg","onUpdate:modelValue":e=>t.org=e,class:"form-control",required:""},null,8,qo),[[M,t.org]])])),_:2},1032,["label"])),u(m,{id:"influxDatabase",label:e.$t("config.influx.label"+(c.showV1(t)?"Database":"Bucket")),example:"evcc"},{default:T((()=>[f(o("input",{id:"influxDatabase","onUpdate:modelValue":e=>t.database=e,class:"form-control",required:""},null,8,Io),[[M,t.database]])])),_:2},1032,["label"]),c.showV1(t)?d("",!0):(r(),g(m,{key:1,id:"influxToken",label:e.$t("config.influx.labelToken"),help:e.$t("config.influx.descriptionToken")},{default:T((()=>[f(o("input",{id:"influxToken","onUpdate:modelValue":e=>t.token=e,class:"form-control",required:""},null,8,Oo),[[M,t.token]])])),_:2},1032,["label","help"])),c.showV1(t)?(r(),g(m,{key:2,id:"influxUser",label:e.$t("config.influx.labelUser"),optional:""},{default:T((()=>[f(o("input",{id:"influxUser","onUpdate:modelValue":e=>t.user=e,class:"form-control"},null,8,No),[[M,t.user]])])),_:2},1032,["label"])):d("",!0),c.showV1(t)?(r(),g(m,{key:3,id:"influxPassword",label:e.$t("config.influx.labelPassword"),optional:""},{default:T((()=>[f(o("input",{id:"influxPassword","onUpdate:modelValue":e=>t.password=e,class:"form-control",type:"password",autocomplete:"off"},null,8,Uo),[[M,t.password]])])),_:2},1032,["label"])):d("",!0),u(m,{id:"influxInsecure",label:e.$t("config.influx.labelInsecure")},{default:T((()=>[o("div",Do,[f(o("input",{id:"influxInsecure","onUpdate:modelValue":e=>t.insecure=e,class:"form-check-input",type:"checkbox"},null,8,_o),[[W,t.insecure]]),o("label",Eo,l(e.$t("config.influx.labelCheckInsecure")),1)])])),_:2},1032,["label"]),o("p",null,[c.showV1(t)?(r(),n("button",{key:0,class:"btn btn-link btn-sm text-primary px-0",type:"button",onClick:e=>{t.user="",t.password="",s.v1=!1}},l(e.$t("config.influx.v2Support")),9,Lo)):(r(),n("button",{key:1,class:"btn btn-link btn-sm text-primary px-0",type:"button",onClick:e=>{t.token="",s.v1=!0}},l(e.$t("config.influx.v1Support")),9,Ro))])])),_:1},8,["title","description"])}]]);function jo(e){return JSON.parse(JSON.stringify(e))}const Bo=6e10,Fo={title:"",phasesConfigured:3,minCurrent:6,maxCurrent:16,priority:0,defaultMode:"",thresholds:{enable:{delay:1*Bo,threshold:0},disable:{delay:3*Bo,threshold:0}},soc:{poll:{mode:"charging",interval:60*Bo},estimate:!1},vehicle:"",charger:"",circuit:"",meter:""},zo={enable:{delay:1*Bo,threshold:0},disable:{delay:3*Bo,threshold:0}},Ho={name:"LoadpointModal",components:{FormRow:Te,PropertyField:Fe,GenericModal:N,SelectGroup:h,EditIcon:Gn},mixins:[m],props:{id:Number,name:String,vehicleOptions:{type:Array,default:()=>[]},loadpointCount:Number,fade:String,chargers:{type:Array,default:()=>[]},chargerValues:{type:Object,default:()=>{}},meters:{type:Array,default:()=>[]},circuits:{type:Array,default:()=>[]}},emits:["updated","openMeterModal","openChargerModal","close","opened"],data:()=>({isModalVisible:!1,saving:!1,selectedType:null,values:jo(Fo),chargerPower:"11kw",solarMode:"default",tab:"solar",showAllSelected:!1,powerUnit:q}),computed:{modalTitle(){return this.isNew?this.$t("config.loadpoint.titleAdd"):this.$t("config.loadpoint.titleEdit")},isNew(){return void 0===this.id},showAll(){return!this.isNew||this.showAllSelected},charger(){return this.chargers.find((e=>e.name===this.values.charger))},chargerTitle(){return this.charger?`${this.charger.config?.template||"unknown"} [${this.values.charger}]`:""},chargerStatus(){return this.chargerValues&&this.values.charger&&this.chargerValues[this.values.charger]||{}},chargerSupports1p3p(){return this.chargerStatus.phases1p3p?.value||!1},chargerIsSinglePhase(){return this.chargerStatus.singlePhase?.value||!1},meterTitle(){const e=this.values.meter;if(!e)return"";const t=this.meters.find((t=>t.name===e));return`${t?.config?.template||"unknown"} [${e}]`},isDeletable(){return!this.isNew},showPriority(){return this.isNew?this.loadpointCount>0:this.loadpointCount>1},priorityOptions(){const e=Array.from({length:11},((e,t)=>({key:t,name:`${t}`})));return e[0].name="0 (default)",e[0].key=void 0,e[10].name="10 (highest)",e},showCircuit(){return this.circuits.length>0},circuitOptions(){return[{key:"",name:"unassigned"},...this.circuits.map((e=>({key:e.name,name:`${e.config?.title||""} [${e.name}]`.trim()})))]},allVehicleOptions(){return[{key:"",name:this.$t("config.loadpoint.vehicleAutoDetection")},{key:null,name:null},...this.vehicleOptions]}},watch:{isModalVisible(e){e&&this.values?.id!==this.id&&(this.reset(),this.id&&this.loadConfiguration())},chargerPower(e){"11kw"===e?(this.values.minCurrent=6,this.values.maxCurrent=16):"22kw"===e&&(this.values.minCurrent=6,this.values.maxCurrent=32)},solarMode(e){"default"===e&&(this.values.thresholds=jo(zo))},chargerSupports1p3p(){this.updatePhases()},chargerIsSinglePhase(){this.updatePhases()}},methods:{reset(){this.values=jo(Fo),this.updatePhases()},async loadConfiguration(){try{const e=await U.get(`config/loadpoints/${this.id}`);this.values=jo(e.data.result),this.updateChargerPower(),this.updateSolarMode(),this.updatePhases()}catch(de){console.error(de)}},async update(){this.saving=!0;try{const e=jo(this.values);await U.put(`config/loadpoints/${this.id}`,e),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("update failed")}this.saving=!1},async remove(){try{await U.delete(`config/loadpoints/${this.id}`),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("delete failed")}},async create(){this.saving=!0;try{await U.post("config/loadpoints",this.values),this.reset(),this.$emit("updated"),this.close()}catch(de){console.error(de);const t=de.response?.data?.error;alert(`failed to create loadpoint: ${t}`)}this.saving=!1},open(){this.isModalVisible=!0},opened(){this.$emit("opened")},close(){this.$emit("close"),this.showAllSelected=!1,this.isModalVisible=!1},editCharger(){this.$emit("openChargerModal",this.values.charger)},editMeter(){this.$emit("openMeterModal",this.values.meter)},setMeter(e){this.values.meter=e},setCharger(e){this.values.charger=e},updateChargerPower(){const{minCurrent:e,maxCurrent:t}=this.values;this.chargerPower=6===e&&16===t?"11kw":6===e&&32===t?"22kw":"other"},updateSolarMode(){const{thresholds:e}=this.values;ie(e,zo)?this.solarMode="default":this.solarMode="custom"},updatePhases(){const{phasesConfigured:e}=this.values;this.chargerIsSinglePhase?this.values.phasesConfigured=1:this.chargerSupports1p3p&&this.isNew?this.values.phasesConfigured=0:this.chargerSupports1p3p||0!==e||(this.values.phasesConfigured=3)}}},Yo={class:"d-flex"},Wo={key:1,class:"d-flex justify-content-end"},Go=["disabled"],Ko={key:2},Jo={class:"d-flex"},Qo={key:1},Zo={key:3},Xo={class:"ms-3 mb-5"},ei={class:"mb-4"},ti={class:"d-flex flex-wrap flex-sm-nowrap gap-4"},ai={class:"form-text evcc-gray"},ni={class:"d-flex flex-wrap flex-sm-nowrap gap-4"},oi={class:"form-text evcc-gray"},ii={class:"text-muted"},li={key:1,class:"row ms-3 mb-5"},ri={key:4},si={class:"d-flex mb-4"},di={class:"form-check-label ms-2",for:"loadpointEstimate"},ci={key:5},ui={class:"text-muted"},pi={key:5,class:"mt-5 mb-4 d-flex justify-content-between"},mi={key:1,type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},hi=["disabled"],gi={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},fi=a(Ho,[["render",function(e,t,a,s,c,m){const h=p("PropertyField"),v=p("FormRow"),b=p("EditIcon"),w=p("SelectGroup"),C=p("GenericModal");return r(),g(C,{id:"loadpointModal",title:m.modalTitle,"data-testid":"loadpoint-modal",fade:a.fade,onOpen:m.open,onOpened:m.opened,onClose:m.close},{default:T((()=>[o("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[23]||(t[23]=k((e=>m.isNew?m.create():m.update()),["prevent"]))},[u(v,{id:"loadpointParamTitle",label:e.$t("config.loadpoint.titleLabel"),example:e.$t("config.loadpoint.titleExample")},{default:T((()=>[u(h,{id:"loadpointParamTitle",modelValue:c.values.title,"onUpdate:modelValue":t[0]||(t[0]=e=>c.values.title=e),type:"String",class:"me-2",required:""},null,8,["modelValue"])])),_:1},8,["label","example"]),c.values.charger?(r(),g(v,{key:0,id:"loadpointParamCharger",label:e.$t("config.loadpoint.chargerLabel")},{default:T((()=>[o("div",Yo,[u(h,{id:"loadpointParamCharger",modelValue:m.chargerTitle,type:"String",class:"me-2 flex-grow-1",readonly:"",required:"",onClick:k(m.editCharger,["prevent"])},null,8,["modelValue","onClick"]),o("button",{class:"btn btn-link btn-sm evcc-default-text",type:"button",onClick:t[1]||(t[1]=k(((...e)=>m.editCharger&&m.editCharger(...e)),["prevent"]))},[u(b)])])])),_:1},8,["label"])):(r(),n("div",Wo,[o("button",{class:"btn btn-outline-primary",type:"submit",disabled:0===c.values.title?.length,onClick:t[2]||(t[2]=k(((...e)=>m.editCharger&&m.editCharger(...e)),["prevent"]))},l(e.$t("config.loadpoint.addCharger")),9,Go)])),c.values.charger||!m.isNew?(r(),n("div",Ko,[c.values.meter?(r(),g(v,{key:0,id:"loadpointParamMeter",class:"mb-6",label:e.$t("config.loadpoint.energyMeterLabel"),help:e.$t("config.loadpoint.energyMeterHelp")},{default:T((()=>[o("div",Jo,[u(h,{id:"loadpointParamMeter",modelValue:m.meterTitle,type:"String",class:"me-2 flex-grow-1",required:"",readonly:"",onClick:m.editMeter},null,8,["modelValue","onClick"]),o("button",{class:"btn btn-link btn-sm evcc-default-text",type:"button",tabindex:"0",onClick:t[3]||(t[3]=k(((...e)=>m.editMeter&&m.editMeter(...e)),["prevent"]))},[u(b)])])])),_:1},8,["label","help"])):(r(),n("p",Qo,[o("button",{class:"btn btn-link btn-sm text-gray px-0",style:{"margin-top":"-1rem"},type:"button",tabindex:"0",onClick:t[4]||(t[4]=(...e)=>m.editMeter&&m.editMeter(...e))},l(e.$t("config.loadpoint.addMeter")),1)]))])):d("",!0),c.values.charger?(r(),n("div",Zo,[o("h6",null,l(e.$t("config.loadpoint.chargingTitle")),1),u(v,{id:"loadpointMode",label:e.$t("config.loadpoint.defaultModeLabel"),help:""===c.values.defaultMode?e.$t("config.loadpoint.defaultModeHelpKeep"):e.$t("config.loadpoint.defaultModeHelp")},{default:T((()=>[u(h,{id:"loadpointMode",modelValue:c.values.defaultMode,"onUpdate:modelValue":t[5]||(t[5]=e=>c.values.defaultMode=e),type:"Choice",class:"w-100",required:"",choice:[{key:"",name:"---"},{key:"off",name:e.$t("main.mode.off")},{key:"pv",name:e.$t("main.mode.pv")},{key:"minpv",name:e.$t("main.mode.minpv")},{key:"now",name:e.$t("main.mode.now")}]},null,8,["modelValue","choice"])])),_:1},8,["label","help"]),f(u(v,{id:"loadpointSolarMode",label:e.$t("config.loadpoint.solarBehaviorLabel"),help:"default"===c.solarMode?e.$t("config.loadpoint.solarBehaviorDefaultHelp",{enableDelay:e.fmtDurationNs(c.values.thresholds.enable.delay,!0,"m"),disableDelay:e.fmtDurationNs(c.values.thresholds.disable.delay,!0,"m")}):e.$t("config.loadpoint.solarBehaviorCustomHelp")},{default:T((()=>[u(w,{id:"loadpointSolarMode",modelValue:c.solarMode,"onUpdate:modelValue":t[6]||(t[6]=e=>c.solarMode=e),class:"w-100",options:[{name:e.$t("config.loadpoint.solarModeMaximum"),value:"default"},{name:e.$t("config.loadpoint.solarModeCustom"),value:"custom"}],transparent:"","equal-width":""},null,8,["modelValue","options"])])),_:1},8,["label","help"]),[[$,m.showAll]]),f(o("div",Xo,[o("div",ei,[o("div",ti,[u(v,{id:"loadpointEnableThreshold",label:e.$t("config.loadpoint.thresholdEnableLabel"),style:{"margin-bottom":"0 !important"}},{default:T((()=>[u(h,{id:"loadpointEnableThreshold",modelValue:c.values.thresholds.enable.threshold,"onUpdate:modelValue":t[7]||(t[7]=e=>c.values.thresholds.enable.threshold=e),type:"Float",unit:"W",size:"w-25 w-min-200",required:""},null,8,["modelValue"])])),_:1},8,["label"]),u(v,{id:"loadpointEnableDelay",label:e.$t("config.loadpoint.thresholdEnableDelayLabel"),style:{"margin-bottom":"0 !important"}},{default:T((()=>[u(h,{id:"loadpointEnableDelay",modelValue:c.values.thresholds.enable.delay,"onUpdate:modelValue":t[8]||(t[8]=e=>c.values.thresholds.enable.delay=e),type:"Duration",unit:"minute",size:"w-25 w-min-200",required:""},null,8,["modelValue"])])),_:1},8,["label"])]),o("div",ai,l(0===c.values.thresholds.enable.threshold?e.$t("config.loadpoint.thresholdEnableHelpZero",{delay:e.fmtDurationNs(c.values.thresholds.enable.delay,!0,"m")}):c.values.thresholds.enable.threshold<0?e.$t("config.loadpoint.thresholdEnableHelpNegative",{surplus:e.fmtW(-1*c.values.thresholds.enable.threshold,c.powerUnit.AUTO),delay:e.fmtDurationNs(c.values.thresholds.enable.delay,!0,"m")}):e.$t("config.loadpoint.thresholdEnableHelpInvalid")),1)]),o("div",null,[o("div",ni,[u(v,{id:"loadpointDisableThreshold",label:e.$t("config.loadpoint.thresholdDisableLabel"),style:{"margin-bottom":"0 !important"}},{default:T((()=>[u(h,{id:"loadpointDisableThreshold",modelValue:c.values.thresholds.disable.threshold,"onUpdate:modelValue":t[9]||(t[9]=e=>c.values.thresholds.disable.threshold=e),type:"Float",unit:"W",size:"w-25 w-min-200",required:""},null,8,["modelValue"])])),_:1},8,["label"]),u(v,{id:"loadpointDisableDelay",label:e.$t("config.loadpoint.thresholdDisableDelayLabel"),style:{"margin-bottom":"0 !important"}},{default:T((()=>[u(h,{id:"loadpointDisableDelay",modelValue:c.values.thresholds.disable.delay,"onUpdate:modelValue":t[10]||(t[10]=e=>c.values.thresholds.disable.delay=e),type:"Duration",unit:"minute",size:"w-25 w-min-200",required:""},null,8,["modelValue"])])),_:1},8,["label"])]),o("div",oi,l(0===c.values.thresholds.disable.threshold?e.$t("config.loadpoint.thresholdDisableHelpZero",{delay:e.fmtDurationNs(c.values.thresholds.disable.delay,!0,"m")}):c.values.thresholds.disable.threshold>0?e.$t("config.loadpoint.thresholdDisableHelpPositive",{power:e.fmtW(c.values.thresholds.disable.threshold,c.powerUnit.AUTO),delay:e.fmtDurationNs(c.values.thresholds.disable.delay,!0,"m")}):e.$t("config.loadpoint.thresholdDisableHelpInvalid")),1)])],512),[[$,"custom"===c.solarMode]]),m.showPriority?f((r(),g(v,{key:0,id:"loadpointParamPriority",label:e.$t("config.loadpoint.priorityLabel"),help:e.$t("config.loadpoint.priorityHelp")},{default:T((()=>[u(h,{id:"loadpointParamPriority",modelValue:c.values.priority,"onUpdate:modelValue":t[11]||(t[11]=e=>c.values.priority=e),type:"Choice",size:"w-100",class:"me-2",choice:m.priorityOptions,required:""},null,8,["modelValue","choice"])])),_:1},8,["label","help"])),[[$,m.showAll]]):d("",!0),f(o("h6",null,[i(l(e.$t("config.loadpoint.electricalTitle"))+" ",1),o("small",ii,l(e.$t("config.loadpoint.electricalSubtitle")),1)],512),[[$,m.showAll]]),u(v,{id:"chargerPower",label:e.$t("config.loadpoint.chargerTypeLabel"),help:"11kw"===c.chargerPower?e.$t("config.loadpoint.chargerPower11kwHelp"):"22kw"===c.chargerPower?e.$t("config.loadpoint.chargerPower22kwHelp"):e.$t("config.loadpoint.chargerPowerCustomHelp")},{default:T((()=>[u(w,{id:"chargerPower",modelValue:c.chargerPower,"onUpdate:modelValue":t[12]||(t[12]=e=>c.chargerPower=e),class:"w-100",options:[{name:e.$t("config.loadpoint.chargerPower11kw"),value:"11kw"},{name:e.$t("config.loadpoint.chargerPower22kw"),value:"22kw"},{name:e.$t("config.loadpoint.chargerPowerCustom"),value:"other"}],transparent:""},null,8,["modelValue","options"])])),_:1},8,["label","help"]),"other"===c.chargerPower?(r(),n("div",li,[u(v,{id:"loadpointMinCurrent",label:e.$t("config.loadpoint.minCurrentLabel"),class:"col-sm-6 mb-sm-0",help:c.values.minCurrent<6?e.$t("config.loadpoint.minCurrentHelp"):null},{default:T((()=>[u(h,{id:"loadpointMinCurrent",modelValue:c.values.minCurrent,"onUpdate:modelValue":t[13]||(t[13]=e=>c.values.minCurrent=e),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2",required:""},null,8,["modelValue"])])),_:1},8,["label","help"]),u(v,{id:"loadpointMaxCurrent",label:e.$t("config.loadpoint.maxCurrentLabel"),class:"col-sm-6 mb-sm-0",help:c.values.maxCurrent<c.values.minCurrent?e.$t("config.loadpoint.maxCurrentHelp"):null},{default:T((()=>[u(h,{id:"loadpointMaxCurrent",modelValue:c.values.maxCurrent,"onUpdate:modelValue":t[14]||(t[14]=e=>c.values.maxCurrent=e),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2",required:""},null,8,["modelValue"])])),_:1},8,["label","help"])])):d("",!0),m.chargerIsSinglePhase?d("",!0):(r(),n(y,{key:2},[m.chargerSupports1p3p?f((r(),g(v,{key:0,id:"loadpointParamPhases",label:e.$t("config.loadpoint.phasesAutomatic"),help:e.$t("config.loadpoint.phasesAutomaticHelp")},null,8,["label","help"])),[[$,m.showAll]]):f((r(),g(v,{key:1,id:"loadpointParamPhases",label:e.$t("config.loadpoint.phasesLabel"),help:e.$t("config.loadpoint.phasesHelp")},{default:T((()=>[u(w,{id:"loadpointParamPhases",modelValue:c.values.phasesConfigured,"onUpdate:modelValue":t[15]||(t[15]=e=>c.values.phasesConfigured=e),class:"w-100",options:[{value:1,name:e.$t("config.loadpoint.phases1p")},{value:3,name:e.$t("config.loadpoint.phases3p")}],transparent:"","equal-width":""},null,8,["modelValue","options"])])),_:1},8,["label","help"])),[[$,m.showAll]])],64)),m.showCircuit?f((r(),g(v,{key:3,id:"loadpointParamCircuit",label:e.$t("config.loadpoint.circuitLabel"),help:e.$t("config.loadpoint.circuitHelp")},{default:T((()=>[u(h,{id:"loadpointParamCircuit",modelValue:c.values.circuit,"onUpdate:modelValue":t[16]||(t[16]=e=>c.values.circuit=e),type:"Choice",class:"me-2",choice:m.circuitOptions,required:""},null,8,["modelValue","choice"])])),_:1},8,["label","help"])),[[$,m.showAll]]):d("",!0),f(o("h6",null,l(e.$t("config.loadpoint.vehiclesTitle")),513),[[$,m.showAll]]),a.vehicleOptions.length?(r(),n("div",ri,[u(v,{id:"loadpointParamVehicle",label:e.$t("config.loadpoint.vehicleLabel"),help:c.values.vehicle?e.$t("config.loadpoint.vehicleHelpDefault"):e.$t("config.loadpoint.vehicleHelpAutoDetection")},{default:T((()=>[u(h,{id:"loadpointParamVehicle",modelValue:c.values.vehicle,"onUpdate:modelValue":t[17]||(t[17]=e=>c.values.vehicle=e),type:"Choice",class:"me-2",choice:m.allVehicleOptions,required:""},null,8,["modelValue","choice"])])),_:1},8,["label","help"]),f(u(v,{id:"loadpointPollMode",label:e.$t("config.loadpoint.pollModeLabel"),help:"charging"===c.values.soc.poll.mode?e.$t("config.loadpoint.pollModeChargingHelp"):"connected"===c.values.soc.poll.mode?e.$t("config.loadpoint.pollModeConnectedHelp"):"always"===c.values.soc.poll.mode?e.$t("config.loadpoint.pollModeAlwaysHelp"):null},{default:T((()=>[u(w,{id:"loadpointPollMode",modelValue:c.values.soc.poll.mode,"onUpdate:modelValue":t[18]||(t[18]=e=>c.values.soc.poll.mode=e),class:"w-100",options:[{value:"charging",name:e.$t("config.loadpoint.pollModeCharging")},{value:"connected",name:e.$t("config.loadpoint.pollModeConnected")},{value:"always",name:e.$t("config.loadpoint.pollModeAlways")}],transparent:""},null,8,["modelValue","options"])])),_:1},8,["label","help"]),[[$,m.showAll]]),"charging"!==c.values.soc.poll.mode?f((r(),g(v,{key:0,id:"loadpointPollInterval",class:"ms-3 mb-5",label:e.$t("config.loadpoint.pollIntervalLabel"),help:e.$t("config.loadpoint.pollIntervalHelp")},{default:T((()=>[u(h,{id:"loadpointPollInterval",modelValue:c.values.soc.poll.interval,"onUpdate:modelValue":t[19]||(t[19]=e=>c.values.soc.poll.interval=e),type:"Duration",unit:"minute",size:"w-25 w-min-200",class:"me-2",required:""},null,8,["modelValue"])])),_:1},8,["label","help"])),[[$,m.showAll]]):d("",!0),f(o("div",si,[f(o("input",{id:"loadpointEstimate","onUpdate:modelValue":t[20]||(t[20]=e=>c.values.soc.estimate=e),class:"form-check-input",type:"checkbox"},null,512),[[W,c.values.soc.estimate]]),o("label",di,l(e.$t("config.loadpoint.estimateLabel")),1)],512),[[$,m.showAll]])])):f((r(),n("div",ci,[o("p",ui,l(e.$t("config.loadpoint.noVehicles")),1)],512)),[[$,m.showAll]])])):d("",!0),!m.showAll&&c.values.charger?(r(),n("button",{key:4,class:"btn btn-link btn-sm text-gray px-0 border-0 d-flex align-items-center mb-2",type:"button",tabindex:"0",onClick:t[21]||(t[21]=e=>c.showAllSelected=!0)},l(e.$t("config.loadpoint.showAllSettings")),1)):d("",!0),c.values.charger?(r(),n("div",pi,[m.isDeletable?(r(),n("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[22]||(t[22]=k(((...e)=>m.remove&&m.remove(...e)),["prevent"]))},l(e.$t("config.meter.delete")),1)):(r(),n("button",mi,l(e.$t("config.loadpoint.cancel")),1)),o("button",{type:"submit",class:"btn btn-primary",disabled:c.saving},[c.saving?(r(),n("span",gi)):d("",!0),i(" "+l(e.$t("config.loadpoint.save")),1)],8,hi)])):d("",!0)],544)])),_:1},8,["title","fade","onOpen","onOpened","onClose"])}],["__scopeId","data-v-92baecd5"]]),vi=a({name:"Loadpoint",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M6 19h6V5H6Zm2-1l4-7h-2V6l-4 7.5h2Zm-4 3V5q0-.825.588-1.413Q5.175 3 6 3h6q.825 0 1.413.587Q14 4.175 14 5v7h1q.825 0 1.413.587Q17 13.175 17 14v4.5q0 .425.288.712q.287.288.712.288t.712-.288Q19 18.925 19 18.5v-7.2q-.225.125-.475.162q-.25.038-.525.038q-1.05 0-1.775-.725Q15.5 10.05 15.5 9q0-.8.438-1.438q.437-.637 1.162-.912L15 4.55l1.05-1.05l3.7 3.6q.375.375.562.875q.188.5.188 1.025v9.5q0 1.05-.725 1.775Q19.05 21 18 21q-1.05 0-1.775-.725q-.725-.725-.725-1.775v-5H14V21Zm8-2H6h6Zm6-9q.425 0 .712-.288Q19 9.425 19 9t-.288-.713Q18.425 8 18 8t-.712.287Q17 8.575 17 9t.288.712Q17.575 10 18 10Z"},null,-1)]),4)}]]),bi=a({name:"MessagingModal",components:{YamlModal:pn},emits:["changed"],data:()=>({defaultYaml:'#events:\n#  start:\n#    title: Charge started\n#    msg: Started charging in "${mode}" mode\n#  stop:\n#    title: Charge finished\n#    msg: Finished charging ${chargedEnergy:%.1fk}kWh in ${chargeDuration}.\n#  connect:\n#    title: Car connected\n#    msg: "Car connected at ${pvPower:%.1fk}kW PV"\n#  disconnect:\n#    title: Car disconnected\n#    msg: Car disconnected after ${connectedDuration}\n#  soc:\n#    title: Soc updated\n#    msg: Battery charged to ${vehicleSoc:%.0f}%\n#  guest:\n#    title: Unknown vehicle\n#    msg: Unknown vehicle, guest connected?\n\n#services:\n#- type: pushover\n#  app: # app id\n#  recipients:\n#  - # list of recipient ids\n#- type: telegram\n#  token: # bot id\n#  chats:\n#  - # list of chat ids\n#- type: email\n#  uri: smtp://<user>:<password>@<host>:<port>/?fromAddress=<from>&toAddresses=<to>\n#- type: ntfy\n#  uri: https://<host>/<topics>\n#  priority: <priority>\n#  tags: <tags>\n'.trim()})},[["render",function(e,t,a,n,o,i){const l=p("YamlModal");return r(),g(l,{id:"messagingModal",title:e.$t("config.messaging.title"),description:e.$t("config.messaging.description"),docs:"/docs/reference/configuration/messaging",defaultYaml:o.defaultYaml,endpoint:"/config/messaging",removeKey:"messaging","data-testid":"messaging-modal",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}]]),yi={type:"template"};function wi(e){return new Promise((t=>setTimeout(t,e)))}const ki=["usage","modbus"],Ci={name:"MeterModal",components:{FormRow:Te,PropertyEntry:He,GenericModal:N,Modbus:Tt,TestResult:gt,NewDeviceButton:se,PropertyCollapsible:Qe,Markdown:he},mixins:[wt],props:{id:Number,name:String,type:String,fade:String},emits:["added","updated","removed","close"],data:()=>({isModalVisible:!1,templates:[],products:[],templateName:null,template:null,saving:!1,selectedType:null,loadingTemplate:!1,values:{...yi}}),computed:{modalTitle(){return this.isNew?this.meterType?this.$t(`config.${this.meterType}.titleAdd`):this.$t("config.meter.titleChoice"):this.$t(`config.${this.meterType}.titleEdit`)},meterType(){return this.type||this.selectedType},templateOptions(){return this.products.filter((e=>"generic"!==e.group))},genericOptions(){return this.products.filter((e=>"generic"===e.group))},templateParams(){return(this.template?.Params||[]).filter((e=>!ki.includes(e.Name))).map((e=>("battery"===this.meterType&&"capacity"===e.Name&&(e.Advanced=!1),e)))},normalParams(){return this.templateParams.filter((e=>!e.Advanced))},advancedParams(){return this.templateParams.filter((e=>e.Advanced))},modbus(){return(this.template?.Params||[]).find((e=>"modbus"===e.Name))},modbusCapabilities(){return this.modbus?.Choice||[]},modbusDefaults(){const{ID:e,Comset:t,Baudrate:a,Port:n}=this.modbus||{};return{id:e,comset:t,baudrate:a,port:n}},description(){return this.template?.Requirements?.Description},apiData(){return{template:this.templateName,...this.modbusDefaults,...this.values,usage:this.meterType}},isNew(){return void 0===this.id},isDeletable(){return!this.isNew}},watch:{isModalVisible(e){e&&(this.templateName=null,this.selectedType=null,this.reset(),this.loadProducts(),void 0!==this.id&&this.loadConfiguration())},meterType(){this.loadProducts()},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},methods:{reset(){this.values={...yi},this.resetTest()},async loadConfiguration(){try{const e=(await U.get(`config/devices/meter/${this.id}`)).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(de){console.error(de)}},async loadProducts(){if(this.isModalVisible&&this.meterType)try{const e={params:{usage:this.meterType,lang:this.$i18n?.locale}};this.products=(await U.get("config/products/meter",e)).data.result}catch(de){console.error(de)}},async loadTemplate(){if(this.templateName){this.template=null,this.loadingTemplate=!0;try{const e={params:{lang:this.$i18n?.locale,name:this.templateName}},t=await U.get("config/templates/meter",e);this.template=t.data.result,this.applyDefaultsFromTemplate()}catch(de){console.error(de)}this.loadingTemplate=!1}},applyDefaultsFromTemplate(){(this.template?.Params||[]).filter((e=>e.Default&&!this.values[e.Name])).forEach((e=>{this.values[e.Name]=e.Default}))},async create(){if(this.testUnknown){if(!(await this.test(this.testMeter)))return;await wi(100)}this.saving=!0;try{const e=await U.post("config/devices/meter",this.apiData),{name:t}=e.data.result;this.$emit("added",this.meterType,t),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testMeter)},async testMeter(){let e="config/test/meter";return this.isNew||(e+=`/merge/${this.id}`),await U.post(e,this.apiData)},async update(){if(this.testUnknown){if(!(await this.test(this.testMeter)))return;await wi(250)}this.saving=!0;try{await U.put(`config/devices/meter/${this.id}`,this.apiData),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("update failed")}this.saving=!1},async remove(){try{await U.delete(`config/devices/meter/${this.id}`),this.$emit("removed",this.meterType,this.name),this.$emit("updated"),this.close()}catch(de){console.error(de),alert("delete failed")}},open(){this.isModalVisible=!0},close(){this.$emit("close"),this.isModalVisible=!1},selectType(e){this.selectedType=e},templateChanged(){this.reset()}}},Mi={key:0},$i={key:1,ref:"form",class:"container mx-0 px-0"},xi=["disabled"],Ti=["value"],Vi={key:0,disabled:""},Pi=["value"],Si={key:0},qi={key:4,class:"my-4 d-flex justify-content-between"},Ii={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal",tabindex:"0"},Oi=["disabled"],Ni={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ui=a(Ci,[["render",function(e,t,a,s,c,m){const h=p("NewDeviceButton"),v=p("FormRow"),b=p("Markdown"),M=p("Modbus"),$=p("PropertyEntry"),x=p("PropertyCollapsible"),V=p("TestResult"),P=p("GenericModal");return r(),g(P,{id:"meterModal",title:m.modalTitle,"data-testid":"meter-modal",fade:a.fade,onOpen:m.open,onClose:m.close},{default:T((()=>[m.meterType?(r(),n("form",$i,[u(v,{id:"meterTemplate",label:e.$t("config.meter.template")},{default:T((()=>[f(o("select",{id:"meterTemplate","onUpdate:modelValue":t[2]||(t[2]=e=>c.templateName=e),disabled:!m.isNew,class:"form-select w-100",onChange:t[3]||(t[3]=(...e)=>m.templateChanged&&m.templateChanged(...e))},[(r(!0),n(y,null,w(m.genericOptions,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Ti)))),128)),m.genericOptions.length?(r(),n("option",Vi,"──────────")):d("",!0),(r(!0),n(y,null,w(m.templateOptions,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Pi)))),128))],40,xi),[[C,c.templateName]])])),_:1},8,["label"]),c.loadingTemplate?(r(),n("p",Si,"Loading ...")):d("",!0),m.description?(r(),g(b,{key:1,markdown:m.description,class:"my-4"},null,8,["markdown"])):d("",!0),m.modbus?(r(),g(M,{key:2,modbus:c.values.modbus,"onUpdate:modbus":t[4]||(t[4]=e=>c.values.modbus=e),id:c.values.id,"onUpdate:id":t[5]||(t[5]=e=>c.values.id=e),host:c.values.host,"onUpdate:host":t[6]||(t[6]=e=>c.values.host=e),port:c.values.port,"onUpdate:port":t[7]||(t[7]=e=>c.values.port=e),device:c.values.device,"onUpdate:device":t[8]||(t[8]=e=>c.values.device=e),baudrate:c.values.baudrate,"onUpdate:baudrate":t[9]||(t[9]=e=>c.values.baudrate=e),comset:c.values.comset,"onUpdate:comset":t[10]||(t[10]=e=>c.values.comset=e),defaultId:m.modbus.ID,defaultComset:m.modbus.Comset,defaultBaudrate:m.modbus.Baudrate,defaultPort:m.modbus.Port,capabilities:m.modbusCapabilities},null,8,["modbus","id","host","port","device","baudrate","comset","defaultId","defaultComset","defaultBaudrate","defaultPort","capabilities"])):d("",!0),(r(!0),n(y,null,w(m.normalParams,(e=>(r(),g($,D({id:`meterParam${e.Name}`,key:e.Name,ref_for:!0},e,{modelValue:c.values[e.Name],"onUpdate:modelValue":t=>c.values[e.Name]=t}),null,16,["id","modelValue","onUpdate:modelValue"])))),128)),u(x,null,_({_:2},[m.advancedParams.length?{name:"advanced",fn:T((()=>[(r(!0),n(y,null,w(m.advancedParams,(e=>(r(),g($,D({id:`meterParam${e.Name}`,key:e.Name,ref_for:!0},e,{modelValue:c.values[e.Name],"onUpdate:modelValue":t=>c.values[e.Name]=t}),null,16,["id","modelValue","onUpdate:modelValue"])))),128))])),key:"0"}:void 0]),1024),c.templateName?(r(),g(V,{key:3,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:m.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):d("",!0),c.templateName?(r(),n("div",qi,[m.isDeletable?(r(),n("button",{key:0,type:"button",class:"btn btn-link text-danger",tabindex:"0",onClick:t[11]||(t[11]=k(((...e)=>m.remove&&m.remove(...e)),["prevent"]))},l(e.$t("config.general.delete")),1)):(r(),n("button",Ii,l(e.$t("config.general.cancel")),1)),o("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||c.saving,tabindex:"0",onClick:t[12]||(t[12]=k((e=>m.isNew?m.create():m.update()),["prevent"]))},[c.saving?(r(),n("span",Ni)):d("",!0),i(" "+l(e.testUnknown?e.$t("config.general.validateSave"):e.$t("config.general.save")),1)],8,Oi)])):d("",!0)],512)):(r(),n("div",Mi,[u(h,{title:"Add solar meter",class:"mb-4 addButton",onClick:t[0]||(t[0]=e=>m.selectType("pv"))}),u(h,{title:"Add battery meter",class:"addButton",onClick:t[1]||(t[1]=e=>m.selectType("battery"))})]))])),_:1},8,["title","fade","onOpen","onClose"])}],["__scopeId","data-v-bc5c1b6f"]]),Di=a({name:"ModbusProxy",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M15 19v-1h-2q-.825 0-1.412-.587T11 16V8H9v1q0 .825-.587 1.413T7 11H4q-.825 0-1.412-.587T2 9V5q0-.825.588-1.412T4 3h3q.825 0 1.413.588T9 5v1h6V5q0-.825.588-1.412T17 3h3q.825 0 1.413.588T22 5v4q0 .825-.587 1.413T20 11h-3q-.825 0-1.412-.587T15 9V8h-2v8h2v-1q0-.825.588-1.412T17 13h3q.825 0 1.413.588T22 15v4q0 .825-.587 1.413T20 21h-3q-.825 0-1.412-.587T15 19M4 5v4zm13 10v4zm0-10v4zm0 4h3V5h-3zm0 10h3v-4h-3zM4 9h3V5H4z"},null,-1)]),4)}]]),_i=a({name:"ModbusProxyModal",components:{YamlModal:pn},emits:["changed"],data:()=>({defaultYaml:'#- port: 5021\n#  uri: 192.0.2.2:502\n#- port: 5022\n#  device: /dev/ttyUSB0\n#  baudrate: 9600\n#  comset: "8N1"\n#- port: 5023\n#  uri: 192.0.2.3:502\n#  rtu: true\n'.trim()})},[["render",function(e,t,a,n,o,i){const l=p("YamlModal");return r(),g(l,{id:"modbusProxyModal",title:e.$t("config.modbusproxy.title"),description:e.$t("config.modbusproxy.description"),docs:"/docs/reference/configuration/modbusproxy",defaultYaml:o.defaultYaml,endpoint:"/config/modbusproxy",removeKey:"modbusproxy",size:"md",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}]]),Ei=a({name:"Mqtt",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"-40 -40 400 400"},t[0]||(t[0]=[o("g",null,[o("path",{fill:"currentColor",d:"M7.1,180.6v117.1c0,8.4,6.8,15.3,15.3,15.3H142C141,239.8,80.9,180.7,7.1,180.6z"}),o("path",{fill:"currentColor",d:"M7.1,84.1v49.8c99,0.9,179.4,80.7,180.4,179.1h51.7C238.2,186.6,134.5,84.2,7.1,84.1z"}),o("path",{fill:"currentColor",d:"M312.9,297.6V193.5C278.1,107.2,207.3,38.9,119,7.1H22.4c-8.4,0-15.3,6.8-15.3,15.3v15\n\t\t\tc152.6,0.9,276.6,124,277.6,275.6h13C306.1,312.9,312.9,306.1,312.9,297.6z"}),o("path",{fill:"currentColor",d:"M272.6,49.8c14.5,14.4,28.6,31.7,40.4,47.8V22.4c0-8.4-6.8-15.3-15.3-15.3h-77.3\n\t\t\tC238.4,19.7,256.6,33.9,272.6,49.8z"})],-1)]),4)}]]),Li={name:"PropertyCertField",props:{id:String,modelValue:String},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{openFilePicker(){this.$refs.fileInput.click()},readFile(e){const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.value=e.target.result},a.readAsText(t)}}},Ri=["id"],Ai={class:"d-flex justify-content-end"},ji=["onUpdate:modelValue"],Bi=["onUpdate:modelValue"],Fi=["onUpdate:modelValue"],zi=["onUpdate:modelValue"],Hi=["onUpdate:modelValue"],Yi={class:"d-flex"},Wi=["onUpdate:modelValue"],Gi={class:"form-check-label ms-2",for:"mqttInsecure"},Ki=a({name:"MqttModal",components:{FormRow:Te,JsonModal:Hn,PropertyCollapsible:Qe,PropertyCertField:a(Li,[["render",function(e,t,a,i,s,d){return r(),n("div",null,[f(o("textarea",{id:a.id,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),class:"form-control",rows:"3"},null,8,Ri),[[M,d.value]]),o("div",Ai,[o("button",{type:"button",class:"btn btn-link btn-sm text-muted pe-0",onClick:t[1]||(t[1]=(...e)=>d.openFilePicker&&d.openFilePicker(...e))},l(e.$t("config.general.readFromFile")),1),o("input",{ref:"fileInput",type:"file",class:"d-none",accept:".crt,.pem,.cer,.csr,.key",onChange:t[2]||(t[2]=(...e)=>d.readFile&&d.readFile(...e))},null,544)])])}]])},emits:["changed"]},[["render",function(e,t,a,n,i,s){const d=p("FormRow"),c=p("PropertyCertField"),m=p("PropertyCollapsible"),h=p("JsonModal");return r(),g(h,{id:"mqttModal",title:e.$t("config.mqtt.title"),description:e.$t("config.mqtt.description"),docs:"/docs/reference/configuration/mqtt",endpoint:"/config/mqtt","state-key":"mqtt","data-testid":"mqtt-modal",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},{default:T((({values:t})=>[u(d,{id:"mqttBroker",label:e.$t("config.mqtt.labelBroker"),example:"localhost:1883"},{default:T((()=>[f(o("input",{id:"mqttBroker","onUpdate:modelValue":e=>t.broker=e,class:"form-control",required:""},null,8,ji),[[M,t.broker]])])),_:2},1032,["label"]),o("h6",null,l(e.$t("config.mqtt.publishing")),1),u(d,{id:"mqttTopic",label:e.$t("config.mqtt.labelTopic"),help:e.$t("config.mqtt.descriptionTopic"),example:"evcc",optional:""},{default:T((()=>[f(o("input",{id:"mqttTopic","onUpdate:modelValue":e=>t.topic=e,class:"form-control"},null,8,Bi),[[M,t.topic]])])),_:2},1032,["label","help"]),u(d,{id:"mqttClientId",label:e.$t("config.mqtt.labelClientId"),help:e.$t("config.mqtt.descriptionClientId"),optional:""},{default:T((()=>[f(o("input",{id:"mqttClientId","onUpdate:modelValue":e=>t.clientID=e,class:"form-control"},null,8,Fi),[[M,t.clientID]])])),_:2},1032,["label","help"]),o("h6",null,l(e.$t("config.mqtt.authentication")),1),u(d,{id:"mqttUser",label:e.$t("config.mqtt.labelUser"),optional:""},{default:T((()=>[f(o("input",{id:"mqttUser","onUpdate:modelValue":e=>t.user=e,class:"form-control"},null,8,zi),[[M,t.user]])])),_:2},1032,["label"]),u(d,{id:"mqttPassword",label:e.$t("config.mqtt.labelPassword"),optional:""},{default:T((()=>[f(o("input",{id:"mqttPassword","onUpdate:modelValue":e=>t.password=e,class:"form-control",type:"password",autocomplete:"off"},null,8,Hi),[[M,t.password]])])),_:2},1032,["label"]),u(d,{id:"mqttInsecure",label:e.$t("config.mqtt.labelInsecure")},{default:T((()=>[o("div",Yi,[f(o("input",{id:"mqttInsecure","onUpdate:modelValue":e=>t.insecure=e,class:"form-check-input",type:"checkbox"},null,8,Wi),[[W,t.insecure]]),o("label",Gi,l(e.$t("config.mqtt.labelCheckInsecure")),1)])])),_:2},1032,["label"]),u(m,null,{advanced:T((()=>[u(d,{id:"mqttCaCert",label:e.$t("config.mqtt.labelCaCert"),optional:""},{default:T((()=>[u(c,{id:"mqttCaCert",modelValue:t.caCert,"onUpdate:modelValue":e=>t.caCert=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"]),u(d,{id:"mqttClientCert",label:e.$t("config.mqtt.labelClientCert"),optional:""},{default:T((()=>[u(c,{id:"mqttClientCert",modelValue:t.clientCert,"onUpdate:modelValue":e=>t.clientCert=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"]),u(d,{id:"mqttClientKey",label:e.$t("config.mqtt.labelClientKey"),optional:""},{default:T((()=>[u(c,{id:"mqttClientKey",modelValue:t.clientKey,"onUpdate:modelValue":e=>t.clientKey=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])])),_:2},1024)])),_:1},8,["title","description"])}]]),Ji={class:"btn-group",role:"group"},Qi=["onUpdate:modelValue"],Zi=["onUpdate:modelValue"],Xi=["onUpdate:modelValue"],el=["onUpdate:modelValue"],tl=a({name:"NetworkModal",components:{FormRow:Te,JsonModal:Hn},emits:["changed"]},[["render",function(e,t,a,n,i,l){const s=p("FormRow"),d=p("JsonModal");return r(),g(d,{id:"networkModal",title:e.$t("config.network.title"),endpoint:"/config/network","state-key":"network","disable-remove":"","data-testid":"network-modal",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},{default:T((({values:a})=>[u(s,{id:"networkSchema",label:e.$t("config.network.labelSchema"),help:e.$t("config.network.descriptionSchema")},{default:T((()=>[o("div",Ji,[f(o("input",{id:"networkSchemaHttp","onUpdate:modelValue":e=>a.schema=e,type:"radio",class:"btn-check",name:"networkSchema",tabindex:"0",value:"http",autocomplete:"off"},null,8,Qi),[[x,a.schema]]),t[1]||(t[1]=o("label",{class:"btn btn-outline-primary",for:"networkSchemaHttp"},"HTTP",-1)),f(o("input",{id:"networkSchemaHttps","onUpdate:modelValue":e=>a.schema=e,type:"radio",class:"btn-check",name:"networkSchema",tabindex:"0",value:"https",autocomplete:"off"},null,8,Zi),[[x,a.schema]]),t[2]||(t[2]=o("label",{class:"btn btn-outline-primary",for:"networkSchemaHttps"},"HTTPS",-1))])])),_:2},1032,["label","help"]),u(s,{id:"networkHost",label:e.$t("config.network.labelHost"),help:e.$t("config.network.descriptionHost"),example:"evcc.local"},{default:T((()=>[f(o("input",{id:"networkHost","onUpdate:modelValue":e=>a.host=e,class:"form-control"},null,8,Xi),[[M,a.host]])])),_:2},1032,["label","help"]),u(s,{id:"networkPort",label:e.$t("config.network.labelPort"),help:e.$t("config.network.descriptionPort")},{default:T((()=>[f(o("input",{id:"networkPort","onUpdate:modelValue":e=>a.port=e,class:"form-control w-50 me-2 w-50",type:"number",example:"7070"},null,8,el),[[M,a.port]])])),_:2},1032,["label","help"])])),_:1},8,["title"])}]]),al=a({name:"Notification",mixins:[V]},[["render",function(e,t,a,i,l,s){return r(),n("svg",{style:P(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[o("path",{fill:"currentColor",d:"M5 19q-.425 0-.712-.288T4 18t.288-.712T5 17h1v-7q0-2.075 1.25-3.687T10.5 4.2v-.7q0-.625.438-1.062T12 2t1.063.438T13.5 3.5v.7q2 .5 3.25 2.113T18 10v7h1q.425 0 .713.288T20 18t-.288.713T19 19zm7 3q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-4-5h8v-7q0-1.65-1.175-2.825T12 6T9.175 7.175T8 10zm-5-7q-.425 0-.712-.325t-.238-.75q.2-1.875 1.05-3.488t2.175-2.812q.325-.275.738-.25t.662.375t.2.75t-.375.7q-.975.925-1.6 2.15T4.075 9q-.05.425-.35.713T3 10m18 0q-.425 0-.725-.288T19.925 9q-.2-1.425-.825-2.65T17.5 4.2q-.325-.3-.375-.7t.2-.75t.663-.375t.737.25q1.325 1.2 2.175 2.812t1.05 3.488q.05.425-.237.75T21 10"},null,-1)]),4)}]]),nl={name:"SponsorTokenExpires",mixins:[m],props:{expiresSoon:Boolean,expiresAt:String,name:String},computed:{inXDays(){return this.fmtTimeAgo(new Date(this.expiresAt)-new Date)},isTrial(){return this.name===ae}}},ol={key:0,class:"alert alert-warning my-4",role:"alert"},il={href:"https://sponsor.evcc.io",target:"_blank",class:"text-danger"},ll={key:0,class:"d-block mt-2"},rl={class:"mt-4 mb-3"},sl={key:0,class:"d-flex gap-1 justify-content-between flex-wrap"},dl=["href"],cl={key:1},ul=["onUpdate:modelValue"],pl=a({name:"SponsorModal",components:{FormRow:Te,JsonModal:Hn,Sponsor:ne,SponsorTokenExpires:a(nl,[["render",function(e,t,a,s,c,m){const h=p("i18n-t");return a.expiresSoon?(r(),n("div",ol,[u(h,{tag:"div",keypath:"settings.sponsorToken.expires",scope:"global"},{inXDays:T((()=>[i(l(m.inXDays),1)])),getNewToken:T((()=>[o("a",il,l(e.$t("settings.sponsorToken.getNew")),1)])),_:1}),m.isTrial?d("",!0):(r(),n("em",ll,l(e.$t("settings.sponsorToken.hint")),1))])):d("",!0)}]])},emits:["changed"],data:()=>({showForm:!1}),computed:{sponsor:()=>H?.state?.sponsor,hasToken(){const e=this.sponsor?.name||"";return""!==e&&e!==oe},sponsorTokenLabel(){return this.hasToken?this.$t("config.sponsor.changeToken"):this.$t("config.sponsor.addToken")},trialTokenLink:()=>`${s()}/docs/sponsorship#trial`},methods:{transformReadValues:()=>({token:""}),handlePaste(e){e.preventDefault();const t=Qa(e.clipboardData.getData("text"),"sponsortoken");e.target.value=t}}},[["render",function(e,t,a,i,s,c){const m=p("SponsorTokenExpires"),h=p("Sponsor"),v=p("FormRow"),b=p("JsonModal");return r(),g(b,{id:"sponsorModal",title:`${e.$t("config.sponsor.title")} 💚`,description:e.$t("config.sponsor.description"),"error-message":e.$t("config.sponsor.error"),endpoint:"/config/sponsortoken","transform-read-values":c.transformReadValues,"data-testid":"sponsor-modal",size:"lg","no-buttons":!e.showForm,"disable-remove":!c.hasToken,onChanged:t[2]||(t[2]=t=>e.$emit("changed")),onOpen:t[3]||(t[3]=t=>e.showForm=!1)},{default:T((({values:a})=>[u(m,G(K(c.sponsor)),null,16),o("div",rl,[u(h,G(K(c.sponsor)),null,16)]),e.showForm?(r(),n("div",cl,[t[4]||(t[4]=o("hr",null,null,-1)),u(v,{id:"sponsorToken",label:c.sponsorTokenLabel,help:e.$t("config.sponsor.descriptionToken",{url:"https://sponsor.evcc.io/"}),"docs-link":"/docs/sponsorship#trial",class:"mt-4"},{default:T((()=>[f(o("textarea",{id:"sponsorToken","onUpdate:modelValue":e=>a.token=e,required:"",rows:"5",spellcheck:"false",class:"form-control",onPaste:t[1]||(t[1]=(...e)=>c.handlePaste&&c.handlePaste(...e))},null,40,ul),[[M,a.token]])])),_:2},1032,["label","help"])])):(r(),n("div",sl,[o("button",{type:"button",class:"btn btn-link text-muted text-truncate",onClick:t[0]||(t[0]=t=>e.showForm=!e.showForm)},l(c.sponsorTokenLabel),1),c.hasToken?d("",!0):(r(),n("a",{key:0,class:"btn btn-link text-muted text-truncate",href:c.trialTokenLink,target:"_blank"},l(e.$t("config.sponsor.trialToken")),9,dl))]))])),_:1},8,["title","description","error-message","transform-read-values","no-buttons","disable-remove"])}],["__scopeId","data-v-f3aebc69"]]),ml=a({name:"TariffsModal",components:{YamlModal:pn},emits:["changed"],data:()=>({defaultYaml:"#currency: EUR\n\n#grid: # price using energy from the grid\n#  type: fixed\n#  price: 0.294 # EUR/kWh\n\n#feedin: # price for feeding solar energy to the grid\n#  type: fixed\n#  price: 0.08 # EUR/kWh\n\n#co2: # carbon intensity forecast data\n#  type: template\n#  template: grünstromindex\n#  zip: <zip>\n".trim()})},[["render",function(e,t,a,n,o,i){const l=p("YamlModal");return r(),g(l,{id:"tariffsModal",title:e.$t("config.tariffs.title"),description:e.$t("config.tariffs.description"),docs:"/docs/tariffs",defaultYaml:o.defaultYaml,removeKey:"tariffs",endpoint:"/config/tariffs","data-testid":"tariffs-modal",onChanged:t[0]||(t[0]=t=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}]]),hl={type:"template",icon:"car"};function gl(e){return new Promise((t=>setTimeout(t,e)))}const fl=["minCurrent","maxCurrent","priority","identifiers","phases","mode"],vl={name:"VehicleModal",components:{FormRow:Te,PropertyField:Fe,TestResult:gt,GenericModal:N,SelectGroup:h,PropertyCollapsible:Qe,PropertyEntry:He,Markdown:he},mixins:[wt],props:{id:Number},emits:["vehicle-changed"],data:()=>({isModalVisible:!1,templates:[],products:[],saving:!1,templateName:null,template:null,values:{...hl},loadingTemplate:!1}),computed:{templateOptions(){return{online:this.products.filter((e=>!e.group&&"offline"!==e.template)),generic:this.products.filter((e=>"generic"===e.group)),scooter:this.products.filter((e=>"scooter"===e.group))}},templateParams(){const e=(this.template?.Params||[]).filter((e=>!fl.includes(e.Name))).map((e=>("title"!==e.Name&&"icon"!==e.Name||(e.Required=!0,e.Advanced=!1),e)));e.sort(((e,t)=>(e.Required?-1:1)-(t.Required?-1:1)));const t={title:-2,icon:-1};return e.sort(((e,a)=>(t[e.Name]||0)-(t[a.Name]||0))),e},normalParams(){return this.templateParams.filter((e=>!e.Advanced&&!e.Deprecated))},advancedParams(){return this.templateParams.filter((e=>e.Advanced||e.Deprecated))},description(){return this.template?.Requirements?.Description},apiData(){const e={template:this.templateName,...this.values};return Array.isArray(e.identifiers)&&(e.identifiers=e.identifiers.map((e=>e.trim())).filter((e=>e))),e},isNew(){return void 0===this.id},isDeletable(){return!this.isNew},priorityOptions(){const e=Array.from({length:11},((e,t)=>({key:t,name:`${t}`})));return e[0].name="0 (default)",e[0].key=void 0,e[10].name="10 (highest)",e}},watch:{isModalVisible(e){e&&(this.reset(),this.templateName="offline",this.resetTest(),this.loadProducts(),void 0!==this.id&&this.loadConfiguration())},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},methods:{reset(){this.values={...hl},this.resetTest()},async loadConfiguration(){try{const e=(await U.get(`config/devices/vehicle/${this.id}`)).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(de){console.error(de)}},async loadProducts(){try{const e={params:{lang:this.$i18n?.locale}};this.products=(await U.get("config/products/vehicle",e)).data.result}catch(de){console.error(de)}},async loadTemplate(){this.template=null,this.loadingTemplate=!0;try{const e={params:{lang:this.$i18n?.locale,name:this.templateName}};this.template=(await U.get("config/templates/vehicle",e)).data.result,this.applyDefaultsFromTemplate()}catch(de){console.error(de)}this.loadingTemplate=!1},applyDefaultsFromTemplate(){(this.template?.Params||[]).filter((e=>e.Default&&!this.values[e.Name])).forEach((e=>{this.values[e.Name]=e.Default}))},async create(){if(this.testUnknown){if(!(await this.test(this.testVehicle)))return;await gl(250)}this.saving=!0;try{await U.post("config/devices/vehicle",this.apiData),this.$emit("vehicle-changed"),this.closed()}catch(de){console.error(de),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testVehicle)},async testVehicle(){let e="config/test/vehicle";return this.isNew||(e+=`/merge/${this.id}`),await U.post(e,this.apiData)},async update(){if(this.testUnknown){if(!(await this.test(this.testVehicle)))return;await gl(250)}this.saving=!0;try{await U.put(`config/devices/vehicle/${this.id}`,this.apiData),this.$emit("vehicle-changed"),this.closed()}catch(de){console.error(de),alert("update failed")}this.saving=!1},async remove(){try{await U.delete(`config/devices/vehicle/${this.id}`),this.$emit("vehicle-changed"),this.closed()}catch(de){console.error(de),alert("delete failed")}},open(){this.isModalVisible=!0},closed(){this.isModalVisible=!1},templateChanged(){this.reset()}}},bl={ref:"form",class:"container mx-0 px-0"},yl=["disabled"],wl={value:"offline"},kl=["label"],Cl=["value"],Ml=["label"],$l=["value"],xl=["label"],Tl=["value"],Vl={key:0},Pl={class:"row mb-3"},Sl={key:3,class:"my-4 d-flex justify-content-between"},ql={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal"},Il=["disabled"],Ol={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Nl={name:"Config",components:{NewDeviceButton:se,ChargerModal:Yt,CircuitsIcon:Wt,CircuitsModal:mn,ControlModal:Cn,DeviceCard:Sn,DeviceTags:at,EebusIcon:qn,EebusModal:In,GeneralConfig:xo,HemsIcon:To,HemsModal:Vo,InfluxIcon:Po,InfluxModal:Ao,MessagingModal:bi,MeterModal:Ui,LoadpointModal:fi,LoadpointIcon:vi,ModbusProxyIcon:Di,ModbusProxyModal:_i,MqttIcon:Ei,MqttModal:Ki,NetworkModal:tl,NotificationIcon:al,SponsorModal:pl,TariffsModal:ml,TopHeader:le,VehicleIcon:ee,VehicleModal:a(vl,[["render",function(e,t,a,s,c,m){const h=p("FormRow"),v=p("Markdown"),b=p("PropertyEntry"),M=p("PropertyField"),$=p("SelectGroup"),x=p("PropertyCollapsible"),V=p("TestResult"),P=p("GenericModal");return r(),g(P,{id:"vehicleModal",title:e.$t("config.vehicle."+(m.isNew?"titleAdd":"titleEdit")),"data-testid":"vehicle-modal",onOpen:m.open,onClosed:m.closed},{default:T((()=>[o("form",bl,[u(h,{id:"vehicleTemplate",label:e.$t("config.vehicle.template")},{default:T((()=>[f(o("select",{id:"vehicleTemplate","onUpdate:modelValue":t[0]||(t[0]=e=>c.templateName=e),disabled:!m.isNew,class:"form-select w-100",onChange:t[1]||(t[1]=(...e)=>m.templateChanged&&m.templateChanged(...e))},[o("option",wl,l(e.$t("config.vehicle.offline")),1),t[10]||(t[10]=o("option",{disabled:""},"----------",-1)),o("optgroup",{label:e.$t("config.vehicle.online")},[(r(!0),n(y,null,w(m.templateOptions.online,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Cl)))),128))],8,kl),o("optgroup",{label:e.$t("config.vehicle.scooter")},[(r(!0),n(y,null,w(m.templateOptions.scooter,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,$l)))),128))],8,Ml),o("optgroup",{label:e.$t("config.vehicle.generic")},[(r(!0),n(y,null,w(m.templateOptions.generic,(e=>(r(),n("option",{key:e.name,value:e.template},l(e.name),9,Tl)))),128))],8,xl)],40,yl),[[C,c.templateName]])])),_:1},8,["label"]),c.loadingTemplate?(r(),n("p",Vl,"Loading ...")):d("",!0),m.description?(r(),g(v,{key:1,markdown:m.description,class:"my-4"},null,8,["markdown"])):d("",!0),(r(!0),n(y,null,w(m.normalParams,(e=>(r(),g(b,D({id:`vehicleParam${e.Name}`,key:e.Name,ref_for:!0},e,{modelValue:c.values[e.Name],"onUpdate:modelValue":t=>c.values[e.Name]=t}),null,16,["id","modelValue","onUpdate:modelValue"])))),128)),u(x,null,_({more:T((()=>[t[11]||(t[11]=o("h6",{class:"mt-3"},"Charging settings",-1)),u(h,{id:"vehicleParamMode",label:"Default mode",help:"Charging point mode when connecting this vehicle."},{default:T((()=>[u(M,{id:"vehicleParamMode",modelValue:c.values.mode,"onUpdate:modelValue":t[2]||(t[2]=e=>c.values.mode=e),type:"Choice",class:"w-100",choice:[{key:"off",name:e.$t("main.mode.off")},{key:"pv",name:e.$t("main.mode.pv")},{key:"minpv",name:e.$t("main.mode.minpv")},{key:"now",name:e.$t("main.mode.now")}]},null,8,["modelValue","choice"])])),_:1}),u(h,{id:"vehicleParamPhases",label:"Maximum phases",help:"How many phases can this vehicle charge with? Used to calculate required minimum solar surplus and plan duration."},{default:T((()=>[u($,{id:"vehicleParamPhases",modelValue:c.values.phases,"onUpdate:modelValue":t[3]||(t[3]=e=>c.values.phases=e),class:"w-100",options:[{name:"1-phase",value:"1"},{name:"2-phases",value:"2"},{name:"3-phases",value:void 0}],"equal-width":"",transparent:""},null,8,["modelValue"])])),_:1}),o("div",Pl,[u(h,{id:"vehicleParamMinCurrent",label:"Minimum current",class:"col-sm-6 mb-sm-0",help:c.values.minCurrent&&c.values.minCurrent<6?"Only go below 6 A if you know what you're doing.":null},{default:T((()=>[u(M,{id:"vehicleParamMinCurrent",modelValue:c.values.minCurrent,"onUpdate:modelValue":t[4]||(t[4]=e=>c.values.minCurrent=e),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2"},null,8,["modelValue"])])),_:1},8,["help"]),u(h,{id:"vehicleParamMaxCurrent",label:"Maximum current",class:"col-sm-6 mb-sm-0",help:c.values.minCurrent&&c.values.maxCurrent&&c.values.maxCurrent<c.values.minCurrent?"Must be greater than minimum current.":null},{default:T((()=>[u(M,{id:"vehicleParamMaxCurrent",modelValue:c.values.maxCurrent,"onUpdate:modelValue":t[5]||(t[5]=e=>c.values.maxCurrent=e),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2"},null,8,["modelValue"])])),_:1},8,["help"])]),u(h,{id:"vehicleParamPriority",label:"Priority",help:"Changes the charging point priority when connecting this vehicle."},{default:T((()=>[u(M,{id:"vehicleParamPriority",modelValue:c.values.priority,"onUpdate:modelValue":t[6]||(t[6]=e=>c.values.priority=e),type:"Choice",size:"w-100",class:"me-2",choice:m.priorityOptions,required:""},null,8,["modelValue","choice"])])),_:1}),u(h,{id:"vehicleParamIdentifiers",label:"RFID identifiers",help:"List of RFID strings to identify the vehicle. One per line. See the current identifier on the configuration overview."},{default:T((()=>[u(M,{id:"vehicleParamIdentifiers",modelValue:c.values.identifiers,"onUpdate:modelValue":t[7]||(t[7]=e=>c.values.identifiers=e),type:"List",property:"identifiers",size:"w-100",class:"me-2"},null,8,["modelValue"])])),_:1})])),_:2},[m.advancedParams.length?{name:"advanced",fn:T((()=>[(r(!0),n(y,null,w(m.advancedParams,(e=>(r(),g(b,D({id:`vehicleParam${e.Name}`,key:e.Name,ref_for:!0},e,{modelValue:c.values[e.Name],"onUpdate:modelValue":t=>c.values[e.Name]=t}),null,16,["id","modelValue","onUpdate:modelValue"])))),128))])),key:"0"}:void 0]),1024),c.templateName?(r(),g(V,{key:2,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:m.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):d("",!0),c.templateName?(r(),n("div",Sl,[m.isDeletable?(r(),n("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[8]||(t[8]=k(((...e)=>m.remove&&m.remove(...e)),["prevent"]))},l(e.$t("config.vehicle.delete")),1)):(r(),n("button",ql,l(e.$t("config.vehicle.cancel")),1)),o("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||c.saving,onClick:t[9]||(t[9]=k((e=>m.isNew?m.create():m.update()),["prevent"]))},[c.saving?(r(),n("span",Ol)):d("",!0),i(" "+l(e.testUnknown?e.$t("config.vehicle.validateSave"):e.$t("config.vehicle.save")),1)],8,Il)])):d("",!0)],512)])),_:1},8,["title","onOpen","onClosed"])}],["__scopeId","data-v-83eff06e"]])},mixins:[m,J],props:{offline:Boolean,notifications:Array},data:()=>({vehicles:[],meters:[],loadpoints:[],chargers:[],circuits:[],selectedVehicleId:void 0,selectedMeterId:void 0,selectedMeterType:void 0,selectedChargerId:void 0,selectedLoadpointId:void 0,loadpointSubModalOpen:!1,site:{grid:"",pv:[],battery:[],title:""},deviceValueTimeout:void 0,deviceValues:{},isComponentMounted:!0,isPageVisible:!0}),computed:{fatalClass:()=>H.state?.fatal?.class,siteTitle(){return this.site?.title},gridMeter(){const e=this.site?.grid;return this.getMetersByNames([e])[0]},pvMeters(){const e=this.site?.pv;return this.getMetersByNames(e)},batteryMeters(){const e=this.site?.battery;return this.getMetersByNames(e)},selectedMeterName(){return this.getMeterById(this.selectedMeterId)?.name},selectedChargerName(){return this.getChargerById(this.selectedChargerId)?.name},tariffTags(){const{currency:e,tariffGrid:t,tariffFeedIn:a,tariffCo2:n}=H.state;if(void 0===t&&void 0===a&&void 0===n)return null;const o={};return e&&(o.currency={value:e}),t&&(o.gridPrice={value:t,options:{currency:e}}),a&&(o.feedinPrice={value:-1*a,options:{currency:e}}),n&&(o.co2={value:n}),o},mqttTags(){const{broker:e,topic:t}=H.state?.mqtt||{};return e?{broker:{value:e},topic:{value:t}}:{configured:{value:!1}}},influxTags(){const{url:e,database:t,org:a}=H.state?.influx||{};if(!e)return{configured:{value:!1}};const n={url:{value:e}};return t&&(n.bucket={value:t}),a&&(n.org={value:a}),n},vehicleOptions(){return this.vehicles.map((e=>({key:e.name,name:e.config?.title||e.name})))},hemsTags(){const e={configured:{value:!1}},{type:t}=H.state?.hems||{};return t&&(e.configured.value=!0,e.hemsType={value:t}),e},isSponsor(){const{name:e}=H.state?.sponsor||{};return!!e},eebusTags:()=>({configured:{value:H.state?.eebus||!1}}),modbusproxyTags(){const e=H.state?.modbusproxy||[];return e.length>0?{amount:{value:e.length}}:{configured:{value:!1}}},messagingTags:()=>({configured:{value:H.state?.messaging||!1}})},watch:{offline(){this.offline||this.loadAll()}},mounted(){this.isComponentMounted=!0,document.addEventListener("visibilitychange",this.handleVisibilityChange),this.isPageVisible="visible"===document.visibilityState,this.loadAll()},unmounted(){this.isComponentMounted=!1,document.removeEventListener("visibilitychange",this.handleVisibilityChange),clearTimeout(this.deviceValueTimeout)},methods:{handleVisibilityChange(){this.isPageVisible="visible"===document.visibilityState,this.isPageVisible?this.updateValues():clearTimeout(this.deviceValueTimeout)},async loadAll(){await this.loadVehicles(),await this.loadMeters(),await this.loadSite(),await this.loadChargers(),await this.loadLoadpoints(),await this.loadCircuits(),await this.loadDirty(),await this.updateValues()},async loadDirty(){const e=await U.get("/config/dirty");e.data?.result&&(X.restartNeeded=!0)},async loadVehicles(){const e=await U.get("/config/devices/vehicle");this.vehicles=e.data?.result||[]},async loadChargers(){const e=await U.get("/config/devices/charger");this.chargers=e.data?.result||[]},async loadMeters(){const e=await U.get("/config/devices/meter");this.meters=e.data?.result||[]},async loadCircuits(){const e=await U.get("/config/devices/circuit");this.circuits=e.data?.result||[]},async loadSite(){const e=await U.get("/config/site",{validateStatus:e=>e<500});200===e.status&&(this.site=e.data?.result)},async loadLoadpoints(){const e=await U.get("/config/loadpoints");this.loadpoints=e.data?.result||[]},getMetersByNames(e){return e&&this.meters?this.meters.filter((t=>e.includes(t.name))):[]},getMeterById(e){if(e&&this.meters)return this.meters.find((t=>t.id===e))},getChargerById(e){if(e&&this.chargers)return this.chargers.find((t=>t.id===e))},vehicleModal:()=>O.getOrCreateInstance(document.getElementById("vehicleModal")),meterModal:()=>O.getOrCreateInstance(document.getElementById("meterModal")),loadpointModal:()=>O.getOrCreateInstance(document.getElementById("loadpointModal")),chargerModal:()=>O.getOrCreateInstance(document.getElementById("chargerModal")),editLoadpointCharger(e){this.loadpointSubModalOpen=!0;const t=this.chargers.find((t=>t.name===e));t&&void 0===t.id?alert("yaml configured chargers can not be edited. Remove charger from yaml first."):(this.loadpointModal().hide(),this.$nextTick((()=>this.editCharger(t?.id))))},editLoadpointMeter(e){this.loadpointSubModalOpen=!0;const t=this.meters.find((t=>t.name===e));t&&void 0===t.id?alert("yaml configured meters can not be edited. Remove meter from yaml first."):(this.loadpointModal().hide(),this.$nextTick((()=>this.editMeter(t?.id,"charge"))))},editMeter(e,t){this.selectedMeterId=e,this.selectedMeterType=t,this.$nextTick((()=>this.meterModal().show()))},newMeter(e){this.selectedMeterId=void 0,this.selectedMeterType=e,this.$nextTick((()=>this.meterModal().show()))},editCharger(e){this.selectedChargerId=e,this.$nextTick((()=>this.chargerModal().show()))},newCharger(){this.selectedChargerId=void 0,this.$nextTick((()=>this.chargerModal().show()))},async meterChanged(){await this.loadMeters(),this.meterModal().hide(),await this.loadDirty(),await this.updateValues()},async chargerChanged(){await this.loadChargers(),this.chargerModal().hide(),await this.loadDirty(),await this.updateValues()},editLoadpoint(e){this.selectedLoadpointId=e,this.$nextTick((()=>this.loadpointModal().show()))},newLoadpoint(){this.selectedLoadpointId=void 0,this.$nextTick((()=>this.loadpointModal().show()))},async loadpointChanged(){this.selectedLoadpointId=void 0,await this.loadLoadpoints(),this.loadpointModal().hide(),this.loadDirty()},editVehicle(e){this.selectedVehicleId=e,this.$nextTick((()=>this.vehicleModal().show()))},newVehicle(){this.selectedVehicleId=void 0,this.$nextTick((()=>this.vehicleModal().show()))},vehicleChanged(){this.selectedVehicleId=void 0,this.vehicleModal().hide(),this.loadVehicles(),this.loadDirty()},siteChanged(){this.loadDirty()},yamlChanged(){this.loadDirty()},addMeter(e,t){"charge"===e?this.$refs.loadpointModal?.setMeter(t):"grid"===e?(this.site.grid=t,this.saveSite(e)):(this.site[e]||(this.site[e]=[]),this.site[e].push(t),this.saveSite(e))},removeMeter(e,t){"charge"===e?this.$refs.loadpointModal?.setMeter(void 0):"grid"===e?(this.site.grid="",this.saveSite(e)):(this.site[e]=this.site[e].filter((e=>e!==t)),this.saveSite(e))},addCharger(e){this.$refs.loadpointModal?.setCharger(e)},removeCharger(){this.$refs.loadpointModal?.setCharger(void 0)},meterModalClosed(){"charge"===this.selectedMeterType&&this.loadpointModal().show()},chargerModalClosed(){this.loadpointModal().show()},async saveSite(e){const t=e?{[e]:this.site[e]}:this.site;await U.put("/config/site",t),await this.loadSite(),await this.loadDirty(),await this.updateValues()},todo(){alert("not implemented yet")},async restart(){await Z()},async updateDeviceValue(e,t){try{const a=await U.get(`/config/devices/${e}/${t}/status`);this.deviceValues[e]||(this.deviceValues[e]={}),this.deviceValues[e][t]=a.data.result}catch(a){return console.error("Error fetching device values for",e,t,a),null}},async updateValues(){if(clearTimeout(this.deviceValueTimeout),!this.offline){const e={meter:this.meters,vehicle:this.vehicles,charger:this.chargers};for(const t in e)for(const a of e[t])this.isComponentMounted&&this.isPageVisible&&await this.updateDeviceValue(t,a.name)}if(this.isComponentMounted&&this.isPageVisible){const e=1e3*(H.state?.interval||30);this.deviceValueTimeout=setTimeout(this.updateValues,e)}},deviceTags(e,t){return this.deviceValues[e]?.[t]||{}},loadpointTags(e){const{charger:t,meter:a}=e;return{...t?this.deviceTags("charger",t):{},...a?this.deviceTags("meter",a):{}}},openModal(e){const t=document.getElementById(e);t?O.getOrCreateInstance(t).show():console.error(`modal ${e} not found`)},circuitTags(e){const t=(H.state?.circuits||{})[e.name]||{},a={};return t.maxPower?a.powerRange={value:[t.power||0,t.maxPower],warning:t.power>=t.maxPower}:a.power={value:t.power||0,muted:!0},t.maxCurrent&&(a.currentRange={value:[t.current||0,t.maxCurrent],warning:t.current>=t.maxCurrent}),a},deviceError(e,t){const a=H.state?.fatal||{};return a.class===e&&a.device===t},chargerIcon(e){const t=this.chargers.find((t=>t.name===e));return t?.config?.icon}}},Ul={class:"root safe-area-inset"},Dl={class:"container px-4"},_l={class:"wrapper pb-5"},El={key:0,class:"alert alert-danger my-4 pb-0",role:"alert"},Ll={class:"my-4 mt-5"},Rl={key:1},Al={class:"my-4"},jl={class:"p-0 config-list"},Bl={class:"my-4"},Fl={class:"p-0 config-list"},zl={class:"my-4 mt-5"},Hl={class:"p-0 config-list"},Yl={class:"my-4 mt-5"},Wl={class:"p-0 config-list"},Gl={class:"my-4 mt-5"},Kl={class:"p-0 config-list"},Jl={key:0},Ql={class:"my-2 fw-bold"},Zl={class:"my-4 mt-5"},Xl={class:"round-box p-4 d-flex gap-4 mb-5"};e("default",a(Nl,[["render",function(e,t,a,s,c,m){const h=p("TopHeader"),f=p("GeneralConfig"),v=p("DeviceTags"),b=p("VehicleIcon"),k=p("LoadpointIcon"),C=p("DeviceCard"),M=p("NewDeviceButton"),$=p("MqttIcon"),x=p("NotificationIcon"),V=p("InfluxIcon"),P=p("EebusIcon"),S=p("CircuitsIcon"),q=p("ModbusProxyIcon"),I=p("HemsIcon"),O=p("router-link"),N=p("LoadpointModal"),U=p("VehicleModal"),D=p("MeterModal"),_=p("ChargerModal"),E=p("InfluxModal"),L=p("MqttModal"),R=p("NetworkModal"),A=p("ControlModal"),j=p("SponsorModal"),B=p("HemsModal"),F=p("MessagingModal"),z=p("TariffsModal"),H=p("ModbusProxyModal"),Y=p("CircuitsModal"),W=p("EebusModal");return r(),n("div",Ul,[o("div",Dl,[u(h,{title:e.$t("config.main.title")},null,8,["title"]),o("div",_l,[e.$hiddenFeatures()?(r(),n("div",El,t[13]||(t[13]=[Q('<p data-v-4b00b2be><strong data-v-4b00b2be>Experimental! 🧪</strong> Only use these features if you are in the mood for adventure and not afraid of debugging. Unexpected things and data loss may happen. </p><p data-v-4b00b2be> We are in the progress of replacing <code data-v-4b00b2be>evcc.yaml</code> with UI-based configuration. Any changes made here will be written to the database. After that, the corresponding <code data-v-4b00b2be>evcc.yaml</code>-values (e.g. network settings) will be ignored. </p><p class="mb-1" data-v-4b00b2be><strong data-v-4b00b2be>Missing features</strong></p><ul data-v-4b00b2be><li data-v-4b00b2be>aux meters</li><li data-v-4b00b2be>custom/plugin meters and vehicles</li><li data-v-4b00b2be>migration for vehicles, chargers, meters, loadpoints</li><li data-v-4b00b2be>remove mixed mode (evcc.yaml + db) for meters and vehicles</li></ul><p data-v-4b00b2be><strong data-v-4b00b2be>Migration and repair.</strong> Run <code data-v-4b00b2be>evcc migrate</code> to copy configuration from <code data-v-4b00b2be>evcc.yaml</code> to the database. Existing database configurations will be overwritten. Session and statistics data will not be touched. Run <code data-v-4b00b2be>evcc migrate --reset</code> to remove all database configurations. </p>',5)]))):d("",!0),o("h2",Ll,l(e.$t("config.section.general")),1),u(f,{onSiteChanged:m.siteChanged},null,8,["onSiteChanged"]),e.$hiddenFeatures()?(r(),n("div",Rl,[o("h2",Al,l(e.$t("config.section.loadpoints"))+" 🧪",1),o("ul",jl,[(r(!0),n(y,null,w(c.loadpoints,(e=>(r(),g(C,{key:e.name,title:e.title,name:e.name,editable:!!e.id,error:m.deviceError("loadpoint",e.name),"data-testid":"loadpoint",onEdit:t=>m.editLoadpoint(e.id)},{tags:T((()=>[u(v,{tags:m.loadpointTags(e)},null,8,["tags"])])),icon:T((()=>[m.chargerIcon(e.charger)?(r(),g(b,{key:0,name:m.chargerIcon(e.charger)},null,8,["name"])):(r(),g(k,{key:1}))])),_:2},1032,["title","name","editable","error","onEdit"])))),128)),u(M,{"data-testid":"add-loadpoint",title:e.$t("config.main.addLoadpoint"),onClick:m.newLoadpoint},null,8,["title","onClick"])]),o("h2",Bl,l(e.$t("config.section.vehicles"))+" 🧪",1),o("ul",Fl,[(r(!0),n(y,null,w(c.vehicles,(e=>(r(),g(C,{key:e.name,title:e.config?.title||e.name,name:e.name,editable:e.id>=0,error:m.deviceError("vehicle",e.name),"data-testid":"vehicle",onEdit:t=>m.editVehicle(e.id)},{icon:T((()=>[u(b,{name:e.config?.icon},null,8,["name"])])),tags:T((()=>[u(v,{tags:m.deviceTags("vehicle",e.name)},null,8,["tags"])])),_:2},1032,["title","name","editable","error","onEdit"])))),128)),u(M,{"data-testid":"add-vehicle",title:e.$t("config.main.addVehicle"),onClick:m.newVehicle},null,8,["title","onClick"])]),o("h2",zl,l(e.$t("config.section.grid"))+" 🧪",1),o("ul",Hl,[m.gridMeter?(r(),g(C,{key:0,title:e.$t("config.grid.title"),name:m.gridMeter.name,editable:!!m.gridMeter.id,error:m.deviceError("meter",m.gridMeter.name),"data-testid":"grid",onEdit:t[0]||(t[0]=e=>m.editMeter(m.gridMeter.id,"grid"))},{icon:T((()=>t[14]||(t[14]=[o("shopicon-regular-powersupply",null,null,-1)]))),tags:T((()=>[u(v,{tags:m.deviceTags("meter",m.gridMeter.name)},null,8,["tags"])])),_:1},8,["title","name","editable","error"])):(r(),g(M,{key:1,title:e.$t("config.main.addGrid"),"data-testid":"add-grid",onClick:t[1]||(t[1]=e=>m.newMeter("grid"))},null,8,["title"])),m.tariffTags?(r(),g(C,{key:2,title:e.$t("config.tariffs.title"),editable:"",error:"tariff"===m.fatalClass,"data-testid":"tariffs",onEdit:t[2]||(t[2]=e=>m.openModal("tariffsModal"))},{icon:T((()=>t[15]||(t[15]=[o("shopicon-regular-receivepayment",null,null,-1)]))),tags:T((()=>[u(v,{tags:m.tariffTags},null,8,["tags"])])),_:1},8,["title","error"])):(r(),g(M,{key:3,title:e.$t("config.main.addTariffs"),"data-testid":"add-tariffs",onClick:t[3]||(t[3]=e=>m.openModal("tariffsModal"))},null,8,["title"]))]),o("h2",Yl,l(e.$t("config.section.meter"))+" 🧪",1),o("ul",Wl,[(r(!0),n(y,null,w(m.pvMeters,(e=>(r(),g(C,{key:e.name,title:e.config?.template||"Solar system",name:e.name,editable:!!e.id,error:m.deviceError("meter",e.name),"data-testid":"pv",onEdit:t=>m.editMeter(e.id,"pv")},{icon:T((()=>t[16]||(t[16]=[o("shopicon-regular-sun",null,null,-1)]))),tags:T((()=>[u(v,{tags:m.deviceTags("meter",e.name)},null,8,["tags"])])),_:2},1032,["title","name","editable","error","onEdit"])))),128)),(r(!0),n(y,null,w(m.batteryMeters,(e=>(r(),g(C,{key:e.name,title:e.config?.template||"Battery storage",name:e.name,editable:!!e.id,error:m.deviceError("meter",e.name),"data-testid":"battery",onEdit:t=>m.editMeter(e.id,"battery")},{icon:T((()=>t[17]||(t[17]=[o("shopicon-regular-batterythreequarters",null,null,-1)]))),tags:T((()=>[u(v,{tags:m.deviceTags("meter",e.name)},null,8,["tags"])])),_:2},1032,["title","name","editable","error","onEdit"])))),128)),u(M,{title:e.$t("config.main.addPvBattery"),onClick:m.newMeter},null,8,["title","onClick"])]),o("h2",Gl,l(e.$t("config.section.integrations"))+" 🧪",1),o("ul",Kl,[u(C,{title:e.$t("config.mqtt.title"),editable:"",error:"mqtt"===m.fatalClass,"data-testid":"mqtt",onEdit:t[4]||(t[4]=e=>m.openModal("mqttModal"))},{icon:T((()=>[u($)])),tags:T((()=>[u(v,{tags:m.mqttTags},null,8,["tags"])])),_:1},8,["title","error"]),u(C,{title:e.$t("config.messaging.title"),editable:"",error:"messenger"===m.fatalClass,"data-testid":"messaging",onEdit:t[5]||(t[5]=e=>m.openModal("messagingModal"))},{icon:T((()=>[u(x)])),tags:T((()=>[u(v,{tags:m.messagingTags},null,8,["tags"])])),_:1},8,["title","error"]),u(C,{title:e.$t("config.influx.title"),editable:"",error:"influx"===m.fatalClass,"data-testid":"influx",onEdit:t[6]||(t[6]=e=>m.openModal("influxModal"))},{icon:T((()=>[u(V)])),tags:T((()=>[u(v,{tags:m.influxTags},null,8,["tags"])])),_:1},8,["title","error"]),u(C,{title:`${e.$t("config.eebus.title")} 🧪`,editable:"",error:"eebus"===m.fatalClass,"data-testid":"eebus",onEdit:t[7]||(t[7]=e=>m.openModal("eebusModal"))},{icon:T((()=>[u(P)])),tags:T((()=>[u(v,{tags:m.eebusTags},null,8,["tags"])])),_:1},8,["title","error"]),u(C,{title:`${e.$t("config.circuits.title")} 🧪`,editable:"",error:"circuit"===m.fatalClass,"data-testid":"circuits",onEdit:t[8]||(t[8]=e=>m.openModal("circuitsModal"))},{icon:T((()=>[u(S)])),tags:T((()=>[0==c.circuits.length?(r(),g(v,{key:0,tags:{configured:{value:!1}}})):(r(!0),n(y,{key:1},w(c.circuits,((e,t)=>(r(),n(y,{key:e.name},[t>0?(r(),n("hr",Jl)):d("",!0),o("p",Ql,[i(l(e.config?.title)+" ",1),o("code",null,"("+l(e.name)+")",1)]),u(v,{tags:m.circuitTags(e)},null,8,["tags"])],64)))),128))])),_:1},8,["title","error"]),u(C,{title:e.$t("config.modbusproxy.title"),editable:"",error:"modbusproxy"===m.fatalClass,"data-testid":"modbusproxy",onEdit:t[9]||(t[9]=e=>m.openModal("modbusProxyModal"))},{icon:T((()=>[u(q)])),tags:T((()=>[u(v,{tags:m.modbusproxyTags},null,8,["tags"])])),_:1},8,["title","error"]),u(C,{title:e.$t("config.hems.title"),editable:"",error:"hems"===m.fatalClass,"data-testid":"hems",onEdit:t[10]||(t[10]=e=>m.openModal("hemsModal"))},{icon:T((()=>[u(I)])),tags:T((()=>[u(v,{tags:m.hemsTags},null,8,["tags"])])),_:1},8,["title","error"])])])):d("",!0),t[18]||(t[18]=o("hr",{class:"my-5"},null,-1)),o("h2",Zl,l(e.$t("config.section.system")),1),o("div",Xl,[u(O,{to:"/log",class:"btn btn-outline-secondary"},{default:T((()=>[i(l(e.$t("config.system.logs")),1)])),_:1}),o("button",{class:"btn btn-outline-danger",onClick:t[11]||(t[11]=(...e)=>m.restart&&m.restart(...e))},l(e.$t("config.system.restart")),1)]),u(N,{id:c.selectedLoadpointId,ref:"loadpointModal",vehicleOptions:m.vehicleOptions,loadpointCount:c.loadpoints.length,chargers:c.chargers,chargerValues:c.deviceValues.charger,meters:c.meters,circuits:c.circuits,fade:c.loadpointSubModalOpen?"left":"",onUpdated:m.loadpointChanged,onOpenChargerModal:m.editLoadpointCharger,onOpenMeterModal:m.editLoadpointMeter,onOpened:t[12]||(t[12]=e=>c.loadpointSubModalOpen=!1)},null,8,["id","vehicleOptions","loadpointCount","chargers","chargerValues","meters","circuits","fade","onUpdated","onOpenChargerModal","onOpenMeterModal"]),u(U,{id:c.selectedVehicleId,onVehicleChanged:m.vehicleChanged},null,8,["id","onVehicleChanged"]),u(D,{id:c.selectedMeterId,name:m.selectedMeterName,type:c.selectedMeterType,fade:c.loadpointSubModalOpen?"right":"",onAdded:m.addMeter,onUpdated:m.meterChanged,onRemoved:m.removeMeter,onClose:m.meterModalClosed},null,8,["id","name","type","fade","onAdded","onUpdated","onRemoved","onClose"]),u(_,{id:c.selectedChargerId,name:m.selectedChargerName,fade:c.loadpointSubModalOpen?"right":"",isSponsor:m.isSponsor,onAdded:m.addCharger,onUpdated:m.chargerChanged,onRemoved:m.removeCharger,onClose:m.chargerModalClosed},null,8,["id","name","fade","isSponsor","onAdded","onUpdated","onRemoved","onClose"]),u(E,{onChanged:m.loadDirty},null,8,["onChanged"]),u(L,{onChanged:m.loadDirty},null,8,["onChanged"]),u(R,{onChanged:m.loadDirty},null,8,["onChanged"]),u(A,{onChanged:m.loadDirty},null,8,["onChanged"]),u(j,{onChanged:m.loadDirty},null,8,["onChanged"]),u(B,{onChanged:m.yamlChanged},null,8,["onChanged"]),u(F,{onChanged:m.yamlChanged},null,8,["onChanged"]),u(z,{onChanged:m.yamlChanged},null,8,["onChanged"]),u(H,{onChanged:m.yamlChanged},null,8,["onChanged"]),u(Y,{onChanged:m.yamlChanged},null,8,["onChanged"]),u(W,{onChanged:m.yamlChanged},null,8,["onChanged"])])])])}],["__scopeId","data-v-4b00b2be"]]))}}}));
