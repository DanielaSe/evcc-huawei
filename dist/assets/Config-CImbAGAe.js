import{_ as T,c,a as l,i as N,t as f,o as a,Z as re,h as b,l as W,b as u,e as g,f as K,a2 as Pe,q as w,w as _,a3 as Ee,n as E,F as P,r as q,B as S,J as de,K as O,v as D,W as z,d as h,j as F,k as A,a0 as Bt,P as dt,a4 as ut,M as H,a5 as Y,O as $,s as G,A as Se,a6 as ve,a7 as qe,a8 as Te,a9 as jt,aa as ee,ab as ct,ac as mt,ad as pt,a1 as I,y as Le,L as Ie,m as Re,p as Ae,x as xt,ae as Ht,af as zt,ag as Yt}from"./index-CN0w41DB.js";import{V as ht,T as Wt,a as Gt,S as Kt,b as Jt}from"./batterythreequarters-vx6TSM96.js";import{d as Qt}from"./deepEqual-DB6L2s-b.js";import{T as Zt}from"./TopHeader-C6w4H9P6.js";import"./TopNavigation-BCd9W1gB.js";const Xt={name:"NewDeviceButton",props:{title:String},emits:["click"]},en={class:"root"};function tn(e,t,n,i,s,o){return a(),c("li",en,[l("button",{class:"d-flex align-items-center justify-content-center p-3",tabindex:"0",onClick:t[0]||(t[0]=r=>e.$emit("click"))},[t[1]||(t[1]=l("shopicon-regular-plus",{class:"me-1"},null,-1)),N(" "+f(n.title),1)])])}const ft=T(Xt,[["render",tn],["__scopeId","data-v-fd1f8c73"]]);var nn={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function Fe(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function Q(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function $e(e,t){var n,i,s,o,r,p=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,d=[],v="",M=t||{},C=0;function y(m){var V=nn[m[1]||""],B=d[d.length-1]==m;return V?V[1]?(B?d.pop():d.push(m),V[0|B]):V[0]:m}function U(){for(var m="";d.length;)m+=y(d[d.length-1]);return m}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(m,V,B){return M[V.toLowerCase()]=B,""}).replace(/^\n+|\n+$/g,"");s=p.exec(e);)i=e.substring(C,s.index),C=p.lastIndex,n=s[0],i.match(/[^\\](\\\\)*\\$/)||((r=s[3]||s[4])?n='<pre class="code '+(s[4]?"poetry":s[2].toLowerCase())+'"><code'+(s[2]?' class="language-'+s[2].toLowerCase()+'"':"")+">"+Fe(Q(r).replace(/^\n+|\n+$/g,""))+"</code></pre>":(r=s[6])?(r.match(/\./)&&(s[5]=s[5].replace(/^\d+/gm,"")),o=$e(Fe(s[5].replace(/^\s*[>*+.-]/gm,""))),r==">"?r="blockquote":(r=r.match(/\./)?"ol":"ul",o=o.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),n="<"+r+">"+o+"</"+r+">"):s[8]?n='<img src="'+Q(s[8])+'" alt="'+Q(s[7])+'">':s[10]?(v=v.replace("<a>",'<a href="'+Q(s[11]||M[i.toLowerCase()])+'">'),n=U()+"</a>"):s[9]?n="<a>":s[12]||s[14]?n="<"+(r="h"+(s[14]?s[14].length:s[13]>"="?1:2))+">"+$e(s[12]||s[15],M)+"</"+r+">":s[16]?n="<code>"+Q(s[16])+"</code>":(s[17]||s[1])&&(n=y(s[17]||"--"))),v+=i,v+=n;return(v+e.substring(C)+U()).replace(/^\n+|\n+$/g,"")}const on={name:"MarkdownRenderer",props:{markdown:String},computed:{compiledMarkdown(){return $e(this.markdown)}}},sn=["innerHTML"];function an(e,t,n,i,s,o){return a(),c("div",{innerHTML:o.compiledMarkdown},null,8,sn)}const ue=T(on,[["render",an]]),ln={name:"FormRow",components:{Markdown:ue},props:{id:String,label:String,help:String,optional:Boolean,deprecated:Boolean,example:String,docsLink:String},computed:{link(){return this.docsLink?"".concat(re()).concat(this.docsLink):null}}},rn={class:"mb-4"},dn=["for"],un={class:"form-label"},cn={key:0,class:"evcc-gray"},mn={key:1,class:"evcc-gray"},pn={class:"w-100"},hn={class:"form-text evcc-gray"},fn={key:0,class:"hyphenate"},gn={key:1,class:"d-flex gap-1"},vn=["href"];function bn(e,t,n,i,s,o){const r=g("Markdown");return a(),c("div",rn,[l("label",{for:n.id},[l("div",un,[N(f(n.label)+" ",1),n.deprecated?(a(),c("small",cn,f(e.$t("config.form.deprecated")),1)):n.optional?(a(),c("small",mn,f(e.$t("config.form.optional")),1)):b("",!0)])],8,dn),l("div",pn,[W(e.$slots,"default")]),l("div",hn,[n.example?(a(),c("div",fn,f(e.$t("config.form.example"))+": "+f(n.example),1)):b("",!0),n.help?(a(),c("div",gn,[u(r,{markdown:n.help,class:"text-gray hyphenate"},null,8,["markdown"]),o.link?(a(),c("a",{key:0,class:"text-gray",href:o.link,target:"_blank"},f(e.$t("config.general.docsLink")),9,vn)):b("",!0)])):b("",!0)])])}const L=T(ln,[["render",bn]]);var yn='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M8 22h32v4H8z"/></svg>';class wn extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=yn}}window.customElements.define("shopicon-regular-minus",wn);const Be=1e9,Mn={name:"PropertyField",components:{VehicleIcon:ht,SelectGroup:Pe},mixins:[K],props:{id:String,property:String,masked:Boolean,placeholder:String,type:String,unit:String,size:String,scale:Number,required:Boolean,choice:{type:Array,default:()=>[]},modelValue:[String,Number,Boolean,Object]},emits:["update:modelValue"],data:()=>({selectMode:!1}),computed:{inputType(){return this.masked?"password":["Int","Float","Duration"].includes(this.type)?"number":"text"},sizeClass(){return this.size?this.size:["Int","Float","Duration"].includes(this.type)?"w-50 w-min-200":""},endAlign(){return["Int","Float","Duration"].includes(this.type)},step(){return this.type==="Float"||this.type==="Duration"?"any":null},unitValue(){return this.type==="Duration"?this.fmtDurationUnit(this.value,this.unit):this.unit?this.unit:this.property==="capacity"?"kWh":null},icons(){return this.property==="icon"},textarea(){return["accessToken","refreshToken","identifiers"].includes(this.property)},boolean(){return this.type==="Bool"},array(){return this.type==="List"},select(){return this.choice.length>0},durationFactor(){return this.unit==="minute"?60:1},selectOptions(){if(typeof this.choice[0]=="object")return this.choice;let e=[...this.choice];return this.icons&&!this.required&&(e=["",...e]),e.map(t=>({key:t,name:this.$t("config.options.".concat(this.property,".").concat(t||"none"))}))},value:{get(){return this.selectOptions.length>0&&!this.modelValue?this.required?this.selectOptions[0].key:"":this.scale?this.modelValue*this.scale:this.boolean?this.modelValue===!0:this.array?Array.isArray(this.modelValue)?this.modelValue.join("\n"):"":this.type==="Duration"&&typeof this.modelValue=="number"?this.modelValue/this.durationFactor/Be:this.modelValue},set(e){let t=e;this.scale&&(t=e/this.scale),this.array&&(t=e?e.split("\n"):[]),this.type==="Duration"&&typeof t=="number"&&(t=t*this.durationFactor*Be),this.$emit("update:modelValue",t)}}},methods:{toggleSelectMode(){this.$nextTick(()=>{this.selectMode=!this.selectMode})}}},kn=["id","type","step","placeholder","required","aria-describedby"],Cn=["id"],_n={key:1,class:"d-flex flex-wrap"},Tn=["id","name","value"],$n=["for","aria-label"],Vn={key:1},Pn={key:0,class:"me-2 mb-2 d-flex align-items-end"},Sn=["id"],qn=["id"],In={key:0,value:""},On=["value"],Nn=["id","type","placeholder","required"],Un=["id","type","step","placeholder","required","autocomplete"];function Dn(e,t,n,i,s,o){const r=g("VehicleIcon"),p=g("SelectGroup");return o.unitValue?(a(),c("div",{key:0,class:E(["input-group",o.sizeClass])},[_(l("input",{id:n.id,"onUpdate:modelValue":t[0]||(t[0]=d=>o.value=d),type:o.inputType,step:o.step,placeholder:n.placeholder,required:n.required,"aria-describedby":n.id+"_unit",class:E(["form-control",{"text-end":o.endAlign}])},null,10,kn),[[Ee,o.value]]),l("span",{id:n.id+"_unit",class:"input-group-text"},f(o.unitValue),9,Cn)],2)):o.icons?(a(),c("div",_n,[(a(!0),c(P,null,q(o.selectOptions,({key:d})=>_((a(),c("div",{key:d,class:"me-2 mb-2"},[_(l("input",{id:"icon_".concat(d),"onUpdate:modelValue":t[1]||(t[1]=v=>o.value=v),type:"radio",class:E(e.selectMode?"btn-check":"d-none"),name:n.property,value:d,onClick:t[2]||(t[2]=(...v)=>o.toggleSelectMode&&o.toggleSelectMode(...v))},null,10,Tn),[[z,o.value]]),l("label",{class:E(["btn btn-outline-secondary",d===o.value?"active":""]),for:"icon_".concat(d),"aria-label":d},[d?(a(),w(r,{key:0,name:d},null,8,["name"])):(a(),c("shopicon-regular-minus",Vn))],10,$n)])),[[D,d===o.value||e.selectMode]])),128)),e.selectMode?b("",!0):(a(),c("div",Pn,[l("a",{id:n.id,class:"text-muted",href:"#",onClick:t[3]||(t[3]=S((...d)=>o.toggleSelectMode&&o.toggleSelectMode(...d),["prevent"]))},"change",8,Sn)]))])):o.boolean?(a(),w(p,{key:2,id:n.id,modelValue:o.value,"onUpdate:modelValue":t[4]||(t[4]=d=>o.value=d),class:"w-50","equal-width":"",transparent:"",options:[{value:!1,name:e.$t("config.options.boolean.no")},{value:!0,name:e.$t("config.options.boolean.yes")}]},null,8,["id","modelValue","options"])):o.select?_((a(),c("select",{key:3,id:n.id,"onUpdate:modelValue":t[5]||(t[5]=d=>o.value=d),class:E(["form-select",o.sizeClass])},[n.required?b("",!0):(a(),c("option",In,"---")),(a(!0),c(P,null,q(o.selectOptions,({key:d,name:v},M)=>(a(),c(P,null,[d!==null&&v!==null?(a(),c("option",{key:d,value:d},f(v),9,On)):(a(),c("hr",{key:M}))],64))),256))],10,qn)),[[de,o.value]]):o.textarea?_((a(),c("textarea",{key:4,id:n.id,"onUpdate:modelValue":t[6]||(t[6]=d=>o.value=d),class:E(["form-control",o.sizeClass]),type:o.inputType,placeholder:n.placeholder,required:n.required,rows:"4"},null,10,Nn)),[[O,o.value]]):_((a(),c("input",{key:5,id:n.id,"onUpdate:modelValue":t[7]||(t[7]=d=>o.value=d),class:E(["form-control",o.sizeClass]),type:o.inputType,step:o.step,placeholder:n.placeholder,required:n.required,autocomplete:n.masked?"off":null},null,10,Un)),[[Ee,o.value]])}const ce=T(Mn,[["render",Dn]]),En={name:"PropertyEntry",components:{FormRow:L,PropertyField:ce},props:{id:String,Name:String,Required:Boolean,Deprecated:Boolean,Description:String,Help:String,Example:String,Type:String,Mask:Boolean,Choice:Array,modelValue:[String,Number,Boolean,Object]},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}};function Ln(e,t,n,i,s,o){const r=g("PropertyField"),p=g("FormRow");return a(),w(p,{id:n.id,optional:!n.Required,deprecated:n.Deprecated,label:n.Description||"[".concat(n.Name,"]"),help:n.Description===n.Help?void 0:n.Help,example:n.Example},{default:h(()=>[u(r,{id:n.id,modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=d=>o.value=d),masked:n.Mask,property:n.Name,type:n.Type,class:"me-2",required:n.Required,choice:n.Choice},null,8,["id","modelValue","masked","property","type","required","choice"])]),_:1},8,["id","optional","deprecated","label","help","example"])}const Oe=T(En,[["render",Ln]]),Rn={name:"Dropdown",mixins:[F]};function An(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M11.475 14.475L7.85 10.85q-.075-.075-.112-.162T7.7 10.5q0-.2.138-.35T8.2 10h7.6q.225 0 .363.15t.137.35q0 .05-.15.35l-3.625 3.625q-.125.125-.25.175T12 14.7t-.275-.05t-.25-.175"},null,-1)]),4)}const Fn=T(Rn,[["render",An]]),Bn={name:"PropertyCollapsible",components:{DropdownIcon:Fn},data(){return{open:!1}},methods:{toggle(){this.open=!this.open}}},jn={key:0},xn={key:0},Hn={key:1},zn={key:0,class:"pt-2"},Yn={key:0,class:"my-5"};function Wn(e,t,n,i,s,o){const r=g("DropdownIcon");return e.$slots.advanced||e.$slots.more?(a(),c("div",jn,[l("button",{class:E(["btn btn-link btn-sm text-gray px-0 border-0 d-flex align-items-center mb-2",s.open?"text-primary":""]),type:"button",tabindex:"0",onClick:t[0]||(t[0]=(...p)=>o.toggle&&o.toggle(...p))},[s.open?(a(),c("span",xn,f(e.$t("config.general.hideAdvancedSettings")),1)):(a(),c("span",Hn,f(e.$t("config.general.showAdvancedSettings")),1)),u(r,{class:E(["icon",{iconUp:s.open}])},null,8,["class"])],2),u(Bt,null,{default:h(()=>[s.open?(a(),c("div",zn,[W(e.$slots,"advanced",{},void 0,!0),e.$slots.advanced&&e.$slots.more?(a(),c("hr",Yn)):b("",!0),W(e.$slots,"more",{},void 0,!0)])):b("",!0)]),_:3})])):b("",!0)}const me=T(Bn,[["render",Wn],["__scopeId","data-v-ddacac93"]]),Gn=["phasePowers","phaseVoltages","phaseCurrents"],Kn={name:"DeviceTags",mixins:[K],props:{tags:Object},computed:{entries(){return Object.entries(this.tags).map(([e,{value:t,error:n,warning:i,muted:s,options:o}])=>({name:e,value:t,error:n,warning:i,muted:s,options:o}))}},methods:{fmtDeviceValue(e){const{name:t,value:n,options:i={}}=e;if(n==null)return"";switch(t){case"power":return this.fmtW(n);case"energy":case"capacity":case"chargedEnergy":return this.fmtWh(n*1e3);case"soc":case"vehicleLimitSoc":return this.fmtPercentage(n,1);case"temp":return this.fmtTemperature(n);case"odometer":case"range":return"".concat(this.fmtNumber(n,0)," km");case"phaseCurrents":return n.map(s=>this.fmtNumber(s,1)).join(" · ")+" A";case"phaseVoltages":return n.map(s=>this.fmtNumber(s,0)).join(" · ")+" V";case"phasePowers":return n.map(s=>this.fmtW(s,dt.KW,!1)).join(" · ")+" kW";case"chargeStatus":return this.$t("config.deviceValue.chargeStatus".concat(n));case"gridPrice":case"feedinPrice":return this.fmtPricePerKWh(n,i.currency,!0);case"co2":return this.fmtCo2Short(n);case"powerRange":return"".concat(this.fmtW(n[0])," / ").concat(this.fmtW(n[1]));case"currentRange":return"".concat(this.fmtNumber(n[0],1)," A / ").concat(this.fmtNumber(n[1],1)," A");case"controllable":case"phases1p3p":case"singlePhase":case"enabled":case"configured":return n?this.$t("config.deviceValue.yes"):this.$t("config.deviceValue.no")}return n},allowTruncate(e){return!Gn.includes(e)}}},Jn={key:0,class:"tags"},Qn=["data-testid"],Zn={class:"label overflow-hidden text-truncate flex-shrink-1 flex-grow-1"};function Xn(e,t,n,i,s,o){return n.tags?(a(),c("div",Jn,[(a(!0),c(P,null,q(o.entries,(r,p)=>(a(),c("span",{key:p,"data-testid":"device-tag-".concat(r.name),class:"d-flex gap-2 overflow-hidden text-truncate"},[l("div",Zn,f(e.$t("config.deviceValue.".concat(r.name))),1),l("div",{class:E(["value overflow-hidden",{"value--error":!!r.error,"value--warning":r.warning,"value--muted":r.muted||r.value===!1,"text-truncate":o.allowTruncate(r.name),"flex-shrink-0":!o.allowTruncate(r.name)}])},f(o.fmtDeviceValue(r)),3)],8,Qn))),128))])):b("",!0)}const gt=T(Kn,[["render",Xn],["__scopeId","data-v-91ffaca1"]]),eo={name:"TestResult",components:{DeviceTags:gt},props:{success:Boolean,failed:Boolean,unknown:Boolean,running:Boolean,result:Object,error:String},emits:["test"]},to={class:"test-result my-4 p-4"},no={class:"d-flex justify-content-between align-items-center"},oo={key:0},so={key:1},ao={key:2,class:"text-success"},io={key:3,class:"text-danger"},lo={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ro={key:0,class:"divider"},uo={key:1,class:"text-danger"},co={key:2,class:"divider"},mo={key:3};function po(e,t,n,i,s,o){const r=g("DeviceTags");return a(),c("div",to,[l("div",no,[l("strong",null,[l("span",null,f(e.$t("config.validation.label"))+": ",1),n.unknown?(a(),c("span",oo,f(e.$t("config.validation.unknown")),1)):b("",!0),n.running?(a(),c("span",so,f(e.$t("config.validation.running")),1)):b("",!0),n.success?(a(),c("span",ao,f(e.$t("config.validation.success")),1)):b("",!0),n.failed?(a(),c("span",io,f(e.$t("config.validation.failed")),1)):b("",!0)]),n.running?(a(),c("span",lo)):(a(),c("a",{key:1,href:"#",class:"alert-link",tabindex:"0",onClick:t[0]||(t[0]=S(p=>e.$emit("test"),["prevent"]))},f(e.$t("config.validation.validate")),1))]),n.error?(a(),c("hr",ro)):b("",!0),n.error?(a(),c("div",uo,f(n.error),1)):b("",!0),n.result?(a(),c("hr",co)):b("",!0),n.result?(a(),c("div",mo,[u(r,{tags:n.result,class:"success-values"},null,8,["tags"])])):b("",!0)])}const Ne=T(eo,[["render",po],["__scopeId","data-v-2fa2572e"]]),be="unknown",je="success",ye="failed",xe="running",Ue={data(){return{testState:be,testError:null,testResult:null}},computed:{testRunning(){return this.testState===xe},testSuccess(){return this.testState===je},testFailed(){return this.testState===ye},testUnknown(){return this.testState===be}},methods:{resetTest(){this.testState=be,this.testError=null,this.testResult=null},async test(e){var t,n;if(!this.$refs.form.reportValidity())return!1;this.testState=xe;try{const i=await e();for(const[s,{error:o}]of Object.entries(i.data.result))if(o)return this.testState=ye,this.testResult=null,this.testError="".concat(s,": ").concat(o),!1;return this.testResult=i.data.result,this.testError=null,this.testState=je,!0}catch(i){console.error(i),this.testState=ye,this.testResult=null,this.testError=((n=(t=i.response)==null?void 0:t.data)==null?void 0:n.error)||i.message}return!1}}},ho=ut({name:"Modbus",components:{FormRow:L,PropertyField:ce},props:{capabilities:{type:Array,default:()=>[]},modbus:String,host:String,port:[Number,String],id:[Number,String],baudrate:[Number,String],comset:String,device:String,defaultPort:Number,defaultId:Number,defaultComset:String,defaultBaudrate:Number},emits:["update:modbus","update:id","update:host","update:port","update:device","update:baudrate","update:comset"],data(){return{connection:"tcpip",protocol:"tcp"}},computed:{selectedModbus(){return this.connection==="serial"?"rs485serial":this.protocol==="rtu"?"rs485tcpip":"tcpip"},showConnectionOptions(){return this.capabilities.includes("rs485")},showProtocolOptions(){return this.connection==="tcpip"&&this.capabilities.includes("rs485")},comsetOptions(){return["8N1","8E1"].map(e=>({key:e,name:e}))},baudrateOptions(){return[1200,9600,19200,38400,57600,115200].map(e=>({key:e,name:"".concat(e)}))}},watch:{selectedModbus(e){this.$emit("update:modbus",e)},options(e){this.setProtocolByCapabilities(e),this.$emit("update:modbus",this.selectedModbus)},modbus(e){e&&this.setConnectionAndProtocolByModbus(e)}},mounted(){this.setConnectionAndProtocolByModbus(this.modbus),this.$emit("update:modbus",this.selectedModbus)},methods:{setProtocolByCapabilities(e){this.protocol=e.includes("tcpip")?"tcp":"rtu"},setConnectionAndProtocolByModbus(e){switch(e){case"rs485serial":this.connection="serial",this.protocol="rtu";break;case"rs485tcpip":this.connection="tcpip",this.protocol="rtu";break;case"tcpip":this.connection="tcpip",this.protocol="tcp";break}}}}),fo={class:"btn-group",role:"group"},go={key:1},vo={class:"btn-group",role:"group"},bo={key:2};function yo(e,t,n,i,s,o){const r=g("FormRow"),p=g("PropertyField");return a(),c(P,null,[e.showConnectionOptions?(a(),w(r,{key:0,id:"modbusTcpIp",label:"Modbus Connection",help:e.connection==="tcpip"?"The device is addressable from evcc via LAN/Wifi.":"The device is diretly connected to evcc via a RS485 interface."},{default:h(()=>[l("div",fo,[_(l("input",{id:"modbusTcpIp","onUpdate:modelValue":t[0]||(t[0]=d=>e.connection=d),type:"radio",class:"btn-check",name:"modbusConnection",value:"tcpip",tabindex:"0",autocomplete:"off"},null,512),[[z,e.connection]]),t[10]||(t[10]=l("label",{class:"btn btn-outline-primary",for:"modbusTcpIp"},"Network",-1)),_(l("input",{id:"modbusSerial","onUpdate:modelValue":t[1]||(t[1]=d=>e.connection=d),type:"radio",class:"btn-check",name:"modbusConnection",value:"serial",tabindex:"0",autocomplete:"off"},null,512),[[z,e.connection]]),t[11]||(t[11]=l("label",{class:"btn btn-outline-primary",for:"modbusSerial"},"Serial / USB",-1))])]),_:1},8,["help"])):b("",!0),u(r,{id:"modbusId",label:"Modbus ID"},{default:h(()=>[u(p,{id:"modbusId",property:"id",type:"Int",class:"me-2",required:"","model-value":e.id||e.defaultId||1,onChange:t[2]||(t[2]=d=>e.$emit("update:id",d.target.value))},null,8,["model-value"])]),_:1}),e.connection==="tcpip"?(a(),c("div",go,[u(r,{id:"modbusHost",label:"IP address or hostname",help:"Example: 192.0.2.2"},{default:h(()=>[u(p,{id:"modbusHost",property:"host",type:"String",class:"me-2",required:"","model-value":e.host,onChange:t[3]||(t[3]=d=>e.$emit("update:host",d.target.value))},null,8,["model-value"])]),_:1}),u(r,{id:"modbusPort",label:"Port"},{default:h(()=>[u(p,{id:"modbusPort",property:"port",type:"Int",class:"me-2 w-50",required:"","model-value":e.port||e.defaultPort||502,onChange:t[4]||(t[4]=d=>e.$emit("update:port",d.target.value))},null,8,["model-value"])]),_:1}),e.showProtocolOptions?(a(),w(r,{key:0,id:"modbusTcp",label:"Modbus Protocol",help:e.protocol==="tcp"?"Device has native LAN/Wifi support or is connected through a RS485 to Ethernet adapter with protocol translation.":"Connection through a RS485 to Ethernet adapter without protocol translation."},{default:h(()=>[l("div",vo,[_(l("input",{id:"modbusTcp","onUpdate:modelValue":t[5]||(t[5]=d=>e.protocol=d),type:"radio",class:"btn-check",name:"modbusProtocol",value:"tcp",tabindex:"0",autocomplete:"off"},null,512),[[z,e.protocol]]),t[12]||(t[12]=l("label",{class:"btn btn-outline-primary",for:"modbusTcp"},"TCP",-1)),_(l("input",{id:"modbusRtu","onUpdate:modelValue":t[6]||(t[6]=d=>e.protocol=d),type:"radio",class:"btn-check",name:"modbusProtocol",value:"rtu",tabindex:"0",autocomplete:"off"},null,512),[[z,e.protocol]]),t[13]||(t[13]=l("label",{class:"btn btn-outline-primary",for:"modbusRtu"},"RTU",-1))])]),_:1},8,["help"])):b("",!0)])):(a(),c("div",bo,[u(r,{id:"modbusDevice",label:"Device name",help:"Example: /dev/ttyUSB0"},{default:h(()=>[u(p,{id:"modbusDevice",property:"device",type:"String",class:"me-2",required:"","model-value":e.device,onChange:t[7]||(t[7]=d=>e.$emit("update:device",d.target.value))},null,8,["model-value"])]),_:1}),u(r,{id:"modbusBaudrate",label:"Baudrate"},{default:h(()=>[u(p,{id:"modbusBaudrate",property:"baudrate",type:"Choice",class:"me-2 w-50",choice:e.baudrateOptions,required:"","model-value":e.baudrate||e.defaultBaudrate,onChange:t[8]||(t[8]=d=>e.$emit("update:baudrate",d.target.value))},null,8,["choice","model-value"])]),_:1}),u(r,{id:"modbusComset",label:"ComSet"},{default:h(()=>[u(p,{id:"modbusComset",property:"comset",type:"Choice",class:"me-2 w-50",choice:e.comsetOptions,required:"","model-value":e.comset||e.defaultComset||"8N1",onChange:t[9]||(t[9]=d=>e.$emit("update:comset",d.target.value))},null,8,["choice","model-value"])]),_:1})]))],64)}const vt=T(ho,[["render",yo]]),wo={name:"SponsorTokenRequired",methods:{openModal(){H.getOrCreateInstance(document.getElementById("sponsorModal")).show()}}},Mo={class:"alert alert-warning my-4"};function ko(e,t,n,i,s,o){return a(),c("div",Mo,[N(f(e.$t("config.sponsor.tokenRequired"))+" ",1),l("a",{href:"#",role:"button",class:"text-warning",onClick:t[0]||(t[0]=S((...r)=>o.openModal&&o.openModal(...r),["prevent"]))},f(e.$t("config.sponsor.tokenRequiredLearnMore")),1)])}const Co=T(wo,[["render",ko]]),He={type:"template"};function ze(e){return new Promise(t=>setTimeout(t,e))}const _o=["modbus"],To={name:"ChargerModal",components:{FormRow:L,PropertyEntry:Oe,GenericModal:Y,Modbus:vt,TestResult:Ne,PropertyCollapsible:me,Markdown:ue,SponsorTokenRequired:Co},mixins:[Ue],props:{id:Number,name:String,fade:String,isSponsor:Boolean},emits:["added","updated","removed","close"],data(){return{isModalVisible:!1,templates:[],products:[],templateName:null,template:null,saving:!1,selectedType:null,loadingTemplate:!1,values:{...He}}},computed:{modalTitle(){return this.isNew?this.$t("config.charger.titleAdd"):this.$t("config.charger.titleEdit")},chargerOptions(){return this.products.filter(e=>!e.group)},genericOptions(){return this.products.filter(e=>e.group==="generic")},switchSocketOptions(){return this.products.filter(e=>e.group==="switchsockets")},templateParams(){var t;return(((t=this.template)==null?void 0:t.Params)||[]).filter(n=>!_o.includes(n.Name))},normalParams(){return this.templateParams.filter(e=>!e.Advanced)},advancedParams(){return this.templateParams.filter(e=>e.Advanced)},modbus(){var t;return(((t=this.template)==null?void 0:t.Params)||[]).find(n=>n.Name==="modbus")},modbusCapabilities(){var e;return((e=this.modbus)==null?void 0:e.Choice)||[]},ocppUrl(){return this.templateParams.some(t=>t.Name==="connector")&&this.templateParams.some(t=>t.Name==="stationid")?"ws://".concat(window.location.hostname,":8887"):null},modbusDefaults(){const{ID:e,Comset:t,Baudrate:n,Port:i}=this.modbus||{};return{id:e,comset:t,baudrate:n,port:i}},description(){var e,t;return(t=(e=this.template)==null?void 0:e.Requirements)==null?void 0:t.Description},sponsorTokenRequired(){var t,n;return(((n=(t=this.template)==null?void 0:t.Requirements)==null?void 0:n.EVCC)||[]).includes("sponsorship")&&!this.isSponsor},apiData(){return{template:this.templateName,...this.modbusDefaults,...this.values}},isNew(){return this.id===void 0},isDeletable(){return!this.isNew}},watch:{isModalVisible(e){e&&(this.templateName=null,this.reset(),this.loadProducts(),this.id!==void 0&&this.loadConfiguration())},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},methods:{reset(){this.values={...He},this.resetTest()},async loadConfiguration(){try{const e=(await $.get("config/devices/charger/".concat(this.id))).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(e){console.error(e)}},async loadProducts(){var e;if(this.isModalVisible)try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale}};this.products=(await $.get("config/products/charger",t)).data.result}catch(t){console.error(t)}},async loadTemplate(){var e;this.template=null,this.loadingTemplate=!0;try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale,name:this.templateName}},n=await $.get("config/templates/charger",t);this.template=n.data.result,this.applyDefaultsFromTemplate()}catch(t){console.error(t)}this.loadingTemplate=!1},applyDefaultsFromTemplate(){var t;(((t=this.template)==null?void 0:t.Params)||[]).filter(n=>n.Default&&!this.values[n.Name]).forEach(n=>{this.values[n.Name]=n.Default})},async create(){if(this.testUnknown){if(!await this.test(this.testCharger))return;await ze(100)}this.saving=!0;try{const e=await $.post("config/devices/charger",this.apiData),{name:t}=e.data.result;this.$emit("added",t),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testCharger)},async testCharger(){let e="config/test/charger";return this.isNew||(e+="/merge/".concat(this.id)),await $.post(e,this.apiData)},async update(){if(this.testUnknown){if(!await this.test(this.testCharger))return;await ze(250)}this.saving=!0;try{await $.put("config/devices/charger/".concat(this.id),this.apiData),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("update failed")}this.saving=!1},async remove(){try{await $.delete("config/devices/charger/".concat(this.id)),this.$emit("removed",this.name),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("delete failed")}},open(){this.isModalVisible=!0},close(){this.$emit("close"),this.isModalVisible=!1},templateChanged(){this.reset()}}},$o={ref:"form",class:"container mx-0 px-0"},Vo=["disabled"],Po=["label"],So=["value"],qo=["label"],Io=["value"],Oo=["label"],No=["value"],Uo={key:0},Do=["value"],Eo={key:6,class:"my-4 d-flex justify-content-between"},Lo={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal",tabindex:"0"},Ro=["disabled"],Ao={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Fo(e,t,n,i,s,o){const r=g("FormRow"),p=g("SponsorTokenRequired"),d=g("Markdown"),v=g("Modbus"),M=g("PropertyEntry"),C=g("PropertyCollapsible"),y=g("TestResult"),U=g("GenericModal");return a(),w(U,{id:"chargerModal",title:o.modalTitle,"data-testid":"charger-modal",fade:n.fade,onOpen:o.open,onClose:o.close},{default:h(()=>[l("form",$o,[u(r,{id:"chargerTemplate",label:e.$t("config.charger.template")},{default:h(()=>[_(l("select",{id:"chargerTemplate","onUpdate:modelValue":t[0]||(t[0]=m=>s.templateName=m),disabled:!o.isNew,class:"form-select w-100",onChange:t[1]||(t[1]=(...m)=>o.templateChanged&&o.templateChanged(...m))},[t[11]||(t[11]=l("option",{value:""},"---",-1)),l("optgroup",{label:e.$t("config.charger.generic")},[(a(!0),c(P,null,q(o.genericOptions,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,So))),128))],8,Po),l("optgroup",{label:e.$t("config.charger.chargers")},[(a(!0),c(P,null,q(o.chargerOptions,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,Io))),128))],8,qo),l("optgroup",{label:e.$t("config.charger.switchsocket")},[(a(!0),c(P,null,q(o.switchSocketOptions,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,No))),128))],8,Oo)],40,Vo),[[de,s.templateName]])]),_:1},8,["label"]),s.loadingTemplate?(a(),c("p",Uo,"Loading ...")):b("",!0),o.sponsorTokenRequired?(a(),w(p,{key:1})):b("",!0),o.description?(a(),w(d,{key:2,markdown:o.description,class:"my-4"},null,8,["markdown"])):b("",!0),o.ocppUrl?(a(),w(r,{key:3,id:"chargerOcppUrl",label:e.$t("config.charger.ocppLabel"),help:e.$t("config.charger.ocppHelp")},{default:h(()=>[l("input",{type:"text",class:"form-control border",value:o.ocppUrl,readonly:""},null,8,Do)]),_:1},8,["label","help"])):b("",!0),o.modbus?(a(),w(v,{key:4,modbus:s.values.modbus,"onUpdate:modbus":t[2]||(t[2]=m=>s.values.modbus=m),id:s.values.id,"onUpdate:id":t[3]||(t[3]=m=>s.values.id=m),host:s.values.host,"onUpdate:host":t[4]||(t[4]=m=>s.values.host=m),port:s.values.port,"onUpdate:port":t[5]||(t[5]=m=>s.values.port=m),device:s.values.device,"onUpdate:device":t[6]||(t[6]=m=>s.values.device=m),baudrate:s.values.baudrate,"onUpdate:baudrate":t[7]||(t[7]=m=>s.values.baudrate=m),comset:s.values.comset,"onUpdate:comset":t[8]||(t[8]=m=>s.values.comset=m),defaultId:o.modbus.ID,defaultComset:o.modbus.Comset,defaultBaudrate:o.modbus.Baudrate,defaultPort:o.modbus.Port,capabilities:o.modbusCapabilities},null,8,["modbus","id","host","port","device","baudrate","comset","defaultId","defaultComset","defaultBaudrate","defaultPort","capabilities"])):b("",!0),(a(!0),c(P,null,q(o.normalParams,m=>(a(),w(M,G({id:"chargerParam".concat(m.Name),key:m.Name,ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":V=>s.values[m.Name]=V}),null,16,["id","modelValue","onUpdate:modelValue"]))),128)),u(C,null,Se({_:2},[o.advancedParams.length?{name:"advanced",fn:h(()=>[(a(!0),c(P,null,q(o.advancedParams,m=>(a(),w(M,G({id:"chargerParam".concat(m.Name),key:m.Name,ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":V=>s.values[m.Name]=V}),null,16,["id","modelValue","onUpdate:modelValue"]))),128))]),key:"0"}:void 0]),1024),s.templateName?(a(),w(y,{key:5,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:o.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):b("",!0),s.templateName?(a(),c("div",Eo,[o.isDeletable?(a(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[9]||(t[9]=S((...m)=>o.remove&&o.remove(...m),["prevent"]))},f(e.$t("config.general.delete")),1)):(a(),c("button",Lo,f(e.$t("config.general.cancel")),1)),l("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||s.saving||o.sponsorTokenRequired,tabindex:"0",onClick:t[10]||(t[10]=S(m=>o.isNew?o.create():o.update(),["prevent"]))},[s.saving?(a(),c("span",Ao)):b("",!0),N(" "+f(e.testUnknown?e.$t("config.general.validateSave"):e.$t("config.general.save")),1)],8,Ro)])):b("",!0)],512)]),_:1},8,["title","fade","onOpen","onClose"])}const Bo=T(To,[["render",Fo],["__scopeId","data-v-f3f02713"]]),jo={name:"Circuits",mixins:[F]};function xo(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M4 21q-1.25 0-2.125-.875T1 18t.875-2.125T4 15q.225 0 .438.038t.412.087L8.9 9.55q-.425-.525-.663-1.175T8 7q0-1.65 1.175-2.825T12 3t2.825 1.175T16 7q0 .725-.25 1.375t-.675 1.175l4.075 5.575q.2-.05.413-.088T20 15q1.25 0 2.125.875T23 18t-.875 2.125T20 21t-2.125-.875T17 18q0-.475.138-.913t.387-.787l-4.05-5.575q-.125.05-.237.075t-.238.075v4.3q.875.3 1.438 1.075T15 18q0 1.25-.875 2.125T12 21t-2.125-.875T9 18q0-.975.563-1.737T11 15.174v-4.3q-.125-.05-.238-.075t-.237-.075L6.475 16.3q.25.35.388.788T7 18q0 1.25-.875 2.125T4 21m0-2q.425 0 .713-.288T5 18t-.288-.712T4 17t-.712.288T3 18t.288.713T4 19m8 0q.425 0 .713-.288T13 18t-.288-.712T12 17t-.712.288T11 18t.288.713T12 19m8 0q.425 0 .713-.288T21 18t-.288-.712T20 17t-.712.288T19 18t.288.713T20 19M12 9q.825 0 1.413-.587T14 7t-.587-1.412T12 5t-1.412.588T10 7t.588 1.413T12 9"},null,-1)]),4)}const Ho=T(jo,[["render",xo]]);function zo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ye(Object(n),!0).forEach(function(i){zo(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Yo(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Wo(e,t){if(e==null)return{};var n=Yo(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function Go(e,t){return Ko(e)||Jo(e,t)||Qo(e,t)||Zo()}function Ko(e){if(Array.isArray(e))return e}function Jo(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],i=!0,s=!1,o=void 0;try{for(var r=e[Symbol.iterator](),p;!(i=(p=r.next()).done)&&(n.push(p.value),!(t&&n.length===t));i=!0);}catch(d){s=!0,o=d}finally{try{!i&&r.return!=null&&r.return()}finally{if(s)throw o}}return n}}function Qo(e,t){if(e){if(typeof e=="string")return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}}function Ge(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Zo(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Xo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Je(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ke(Object(n),!0).forEach(function(i){Xo(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function es(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduceRight(function(s,o){return o(s)},i)}}function X(e){return function t(){for(var n=this,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return s.length>=e.length?e.apply(this,s):function(){for(var r=arguments.length,p=new Array(r),d=0;d<r;d++)p[d]=arguments[d];return t.apply(n,[].concat(s,p))}}}function ie(e){return{}.toString.call(e).includes("Object")}function ts(e){return!Object.keys(e).length}function ne(e){return typeof e=="function"}function ns(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function os(e,t){return ie(t)||x("changeType"),Object.keys(t).some(function(n){return!ns(e,n)})&&x("changeField"),t}function ss(e){ne(e)||x("selectorType")}function as(e){ne(e)||ie(e)||x("handlerType"),ie(e)&&Object.values(e).some(function(t){return!ne(t)})&&x("handlersType")}function is(e){e||x("initialIsRequired"),ie(e)||x("initialType"),ts(e)&&x("initialContent")}function ls(e,t){throw new Error(e[t]||e.default)}var rs={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},x=X(ls)(rs),ae={changes:os,selector:ss,handler:as,initial:is};function ds(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ae.initial(e),ae.handler(t);var n={current:e},i=X(ms)(n,t),s=X(cs)(n),o=X(ae.changes)(e),r=X(us)(n);function p(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(M){return M};return ae.selector(v),v(n.current)}function d(v){es(i,s,o,r)(v)}return[p,d]}function us(e,t){return ne(t)?t(e.current):t}function cs(e,t){return e.current=Je(Je({},e.current),t),t}function ms(e,t,n){return ne(t)?t(e.current):Object.keys(n).forEach(function(i){var s;return(s=t[i])===null||s===void 0?void 0:s.call(t,e.current[i])}),n}var ps={create:ds},hs={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}};function fs(e){return function t(){for(var n=this,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return s.length>=e.length?e.apply(this,s):function(){for(var r=arguments.length,p=new Array(r),d=0;d<r;d++)p[d]=arguments[d];return t.apply(n,[].concat(s,p))}}}function gs(e){return{}.toString.call(e).includes("Object")}function vs(e){return e||Qe("configIsRequired"),gs(e)||Qe("configType"),e.urls?(bs(),{paths:{vs:e.urls.monacoBase}}):e}function bs(){console.warn(bt.deprecation)}function ys(e,t){throw new Error(e[t]||e.default)}var bt={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},Qe=fs(ys)(bt),ws={config:vs},Ms=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return function(s){return n.reduceRight(function(o,r){return r(o)},s)}};function yt(e,t){return Object.keys(t).forEach(function(n){t[n]instanceof Object&&e[n]&&Object.assign(t[n],yt(e[n],t[n]))}),We(We({},e),t)}var ks={type:"cancelation",msg:"operation is manually canceled"};function we(e){var t=!1,n=new Promise(function(i,s){e.then(function(o){return t?s(ks):i(o)}),e.catch(s)});return n.cancel=function(){return t=!0},n}var Cs=ps.create({config:hs,isInitialized:!1,resolve:null,reject:null,monaco:null}),wt=Go(Cs,2),oe=wt[0],pe=wt[1];function _s(e){var t=ws.config(e),n=t.monaco,i=Wo(t,["monaco"]);pe(function(s){return{config:yt(s.config,i),monaco:n}})}function Ts(){var e=oe(function(t){var n=t.monaco,i=t.isInitialized,s=t.resolve;return{monaco:n,isInitialized:i,resolve:s}});if(!e.isInitialized){if(pe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),we(Me);if(window.monaco&&window.monaco.editor)return Mt(window.monaco),e.resolve(window.monaco),we(Me);Ms($s,Ps)(Ss)}return we(Me)}function $s(e){return document.body.appendChild(e)}function Vs(e){var t=document.createElement("script");return e&&(t.src=e),t}function Ps(e){var t=oe(function(i){var s=i.config,o=i.reject;return{config:s,reject:o}}),n=Vs("".concat(t.config.paths.vs,"/loader.js"));return n.onload=function(){return e()},n.onerror=t.reject,n}function Ss(){var e=oe(function(n){var i=n.config,s=n.resolve,o=n.reject;return{config:i,resolve:s,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(n){Mt(n),e.resolve(n)},function(n){e.reject(n)})}function Mt(e){oe().monaco||pe({monaco:e})}function qs(){return oe(function(e){var t=e.monaco;return t})}var Me=new Promise(function(e,t){return pe({resolve:e,reject:t})}),le={config:_s,init:Ts,__getMonacoInstance:qs},Is=Object.defineProperty,Os=Object.defineProperties,Ns=Object.getOwnPropertyDescriptors,Ze=Object.getOwnPropertySymbols,Us=Object.prototype.hasOwnProperty,Ds=Object.prototype.propertyIsEnumerable,Xe=(e,t,n)=>t in e?Is(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ke=(e,t)=>{for(var n in t||(t={}))Us.call(t,n)&&Xe(e,n,t[n]);if(Ze)for(var n of Ze(t))Ds.call(t,n)&&Xe(e,n,t[n]);return e},Es=(e,t)=>Os(e,Ns(t));const Ce={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function Ls(e,t){const n=Te(()=>{const{width:s,height:o}=e;return Es(ke({},Ce.wrapper),{width:s,height:o})}),i=Te(()=>ke(ke({},Ce.fullWidth),!t.value&&Ce.hide));return{wrapperStyle:n,containerStyle:i}}function Rs(){const e=qe(le.__getMonacoInstance()),t=ct(!1);let n;return mt(()=>{e.value||(n=le.init(),n.then(s=>e.value=s).catch(s=>{(s==null?void 0:s.type)!=="cancelation"&&(t.value=!0,console.error("Monaco initialization error:",s))}))}),{monacoRef:e,unload:()=>n==null?void 0:n.cancel(),isLoadFailed:t}}function et(e){return typeof e=="function"?e():e}function Ve(e){return e===void 0}function kt(e,t,n,i){return As(e,i)||Fs(e,t,n,i)}function As(e,t){return e.editor.getModel(Ct(e,t))}function Fs(e,t,n,i){return e.editor.createModel(t,n,i?Ct(e,i):void 0)}function Ct(e,t){return e.Uri.parse(t)}var Bs=Object.defineProperty,tt=Object.getOwnPropertySymbols,js=Object.prototype.hasOwnProperty,xs=Object.prototype.propertyIsEnumerable,nt=(e,t,n)=>t in e?Bs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hs=(e,t)=>{for(var n in t||(t={}))js.call(t,n)&&nt(e,n,t[n]);if(tt)for(var n of tt(t))xs.call(t,n)&&nt(e,n,t[n]);return e};const zs={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var Ys=ut({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const n=new Map,i=qe(null),{monacoRef:s,unload:o,isLoadFailed:r}=Rs(),{editorRef:p}=Ws(t,e,s,i),{disposeValidator:d}=Gs(t,e,s,p),v=Te(()=>!!s.value&&!!p.value),{wrapperStyle:M,containerStyle:C}=Ls(e,v);return jt(()=>{var y,U;(y=d.value)==null||y.call(d),p.value?((U=p.value.getModel())==null||U.dispose(),p.value.dispose()):o()}),ee([()=>e.path,()=>e.value,()=>e.language,()=>e.line],([y,U,m,V],[B,De,he,fe])=>{if(v.value){if(y!==B){const ge=kt(s.value,U||e.defaultValue||"",m||e.defaultLanguage||"",y||e.defaultPath||"");e.saveViewState&&n.set(B,p.value.saveViewState()),p.value.setModel(ge),e.saveViewState&&p.value.restoreViewState(n.get(y)),Ve(V)||p.value.revealLine(V);return}p.value.getValue()!==U&&p.value.setValue(U),m!==he&&s.value.editor.setModelLanguage(p.value.getModel(),m),!Ve(V)&&V!==fe&&p.value.revealLine(V)}}),ee(()=>e.options,y=>p.value&&p.value.updateOptions(y),{deep:!0}),ee(()=>e.theme,y=>s.value&&s.value.editor.setTheme(y)),{containerRef:i,isEditorReady:v,isLoadFailed:r,wrapperStyle:M,containerStyle:C}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:n,wrapperStyle:i,containerStyle:s,className:o}=this;return ve("div",{style:i},[!t&&ve("div",{style:zs},n?e.failure?et(e.failure):"load failed":e.default?et(e.default):"loading..."),ve("div",{ref:"containerRef",key:"monaco_editor_container",style:s,class:o})])}});function Ws({emit:e},t,n,i){const s=qe(null);mt(()=>{const r=ee(n,()=>{i.value&&n.value&&(pt(()=>r()),o())},{immediate:!0})});function o(){var r;if(!i.value||!n.value||s.value)return;e("beforeMount",n.value);const p=t.path||t.defaultPath,d=kt(n.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",p||"");s.value=n.value.editor.create(i.value,Hs({model:d,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),(r=s.value)==null||r.onDidChangeModelContent(v=>{const M=s.value.getValue();M!==t.value&&(e("update:value",M),e("change",M,v))}),s.value&&!Ve(t.line)&&s.value.revealLine(t.line),e("mount",s.value,n.value)}return{editorRef:s}}function Gs({emit:e},t,n,i){const s=ct(null),o=ee([n,i],()=>{if(n.value&&i.value){pt(()=>o());const r=n.value.editor.onDidChangeMarkers(p=>{var d,v;const M=(v=(d=i.value)==null?void 0:d.getModel())==null?void 0:v.uri;if(M&&p.find(y=>y.path===M.path)){const y=n.value.editor.getModelMarkers({resource:M});e("validate",y)}});s.value=()=>r==null?void 0:r.dispose()}});return{disposeValidator:s}}function _t(e,t){var p;if(!t)return e;const n=[],i=t+":",s=e.split("\n");for(;s[0].startsWith("#");)s.shift();const[o,...r]=s;if(o.startsWith(i)){const d=o.slice(i.length).trim();d&&n.push(d)}else return e;if(r.length>0){const d=((p=r[0].match(/^(\s+)/))==null?void 0:p[0])||"";r.map(v=>v.startsWith(d)?v.slice(d.length):v).map(v=>v.trimEnd()).forEach(v=>n.push(v))}return n.join("\n")}const _e=document.querySelector("html"),Ks={name:"YamlEditor",components:{VueMonacoEditor:Ys},props:{modelValue:String,errorLine:Number,removeKey:String,disabled:Boolean},emits:["update:modelValue"],data(){return{theme:"vs",defaultOptions:{automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,minimap:{enabled:!1},showFoldingControls:"always",scrollBeyondLastLine:!1,wordWrap:"off",wrappingStrategy:"advanced",overviewRulerLanes:0},active:!0,pasteDisposable:null}},computed:{options(){return{...this.defaultOptions,readOnly:this.disabled}},lines(){return(this.modelValue||"").split("\n").length}},watch:{errorLine(){this.active=!1,this.$nextTick(()=>this.active=!0)}},mounted(){this.updateTheme(),_e.addEventListener("themechange",this.updateTheme)},beforeMount(){le.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.50.0/min/vs"}}),le.init()},unmounted(){var e;_e.removeEventListener("themechange",this.updateTheme),(e=this.pasteDisposable)==null||e.dispose()},methods:{updateTheme(){this.theme=_e.classList.contains("dark")?"vs-dark":"vs"},ready(e,t){const n=e.onDidPaste(async()=>{if(!this.removeKey)return;await this.$nextTick();const o=e.getModel(),r=_t(o.getValue(),this.removeKey);o.setValue(r)});this.pasteDisposable=n;let i=null;const s=()=>{i==null||i.clear(),this.errorLine&&(i=e.createDecorationsCollection([{range:new t.Range(this.errorLine,1,this.errorLine,1),options:{isWholeLine:!0,className:"error",lineNumberClassName:"error",marginClassName:"error"}}]))};e.onDidChangeModelContent(()=>s()),s()}}},Js=["rows","value","disabled"];function Qs(e,t,n,i,s,o){const r=g("VueMonacoEditor");return s.active?(a(),w(r,{key:0,ref:"editor",class:"editor",language:"yaml",theme:s.theme,options:o.options,value:n.modelValue,"onUpdate:value":t[1]||(t[1]=p=>e.$emit("update:modelValue",p)),onMount:o.ready},{default:h(()=>[N(f(e.$t("config.editor.loading")),1)]),failure:h(()=>[l("textarea",{class:"form-control",rows:o.lines,value:n.modelValue,disabled:n.disabled,onInput:t[0]||(t[0]=p=>e.$emit("update:modelValue",p.target.value))},null,40,Js)]),_:1},8,["theme","options","value","onMount"])):b("",!0)}const Zs=T(Ks,[["render",Qs],["__scopeId","data-v-158c9e5a"]]),Xs={name:"YamlModal",components:{GenericModal:Y,YamlEditor:Zs},props:{title:String,description:String,docs:String,endpoint:String,defaultYaml:String,removeKey:String,size:{type:String,default:"xl"}},emits:["changed"],data(){return{saving:!1,error:"",errorLine:void 0,yaml:"",serverYaml:""}},computed:{docsLink(){return"".concat(re()).concat(this.docs)},height(){return Math.max(150,this.yaml.split("\n").length*18)+22+"px"},nothingChanged(){return this.yaml===this.serverYaml&&this.yaml!==""}},methods:{reset(){this.yaml="",this.serverYaml="",this.error="",this.saving=!1,this.errorLine=void 0},async open(){this.reset(),await this.load()},async load(){try{const{data:e}=await $.get(this.endpoint);this.serverYaml=e.result,this.yaml=e.result||this.defaultYaml}catch(e){console.error(e)}},async save(){this.saving=!0,this.error="",this.errorLine=void 0;try{const e=this.yaml===this.defaultYaml?"":this.yaml,t=await $.post(this.endpoint,e,{validateStatus:n=>[200,400].includes(n)});t.status===200&&(this.$emit("changed"),this.$refs.modal.close()),t.status===400&&(this.error=t.data.error,this.errorLine=t.data.line)}catch(e){console.error(e)}this.saving=!1}}},ea={key:0},ta={key:0},na=["href"],oa={key:1,class:"text-danger","data-testid":"error"},sa={ref:"form",class:"container mx-0 px-0"},aa={class:"mt-4 d-flex justify-content-between"},ia={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},la=["disabled"],ra={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function da(e,t,n,i,s,o){const r=g("YamlEditor"),p=g("GenericModal");return a(),w(p,{ref:"modal",size:n.size,title:n.title,onOpen:o.open},{default:h(()=>[n.description||o.docsLink?(a(),c("p",ea,[n.description?(a(),c("span",ta,f(n.description+" "),1)):b("",!0),o.docsLink?(a(),c("a",{key:1,href:o.docsLink,target:"_blank"},f(e.$t("config.general.docsLink")),9,na)):b("",!0)])):b("",!0),s.error?(a(),c("p",oa,f(s.error),1)):b("",!0),l("form",sa,[l("div",{class:"editor-container",style:A({height:o.height})},[u(r,{modelValue:s.yaml,"onUpdate:modelValue":t[0]||(t[0]=d=>s.yaml=d),class:"editor",errorLine:s.errorLine,removeKey:n.removeKey},null,8,["modelValue","errorLine","removeKey"])],4),l("div",aa,[l("button",ia,f(e.$t("config.general.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:s.saving||o.nothingChanged,onClick:t[1]||(t[1]=S((...d)=>o.save&&o.save(...d),["prevent"]))},[s.saving?(a(),c("span",ra)):b("",!0),N(" "+f(e.$t("config.general.save")),1)],8,la)])],512)]),_:1},8,["size","title","onOpen"])}const J=T(Xs,[["render",da],["__scopeId","data-v-01f84cbd"]]),ua="#- name: main # unique name, used as reference, e.g. as parent in other circuits\n#  title: Main Circuit # used in the UI\n#  maxcurrent: 63 # 63A main circuit breaker (optional)\n#  maxPower: 30000 # 30kW (optional)\n#  meter: grid # associated meter to monitor the power consumption (optional)\n#  parent: # no parent, this is the root circuit\n#- name: garage # unique name, used as reference, e.g. to associate loadpoints\n#  title: Garage # used in the UI\n#  maxcurrent: 24 # allow individual phase use up to 24A\n#  maxPower: 11000 # limit total power to 11kW\n#  meter: garage # dedicated meter for the garage\n#  parent: main # parent to the main circuit\n#- name: carport # unique name, used as reference, e.g. to associate loadpoints\n#  title: Carport # used in the UI\n#  maxCurrent: 32 # 32A circuit breaker\n#  maxPower: # no limit, only check current\n#  meter: # no meter, using data from loadpoints\n#  parent: main # parent to the main circuit\n",ca={name:"CircuitsModal",components:{YamlModal:J},emits:["changed"],data(){return{defaultYaml:ua.trim()}}};function ma(e,t,n,i,s,o){const r=g("YamlModal");return a(),w(r,{id:"circuitsModal",title:e.$t("config.circuits.title"),description:e.$t("config.circuits.description"),docs:"/docs/features/loadmanagement",defaultYaml:s.defaultYaml,removeKey:"circuits",endpoint:"/config/circuits",onChanged:t[0]||(t[0]=p=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const pa=T(ca,[["render",ma]]),ha={name:"ControlModal",components:{FormRow:L,GenericModal:Y},emits:["changed"],data(){return{saving:!1,error:"",values:{},serverValues:{}}},computed:{intervalChanged(){return this.values.interval!==this.serverValues.interval},residualPowerChanged(){return this.values.residualPower!==this.serverValues.residualPower},nothingChanged(){return!this.intervalChanged&&!this.residualPowerChanged}},methods:{reset(){var n;const{interval:e,residualPower:t}=((n=I)==null?void 0:n.state)||{};this.saving=!1,this.error="",this.values={interval:e,residualPower:t},this.serverValues={...this.values}},async open(){this.reset()},async saveValue(e){let t="";e==="interval"?t="/config/interval/".concat(encodeURIComponent(this.values.interval)):e==="residualPower"&&(t="/residualpower/".concat(encodeURIComponent(this.values.residualPower))),await $.post(t)},async save(){this.saving=!0,this.error="";try{this.intervalChanged&&await this.saveValue("interval"),this.residualPowerChanged&&await this.saveValue("residualPower"),this.$emit("changed"),this.$refs.modal.close()}catch(e){this.error=e.message}this.saving=!1}}},fa={key:0,class:"text-danger"},ga={class:"input-group w-50 w-sm-25"},va={class:"input-group w-50 w-sm-25"},ba={class:"mt-4 d-flex justify-content-between gap-2 flex-column flex-sm-row"},ya={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},wa=["disabled"],Ma={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function ka(e,t,n,i,s,o){const r=g("FormRow"),p=g("GenericModal");return a(),w(p,{id:"controlModal",ref:"modal",title:e.$t("config.control.title"),"data-testid":"control-modal",onOpen:o.open},{default:h(()=>[l("p",null,f(e.$t("config.control.description")),1),s.error?(a(),c("p",fa,f(s.error),1)):b("",!0),l("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[2]||(t[2]=S((...d)=>o.save&&o.save(...d),["prevent"]))},[u(r,{id:"controlInterval",label:e.$t("config.control.labelInterval"),help:e.$t("config.control.descriptionInterval"),example:"30 s",docsLink:"/docs/reference/configuration/interval"},{default:h(()=>[l("div",ga,[_(l("input",{id:"controlInterval","onUpdate:modelValue":t[0]||(t[0]=d=>s.values.interval=d),type:"number",step:"1",min:"1",required:"","aria-describedby":"controlIntervalUnit",class:"form-control text-end"},null,512),[[O,s.values.interval]]),t[3]||(t[3]=l("span",{id:"controlIntervalUnit",class:"input-group-text"},"s",-1))])]),_:1},8,["label","help"]),u(r,{id:"controlResidualPower",label:e.$t("config.control.labelResidualPower"),help:e.$t("config.control.descriptionResidualPower"),example:"100 W",docsLink:"/docs/reference/configuration/site#residualpower"},{default:h(()=>[l("div",va,[_(l("input",{id:"controlResidualPower","onUpdate:modelValue":t[1]||(t[1]=d=>s.values.residualPower=d),type:"number",step:"1",required:"","aria-describedby":"controlResidualPowerUnit",class:"form-control text-end"},null,512),[[O,s.values.residualPower]]),t[4]||(t[4]=l("span",{id:"controlResidualPowerUnit",class:"input-group-text"},"W",-1))])]),_:1},8,["label","help"]),l("div",ba,[l("button",ya,f(e.$t("config.general.cancel")),1),l("button",{type:"submit",class:"btn btn-primary order-1 order-sm-2 flex-grow-1 flex-sm-grow-0 px-4",disabled:s.saving||o.nothingChanged},[s.saving?(a(),c("span",Ma)):b("",!0),N(" "+f(e.$t("config.general.save")),1)],8,wa)])],544)]),_:1},8,["title","onOpen"])}const Ca=T(ha,[["render",ka],["__scopeId","data-v-c72e310b"]]);var _a='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M6 44l9-4 9 4 9-4 9 4V4H6v40zm4-36h28v29.845l-3.375-1.5L33 35.623l-1.625.722L24 39.623l-7.375-3.278L15 35.623l-1.625.722-3.375 1.5V8z"/><path d="M14 12h20v4H14zM14 20h20v4H14zM14 28h12v4H14z"/></svg>';class Ta extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=_a}}window.customElements.define("shopicon-regular-invoice",Ta);const $a={name:"DeviceCard",props:{name:String,title:String,editable:Boolean,error:Boolean},emits:["edit"],data(){return{tooltip:null}},computed:{tooltipTitle(){if(!this.name)return"";let e="".concat(this.$t("config.main.name"),": <span class='font-monospace'>").concat(this.name,"</span>");return this.editable||(e+='<div class="mt-1">'.concat(this.$t("config.main.yaml"),"</div>")),'<div class="text-start">'.concat(e,"</div>")}},watch:{tooltipTitle(){this.initTooltip()}},mounted(){this.initTooltip()},methods:{edit(){var e;this.editable&&((e=this.tooltip)==null||e.hide(),this.$emit("edit"))},initTooltip(){this.$nextTick(()=>{var e;(e=this.tooltip)==null||e.dispose(),this.$refs.tooltip&&(this.tooltip=new Wt(this.$refs.tooltip))})}}},Va={class:"d-flex align-items-center mb-2"},Pa={class:"icon me-2"},Sa=["title"],qa=["title","aria-label","disabled"];function Ia(e,t,n,i,s,o){return a(),c("li",{class:E(["root round-box",{"round-box--error":n.error}])},[l("div",Va,[l("div",Pa,[W(e.$slots,"icon",{},void 0,!0)]),l("strong",{class:"flex-grow-1 text-nowrap text-truncate","data-bs-toggle":"tooltip",title:n.name},f(n.title),9,Sa),l("button",{ref:"tooltip",type:"button",class:E(["btn btn-sm btn-outline-secondary position-relative border-0 p-2",{"opacity-25":!n.editable}]),"data-bs-toggle":"tooltip","data-bs-html":"true",title:o.tooltipTitle,"aria-label":n.editable?e.$t("config.main.edit"):null,disabled:!n.editable,onClick:t[0]||(t[0]=(...r)=>o.edit&&o.edit(...r))},t[1]||(t[1]=[l("shopicon-regular-adjust",{size:"s"},null,-1)]),10,qa)]),t[2]||(t[2]=l("hr",{class:"my-3 divide"},null,-1)),W(e.$slots,"tags",{},void 0,!0)],2)}const Oa=T($a,[["render",Ia],["__scopeId","data-v-2cb3110d"]]),Na={name:"Eebus",mixins:[F]};function Ua(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 32 32"},t[0]||(t[0]=[l("path",{d:"M15.998,8.095c1.369,-0 2.669,0.219 3.902,0.657c1.232,0.438 2.349,1.04 3.352,1.807c0.365,0.273 0.553,0.634 0.562,1.081c0.01,0.448 -0.15,0.835 -0.48,1.163c-0.31,0.31 -0.693,0.47 -1.149,0.48c-0.456,0.009 -0.867,-0.114 -1.232,-0.37c-0.693,-0.475 -1.46,-0.849 -2.299,-1.123c-0.84,-0.273 -1.725,-0.41 -2.656,-0.41c-0.93,-0 -1.815,0.137 -2.655,0.41c-0.839,0.274 -1.606,0.648 -2.299,1.123c-0.365,0.255 -0.776,0.374 -1.232,0.356c-0.456,-0.019 -0.84,-0.183 -1.15,-0.493c-0.31,-0.329 -0.465,-0.716 -0.465,-1.163c-0,-0.447 0.182,-0.807 0.547,-1.082c1.004,-0.766 2.122,-1.364 3.354,-1.793c1.232,-0.43 2.532,-0.644 3.9,-0.643m0,-6.57c2.281,0 4.43,0.374 6.447,1.123c2.017,0.748 3.828,1.806 5.433,3.175c0.365,0.31 0.557,0.693 0.575,1.15c0.019,0.456 -0.137,0.848 -0.465,1.177c-0.31,0.31 -0.693,0.47 -1.15,0.479c-0.456,0.01 -0.867,-0.132 -1.232,-0.425c-1.313,-1.076 -2.787,-1.911 -4.42,-2.504c-1.633,-0.592 -3.362,-0.889 -5.188,-0.89c-1.825,-0.001 -3.554,0.296 -5.186,0.89c-1.633,0.595 -3.106,1.429 -4.422,2.504c-0.365,0.292 -0.775,0.434 -1.232,0.425c-0.456,-0.008 -0.839,-0.168 -1.149,-0.479c-0.329,-0.329 -0.484,-0.721 -0.466,-1.177c0.019,-0.457 0.21,-0.84 0.575,-1.15c1.606,-1.369 3.418,-2.427 5.434,-3.175c2.017,-0.749 4.166,-1.123 6.446,-1.123",fill:"currentColor"},null,-1),l("path",{d:"M15.992,23.961c-1.368,0 -2.669,-0.219 -3.901,-0.657c-1.232,-0.437 -2.35,-1.04 -3.353,-1.806c-0.365,-0.274 -0.552,-0.635 -0.561,-1.082c-0.01,-0.447 0.15,-0.835 0.479,-1.163c0.31,-0.31 0.694,-0.47 1.15,-0.479c0.456,-0.01 0.867,0.113 1.232,0.37c0.693,0.474 1.46,0.848 2.299,1.122c0.84,0.274 1.725,0.411 2.655,0.411c0.931,-0 1.816,-0.137 2.656,-0.411c0.839,-0.274 1.605,-0.648 2.299,-1.122c0.365,-0.256 0.776,-0.374 1.232,-0.356c0.456,0.018 0.839,0.182 1.149,0.493c0.311,0.328 0.466,0.716 0.466,1.162c-0,0.447 -0.183,0.808 -0.548,1.082c-1.003,0.767 -2.121,1.365 -3.353,1.794c-1.233,0.429 -2.533,0.643 -3.901,0.642m0,6.57c-2.281,0 -4.43,-0.374 -6.447,-1.122c-2.017,-0.748 -3.828,-1.807 -5.433,-3.176c-0.365,-0.31 -0.556,-0.693 -0.575,-1.149c-0.018,-0.456 0.137,-0.849 0.466,-1.177c0.31,-0.311 0.693,-0.47 1.149,-0.48c0.457,-0.009 0.867,0.132 1.232,0.425c1.314,1.077 2.788,1.911 4.421,2.504c1.632,0.593 3.362,0.89 5.187,0.89c1.826,0.001 3.555,-0.296 5.187,-0.89c1.632,-0.594 3.106,-1.429 4.421,-2.504c0.365,-0.292 0.776,-0.434 1.232,-0.425c0.456,0.009 0.84,0.169 1.15,0.48c0.328,0.328 0.484,0.721 0.465,1.177c-0.018,0.456 -0.21,0.839 -0.575,1.149c-1.605,1.369 -3.417,2.428 -5.434,3.176c-2.017,0.748 -4.165,1.122 -6.446,1.122",fill:"currentColor"},null,-1)]),4)}const Da=T(Na,[["render",Ua]]),Ea="#shipid: EVCC-1234567890abcdef\n#interfaces:\n#  - eth0\n#certificate:\n#  public: |\n#    -----BEGIN CERTIFICATE-----\n#    1234567890abcdef==\n#    -----END CERTIFICATE-----\n#  private: |\n#    -----BEGIN EC PRIVATE KEY-----\n#    1234567890abcdef\n#    -----END EC PRIVATE KEY-----\n",La={name:"EebusModal",components:{YamlModal:J},emits:["changed"],data(){return{defaultYaml:Ea.trim()}}};function Ra(e,t,n,i,s,o){const r=g("YamlModal");return a(),w(r,{id:"eebusModal",title:e.$t("config.eebus.title"),description:e.$t("config.eebus.description"),docs:"/docs/reference/configuration/eebus",defaultYaml:s.defaultYaml,removeKey:"eebus",endpoint:"/config/eebus",onChanged:t[0]||(t[0]=p=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Aa=T(La,[["render",Ra]]),Fa={name:"JsonModal",components:{GenericModal:Y},props:{title:String,description:String,errorMessage:String,docs:String,endpoint:String,disableRemove:Boolean,noButtons:Boolean,transformReadValues:Function,stateKey:String,saveMethod:{type:String,default:"post"}},emits:["changed","open"],data(){return{saving:!1,removing:!1,error:"",values:{},serverValues:{}}},computed:{docsLink(){return this.docs?"".concat(re()).concat(this.docs):null},nothingChanged(){return JSON.stringify(this.values)===JSON.stringify(this.serverValues)}},methods:{reset(){this.saving=!1,this.deleting=!1,this.error="",this.values="",this.serverValues=""},async open(){this.$emit("open"),this.reset(),await this.load()},async load(){this.serverValues=this.stateKey?I.state[this.stateKey]:I.state,this.transformReadValues&&(this.serverValues=this.transformReadValues(this.serverValues)),this.values={...this.serverValues}},async save(){this.saving=!0,this.error="";try{const e=await $[this.saveMethod](this.endpoint,this.values,{validateStatus:t=>[200,202,400].includes(t)});(e.status===200||e.status===202)&&(this.$emit("changed"),this.$refs.modal.close()),e.status===400&&(this.error=e.data.error)}catch(e){console.error(e)}this.saving=!1},async remove(){this.removing=!0,this.error="";try{const e=await $.delete(this.endpoint,{validateStatus:t=>[200,400].includes(t)});e.status===200&&(this.$emit("changed"),this.$refs.modal.close()),e.status===400&&(this.error=e.data.error)}catch(e){console.error(e)}this.removing=!1}}},Ba={key:0},ja={key:0},xa=["href"],Ha={key:1,class:"text-danger"},za={key:0,class:"d-block"},Ya={key:0,class:"mt-4 d-flex justify-content-between gap-2 flex-column flex-sm-row"},Wa={class:"d-flex justify-content-between order-2 order-sm-1 gap-2 flex-grow-1 flex-sm-grow-0"},Ga={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},Ka=["disabled"],Ja={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Qa=["disabled"],Za={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Xa(e,t,n,i,s,o){const r=g("GenericModal");return a(),w(r,{ref:"modal",title:n.title,onOpen:o.open},{default:h(()=>[n.description||o.docsLink?(a(),c("p",Ba,[n.description?(a(),c("span",ja,f(n.description+" "),1)):b("",!0),o.docsLink?(a(),c("a",{key:1,href:o.docsLink,target:"_blank"},f(e.$t("config.general.docsLink")),9,xa)):b("",!0)])):b("",!0),s.error?(a(),c("p",Ha,[n.errorMessage?(a(),c("span",za,f(n.errorMessage),1)):b("",!0),N(" "+f(s.error),1)])):b("",!0),l("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[1]||(t[1]=S((...p)=>o.save&&o.save(...p),["prevent"]))},[W(e.$slots,"default",{values:s.values},void 0,!0),n.noButtons?b("",!0):(a(),c("div",Ya,[l("div",Wa,[l("button",Ga,f(e.$t("config.general.cancel")),1),n.disableRemove?b("",!0):(a(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",disabled:s.removing,onClick:t[0]||(t[0]=(...p)=>o.remove&&o.remove(...p))},[s.removing?(a(),c("span",Ja)):b("",!0),N(" "+f(e.$t("config.general.remove")),1)],8,Ka))]),l("button",{type:"submit",class:"btn btn-primary order-1 order-sm-2 flex-grow-1 flex-sm-grow-0 px-4",disabled:s.saving||o.nothingChanged},[s.saving?(a(),c("span",Za)):b("",!0),N(" "+f(e.$t("config.general.save")),1)],8,Qa)]))],544)]),_:3},8,["title","onOpen"])}const se=T(Fa,[["render",Xa],["__scopeId","data-v-79654f92"]]),ei={name:"TitleModal",components:{FormRow:L,JsonModal:se},emits:["changed"],methods:{transformReadValues(e){return{title:e}}}},ti=["onUpdate:modelValue"];function ni(e,t,n,i,s,o){const r=g("FormRow"),p=g("JsonModal");return a(),w(p,{id:"titleModal",title:e.$t("config.title.title"),endpoint:"/config/site","state-key":"siteTitle","save-method":"put","transform-read-values":o.transformReadValues,"data-testid":"title-modal","disable-remove":"",onChanged:t[0]||(t[0]=d=>e.$emit("changed"))},{default:h(({values:d})=>[u(r,{id:"siteTitle",label:e.$t("config.title.label"),help:e.$t("config.title.description")},{default:h(()=>[_(l("input",{id:"siteTitle","onUpdate:modelValue":v=>d.title=v,class:"form-control"},null,8,ti),[[O,d.title]])]),_:2},1032,["label","help"])]),_:1},8,["title","transform-read-values"])}const oi=T(ei,[["render",ni]]),si={name:"Edit",mixins:[F]};function ai(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M5 19h1.425L16.2 9.225L14.775 7.8L5 17.575zm-1 2q-.425 0-.712-.288T3 20v-2.425q0-.4.15-.763t.425-.637L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.437.65T21 6.4q0 .4-.138.763t-.437.662l-12.6 12.6q-.275.275-.638.425t-.762.15zM19 6.4L17.6 5zm-3.525 2.125l-.7-.725L16.2 9.225z"},null,-1)]),4)}const Tt=T(si,[["render",ai]]),ii={name:"GeneralConfig",components:{TitleModal:oi,EditIcon:Tt},mixins:[K],emits:["site-changed"],data(){return{title:""}},computed:{telemetryEnabled(){return Le.telemetry===!0},hiddenFeatures(){return Le.hiddenFeatures===!0},networkStatus(){var n;const{host:e,port:t}=((n=I.state)==null?void 0:n.network)||{};return e?"".concat(e,":").concat(t):"".concat(t||"")},controlStatus(){var t;const e=(t=I.state)==null?void 0:t.interval;return e?this.fmtDuration(e):""},sponsorStatus(){var s;const e=((s=I.state)==null?void 0:s.sponsor)||{},{name:t,expiresSoon:n}=e;let i="";return t&&(i=n?"text-warning":"text-primary"),{name:t,expiresSoon:n,cssClass:i}}},async mounted(){await this.load()},methods:{async changed(){this.$emit("site-changed"),this.load()},async load(){try{const e=await $.get("/config/site",{validateStatus:t=>[200,404].includes(t)});e.status===200?this.title=e.data.result.title:console.log("TODO: implement site endpoint in config error mode")}catch(e){console.error(e)}},todo(){alert("not implemented")},openModal(e){const t=document.getElementById(e);t?H.getOrCreateInstance(t).show():console.error("modal ".concat(e," not found"))}}},li={class:"group round-box p-4"},ri={class:"config-entry","data-testid":"generalconfig-title"},di={class:"config-label"},ui={class:"config-text"},ci=["title"],mi={class:"config-entry","data-testid":"generalconfig-password"},pi={class:"config-label"},hi=["title"],fi={class:"config-entry","data-testid":"generalconfig-telemetry"},gi={class:"config-label"},vi={class:"config-text"},bi=["title"],yi={class:"config-entry","data-testid":"generalconfig-experimental"},wi={class:"config-label"},Mi={class:"config-text"},ki=["title"],Ci={key:0,class:"config-entry","data-testid":"generalconfig-sponsoring"},_i={class:"config-label"},Ti={key:0,class:"d-inline-block me-1 p-1 rounded-circle bg-warning rounded-circle"},$i=["title"],Vi={key:1,class:"config-entry","data-testid":"generalconfig-network"},Pi={class:"config-label"},Si={class:"config-text"},qi=["title"],Ii={key:2,class:"config-entry","data-testid":"generalconfig-control"},Oi={class:"config-label"},Ni={class:"config-text"},Ui=["title"];function Di(e,t,n,i,s,o){const r=g("EditIcon"),p=g("TitleModal");return a(),c("div",li,[l("div",ri,[l("strong",di,f(e.$t("config.general.title")),1),l("div",ui,f(s.title||"---"),1),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[0]||(t[0]=S(d=>o.openModal("titleModal"),["prevent"]))},[u(r,{size:"xs"}),u(p,{ref:"titleModal",onChanged:o.load},null,8,["onChanged"])],8,ci)]),l("div",mi,[l("strong",pi,f(e.$t("config.general.password")),1),t[7]||(t[7]=l("div",{class:"config-text"},"*******",-1)),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[1]||(t[1]=S(d=>o.openModal("passwordModal"),["prevent"]))},[u(r,{size:"xs"})],8,hi)]),l("div",fi,[l("strong",gi,f(e.$t("config.general.telemetry")),1),l("div",vi,f(e.$t("config.general.".concat(o.telemetryEnabled?"on":"off"))),1),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[2]||(t[2]=S(d=>o.openModal("globalSettingsModal"),["prevent"]))},[u(r,{size:"xs"})],8,bi)]),l("div",yi,[l("strong",wi,f(e.$t("config.general.experimental")),1),l("div",Mi,f(e.$t("config.general.".concat(o.hiddenFeatures?"on":"off"))),1),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[3]||(t[3]=S(d=>o.openModal("globalSettingsModal"),["prevent"]))},[u(r,{size:"xs"})],8,ki)]),e.$hiddenFeatures()?(a(),c("div",Ci,[l("strong",_i,f(e.$t("config.sponsor.title"))+" 🧪",1),l("div",{class:E(["config-text",o.sponsorStatus.cssClass])},[o.sponsorStatus.expiresSoon&&o.sponsorStatus.name?(a(),c("span",Ti)):b("",!0),N(" "+f(o.sponsorStatus.name||"---"),1)],2),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[4]||(t[4]=S(d=>o.openModal("sponsorModal"),["prevent"]))},[u(r,{size:"xs"})],8,$i)])):b("",!0),e.$hiddenFeatures()?(a(),c("div",Vi,[l("strong",Pi,f(e.$t("config.network.title"))+" 🧪",1),l("div",Si,f(o.networkStatus),1),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[5]||(t[5]=S(d=>o.openModal("networkModal"),["prevent"]))},[u(r,{size:"xs"})],8,qi)])):b("",!0),e.$hiddenFeatures()?(a(),c("div",Ii,[l("strong",Oi,f(e.$t("config.control.title"))+" 🧪",1),l("div",Ni,f(o.controlStatus),1),l("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),tabindex:"0",onClick:t[6]||(t[6]=S(d=>o.openModal("controlModal"),["prevent"]))},[u(r,{size:"xs"})],8,Ui)])):b("",!0)])}const Ei=T(ii,[["render",Di],["__scopeId","data-v-8b3deadf"]]),Li={name:"Hems",mixins:[F]};function Ri(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M3 11q0 1.8 1.15 3.175T7.075 15.9l-.775-.775q-.275-.275-.275-.687t.275-.713q.3-.3.713-.3t.712.3L10.3 16.3q.3.3.3.7t-.3.7l-2.6 2.6q-.275.275-.7.275t-.725-.3Q6 20 6 19.6t.275-.7l.9-.95q-2.65-.3-4.412-2.287T1 11q0-2.925 2.038-4.962T8 4h2q.425 0 .713.288T11 5t-.288.713T10 6H8Q5.925 6 4.463 7.463T3 11m11 9q-.425 0-.712-.288T13 19v-5q0-.425.288-.712T14 13h7q.425 0 .713.288T22 14v5q0 .425-.288.713T21 20zm0-9q-.425 0-.712-.288T13 10V5q0-.425.288-.712T14 4h7q.425 0 .713.288T22 5v5q0 .425-.288.713T21 11zm1-2h5V6h-5z"},null,-1)]),4)}const Ai=T(Li,[["render",Ri]]),Fi="#type: sma\n#allowcontrol: false\n#vendorid: AAAAAAAA\n#deviceid: BBBBBBBB\n",Bi={name:"HemsModal",components:{YamlModal:J},emits:["changed"],data(){return{defaultYaml:Fi.trim()}}};function ji(e,t,n,i,s,o){const r=g("YamlModal");return a(),w(r,{id:"hemsModal",title:e.$t("config.hems.title"),description:e.$t("config.hems.description"),docs:"/docs/reference/configuration/hems",defaultYaml:s.defaultYaml,endpoint:"/config/hems",removeKey:"hems",size:"md",onChanged:t[0]||(t[0]=p=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const xi=T(Bi,[["render",ji]]),Hi={name:"Influx",mixins:[F]};function zi(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"m23.778 14.482l-2.287-9.959c-.13-.545-.624-1.09-1.169-1.248L9.87.051C9.74 0 9.584 0 9.426 0c-.443 0-.909.18-1.222.443L.716 7.412C.3 7.776.092 8.504.222 9.024l2.445 10.662c.13.545.624 1.092 1.169 1.248l9.775 3.015c.13.051.285.051.443.051c.443 0 .91-.18 1.223-.443l8.007-7.435c.418-.39.624-1.092.494-1.64M10.962 2.417l7.175 2.21c.285.08.285.21 0 .286l-3.77.858c-.285.08-.674-.05-.883-.26l-2.626-2.834c-.235-.232-.184-.336.104-.26m4.47 12.872c.079.286-.105.444-.39.365l-7.748-2.392c-.285-.079-.338-.313-.13-.52l5.93-5.514c.209-.209.443-.13.52.156zM2.667 8.267l6.293-5.85c.21-.209.545-.18.754.025L12.86 5.85c.209.21.18.545-.026.754l-6.293 5.85c-.21.21-.545.181-.754-.025L2.64 9.024a.536.536 0 0 1 .026-.757zm1.536 9.284L2.54 10.244c-.08-.285.05-.34.234-.13L5.4 12.949c.209.209.285.624.209.909L4.462 17.55c-.079.285-.208.285-.26 0zm9.202 4.264l-8.217-2.522a.547.547 0 0 1-.364-.675l1.378-4.421a.547.547 0 0 1 .675-.365l8.216 2.522c.285.079.443.39.364.675L14.08 21.45a.553.553 0 0 1-.674.365zm7.279-5.98L15.2 20.93c-.209.209-.31.13-.234-.155l1.144-3.694c.079-.285.39-.573.674-.624l3.77-.858c.288-.076.339.054.13.234zm.598-1.09l-4.523 1.039a.534.534 0 0 1-.65-.39l-1.922-8.372a.534.534 0 0 1 .39-.65L19.1 5.335a.534.534 0 0 1 .649.39l1.923 8.371c.079.31-.102.596-.39.65Z"},null,-1)]),4)}const Yi=T(Hi,[["render",zi]]),Wi={name:"InfluxModal",components:{FormRow:L,JsonModal:se},emits:["changed"],data(){return{v1:!1}},methods:{showV1(e){return this.v1||e.user||e.password}}},Gi=["onUpdate:modelValue"],Ki=["onUpdate:modelValue"],Ji=["onUpdate:modelValue"],Qi=["onUpdate:modelValue"],Zi=["onUpdate:modelValue"],Xi=["onUpdate:modelValue"],el={class:"d-flex"},tl=["onUpdate:modelValue"],nl={class:"form-check-label ms-2",for:"influxInsecure"},ol=["onClick"],sl=["onClick"];function al(e,t,n,i,s,o){const r=g("FormRow"),p=g("JsonModal");return a(),w(p,{id:"influxModal",title:e.$t("config.influx.title"),description:e.$t("config.influx.description"),docs:"/docs/reference/configuration/influx",endpoint:"/config/influx","state-key":"influx","data-testid":"influx-modal",onChanged:t[0]||(t[0]=d=>e.$emit("changed"))},{default:h(({values:d})=>[u(r,{id:"influxUrl",label:e.$t("config.influx.labelUrl"),example:"http://localhost:8086"},{default:h(()=>[_(l("input",{id:"influxUrl","onUpdate:modelValue":v=>d.url=v,type:"url",class:"form-control",required:""},null,8,Gi),[[O,d.url]])]),_:2},1032,["label"]),o.showV1(d)?b("",!0):(a(),w(r,{key:0,id:"influxOrg",label:e.$t("config.influx.labelOrg"),example:"home"},{default:h(()=>[_(l("input",{id:"influxOrg","onUpdate:modelValue":v=>d.org=v,class:"form-control",required:""},null,8,Ki),[[O,d.org]])]),_:2},1032,["label"])),u(r,{id:"influxDatabase",label:e.$t("config.influx.label".concat(o.showV1(d)?"Database":"Bucket")),example:"evcc"},{default:h(()=>[_(l("input",{id:"influxDatabase","onUpdate:modelValue":v=>d.database=v,class:"form-control",required:""},null,8,Ji),[[O,d.database]])]),_:2},1032,["label"]),o.showV1(d)?b("",!0):(a(),w(r,{key:1,id:"influxToken",label:e.$t("config.influx.labelToken"),help:e.$t("config.influx.descriptionToken")},{default:h(()=>[_(l("input",{id:"influxToken","onUpdate:modelValue":v=>d.token=v,class:"form-control",required:""},null,8,Qi),[[O,d.token]])]),_:2},1032,["label","help"])),o.showV1(d)?(a(),w(r,{key:2,id:"influxUser",label:e.$t("config.influx.labelUser"),optional:""},{default:h(()=>[_(l("input",{id:"influxUser","onUpdate:modelValue":v=>d.user=v,class:"form-control"},null,8,Zi),[[O,d.user]])]),_:2},1032,["label"])):b("",!0),o.showV1(d)?(a(),w(r,{key:3,id:"influxPassword",label:e.$t("config.influx.labelPassword"),optional:""},{default:h(()=>[_(l("input",{id:"influxPassword","onUpdate:modelValue":v=>d.password=v,class:"form-control",type:"password",autocomplete:"off"},null,8,Xi),[[O,d.password]])]),_:2},1032,["label"])):b("",!0),u(r,{id:"influxInsecure",label:e.$t("config.influx.labelInsecure")},{default:h(()=>[l("div",el,[_(l("input",{id:"influxInsecure","onUpdate:modelValue":v=>d.insecure=v,class:"form-check-input",type:"checkbox"},null,8,tl),[[Ie,d.insecure]]),l("label",nl,f(e.$t("config.influx.labelCheckInsecure")),1)])]),_:2},1032,["label"]),l("p",null,[o.showV1(d)?(a(),c("button",{key:0,class:"btn btn-link btn-sm text-primary px-0",type:"button",onClick:v=>{d.user="",d.password="",s.v1=!1}},f(e.$t("config.influx.v2Support")),9,ol)):(a(),c("button",{key:1,class:"btn btn-link btn-sm text-primary px-0",type:"button",onClick:v=>{d.token="",s.v1=!0}},f(e.$t("config.influx.v1Support")),9,sl))])]),_:1},8,["title","description"])}const il=T(Wi,[["render",al]]);function Z(e){return JSON.parse(JSON.stringify(e))}const te=60*1e9,ot={title:"",phasesConfigured:3,minCurrent:6,maxCurrent:16,priority:0,defaultMode:"",thresholds:{enable:{delay:1*te,threshold:0},disable:{delay:3*te,threshold:0}},soc:{poll:{mode:"charging",interval:60*te},estimate:!1},vehicle:"",charger:"",circuit:"",meter:""},st={enable:{delay:1*te,threshold:0},disable:{delay:3*te,threshold:0}},ll={name:"LoadpointModal",components:{FormRow:L,PropertyField:ce,GenericModal:Y,SelectGroup:Pe,EditIcon:Tt},mixins:[K],props:{id:Number,name:String,vehicleOptions:{type:Array,default:()=>[]},loadpointCount:Number,fade:String,chargers:{type:Array,default:()=>[]},chargerValues:{type:Object,default:()=>{}},meters:{type:Array,default:()=>[]},circuits:{type:Array,default:()=>[]}},emits:["updated","openMeterModal","openChargerModal","close","opened"],data(){return{isModalVisible:!1,saving:!1,selectedType:null,values:Z(ot),chargerPower:"11kw",solarMode:"default",tab:"solar",showAllSelected:!1,powerUnit:dt}},computed:{modalTitle(){return this.isNew?this.$t("config.loadpoint.titleAdd"):this.$t("config.loadpoint.titleEdit")},isNew(){return this.id===void 0},showAll(){return!this.isNew||this.showAllSelected},charger(){return this.chargers.find(e=>e.name===this.values.charger)},chargerTitle(){var t;if(!this.charger)return"";const e=((t=this.charger.config)==null?void 0:t.template)||"unknown";return"".concat(e," [").concat(this.values.charger,"]")},chargerStatus(){return!this.chargerValues||!this.values.charger?{}:this.chargerValues[this.values.charger]||{}},chargerSupports1p3p(){var e;return((e=this.chargerStatus.phases1p3p)==null?void 0:e.value)||!1},chargerIsSinglePhase(){var e;return((e=this.chargerStatus.singlePhase)==null?void 0:e.value)||!1},meterTitle(){var i;const e=this.values.meter;if(!e)return"";const t=this.meters.find(s=>s.name===e),n=((i=t==null?void 0:t.config)==null?void 0:i.template)||"unknown";return"".concat(n," [").concat(e,"]")},isDeletable(){return!this.isNew},showPriority(){return this.isNew?this.loadpointCount>0:this.loadpointCount>1},priorityOptions(){const e=Array.from({length:11},(t,n)=>({key:n,name:"".concat(n)}));return e[0].name="0 (default)",e[0].key=void 0,e[10].name="10 (highest)",e},showCircuit(){return this.circuits.length>0},circuitOptions(){const e=this.circuits.map(t=>{var n;return{key:t.name,name:"".concat(((n=t.config)==null?void 0:n.title)||""," [").concat(t.name,"]").trim()}});return[{key:"",name:"unassigned"},...e]},allVehicleOptions(){return[{key:"",name:this.$t("config.loadpoint.vehicleAutoDetection")},{key:null,name:null},...this.vehicleOptions]}},watch:{isModalVisible(e){var t;e&&((t=this.values)==null?void 0:t.id)!==this.id&&(this.reset(),this.id&&this.loadConfiguration())},chargerPower(e){e==="11kw"?(this.values.minCurrent=6,this.values.maxCurrent=16):e==="22kw"&&(this.values.minCurrent=6,this.values.maxCurrent=32)},solarMode(e){e==="default"&&(this.values.thresholds=Z(st))},chargerSupports1p3p(){this.updatePhases()},chargerIsSinglePhase(){this.updatePhases()}},methods:{reset(){this.values=Z(ot),this.updatePhases()},async loadConfiguration(){try{const e=await $.get("config/loadpoints/".concat(this.id));this.values=Z(e.data.result),this.updateChargerPower(),this.updateSolarMode(),this.updatePhases()}catch(e){console.error(e)}},async update(){this.saving=!0;try{const e=Z(this.values);await $.put("config/loadpoints/".concat(this.id),e),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("update failed")}this.saving=!1},async remove(){try{await $.delete("config/loadpoints/".concat(this.id)),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("delete failed")}},async create(){var e,t;this.saving=!0;try{await $.post("config/loadpoints",this.values),this.reset(),this.$emit("updated"),this.close()}catch(n){console.error(n);const i=(t=(e=n.response)==null?void 0:e.data)==null?void 0:t.error;alert("failed to create loadpoint: ".concat(i))}this.saving=!1},open(){this.isModalVisible=!0},opened(){this.$emit("opened")},close(){this.$emit("close"),this.showAllSelected=!1,this.isModalVisible=!1},editCharger(){this.$emit("openChargerModal",this.values.charger)},editMeter(){this.$emit("openMeterModal",this.values.meter)},setMeter(e){this.values.meter=e},setCharger(e){this.values.charger=e},updateChargerPower(){const{minCurrent:e,maxCurrent:t}=this.values;e===6&&t===16?this.chargerPower="11kw":e===6&&t===32?this.chargerPower="22kw":this.chargerPower="other"},updateSolarMode(){const{thresholds:e}=this.values;Qt(e,st)?this.solarMode="default":this.solarMode="custom"},updatePhases(){const{phasesConfigured:e}=this.values;if(this.chargerIsSinglePhase){this.values.phasesConfigured=1;return}if(this.chargerSupports1p3p&&this.isNew){this.values.phasesConfigured=0;return}if(!this.chargerSupports1p3p&&e===0){this.values.phasesConfigured=3;return}}}},rl={class:"d-flex"},dl={key:1,class:"d-flex justify-content-end"},ul=["disabled"],cl={key:2},ml={class:"d-flex"},pl={key:1},hl={key:3},fl={class:"ms-3 mb-5"},gl={class:"mb-4"},vl={class:"d-flex flex-wrap flex-sm-nowrap gap-4"},bl={class:"form-text evcc-gray"},yl={class:"d-flex flex-wrap flex-sm-nowrap gap-4"},wl={class:"form-text evcc-gray"},Ml={class:"text-muted"},kl={key:1,class:"row ms-3 mb-5"},Cl={key:4},_l={class:"d-flex mb-4"},Tl={class:"form-check-label ms-2",for:"loadpointEstimate"},$l={key:5},Vl={class:"text-muted"},Pl={key:5,class:"mt-5 mb-4 d-flex justify-content-between"},Sl={key:1,type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},ql=["disabled"],Il={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Ol(e,t,n,i,s,o){const r=g("PropertyField"),p=g("FormRow"),d=g("EditIcon"),v=g("SelectGroup"),M=g("GenericModal");return a(),w(M,{id:"loadpointModal",title:o.modalTitle,"data-testid":"loadpoint-modal",fade:n.fade,onOpen:o.open,onOpened:o.opened,onClose:o.close},{default:h(()=>{var C;return[l("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[23]||(t[23]=S(y=>o.isNew?o.create():o.update(),["prevent"]))},[u(p,{id:"loadpointParamTitle",label:e.$t("config.loadpoint.titleLabel"),example:e.$t("config.loadpoint.titleExample")},{default:h(()=>[u(r,{id:"loadpointParamTitle",modelValue:s.values.title,"onUpdate:modelValue":t[0]||(t[0]=y=>s.values.title=y),type:"String",class:"me-2",required:""},null,8,["modelValue"])]),_:1},8,["label","example"]),s.values.charger?(a(),w(p,{key:0,id:"loadpointParamCharger",label:e.$t("config.loadpoint.chargerLabel")},{default:h(()=>[l("div",rl,[u(r,{id:"loadpointParamCharger",modelValue:o.chargerTitle,type:"String",class:"me-2 flex-grow-1",readonly:"",required:"",onClick:S(o.editCharger,["prevent"])},null,8,["modelValue","onClick"]),l("button",{class:"btn btn-link btn-sm evcc-default-text",type:"button",onClick:t[1]||(t[1]=S((...y)=>o.editCharger&&o.editCharger(...y),["prevent"]))},[u(d)])])]),_:1},8,["label"])):(a(),c("div",dl,[l("button",{class:"btn btn-outline-primary",type:"submit",disabled:((C=s.values.title)==null?void 0:C.length)===0,onClick:t[2]||(t[2]=S((...y)=>o.editCharger&&o.editCharger(...y),["prevent"]))},f(e.$t("config.loadpoint.addCharger")),9,ul)])),s.values.charger||!o.isNew?(a(),c("div",cl,[s.values.meter?(a(),w(p,{key:0,id:"loadpointParamMeter",class:"mb-6",label:e.$t("config.loadpoint.energyMeterLabel"),help:e.$t("config.loadpoint.energyMeterHelp")},{default:h(()=>[l("div",ml,[u(r,{id:"loadpointParamMeter",modelValue:o.meterTitle,type:"String",class:"me-2 flex-grow-1",required:"",readonly:"",onClick:o.editMeter},null,8,["modelValue","onClick"]),l("button",{class:"btn btn-link btn-sm evcc-default-text",type:"button",tabindex:"0",onClick:t[3]||(t[3]=S((...y)=>o.editMeter&&o.editMeter(...y),["prevent"]))},[u(d)])])]),_:1},8,["label","help"])):(a(),c("p",pl,[l("button",{class:"btn btn-link btn-sm text-gray px-0",style:{"margin-top":"-1rem"},type:"button",tabindex:"0",onClick:t[4]||(t[4]=(...y)=>o.editMeter&&o.editMeter(...y))},f(e.$t("config.loadpoint.addMeter")),1)]))])):b("",!0),s.values.charger?(a(),c("div",hl,[l("h6",null,f(e.$t("config.loadpoint.chargingTitle")),1),u(p,{id:"loadpointMode",label:e.$t("config.loadpoint.defaultModeLabel"),help:s.values.defaultMode===""?e.$t("config.loadpoint.defaultModeHelpKeep"):e.$t("config.loadpoint.defaultModeHelp")},{default:h(()=>[u(r,{id:"loadpointMode",modelValue:s.values.defaultMode,"onUpdate:modelValue":t[5]||(t[5]=y=>s.values.defaultMode=y),type:"Choice",class:"w-100",required:"",choice:[{key:"",name:"---"},{key:"off",name:e.$t("main.mode.off")},{key:"pv",name:e.$t("main.mode.pv")},{key:"minpv",name:e.$t("main.mode.minpv")},{key:"now",name:e.$t("main.mode.now")}]},null,8,["modelValue","choice"])]),_:1},8,["label","help"]),_(u(p,{id:"loadpointSolarMode",label:e.$t("config.loadpoint.solarBehaviorLabel"),help:s.solarMode==="default"?e.$t("config.loadpoint.solarBehaviorDefaultHelp",{enableDelay:e.fmtDurationNs(s.values.thresholds.enable.delay,!0,"m"),disableDelay:e.fmtDurationNs(s.values.thresholds.disable.delay,!0,"m")}):e.$t("config.loadpoint.solarBehaviorCustomHelp")},{default:h(()=>[u(v,{id:"loadpointSolarMode",modelValue:s.solarMode,"onUpdate:modelValue":t[6]||(t[6]=y=>s.solarMode=y),class:"w-100",options:[{name:e.$t("config.loadpoint.solarModeMaximum"),value:"default"},{name:e.$t("config.loadpoint.solarModeCustom"),value:"custom"}],transparent:"","equal-width":""},null,8,["modelValue","options"])]),_:1},8,["label","help"]),[[D,o.showAll]]),_(l("div",fl,[l("div",gl,[l("div",vl,[u(p,{id:"loadpointEnableThreshold",label:e.$t("config.loadpoint.thresholdEnableLabel"),style:{"margin-bottom":"0 !important"}},{default:h(()=>[u(r,{id:"loadpointEnableThreshold",modelValue:s.values.thresholds.enable.threshold,"onUpdate:modelValue":t[7]||(t[7]=y=>s.values.thresholds.enable.threshold=y),type:"Float",unit:"W",size:"w-25 w-min-200",required:""},null,8,["modelValue"])]),_:1},8,["label"]),u(p,{id:"loadpointEnableDelay",label:e.$t("config.loadpoint.thresholdEnableDelayLabel"),style:{"margin-bottom":"0 !important"}},{default:h(()=>[u(r,{id:"loadpointEnableDelay",modelValue:s.values.thresholds.enable.delay,"onUpdate:modelValue":t[8]||(t[8]=y=>s.values.thresholds.enable.delay=y),type:"Duration",unit:"minute",size:"w-25 w-min-200",required:""},null,8,["modelValue"])]),_:1},8,["label"])]),l("div",bl,f(s.values.thresholds.enable.threshold===0?e.$t("config.loadpoint.thresholdEnableHelpZero",{delay:e.fmtDurationNs(s.values.thresholds.enable.delay,!0,"m")}):s.values.thresholds.enable.threshold<0?e.$t("config.loadpoint.thresholdEnableHelpNegative",{surplus:e.fmtW(-1*s.values.thresholds.enable.threshold,s.powerUnit.AUTO),delay:e.fmtDurationNs(s.values.thresholds.enable.delay,!0,"m")}):e.$t("config.loadpoint.thresholdEnableHelpInvalid")),1)]),l("div",null,[l("div",yl,[u(p,{id:"loadpointDisableThreshold",label:e.$t("config.loadpoint.thresholdDisableLabel"),style:{"margin-bottom":"0 !important"}},{default:h(()=>[u(r,{id:"loadpointDisableThreshold",modelValue:s.values.thresholds.disable.threshold,"onUpdate:modelValue":t[9]||(t[9]=y=>s.values.thresholds.disable.threshold=y),type:"Float",unit:"W",size:"w-25 w-min-200",required:""},null,8,["modelValue"])]),_:1},8,["label"]),u(p,{id:"loadpointDisableDelay",label:e.$t("config.loadpoint.thresholdDisableDelayLabel"),style:{"margin-bottom":"0 !important"}},{default:h(()=>[u(r,{id:"loadpointDisableDelay",modelValue:s.values.thresholds.disable.delay,"onUpdate:modelValue":t[10]||(t[10]=y=>s.values.thresholds.disable.delay=y),type:"Duration",unit:"minute",size:"w-25 w-min-200",required:""},null,8,["modelValue"])]),_:1},8,["label"])]),l("div",wl,f(s.values.thresholds.disable.threshold===0?e.$t("config.loadpoint.thresholdDisableHelpZero",{delay:e.fmtDurationNs(s.values.thresholds.disable.delay,!0,"m")}):s.values.thresholds.disable.threshold>0?e.$t("config.loadpoint.thresholdDisableHelpPositive",{power:e.fmtW(s.values.thresholds.disable.threshold,s.powerUnit.AUTO),delay:e.fmtDurationNs(s.values.thresholds.disable.delay,!0,"m")}):e.$t("config.loadpoint.thresholdDisableHelpInvalid")),1)])],512),[[D,s.solarMode==="custom"]]),o.showPriority?_((a(),w(p,{key:0,id:"loadpointParamPriority",label:e.$t("config.loadpoint.priorityLabel"),help:e.$t("config.loadpoint.priorityHelp")},{default:h(()=>[u(r,{id:"loadpointParamPriority",modelValue:s.values.priority,"onUpdate:modelValue":t[11]||(t[11]=y=>s.values.priority=y),type:"Choice",size:"w-100",class:"me-2",choice:o.priorityOptions,required:""},null,8,["modelValue","choice"])]),_:1},8,["label","help"])),[[D,o.showAll]]):b("",!0),_(l("h6",null,[N(f(e.$t("config.loadpoint.electricalTitle"))+" ",1),l("small",Ml,f(e.$t("config.loadpoint.electricalSubtitle")),1)],512),[[D,o.showAll]]),u(p,{id:"chargerPower",label:e.$t("config.loadpoint.chargerTypeLabel"),help:s.chargerPower==="11kw"?e.$t("config.loadpoint.chargerPower11kwHelp"):s.chargerPower==="22kw"?e.$t("config.loadpoint.chargerPower22kwHelp"):e.$t("config.loadpoint.chargerPowerCustomHelp")},{default:h(()=>[u(v,{id:"chargerPower",modelValue:s.chargerPower,"onUpdate:modelValue":t[12]||(t[12]=y=>s.chargerPower=y),class:"w-100",options:[{name:e.$t("config.loadpoint.chargerPower11kw"),value:"11kw"},{name:e.$t("config.loadpoint.chargerPower22kw"),value:"22kw"},{name:e.$t("config.loadpoint.chargerPowerCustom"),value:"other"}],transparent:""},null,8,["modelValue","options"])]),_:1},8,["label","help"]),s.chargerPower==="other"?(a(),c("div",kl,[u(p,{id:"loadpointMinCurrent",label:e.$t("config.loadpoint.minCurrentLabel"),class:"col-sm-6 mb-sm-0",help:s.values.minCurrent<6?e.$t("config.loadpoint.minCurrentHelp"):null},{default:h(()=>[u(r,{id:"loadpointMinCurrent",modelValue:s.values.minCurrent,"onUpdate:modelValue":t[13]||(t[13]=y=>s.values.minCurrent=y),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2",required:""},null,8,["modelValue"])]),_:1},8,["label","help"]),u(p,{id:"loadpointMaxCurrent",label:e.$t("config.loadpoint.maxCurrentLabel"),class:"col-sm-6 mb-sm-0",help:s.values.maxCurrent<s.values.minCurrent?e.$t("config.loadpoint.maxCurrentHelp"):null},{default:h(()=>[u(r,{id:"loadpointMaxCurrent",modelValue:s.values.maxCurrent,"onUpdate:modelValue":t[14]||(t[14]=y=>s.values.maxCurrent=y),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2",required:""},null,8,["modelValue"])]),_:1},8,["label","help"])])):b("",!0),o.chargerIsSinglePhase?b("",!0):(a(),c(P,{key:2},[o.chargerSupports1p3p?_((a(),w(p,{key:0,id:"loadpointParamPhases",label:e.$t("config.loadpoint.phasesAutomatic"),help:e.$t("config.loadpoint.phasesAutomaticHelp")},null,8,["label","help"])),[[D,o.showAll]]):_((a(),w(p,{key:1,id:"loadpointParamPhases",label:e.$t("config.loadpoint.phasesLabel"),help:e.$t("config.loadpoint.phasesHelp")},{default:h(()=>[u(v,{id:"loadpointParamPhases",modelValue:s.values.phasesConfigured,"onUpdate:modelValue":t[15]||(t[15]=y=>s.values.phasesConfigured=y),class:"w-100",options:[{value:1,name:e.$t("config.loadpoint.phases1p")},{value:3,name:e.$t("config.loadpoint.phases3p")}],transparent:"","equal-width":""},null,8,["modelValue","options"])]),_:1},8,["label","help"])),[[D,o.showAll]])],64)),o.showCircuit?_((a(),w(p,{key:3,id:"loadpointParamCircuit",label:e.$t("config.loadpoint.circuitLabel"),help:e.$t("config.loadpoint.circuitHelp")},{default:h(()=>[u(r,{id:"loadpointParamCircuit",modelValue:s.values.circuit,"onUpdate:modelValue":t[16]||(t[16]=y=>s.values.circuit=y),type:"Choice",class:"me-2",choice:o.circuitOptions,required:""},null,8,["modelValue","choice"])]),_:1},8,["label","help"])),[[D,o.showAll]]):b("",!0),_(l("h6",null,f(e.$t("config.loadpoint.vehiclesTitle")),513),[[D,o.showAll]]),n.vehicleOptions.length?(a(),c("div",Cl,[u(p,{id:"loadpointParamVehicle",label:e.$t("config.loadpoint.vehicleLabel"),help:s.values.vehicle?e.$t("config.loadpoint.vehicleHelpDefault"):e.$t("config.loadpoint.vehicleHelpAutoDetection")},{default:h(()=>[u(r,{id:"loadpointParamVehicle",modelValue:s.values.vehicle,"onUpdate:modelValue":t[17]||(t[17]=y=>s.values.vehicle=y),type:"Choice",class:"me-2",choice:o.allVehicleOptions,required:""},null,8,["modelValue","choice"])]),_:1},8,["label","help"]),_(u(p,{id:"loadpointPollMode",label:e.$t("config.loadpoint.pollModeLabel"),help:s.values.soc.poll.mode==="charging"?e.$t("config.loadpoint.pollModeChargingHelp"):s.values.soc.poll.mode==="connected"?e.$t("config.loadpoint.pollModeConnectedHelp"):s.values.soc.poll.mode==="always"?e.$t("config.loadpoint.pollModeAlwaysHelp"):null},{default:h(()=>[u(v,{id:"loadpointPollMode",modelValue:s.values.soc.poll.mode,"onUpdate:modelValue":t[18]||(t[18]=y=>s.values.soc.poll.mode=y),class:"w-100",options:[{value:"charging",name:e.$t("config.loadpoint.pollModeCharging")},{value:"connected",name:e.$t("config.loadpoint.pollModeConnected")},{value:"always",name:e.$t("config.loadpoint.pollModeAlways")}],transparent:""},null,8,["modelValue","options"])]),_:1},8,["label","help"]),[[D,o.showAll]]),s.values.soc.poll.mode!=="charging"?_((a(),w(p,{key:0,id:"loadpointPollInterval",class:"ms-3 mb-5",label:e.$t("config.loadpoint.pollIntervalLabel"),help:e.$t("config.loadpoint.pollIntervalHelp")},{default:h(()=>[u(r,{id:"loadpointPollInterval",modelValue:s.values.soc.poll.interval,"onUpdate:modelValue":t[19]||(t[19]=y=>s.values.soc.poll.interval=y),type:"Duration",unit:"minute",size:"w-25 w-min-200",class:"me-2",required:""},null,8,["modelValue"])]),_:1},8,["label","help"])),[[D,o.showAll]]):b("",!0),_(l("div",_l,[_(l("input",{id:"loadpointEstimate","onUpdate:modelValue":t[20]||(t[20]=y=>s.values.soc.estimate=y),class:"form-check-input",type:"checkbox"},null,512),[[Ie,s.values.soc.estimate]]),l("label",Tl,f(e.$t("config.loadpoint.estimateLabel")),1)],512),[[D,o.showAll]])])):_((a(),c("div",$l,[l("p",Vl,f(e.$t("config.loadpoint.noVehicles")),1)],512)),[[D,o.showAll]])])):b("",!0),!o.showAll&&s.values.charger?(a(),c("button",{key:4,class:"btn btn-link btn-sm text-gray px-0 border-0 d-flex align-items-center mb-2",type:"button",tabindex:"0",onClick:t[21]||(t[21]=y=>s.showAllSelected=!0)},f(e.$t("config.loadpoint.showAllSettings")),1)):b("",!0),s.values.charger?(a(),c("div",Pl,[o.isDeletable?(a(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[22]||(t[22]=S((...y)=>o.remove&&o.remove(...y),["prevent"]))},f(e.$t("config.meter.delete")),1)):(a(),c("button",Sl,f(e.$t("config.loadpoint.cancel")),1)),l("button",{type:"submit",class:"btn btn-primary",disabled:s.saving},[s.saving?(a(),c("span",Il)):b("",!0),N(" "+f(e.$t("config.loadpoint.save")),1)],8,ql)])):b("",!0)],544)]}),_:1},8,["title","fade","onOpen","onOpened","onClose"])}const Nl=T(ll,[["render",Ol],["__scopeId","data-v-92baecd5"]]),Ul={name:"Loadpoint",mixins:[F]};function Dl(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M6 19h6V5H6Zm2-1l4-7h-2V6l-4 7.5h2Zm-4 3V5q0-.825.588-1.413Q5.175 3 6 3h6q.825 0 1.413.587Q14 4.175 14 5v7h1q.825 0 1.413.587Q17 13.175 17 14v4.5q0 .425.288.712q.287.288.712.288t.712-.288Q19 18.925 19 18.5v-7.2q-.225.125-.475.162q-.25.038-.525.038q-1.05 0-1.775-.725Q15.5 10.05 15.5 9q0-.8.438-1.438q.437-.637 1.162-.912L15 4.55l1.05-1.05l3.7 3.6q.375.375.562.875q.188.5.188 1.025v9.5q0 1.05-.725 1.775Q19.05 21 18 21q-1.05 0-1.775-.725q-.725-.725-.725-1.775v-5H14V21Zm8-2H6h6Zm6-9q.425 0 .712-.288Q19 9.425 19 9t-.288-.713Q18.425 8 18 8t-.712.287Q17 8.575 17 9t.288.712Q17.575 10 18 10Z"},null,-1)]),4)}const El=T(Ul,[["render",Dl]]),Ll='#events:\n#  start:\n#    title: Charge started\n#    msg: Started charging in "${mode}" mode\n#  stop:\n#    title: Charge finished\n#    msg: Finished charging ${chargedEnergy:%.1fk}kWh in ${chargeDuration}.\n#  connect:\n#    title: Car connected\n#    msg: "Car connected at ${pvPower:%.1fk}kW PV"\n#  disconnect:\n#    title: Car disconnected\n#    msg: Car disconnected after ${connectedDuration}\n#  soc:\n#    title: Soc updated\n#    msg: Battery charged to ${vehicleSoc:%.0f}%\n#  guest:\n#    title: Unknown vehicle\n#    msg: Unknown vehicle, guest connected?\n\n#services:\n#- type: pushover\n#  app: # app id\n#  recipients:\n#  - # list of recipient ids\n#- type: telegram\n#  token: # bot id\n#  chats:\n#  - # list of chat ids\n#- type: email\n#  uri: smtp://<user>:<password>@<host>:<port>/?fromAddress=<from>&toAddresses=<to>\n#- type: ntfy\n#  uri: https://<host>/<topics>\n#  priority: <priority>\n#  tags: <tags>\n',Rl={name:"MessagingModal",components:{YamlModal:J},emits:["changed"],data(){return{defaultYaml:Ll.trim()}}};function Al(e,t,n,i,s,o){const r=g("YamlModal");return a(),w(r,{id:"messagingModal",title:e.$t("config.messaging.title"),description:e.$t("config.messaging.description"),docs:"/docs/reference/configuration/messaging",defaultYaml:s.defaultYaml,endpoint:"/config/messaging",removeKey:"messaging","data-testid":"messaging-modal",onChanged:t[0]||(t[0]=p=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Fl=T(Rl,[["render",Al]]),at={type:"template"};function it(e){return new Promise(t=>setTimeout(t,e))}const Bl=["usage","modbus"],jl={name:"MeterModal",components:{FormRow:L,PropertyEntry:Oe,GenericModal:Y,Modbus:vt,TestResult:Ne,NewDeviceButton:ft,PropertyCollapsible:me,Markdown:ue},mixins:[Ue],props:{id:Number,name:String,type:String,fade:String},emits:["added","updated","removed","close"],data(){return{isModalVisible:!1,templates:[],products:[],templateName:null,template:null,saving:!1,selectedType:null,loadingTemplate:!1,values:{...at}}},computed:{modalTitle(){return this.isNew?this.meterType?this.$t("config.".concat(this.meterType,".titleAdd")):this.$t("config.meter.titleChoice"):this.$t("config.".concat(this.meterType,".titleEdit"))},meterType(){return this.type||this.selectedType},templateOptions(){return this.products.filter(e=>e.group!=="generic")},genericOptions(){return this.products.filter(e=>e.group==="generic")},templateParams(){var e;return(((e=this.template)==null?void 0:e.Params)||[]).filter(t=>!Bl.includes(t.Name)).map(t=>(this.meterType==="battery"&&t.Name==="capacity"&&(t.Advanced=!1),t))},normalParams(){return this.templateParams.filter(e=>!e.Advanced)},advancedParams(){return this.templateParams.filter(e=>e.Advanced)},modbus(){var t;return(((t=this.template)==null?void 0:t.Params)||[]).find(n=>n.Name==="modbus")},modbusCapabilities(){var e;return((e=this.modbus)==null?void 0:e.Choice)||[]},modbusDefaults(){const{ID:e,Comset:t,Baudrate:n,Port:i}=this.modbus||{};return{id:e,comset:t,baudrate:n,port:i}},description(){var e,t;return(t=(e=this.template)==null?void 0:e.Requirements)==null?void 0:t.Description},apiData(){return{template:this.templateName,...this.modbusDefaults,...this.values,usage:this.meterType}},isNew(){return this.id===void 0},isDeletable(){return!this.isNew}},watch:{isModalVisible(e){e&&(this.templateName=null,this.selectedType=null,this.reset(),this.loadProducts(),this.id!==void 0&&this.loadConfiguration())},meterType(){this.loadProducts()},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},methods:{reset(){this.values={...at},this.resetTest()},async loadConfiguration(){try{const e=(await $.get("config/devices/meter/".concat(this.id))).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(e){console.error(e)}},async loadProducts(){var e;if(!(!this.isModalVisible||!this.meterType))try{const t={params:{usage:this.meterType,lang:(e=this.$i18n)==null?void 0:e.locale}};this.products=(await $.get("config/products/meter",t)).data.result}catch(t){console.error(t)}},async loadTemplate(){var e;if(this.templateName){this.template=null,this.loadingTemplate=!0;try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale,name:this.templateName}},n=await $.get("config/templates/meter",t);this.template=n.data.result,this.applyDefaultsFromTemplate()}catch(t){console.error(t)}this.loadingTemplate=!1}},applyDefaultsFromTemplate(){var t;(((t=this.template)==null?void 0:t.Params)||[]).filter(n=>n.Default&&!this.values[n.Name]).forEach(n=>{this.values[n.Name]=n.Default})},async create(){if(this.testUnknown){if(!await this.test(this.testMeter))return;await it(100)}this.saving=!0;try{const e=await $.post("config/devices/meter",this.apiData),{name:t}=e.data.result;this.$emit("added",this.meterType,t),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testMeter)},async testMeter(){let e="config/test/meter";return this.isNew||(e+="/merge/".concat(this.id)),await $.post(e,this.apiData)},async update(){if(this.testUnknown){if(!await this.test(this.testMeter))return;await it(250)}this.saving=!0;try{await $.put("config/devices/meter/".concat(this.id),this.apiData),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("update failed")}this.saving=!1},async remove(){try{await $.delete("config/devices/meter/".concat(this.id)),this.$emit("removed",this.meterType,this.name),this.$emit("updated"),this.close()}catch(e){console.error(e),alert("delete failed")}},open(){this.isModalVisible=!0},close(){this.$emit("close"),this.isModalVisible=!1},selectType(e){this.selectedType=e},templateChanged(){this.reset()}}},xl={key:0},Hl={key:1,ref:"form",class:"container mx-0 px-0"},zl=["disabled"],Yl=["value"],Wl={key:0,disabled:""},Gl=["value"],Kl={key:0},Jl={key:4,class:"my-4 d-flex justify-content-between"},Ql={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal",tabindex:"0"},Zl=["disabled"],Xl={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function er(e,t,n,i,s,o){const r=g("NewDeviceButton"),p=g("FormRow"),d=g("Markdown"),v=g("Modbus"),M=g("PropertyEntry"),C=g("PropertyCollapsible"),y=g("TestResult"),U=g("GenericModal");return a(),w(U,{id:"meterModal",title:o.modalTitle,"data-testid":"meter-modal",fade:n.fade,onOpen:o.open,onClose:o.close},{default:h(()=>[o.meterType?(a(),c("form",Hl,[u(p,{id:"meterTemplate",label:e.$t("config.meter.template")},{default:h(()=>[_(l("select",{id:"meterTemplate","onUpdate:modelValue":t[2]||(t[2]=m=>s.templateName=m),disabled:!o.isNew,class:"form-select w-100",onChange:t[3]||(t[3]=(...m)=>o.templateChanged&&o.templateChanged(...m))},[(a(!0),c(P,null,q(o.genericOptions,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,Yl))),128)),o.genericOptions.length?(a(),c("option",Wl,"──────────")):b("",!0),(a(!0),c(P,null,q(o.templateOptions,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,Gl))),128))],40,zl),[[de,s.templateName]])]),_:1},8,["label"]),s.loadingTemplate?(a(),c("p",Kl,"Loading ...")):b("",!0),o.description?(a(),w(d,{key:1,markdown:o.description,class:"my-4"},null,8,["markdown"])):b("",!0),o.modbus?(a(),w(v,{key:2,modbus:s.values.modbus,"onUpdate:modbus":t[4]||(t[4]=m=>s.values.modbus=m),id:s.values.id,"onUpdate:id":t[5]||(t[5]=m=>s.values.id=m),host:s.values.host,"onUpdate:host":t[6]||(t[6]=m=>s.values.host=m),port:s.values.port,"onUpdate:port":t[7]||(t[7]=m=>s.values.port=m),device:s.values.device,"onUpdate:device":t[8]||(t[8]=m=>s.values.device=m),baudrate:s.values.baudrate,"onUpdate:baudrate":t[9]||(t[9]=m=>s.values.baudrate=m),comset:s.values.comset,"onUpdate:comset":t[10]||(t[10]=m=>s.values.comset=m),defaultId:o.modbus.ID,defaultComset:o.modbus.Comset,defaultBaudrate:o.modbus.Baudrate,defaultPort:o.modbus.Port,capabilities:o.modbusCapabilities},null,8,["modbus","id","host","port","device","baudrate","comset","defaultId","defaultComset","defaultBaudrate","defaultPort","capabilities"])):b("",!0),(a(!0),c(P,null,q(o.normalParams,m=>(a(),w(M,G({id:"meterParam".concat(m.Name),key:m.Name,ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":V=>s.values[m.Name]=V}),null,16,["id","modelValue","onUpdate:modelValue"]))),128)),u(C,null,Se({_:2},[o.advancedParams.length?{name:"advanced",fn:h(()=>[(a(!0),c(P,null,q(o.advancedParams,m=>(a(),w(M,G({id:"meterParam".concat(m.Name),key:m.Name,ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":V=>s.values[m.Name]=V}),null,16,["id","modelValue","onUpdate:modelValue"]))),128))]),key:"0"}:void 0]),1024),s.templateName?(a(),w(y,{key:3,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:o.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):b("",!0),s.templateName?(a(),c("div",Jl,[o.isDeletable?(a(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",tabindex:"0",onClick:t[11]||(t[11]=S((...m)=>o.remove&&o.remove(...m),["prevent"]))},f(e.$t("config.general.delete")),1)):(a(),c("button",Ql,f(e.$t("config.general.cancel")),1)),l("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||s.saving,tabindex:"0",onClick:t[12]||(t[12]=S(m=>o.isNew?o.create():o.update(),["prevent"]))},[s.saving?(a(),c("span",Xl)):b("",!0),N(" "+f(e.testUnknown?e.$t("config.general.validateSave"):e.$t("config.general.save")),1)],8,Zl)])):b("",!0)],512)):(a(),c("div",xl,[u(r,{title:"Add solar meter",class:"mb-4 addButton",onClick:t[0]||(t[0]=m=>o.selectType("pv"))}),u(r,{title:"Add battery meter",class:"addButton",onClick:t[1]||(t[1]=m=>o.selectType("battery"))})]))]),_:1},8,["title","fade","onOpen","onClose"])}const tr=T(jl,[["render",er],["__scopeId","data-v-bc5c1b6f"]]),nr={name:"ModbusProxy",mixins:[F]};function or(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M15 19v-1h-2q-.825 0-1.412-.587T11 16V8H9v1q0 .825-.587 1.413T7 11H4q-.825 0-1.412-.587T2 9V5q0-.825.588-1.412T4 3h3q.825 0 1.413.588T9 5v1h6V5q0-.825.588-1.412T17 3h3q.825 0 1.413.588T22 5v4q0 .825-.587 1.413T20 11h-3q-.825 0-1.412-.587T15 9V8h-2v8h2v-1q0-.825.588-1.412T17 13h3q.825 0 1.413.588T22 15v4q0 .825-.587 1.413T20 21h-3q-.825 0-1.412-.587T15 19M4 5v4zm13 10v4zm0-10v4zm0 4h3V5h-3zm0 10h3v-4h-3zM4 9h3V5H4z"},null,-1)]),4)}const sr=T(nr,[["render",or]]),ar='#- port: 5021\n#  uri: 192.0.2.2:502\n#- port: 5022\n#  device: /dev/ttyUSB0\n#  baudrate: 9600\n#  comset: "8N1"\n#- port: 5023\n#  uri: 192.0.2.3:502\n#  rtu: true\n',ir={name:"ModbusProxyModal",components:{YamlModal:J},emits:["changed"],data(){return{defaultYaml:ar.trim()}}};function lr(e,t,n,i,s,o){const r=g("YamlModal");return a(),w(r,{id:"modbusProxyModal",title:e.$t("config.modbusproxy.title"),description:e.$t("config.modbusproxy.description"),docs:"/docs/reference/configuration/modbusproxy",defaultYaml:s.defaultYaml,endpoint:"/config/modbusproxy",removeKey:"modbusproxy",size:"md",onChanged:t[0]||(t[0]=p=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const rr=T(ir,[["render",lr]]),dr={name:"Mqtt",mixins:[F]};function ur(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"-40 -40 400 400"},t[0]||(t[0]=[l("g",null,[l("path",{fill:"currentColor",d:"M7.1,180.6v117.1c0,8.4,6.8,15.3,15.3,15.3H142C141,239.8,80.9,180.7,7.1,180.6z"}),l("path",{fill:"currentColor",d:"M7.1,84.1v49.8c99,0.9,179.4,80.7,180.4,179.1h51.7C238.2,186.6,134.5,84.2,7.1,84.1z"}),l("path",{fill:"currentColor",d:"M312.9,297.6V193.5C278.1,107.2,207.3,38.9,119,7.1H22.4c-8.4,0-15.3,6.8-15.3,15.3v15\n			c152.6,0.9,276.6,124,277.6,275.6h13C306.1,312.9,312.9,306.1,312.9,297.6z"}),l("path",{fill:"currentColor",d:"M272.6,49.8c14.5,14.4,28.6,31.7,40.4,47.8V22.4c0-8.4-6.8-15.3-15.3-15.3h-77.3\n			C238.4,19.7,256.6,33.9,272.6,49.8z"})],-1)]),4)}const cr=T(dr,[["render",ur]]),mr={name:"PropertyCertField",props:{id:String,modelValue:String},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{openFilePicker(){this.$refs.fileInput.click()},readFile(e){const t=e.target.files[0],n=new FileReader;n.onload=i=>{this.value=i.target.result},n.readAsText(t)}}},pr=["id"],hr={class:"d-flex justify-content-end"};function fr(e,t,n,i,s,o){return a(),c("div",null,[_(l("textarea",{id:n.id,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value=r),class:"form-control",rows:"3"},null,8,pr),[[O,o.value]]),l("div",hr,[l("button",{type:"button",class:"btn btn-link btn-sm text-muted pe-0",onClick:t[1]||(t[1]=(...r)=>o.openFilePicker&&o.openFilePicker(...r))},f(e.$t("config.general.readFromFile")),1),l("input",{ref:"fileInput",type:"file",class:"d-none",accept:".crt,.pem,.cer,.csr,.key",onChange:t[2]||(t[2]=(...r)=>o.readFile&&o.readFile(...r))},null,544)])])}const gr=T(mr,[["render",fr]]),vr={name:"MqttModal",components:{FormRow:L,JsonModal:se,PropertyCollapsible:me,PropertyCertField:gr},emits:["changed"]},br=["onUpdate:modelValue"],yr=["onUpdate:modelValue"],wr=["onUpdate:modelValue"],Mr=["onUpdate:modelValue"],kr=["onUpdate:modelValue"],Cr={class:"d-flex"},_r=["onUpdate:modelValue"],Tr={class:"form-check-label ms-2",for:"mqttInsecure"};function $r(e,t,n,i,s,o){const r=g("FormRow"),p=g("PropertyCertField"),d=g("PropertyCollapsible"),v=g("JsonModal");return a(),w(v,{id:"mqttModal",title:e.$t("config.mqtt.title"),description:e.$t("config.mqtt.description"),docs:"/docs/reference/configuration/mqtt",endpoint:"/config/mqtt","state-key":"mqtt","data-testid":"mqtt-modal",onChanged:t[0]||(t[0]=M=>e.$emit("changed"))},{default:h(({values:M})=>[u(r,{id:"mqttBroker",label:e.$t("config.mqtt.labelBroker"),example:"localhost:1883"},{default:h(()=>[_(l("input",{id:"mqttBroker","onUpdate:modelValue":C=>M.broker=C,class:"form-control",required:""},null,8,br),[[O,M.broker]])]),_:2},1032,["label"]),l("h6",null,f(e.$t("config.mqtt.publishing")),1),u(r,{id:"mqttTopic",label:e.$t("config.mqtt.labelTopic"),help:e.$t("config.mqtt.descriptionTopic"),example:"evcc",optional:""},{default:h(()=>[_(l("input",{id:"mqttTopic","onUpdate:modelValue":C=>M.topic=C,class:"form-control"},null,8,yr),[[O,M.topic]])]),_:2},1032,["label","help"]),u(r,{id:"mqttClientId",label:e.$t("config.mqtt.labelClientId"),help:e.$t("config.mqtt.descriptionClientId"),optional:""},{default:h(()=>[_(l("input",{id:"mqttClientId","onUpdate:modelValue":C=>M.clientID=C,class:"form-control"},null,8,wr),[[O,M.clientID]])]),_:2},1032,["label","help"]),l("h6",null,f(e.$t("config.mqtt.authentication")),1),u(r,{id:"mqttUser",label:e.$t("config.mqtt.labelUser"),optional:""},{default:h(()=>[_(l("input",{id:"mqttUser","onUpdate:modelValue":C=>M.user=C,class:"form-control"},null,8,Mr),[[O,M.user]])]),_:2},1032,["label"]),u(r,{id:"mqttPassword",label:e.$t("config.mqtt.labelPassword"),optional:""},{default:h(()=>[_(l("input",{id:"mqttPassword","onUpdate:modelValue":C=>M.password=C,class:"form-control",type:"password",autocomplete:"off"},null,8,kr),[[O,M.password]])]),_:2},1032,["label"]),u(r,{id:"mqttInsecure",label:e.$t("config.mqtt.labelInsecure")},{default:h(()=>[l("div",Cr,[_(l("input",{id:"mqttInsecure","onUpdate:modelValue":C=>M.insecure=C,class:"form-check-input",type:"checkbox"},null,8,_r),[[Ie,M.insecure]]),l("label",Tr,f(e.$t("config.mqtt.labelCheckInsecure")),1)])]),_:2},1032,["label"]),u(d,null,{advanced:h(()=>[u(r,{id:"mqttCaCert",label:e.$t("config.mqtt.labelCaCert"),optional:""},{default:h(()=>[u(p,{id:"mqttCaCert",modelValue:M.caCert,"onUpdate:modelValue":C=>M.caCert=C},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),u(r,{id:"mqttClientCert",label:e.$t("config.mqtt.labelClientCert"),optional:""},{default:h(()=>[u(p,{id:"mqttClientCert",modelValue:M.clientCert,"onUpdate:modelValue":C=>M.clientCert=C},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),u(r,{id:"mqttClientKey",label:e.$t("config.mqtt.labelClientKey"),optional:""},{default:h(()=>[u(p,{id:"mqttClientKey",modelValue:M.clientKey,"onUpdate:modelValue":C=>M.clientKey=C},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024)]),_:1},8,["title","description"])}const Vr=T(vr,[["render",$r]]),Pr={name:"NetworkModal",components:{FormRow:L,JsonModal:se},emits:["changed"]},Sr={class:"btn-group",role:"group"},qr=["onUpdate:modelValue"],Ir=["onUpdate:modelValue"],Or=["onUpdate:modelValue"],Nr=["onUpdate:modelValue"];function Ur(e,t,n,i,s,o){const r=g("FormRow"),p=g("JsonModal");return a(),w(p,{id:"networkModal",title:e.$t("config.network.title"),endpoint:"/config/network","state-key":"network","disable-remove":"","data-testid":"network-modal",onChanged:t[0]||(t[0]=d=>e.$emit("changed"))},{default:h(({values:d})=>[u(r,{id:"networkSchema",label:e.$t("config.network.labelSchema"),help:e.$t("config.network.descriptionSchema")},{default:h(()=>[l("div",Sr,[_(l("input",{id:"networkSchemaHttp","onUpdate:modelValue":v=>d.schema=v,type:"radio",class:"btn-check",name:"networkSchema",tabindex:"0",value:"http",autocomplete:"off"},null,8,qr),[[z,d.schema]]),t[1]||(t[1]=l("label",{class:"btn btn-outline-primary",for:"networkSchemaHttp"},"HTTP",-1)),_(l("input",{id:"networkSchemaHttps","onUpdate:modelValue":v=>d.schema=v,type:"radio",class:"btn-check",name:"networkSchema",tabindex:"0",value:"https",autocomplete:"off"},null,8,Ir),[[z,d.schema]]),t[2]||(t[2]=l("label",{class:"btn btn-outline-primary",for:"networkSchemaHttps"},"HTTPS",-1))])]),_:2},1032,["label","help"]),u(r,{id:"networkHost",label:e.$t("config.network.labelHost"),help:e.$t("config.network.descriptionHost"),example:"evcc.local"},{default:h(()=>[_(l("input",{id:"networkHost","onUpdate:modelValue":v=>d.host=v,class:"form-control"},null,8,Or),[[O,d.host]])]),_:2},1032,["label","help"]),u(r,{id:"networkPort",label:e.$t("config.network.labelPort"),help:e.$t("config.network.descriptionPort")},{default:h(()=>[_(l("input",{id:"networkPort","onUpdate:modelValue":v=>d.port=v,class:"form-control w-50 me-2 w-50",type:"number",example:"7070"},null,8,Nr),[[O,d.port]])]),_:2},1032,["label","help"])]),_:1},8,["title"])}const Dr=T(Pr,[["render",Ur]]),Er={name:"Notification",mixins:[F]};function Lr(e,t,n,i,s,o){return a(),c("svg",{style:A(e.svgStyle),viewBox:"0 0 24 24"},t[0]||(t[0]=[l("path",{fill:"currentColor",d:"M5 19q-.425 0-.712-.288T4 18t.288-.712T5 17h1v-7q0-2.075 1.25-3.687T10.5 4.2v-.7q0-.625.438-1.062T12 2t1.063.438T13.5 3.5v.7q2 .5 3.25 2.113T18 10v7h1q.425 0 .713.288T20 18t-.288.713T19 19zm7 3q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-4-5h8v-7q0-1.65-1.175-2.825T12 6T9.175 7.175T8 10zm-5-7q-.425 0-.712-.325t-.238-.75q.2-1.875 1.05-3.488t2.175-2.812q.325-.275.738-.25t.662.375t.2.75t-.375.7q-.975.925-1.6 2.15T4.075 9q-.05.425-.35.713T3 10m18 0q-.425 0-.725-.288T19.925 9q-.2-1.425-.825-2.65T17.5 4.2q-.325-.3-.375-.7t.2-.75t.663-.375t.737.25q1.325 1.2 2.175 2.812t1.05 3.488q.05.425-.237.75T21 10"},null,-1)]),4)}const Rr=T(Er,[["render",Lr]]),Ar={name:"SponsorTokenExpires",mixins:[K],props:{expiresSoon:Boolean,expiresAt:String,name:String},computed:{inXDays(){return this.fmtTimeAgo(new Date(this.expiresAt)-new Date)},isTrial(){return this.name===Gt}}},Fr={key:0,class:"alert alert-warning my-4",role:"alert"},Br={href:"https://sponsor.evcc.io",target:"_blank",class:"text-danger"},jr={key:0,class:"d-block mt-2"};function xr(e,t,n,i,s,o){const r=g("i18n-t");return n.expiresSoon?(a(),c("div",Fr,[u(r,{tag:"div",keypath:"settings.sponsorToken.expires",scope:"global"},{inXDays:h(()=>[N(f(o.inXDays),1)]),getNewToken:h(()=>[l("a",Br,f(e.$t("settings.sponsorToken.getNew")),1)]),_:1}),o.isTrial?b("",!0):(a(),c("em",jr,f(e.$t("settings.sponsorToken.hint")),1))])):b("",!0)}const Hr=T(Ar,[["render",xr]]),zr={name:"SponsorModal",components:{FormRow:L,JsonModal:se,Sponsor:Kt,SponsorTokenExpires:Hr},emits:["changed"],data:()=>({showForm:!1}),computed:{sponsor(){var e,t;return(t=(e=I)==null?void 0:e.state)==null?void 0:t.sponsor},hasToken(){var t;const e=((t=this.sponsor)==null?void 0:t.name)||"";return e!==""&&e!==Jt},sponsorTokenLabel(){return this.hasToken?this.$t("config.sponsor.changeToken"):this.$t("config.sponsor.addToken")},trialTokenLink(){return"".concat(re(),"/docs/sponsorship#trial")}},methods:{transformReadValues(){return{token:""}},handlePaste(e){e.preventDefault();const t=e.clipboardData.getData("text"),n=_t(t,"sponsortoken");e.target.value=n}}},Yr={class:"mt-4 mb-3"},Wr={key:0,class:"d-flex gap-1 justify-content-between flex-wrap"},Gr=["href"],Kr={key:1},Jr=["onUpdate:modelValue"];function Qr(e,t,n,i,s,o){const r=g("SponsorTokenExpires"),p=g("Sponsor"),d=g("FormRow"),v=g("JsonModal");return a(),w(v,{id:"sponsorModal",title:"".concat(e.$t("config.sponsor.title")," 💚"),description:e.$t("config.sponsor.description"),"error-message":e.$t("config.sponsor.error"),endpoint:"/config/sponsortoken","transform-read-values":o.transformReadValues,"data-testid":"sponsor-modal",size:"lg","no-buttons":!e.showForm,"disable-remove":!o.hasToken,onChanged:t[2]||(t[2]=M=>e.$emit("changed")),onOpen:t[3]||(t[3]=M=>e.showForm=!1)},{default:h(({values:M})=>[u(r,Re(Ae(o.sponsor)),null,16),l("div",Yr,[u(p,Re(Ae(o.sponsor)),null,16)]),e.showForm?(a(),c("div",Kr,[t[4]||(t[4]=l("hr",null,null,-1)),u(d,{id:"sponsorToken",label:o.sponsorTokenLabel,help:e.$t("config.sponsor.descriptionToken",{url:"https://sponsor.evcc.io/"}),"docs-link":"/docs/sponsorship#trial",class:"mt-4"},{default:h(()=>[_(l("textarea",{id:"sponsorToken","onUpdate:modelValue":C=>M.token=C,required:"",rows:"5",spellcheck:"false",class:"form-control",onPaste:t[1]||(t[1]=(...C)=>o.handlePaste&&o.handlePaste(...C))},null,40,Jr),[[O,M.token]])]),_:2},1032,["label","help"])])):(a(),c("div",Wr,[l("button",{type:"button",class:"btn btn-link text-muted text-truncate",onClick:t[0]||(t[0]=C=>e.showForm=!e.showForm)},f(o.sponsorTokenLabel),1),o.hasToken?b("",!0):(a(),c("a",{key:0,class:"btn btn-link text-muted text-truncate",href:o.trialTokenLink,target:"_blank"},f(e.$t("config.sponsor.trialToken")),9,Gr))]))]),_:1},8,["title","description","error-message","transform-read-values","no-buttons","disable-remove"])}const Zr=T(zr,[["render",Qr],["__scopeId","data-v-f3aebc69"]]),Xr="#currency: EUR\n\n#grid: # price using energy from the grid\n#  type: fixed\n#  price: 0.294 # EUR/kWh\n\n#feedin: # price for feeding solar energy to the grid\n#  type: fixed\n#  price: 0.08 # EUR/kWh\n\n#co2: # carbon intensity forecast data\n#  type: template\n#  template: grünstromindex\n#  zip: <zip>\n",ed={name:"TariffsModal",components:{YamlModal:J},emits:["changed"],data(){return{defaultYaml:Xr.trim()}}};function td(e,t,n,i,s,o){const r=g("YamlModal");return a(),w(r,{id:"tariffsModal",title:e.$t("config.tariffs.title"),description:e.$t("config.tariffs.description"),docs:"/docs/tariffs",defaultYaml:s.defaultYaml,removeKey:"tariffs",endpoint:"/config/tariffs","data-testid":"tariffs-modal",onChanged:t[0]||(t[0]=p=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const nd=T(ed,[["render",td]]),lt={type:"template",icon:"car"};function rt(e){return new Promise(t=>setTimeout(t,e))}const od=["minCurrent","maxCurrent","priority","identifiers","phases","mode"],sd={name:"VehicleModal",components:{FormRow:L,PropertyField:ce,TestResult:Ne,GenericModal:Y,SelectGroup:Pe,PropertyCollapsible:me,PropertyEntry:Oe,Markdown:ue},mixins:[Ue],props:{id:Number},emits:["vehicle-changed"],data(){return{isModalVisible:!1,templates:[],products:[],saving:!1,templateName:null,template:null,values:{...lt},loadingTemplate:!1}},computed:{templateOptions(){return{online:this.products.filter(e=>!e.group&&e.template!=="offline"),generic:this.products.filter(e=>e.group==="generic"),scooter:this.products.filter(e=>e.group==="scooter")}},templateParams(){var n;const e=(((n=this.template)==null?void 0:n.Params)||[]).filter(i=>!od.includes(i.Name)).map(i=>((i.Name==="title"||i.Name==="icon")&&(i.Required=!0,i.Advanced=!1),i));e.sort((i,s)=>(i.Required?-1:1)-(s.Required?-1:1));const t={title:-2,icon:-1};return e.sort((i,s)=>(t[i.Name]||0)-(t[s.Name]||0)),e},normalParams(){return this.templateParams.filter(e=>!e.Advanced&&!e.Deprecated)},advancedParams(){return this.templateParams.filter(e=>e.Advanced||e.Deprecated)},description(){var e,t;return(t=(e=this.template)==null?void 0:e.Requirements)==null?void 0:t.Description},apiData(){const e={template:this.templateName,...this.values};return Array.isArray(e.identifiers)&&(e.identifiers=e.identifiers.map(t=>t.trim()).filter(t=>t)),e},isNew(){return this.id===void 0},isDeletable(){return!this.isNew},priorityOptions(){const e=Array.from({length:11},(t,n)=>({key:n,name:"".concat(n)}));return e[0].name="0 (default)",e[0].key=void 0,e[10].name="10 (highest)",e}},watch:{isModalVisible(e){e&&(this.reset(),this.templateName="offline",this.resetTest(),this.loadProducts(),this.id!==void 0&&this.loadConfiguration())},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},methods:{reset(){this.values={...lt},this.resetTest()},async loadConfiguration(){try{const e=(await $.get("config/devices/vehicle/".concat(this.id))).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(e){console.error(e)}},async loadProducts(){var e;try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale}};this.products=(await $.get("config/products/vehicle",t)).data.result}catch(t){console.error(t)}},async loadTemplate(){var e;this.template=null,this.loadingTemplate=!0;try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale,name:this.templateName}};this.template=(await $.get("config/templates/vehicle",t)).data.result,this.applyDefaultsFromTemplate()}catch(t){console.error(t)}this.loadingTemplate=!1},applyDefaultsFromTemplate(){var t;(((t=this.template)==null?void 0:t.Params)||[]).filter(n=>n.Default&&!this.values[n.Name]).forEach(n=>{this.values[n.Name]=n.Default})},async create(){if(this.testUnknown){if(!await this.test(this.testVehicle))return;await rt(250)}this.saving=!0;try{await $.post("config/devices/vehicle",this.apiData),this.$emit("vehicle-changed"),this.closed()}catch(e){console.error(e),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testVehicle)},async testVehicle(){let e="config/test/vehicle";return this.isNew||(e+="/merge/".concat(this.id)),await $.post(e,this.apiData)},async update(){if(this.testUnknown){if(!await this.test(this.testVehicle))return;await rt(250)}this.saving=!0;try{await $.put("config/devices/vehicle/".concat(this.id),this.apiData),this.$emit("vehicle-changed"),this.closed()}catch(e){console.error(e),alert("update failed")}this.saving=!1},async remove(){try{await $.delete("config/devices/vehicle/".concat(this.id)),this.$emit("vehicle-changed"),this.closed()}catch(e){console.error(e),alert("delete failed")}},open(){this.isModalVisible=!0},closed(){this.isModalVisible=!1},templateChanged(){this.reset()}}},ad={ref:"form",class:"container mx-0 px-0"},id=["disabled"],ld={value:"offline"},rd=["label"],dd=["value"],ud=["label"],cd=["value"],md=["label"],pd=["value"],hd={key:0},fd={class:"row mb-3"},gd={key:3,class:"my-4 d-flex justify-content-between"},vd={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal"},bd=["disabled"],yd={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function wd(e,t,n,i,s,o){const r=g("FormRow"),p=g("Markdown"),d=g("PropertyEntry"),v=g("PropertyField"),M=g("SelectGroup"),C=g("PropertyCollapsible"),y=g("TestResult"),U=g("GenericModal");return a(),w(U,{id:"vehicleModal",title:e.$t("config.vehicle.".concat(o.isNew?"titleAdd":"titleEdit")),"data-testid":"vehicle-modal",onOpen:o.open,onClosed:o.closed},{default:h(()=>[l("form",ad,[u(r,{id:"vehicleTemplate",label:e.$t("config.vehicle.template")},{default:h(()=>[_(l("select",{id:"vehicleTemplate","onUpdate:modelValue":t[0]||(t[0]=m=>s.templateName=m),disabled:!o.isNew,class:"form-select w-100",onChange:t[1]||(t[1]=(...m)=>o.templateChanged&&o.templateChanged(...m))},[l("option",ld,f(e.$t("config.vehicle.offline")),1),t[10]||(t[10]=l("option",{disabled:""},"----------",-1)),l("optgroup",{label:e.$t("config.vehicle.online")},[(a(!0),c(P,null,q(o.templateOptions.online,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,dd))),128))],8,rd),l("optgroup",{label:e.$t("config.vehicle.scooter")},[(a(!0),c(P,null,q(o.templateOptions.scooter,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,cd))),128))],8,ud),l("optgroup",{label:e.$t("config.vehicle.generic")},[(a(!0),c(P,null,q(o.templateOptions.generic,m=>(a(),c("option",{key:m.name,value:m.template},f(m.name),9,pd))),128))],8,md)],40,id),[[de,s.templateName]])]),_:1},8,["label"]),s.loadingTemplate?(a(),c("p",hd,"Loading ...")):b("",!0),o.description?(a(),w(p,{key:1,markdown:o.description,class:"my-4"},null,8,["markdown"])):b("",!0),(a(!0),c(P,null,q(o.normalParams,m=>(a(),w(d,G({id:"vehicleParam".concat(m.Name),key:m.Name,ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":V=>s.values[m.Name]=V}),null,16,["id","modelValue","onUpdate:modelValue"]))),128)),u(C,null,Se({more:h(()=>[t[11]||(t[11]=l("h6",{class:"mt-3"},"Charging settings",-1)),u(r,{id:"vehicleParamMode",label:"Default mode",help:"Charging point mode when connecting this vehicle."},{default:h(()=>[u(v,{id:"vehicleParamMode",modelValue:s.values.mode,"onUpdate:modelValue":t[2]||(t[2]=m=>s.values.mode=m),type:"Choice",class:"w-100",choice:[{key:"off",name:e.$t("main.mode.off")},{key:"pv",name:e.$t("main.mode.pv")},{key:"minpv",name:e.$t("main.mode.minpv")},{key:"now",name:e.$t("main.mode.now")}]},null,8,["modelValue","choice"])]),_:1}),u(r,{id:"vehicleParamPhases",label:"Maximum phases",help:"How many phases can this vehicle charge with? Used to calculate required minimum solar surplus and plan duration."},{default:h(()=>[u(M,{id:"vehicleParamPhases",modelValue:s.values.phases,"onUpdate:modelValue":t[3]||(t[3]=m=>s.values.phases=m),class:"w-100",options:[{name:"1-phase",value:"1"},{name:"2-phases",value:"2"},{name:"3-phases",value:void 0}],"equal-width":"",transparent:""},null,8,["modelValue"])]),_:1}),l("div",fd,[u(r,{id:"vehicleParamMinCurrent",label:"Minimum current",class:"col-sm-6 mb-sm-0",help:s.values.minCurrent&&s.values.minCurrent<6?"Only go below 6 A if you know what you're doing.":null},{default:h(()=>[u(v,{id:"vehicleParamMinCurrent",modelValue:s.values.minCurrent,"onUpdate:modelValue":t[4]||(t[4]=m=>s.values.minCurrent=m),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2"},null,8,["modelValue"])]),_:1},8,["help"]),u(r,{id:"vehicleParamMaxCurrent",label:"Maximum current",class:"col-sm-6 mb-sm-0",help:s.values.minCurrent&&s.values.maxCurrent&&s.values.maxCurrent<s.values.minCurrent?"Must be greater than minimum current.":null},{default:h(()=>[u(v,{id:"vehicleParamMaxCurrent",modelValue:s.values.maxCurrent,"onUpdate:modelValue":t[5]||(t[5]=m=>s.values.maxCurrent=m),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2"},null,8,["modelValue"])]),_:1},8,["help"])]),u(r,{id:"vehicleParamPriority",label:"Priority",help:"Changes the charging point priority when connecting this vehicle."},{default:h(()=>[u(v,{id:"vehicleParamPriority",modelValue:s.values.priority,"onUpdate:modelValue":t[6]||(t[6]=m=>s.values.priority=m),type:"Choice",size:"w-100",class:"me-2",choice:o.priorityOptions,required:""},null,8,["modelValue","choice"])]),_:1}),u(r,{id:"vehicleParamIdentifiers",label:"RFID identifiers",help:"List of RFID strings to identify the vehicle. One per line. See the current identifier on the configuration overview."},{default:h(()=>[u(v,{id:"vehicleParamIdentifiers",modelValue:s.values.identifiers,"onUpdate:modelValue":t[7]||(t[7]=m=>s.values.identifiers=m),type:"List",property:"identifiers",size:"w-100",class:"me-2"},null,8,["modelValue"])]),_:1})]),_:2},[o.advancedParams.length?{name:"advanced",fn:h(()=>[(a(!0),c(P,null,q(o.advancedParams,m=>(a(),w(d,G({id:"vehicleParam".concat(m.Name),key:m.Name,ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":V=>s.values[m.Name]=V}),null,16,["id","modelValue","onUpdate:modelValue"]))),128))]),key:"0"}:void 0]),1024),s.templateName?(a(),w(y,{key:2,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:o.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):b("",!0),s.templateName?(a(),c("div",gd,[o.isDeletable?(a(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[8]||(t[8]=S((...m)=>o.remove&&o.remove(...m),["prevent"]))},f(e.$t("config.vehicle.delete")),1)):(a(),c("button",vd,f(e.$t("config.vehicle.cancel")),1)),l("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||s.saving,onClick:t[9]||(t[9]=S(m=>o.isNew?o.create():o.update(),["prevent"]))},[s.saving?(a(),c("span",yd)):b("",!0),N(" "+f(e.testUnknown?e.$t("config.vehicle.validateSave"):e.$t("config.vehicle.save")),1)],8,bd)])):b("",!0)],512)]),_:1},8,["title","onOpen","onClosed"])}const Md=T(sd,[["render",wd],["__scopeId","data-v-83eff06e"]]),kd={name:"Config",components:{NewDeviceButton:ft,ChargerModal:Bo,CircuitsIcon:Ho,CircuitsModal:pa,ControlModal:Ca,DeviceCard:Oa,DeviceTags:gt,EebusIcon:Da,EebusModal:Aa,GeneralConfig:Ei,HemsIcon:Ai,HemsModal:xi,InfluxIcon:Yi,InfluxModal:il,MessagingModal:Fl,MeterModal:tr,LoadpointModal:Nl,LoadpointIcon:El,ModbusProxyIcon:sr,ModbusProxyModal:rr,MqttIcon:cr,MqttModal:Vr,NetworkModal:Dr,NotificationIcon:Rr,SponsorModal:Zr,TariffsModal:nd,TopHeader:Zt,VehicleIcon:ht,VehicleModal:Md},mixins:[K,xt],props:{offline:Boolean,notifications:Array},data(){return{vehicles:[],meters:[],loadpoints:[],chargers:[],circuits:[],selectedVehicleId:void 0,selectedMeterId:void 0,selectedMeterType:void 0,selectedChargerId:void 0,selectedLoadpointId:void 0,loadpointSubModalOpen:!1,site:{grid:"",pv:[],battery:[],title:""},deviceValueTimeout:void 0,deviceValues:{},isComponentMounted:!0,isPageVisible:!0}},computed:{fatalClass(){var e,t;return(t=(e=I.state)==null?void 0:e.fatal)==null?void 0:t.class},siteTitle(){var e;return(e=this.site)==null?void 0:e.title},gridMeter(){var t;const e=(t=this.site)==null?void 0:t.grid;return this.getMetersByNames([e])[0]},pvMeters(){var t;const e=(t=this.site)==null?void 0:t.pv;return this.getMetersByNames(e)},batteryMeters(){var t;const e=(t=this.site)==null?void 0:t.battery;return this.getMetersByNames(e)},selectedMeterName(){var e;return(e=this.getMeterById(this.selectedMeterId))==null?void 0:e.name},selectedChargerName(){var e;return(e=this.getChargerById(this.selectedChargerId))==null?void 0:e.name},tariffTags(){const{currency:e,tariffGrid:t,tariffFeedIn:n,tariffCo2:i}=I.state;if(t===void 0&&n===void 0&&i===void 0)return null;const s={};return e&&(s.currency={value:e}),t&&(s.gridPrice={value:t,options:{currency:e}}),n&&(s.feedinPrice={value:n*-1,options:{currency:e}}),i&&(s.co2={value:i}),s},mqttTags(){var n;const{broker:e,topic:t}=((n=I.state)==null?void 0:n.mqtt)||{};return e?{broker:{value:e},topic:{value:t}}:{configured:{value:!1}}},influxTags(){var s;const{url:e,database:t,org:n}=((s=I.state)==null?void 0:s.influx)||{};if(!e)return{configured:{value:!1}};const i={url:{value:e}};return t&&(i.bucket={value:t}),n&&(i.org={value:n}),i},vehicleOptions(){return this.vehicles.map(e=>{var t;return{key:e.name,name:((t=e.config)==null?void 0:t.title)||e.name}})},hemsTags(){var n;const e={configured:{value:!1}},{type:t}=((n=I.state)==null?void 0:n.hems)||{};return t&&(e.configured.value=!0,e.hemsType={value:t}),e},isSponsor(){var t;const{name:e}=((t=I.state)==null?void 0:t.sponsor)||{};return!!e},eebusTags(){var e;return{configured:{value:((e=I.state)==null?void 0:e.eebus)||!1}}},modbusproxyTags(){var t;const e=((t=I.state)==null?void 0:t.modbusproxy)||[];return e.length>0?{amount:{value:e.length}}:{configured:{value:!1}}},messagingTags(){var e;return{configured:{value:((e=I.state)==null?void 0:e.messaging)||!1}}}},watch:{offline(){this.offline||this.loadAll()}},mounted(){this.isComponentMounted=!0,document.addEventListener("visibilitychange",this.handleVisibilityChange),this.isPageVisible=document.visibilityState==="visible",this.loadAll()},unmounted(){this.isComponentMounted=!1,document.removeEventListener("visibilitychange",this.handleVisibilityChange),clearTimeout(this.deviceValueTimeout)},methods:{handleVisibilityChange(){this.isPageVisible=document.visibilityState==="visible",this.isPageVisible?this.updateValues():clearTimeout(this.deviceValueTimeout)},async loadAll(){await this.loadVehicles(),await this.loadMeters(),await this.loadSite(),await this.loadChargers(),await this.loadLoadpoints(),await this.loadCircuits(),await this.loadDirty(),await this.updateValues()},async loadDirty(){var t;(t=(await $.get("/config/dirty")).data)!=null&&t.result&&(Yt.restartNeeded=!0)},async loadVehicles(){var t;const e=await $.get("/config/devices/vehicle");this.vehicles=((t=e.data)==null?void 0:t.result)||[]},async loadChargers(){var t;const e=await $.get("/config/devices/charger");this.chargers=((t=e.data)==null?void 0:t.result)||[]},async loadMeters(){var t;const e=await $.get("/config/devices/meter");this.meters=((t=e.data)==null?void 0:t.result)||[]},async loadCircuits(){var t;const e=await $.get("/config/devices/circuit");this.circuits=((t=e.data)==null?void 0:t.result)||[]},async loadSite(){var t;const e=await $.get("/config/site",{validateStatus:n=>n<500});e.status===200&&(this.site=(t=e.data)==null?void 0:t.result)},async loadLoadpoints(){var t;const e=await $.get("/config/loadpoints");this.loadpoints=((t=e.data)==null?void 0:t.result)||[]},getMetersByNames(e){return!e||!this.meters?[]:this.meters.filter(t=>e.includes(t.name))},getMeterById(e){if(!(!e||!this.meters))return this.meters.find(t=>t.id===e)},getChargerById(e){if(!(!e||!this.chargers))return this.chargers.find(t=>t.id===e)},vehicleModal(){return H.getOrCreateInstance(document.getElementById("vehicleModal"))},meterModal(){return H.getOrCreateInstance(document.getElementById("meterModal"))},loadpointModal(){return H.getOrCreateInstance(document.getElementById("loadpointModal"))},chargerModal(){return H.getOrCreateInstance(document.getElementById("chargerModal"))},editLoadpointCharger(e){this.loadpointSubModalOpen=!0;const t=this.chargers.find(n=>n.name===e);if(t&&t.id===void 0){alert("yaml configured chargers can not be edited. Remove charger from yaml first.");return}this.loadpointModal().hide(),this.$nextTick(()=>this.editCharger(t==null?void 0:t.id))},editLoadpointMeter(e){this.loadpointSubModalOpen=!0;const t=this.meters.find(n=>n.name===e);if(t&&t.id===void 0){alert("yaml configured meters can not be edited. Remove meter from yaml first.");return}this.loadpointModal().hide(),this.$nextTick(()=>this.editMeter(t==null?void 0:t.id,"charge"))},editMeter(e,t){this.selectedMeterId=e,this.selectedMeterType=t,this.$nextTick(()=>this.meterModal().show())},newMeter(e){this.selectedMeterId=void 0,this.selectedMeterType=e,this.$nextTick(()=>this.meterModal().show())},editCharger(e){this.selectedChargerId=e,this.$nextTick(()=>this.chargerModal().show())},newCharger(){this.selectedChargerId=void 0,this.$nextTick(()=>this.chargerModal().show())},async meterChanged(){await this.loadMeters(),this.meterModal().hide(),await this.loadDirty(),await this.updateValues()},async chargerChanged(){await this.loadChargers(),this.chargerModal().hide(),await this.loadDirty(),await this.updateValues()},editLoadpoint(e){this.selectedLoadpointId=e,this.$nextTick(()=>this.loadpointModal().show())},newLoadpoint(){this.selectedLoadpointId=void 0,this.$nextTick(()=>this.loadpointModal().show())},async loadpointChanged(){this.selectedLoadpointId=void 0,await this.loadLoadpoints(),this.loadpointModal().hide(),this.loadDirty()},editVehicle(e){this.selectedVehicleId=e,this.$nextTick(()=>this.vehicleModal().show())},newVehicle(){this.selectedVehicleId=void 0,this.$nextTick(()=>this.vehicleModal().show())},vehicleChanged(){this.selectedVehicleId=void 0,this.vehicleModal().hide(),this.loadVehicles(),this.loadDirty()},siteChanged(){this.loadDirty()},yamlChanged(){this.loadDirty()},addMeter(e,t){var n;e==="charge"?(n=this.$refs.loadpointModal)==null||n.setMeter(t):e==="grid"?(this.site.grid=t,this.saveSite(e)):(this.site[e]||(this.site[e]=[]),this.site[e].push(t),this.saveSite(e))},removeMeter(e,t){var n;e==="charge"?(n=this.$refs.loadpointModal)==null||n.setMeter(void 0):e==="grid"?(this.site.grid="",this.saveSite(e)):(this.site[e]=this.site[e].filter(i=>i!==t),this.saveSite(e))},addCharger(e){var t;(t=this.$refs.loadpointModal)==null||t.setCharger(e)},removeCharger(){var e;(e=this.$refs.loadpointModal)==null||e.setCharger(void 0)},meterModalClosed(){this.selectedMeterType==="charge"&&this.loadpointModal().show()},chargerModalClosed(){this.loadpointModal().show()},async saveSite(e){const t=e?{[e]:this.site[e]}:this.site;await $.put("/config/site",t),await this.loadSite(),await this.loadDirty(),await this.updateValues()},todo(){alert("not implemented yet")},async restart(){await zt()},async updateDeviceValue(e,t){try{const n=await $.get("/config/devices/".concat(e,"/").concat(t,"/status"));this.deviceValues[e]||(this.deviceValues[e]={}),this.deviceValues[e][t]=n.data.result}catch(n){return console.error("Error fetching device values for",e,t,n),null}},async updateValues(){var e;if(clearTimeout(this.deviceValueTimeout),!this.offline){const t={meter:this.meters,vehicle:this.vehicles,charger:this.chargers};for(const n in t)for(const i of t[n])this.isComponentMounted&&this.isPageVisible&&await this.updateDeviceValue(n,i.name)}if(this.isComponentMounted&&this.isPageVisible){const t=(((e=I.state)==null?void 0:e.interval)||30)*1e3;this.deviceValueTimeout=setTimeout(this.updateValues,t)}},deviceTags(e,t){var n;return((n=this.deviceValues[e])==null?void 0:n[t])||{}},loadpointTags(e){const{charger:t,meter:n}=e,i=t?this.deviceTags("charger",t):{},s=n?this.deviceTags("meter",n):{};return{...i,...s}},openModal(e){const t=document.getElementById(e);t?H.getOrCreateInstance(t).show():console.error("modal ".concat(e," not found"))},circuitTags(e){var s;const n=(((s=I.state)==null?void 0:s.circuits)||{})[e.name]||{},i={};return n.maxPower?i.powerRange={value:[n.power||0,n.maxPower],warning:n.power>=n.maxPower}:i.power={value:n.power||0,muted:!0},n.maxCurrent&&(i.currentRange={value:[n.current||0,n.maxCurrent],warning:n.current>=n.maxCurrent}),i},deviceError(e,t){var i;const n=((i=I.state)==null?void 0:i.fatal)||{};return n.class===e&&n.device===t},chargerIcon(e){var n;const t=this.chargers.find(i=>i.name===e);return(n=t==null?void 0:t.config)==null?void 0:n.icon}}},Cd={class:"root safe-area-inset"},_d={class:"container px-4"},Td={class:"wrapper pb-5"},$d={key:0,class:"alert alert-danger my-4 pb-0",role:"alert"},Vd={class:"my-4 mt-5"},Pd={key:1},Sd={class:"my-4"},qd={class:"p-0 config-list"},Id={class:"my-4"},Od={class:"p-0 config-list"},Nd={class:"my-4 mt-5"},Ud={class:"p-0 config-list"},Dd={class:"my-4 mt-5"},Ed={class:"p-0 config-list"},Ld={class:"my-4 mt-5"},Rd={class:"p-0 config-list"},Ad={key:0},Fd={class:"my-2 fw-bold"},Bd={class:"my-4 mt-5"},jd={class:"round-box p-4 d-flex gap-4 mb-5"};function xd(e,t,n,i,s,o){const r=g("TopHeader"),p=g("GeneralConfig"),d=g("DeviceTags"),v=g("VehicleIcon"),M=g("LoadpointIcon"),C=g("DeviceCard"),y=g("NewDeviceButton"),U=g("MqttIcon"),m=g("NotificationIcon"),V=g("InfluxIcon"),B=g("EebusIcon"),De=g("CircuitsIcon"),he=g("ModbusProxyIcon"),fe=g("HemsIcon"),ge=g("router-link"),$t=g("LoadpointModal"),Vt=g("VehicleModal"),Pt=g("MeterModal"),St=g("ChargerModal"),qt=g("InfluxModal"),It=g("MqttModal"),Ot=g("NetworkModal"),Nt=g("ControlModal"),Ut=g("SponsorModal"),Dt=g("HemsModal"),Et=g("MessagingModal"),Lt=g("TariffsModal"),Rt=g("ModbusProxyModal"),At=g("CircuitsModal"),Ft=g("EebusModal");return a(),c("div",Cd,[l("div",_d,[u(r,{title:e.$t("config.main.title")},null,8,["title"]),l("div",Td,[e.$hiddenFeatures()?(a(),c("div",$d,t[13]||(t[13]=[Ht('<p data-v-4b00b2be><strong data-v-4b00b2be>Experimental! 🧪</strong> Only use these features if you are in the mood for adventure and not afraid of debugging. Unexpected things and data loss may happen. </p><p data-v-4b00b2be> We are in the progress of replacing <code data-v-4b00b2be>evcc.yaml</code> with UI-based configuration. Any changes made here will be written to the database. After that, the corresponding <code data-v-4b00b2be>evcc.yaml</code>-values (e.g. network settings) will be ignored. </p><p class="mb-1" data-v-4b00b2be><strong data-v-4b00b2be>Missing features</strong></p><ul data-v-4b00b2be><li data-v-4b00b2be>aux meters</li><li data-v-4b00b2be>custom/plugin meters and vehicles</li><li data-v-4b00b2be>migration for vehicles, chargers, meters, loadpoints</li><li data-v-4b00b2be>remove mixed mode (evcc.yaml + db) for meters and vehicles</li></ul><p data-v-4b00b2be><strong data-v-4b00b2be>Migration and repair.</strong> Run <code data-v-4b00b2be>evcc migrate</code> to copy configuration from <code data-v-4b00b2be>evcc.yaml</code> to the database. Existing database configurations will be overwritten. Session and statistics data will not be touched. Run <code data-v-4b00b2be>evcc migrate --reset</code> to remove all database configurations. </p>',5)]))):b("",!0),l("h2",Vd,f(e.$t("config.section.general")),1),u(p,{onSiteChanged:o.siteChanged},null,8,["onSiteChanged"]),e.$hiddenFeatures()?(a(),c("div",Pd,[l("h2",Sd,f(e.$t("config.section.loadpoints"))+" 🧪",1),l("ul",qd,[(a(!0),c(P,null,q(s.loadpoints,k=>(a(),w(C,{key:k.name,title:k.title,name:k.name,editable:!!k.id,error:o.deviceError("loadpoint",k.name),"data-testid":"loadpoint",onEdit:R=>o.editLoadpoint(k.id)},{tags:h(()=>[u(d,{tags:o.loadpointTags(k)},null,8,["tags"])]),icon:h(()=>[o.chargerIcon(k.charger)?(a(),w(v,{key:0,name:o.chargerIcon(k.charger)},null,8,["name"])):(a(),w(M,{key:1}))]),_:2},1032,["title","name","editable","error","onEdit"]))),128)),u(y,{"data-testid":"add-loadpoint",title:e.$t("config.main.addLoadpoint"),onClick:o.newLoadpoint},null,8,["title","onClick"])]),l("h2",Id,f(e.$t("config.section.vehicles"))+" 🧪",1),l("ul",Od,[(a(!0),c(P,null,q(s.vehicles,k=>{var R;return a(),w(C,{key:k.name,title:((R=k.config)==null?void 0:R.title)||k.name,name:k.name,editable:k.id>=0,error:o.deviceError("vehicle",k.name),"data-testid":"vehicle",onEdit:j=>o.editVehicle(k.id)},{icon:h(()=>{var j;return[u(v,{name:(j=k.config)==null?void 0:j.icon},null,8,["name"])]}),tags:h(()=>[u(d,{tags:o.deviceTags("vehicle",k.name)},null,8,["tags"])]),_:2},1032,["title","name","editable","error","onEdit"])}),128)),u(y,{"data-testid":"add-vehicle",title:e.$t("config.main.addVehicle"),onClick:o.newVehicle},null,8,["title","onClick"])]),l("h2",Nd,f(e.$t("config.section.grid"))+" 🧪",1),l("ul",Ud,[o.gridMeter?(a(),w(C,{key:0,title:e.$t("config.grid.title"),name:o.gridMeter.name,editable:!!o.gridMeter.id,error:o.deviceError("meter",o.gridMeter.name),"data-testid":"grid",onEdit:t[0]||(t[0]=k=>o.editMeter(o.gridMeter.id,"grid"))},{icon:h(()=>t[14]||(t[14]=[l("shopicon-regular-powersupply",null,null,-1)])),tags:h(()=>[u(d,{tags:o.deviceTags("meter",o.gridMeter.name)},null,8,["tags"])]),_:1},8,["title","name","editable","error"])):(a(),w(y,{key:1,title:e.$t("config.main.addGrid"),"data-testid":"add-grid",onClick:t[1]||(t[1]=k=>o.newMeter("grid"))},null,8,["title"])),o.tariffTags?(a(),w(C,{key:2,title:e.$t("config.tariffs.title"),editable:"",error:o.fatalClass==="tariff","data-testid":"tariffs",onEdit:t[2]||(t[2]=k=>o.openModal("tariffsModal"))},{icon:h(()=>t[15]||(t[15]=[l("shopicon-regular-receivepayment",null,null,-1)])),tags:h(()=>[u(d,{tags:o.tariffTags},null,8,["tags"])]),_:1},8,["title","error"])):(a(),w(y,{key:3,title:e.$t("config.main.addTariffs"),"data-testid":"add-tariffs",onClick:t[3]||(t[3]=k=>o.openModal("tariffsModal"))},null,8,["title"]))]),l("h2",Dd,f(e.$t("config.section.meter"))+" 🧪",1),l("ul",Ed,[(a(!0),c(P,null,q(o.pvMeters,k=>{var R;return a(),w(C,{key:k.name,title:((R=k.config)==null?void 0:R.template)||"Solar system",name:k.name,editable:!!k.id,error:o.deviceError("meter",k.name),"data-testid":"pv",onEdit:j=>o.editMeter(k.id,"pv")},{icon:h(()=>t[16]||(t[16]=[l("shopicon-regular-sun",null,null,-1)])),tags:h(()=>[u(d,{tags:o.deviceTags("meter",k.name)},null,8,["tags"])]),_:2},1032,["title","name","editable","error","onEdit"])}),128)),(a(!0),c(P,null,q(o.batteryMeters,k=>{var R;return a(),w(C,{key:k.name,title:((R=k.config)==null?void 0:R.template)||"Battery storage",name:k.name,editable:!!k.id,error:o.deviceError("meter",k.name),"data-testid":"battery",onEdit:j=>o.editMeter(k.id,"battery")},{icon:h(()=>t[17]||(t[17]=[l("shopicon-regular-batterythreequarters",null,null,-1)])),tags:h(()=>[u(d,{tags:o.deviceTags("meter",k.name)},null,8,["tags"])]),_:2},1032,["title","name","editable","error","onEdit"])}),128)),u(y,{title:e.$t("config.main.addPvBattery"),onClick:o.newMeter},null,8,["title","onClick"])]),l("h2",Ld,f(e.$t("config.section.integrations"))+" 🧪",1),l("ul",Rd,[u(C,{title:e.$t("config.mqtt.title"),editable:"",error:o.fatalClass==="mqtt","data-testid":"mqtt",onEdit:t[4]||(t[4]=k=>o.openModal("mqttModal"))},{icon:h(()=>[u(U)]),tags:h(()=>[u(d,{tags:o.mqttTags},null,8,["tags"])]),_:1},8,["title","error"]),u(C,{title:e.$t("config.messaging.title"),editable:"",error:o.fatalClass==="messenger","data-testid":"messaging",onEdit:t[5]||(t[5]=k=>o.openModal("messagingModal"))},{icon:h(()=>[u(m)]),tags:h(()=>[u(d,{tags:o.messagingTags},null,8,["tags"])]),_:1},8,["title","error"]),u(C,{title:e.$t("config.influx.title"),editable:"",error:o.fatalClass==="influx","data-testid":"influx",onEdit:t[6]||(t[6]=k=>o.openModal("influxModal"))},{icon:h(()=>[u(V)]),tags:h(()=>[u(d,{tags:o.influxTags},null,8,["tags"])]),_:1},8,["title","error"]),u(C,{title:"".concat(e.$t("config.eebus.title")," 🧪"),editable:"",error:o.fatalClass==="eebus","data-testid":"eebus",onEdit:t[7]||(t[7]=k=>o.openModal("eebusModal"))},{icon:h(()=>[u(B)]),tags:h(()=>[u(d,{tags:o.eebusTags},null,8,["tags"])]),_:1},8,["title","error"]),u(C,{title:"".concat(e.$t("config.circuits.title")," 🧪"),editable:"",error:o.fatalClass==="circuit","data-testid":"circuits",onEdit:t[8]||(t[8]=k=>o.openModal("circuitsModal"))},{icon:h(()=>[u(De)]),tags:h(()=>[s.circuits.length==0?(a(),w(d,{key:0,tags:{configured:{value:!1}}})):(a(!0),c(P,{key:1},q(s.circuits,(k,R)=>{var j;return a(),c(P,{key:k.name},[R>0?(a(),c("hr",Ad)):b("",!0),l("p",Fd,[N(f((j=k.config)==null?void 0:j.title)+" ",1),l("code",null,"("+f(k.name)+")",1)]),u(d,{tags:o.circuitTags(k)},null,8,["tags"])],64)}),128))]),_:1},8,["title","error"]),u(C,{title:e.$t("config.modbusproxy.title"),editable:"",error:o.fatalClass==="modbusproxy","data-testid":"modbusproxy",onEdit:t[9]||(t[9]=k=>o.openModal("modbusProxyModal"))},{icon:h(()=>[u(he)]),tags:h(()=>[u(d,{tags:o.modbusproxyTags},null,8,["tags"])]),_:1},8,["title","error"]),u(C,{title:e.$t("config.hems.title"),editable:"",error:o.fatalClass==="hems","data-testid":"hems",onEdit:t[10]||(t[10]=k=>o.openModal("hemsModal"))},{icon:h(()=>[u(fe)]),tags:h(()=>[u(d,{tags:o.hemsTags},null,8,["tags"])]),_:1},8,["title","error"])])])):b("",!0),t[18]||(t[18]=l("hr",{class:"my-5"},null,-1)),l("h2",Bd,f(e.$t("config.section.system")),1),l("div",jd,[u(ge,{to:"/log",class:"btn btn-outline-secondary"},{default:h(()=>[N(f(e.$t("config.system.logs")),1)]),_:1}),l("button",{class:"btn btn-outline-danger",onClick:t[11]||(t[11]=(...k)=>o.restart&&o.restart(...k))},f(e.$t("config.system.restart")),1)]),u($t,{id:s.selectedLoadpointId,ref:"loadpointModal",vehicleOptions:o.vehicleOptions,loadpointCount:s.loadpoints.length,chargers:s.chargers,chargerValues:s.deviceValues.charger,meters:s.meters,circuits:s.circuits,fade:s.loadpointSubModalOpen?"left":"",onUpdated:o.loadpointChanged,onOpenChargerModal:o.editLoadpointCharger,onOpenMeterModal:o.editLoadpointMeter,onOpened:t[12]||(t[12]=k=>s.loadpointSubModalOpen=!1)},null,8,["id","vehicleOptions","loadpointCount","chargers","chargerValues","meters","circuits","fade","onUpdated","onOpenChargerModal","onOpenMeterModal"]),u(Vt,{id:s.selectedVehicleId,onVehicleChanged:o.vehicleChanged},null,8,["id","onVehicleChanged"]),u(Pt,{id:s.selectedMeterId,name:o.selectedMeterName,type:s.selectedMeterType,fade:s.loadpointSubModalOpen?"right":"",onAdded:o.addMeter,onUpdated:o.meterChanged,onRemoved:o.removeMeter,onClose:o.meterModalClosed},null,8,["id","name","type","fade","onAdded","onUpdated","onRemoved","onClose"]),u(St,{id:s.selectedChargerId,name:o.selectedChargerName,fade:s.loadpointSubModalOpen?"right":"",isSponsor:o.isSponsor,onAdded:o.addCharger,onUpdated:o.chargerChanged,onRemoved:o.removeCharger,onClose:o.chargerModalClosed},null,8,["id","name","fade","isSponsor","onAdded","onUpdated","onRemoved","onClose"]),u(qt,{onChanged:o.loadDirty},null,8,["onChanged"]),u(It,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Ot,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Nt,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Ut,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Dt,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Et,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Lt,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Rt,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(At,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Ft,{onChanged:o.yamlChanged},null,8,["onChanged"])])])])}const Kd=T(kd,[["render",xd],["__scopeId","data-v-4b00b2be"]]);export{Kd as default};
