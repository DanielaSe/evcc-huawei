System.register(["./index-legacy-C3BDSfGU.js","./TopHeader-legacy-IVHoAQla.js","./MultiSelect-legacy-B0Z-dmKX.js","./TopNavigation-legacy-DyfmuRER.js","./deepEqual-legacy-nmvg_8Jh.js"],(function(t,e){"use strict";var a,l,o,s,r,n,i,c,d,u,h,g,p,v,m,f,b,y,w,x,T,L;return{setters:[t=>{a=t._,l=t.j,o=t.c,s=t.a,r=t.k,n=t.o,i=t.b,c=t.n,d=t.q,u=t.t,h=t.w,g=t.K,p=t.F,v=t.r,m=t.d,f=t.h,b=t.O,y=t.a1,w=t.e,x=t.i},t=>{T=t.T},t=>{L=t.M},null,null],execute:function(){var e=document.createElement("style");e.textContent=".logs[data-v-6a783ccb]{border-radius:2rem;background:var(--evcc-box)}.root[data-v-6a783ccb]{height:100vh;height:100dvh}.btn[data-v-6a783ccb]{--bs-btn-border-width: 1px}.play[data-v-6a783ccb]{transform:scale(1.2)}.spin[data-v-6a783ccb]{animation:rotation-6a783ccb 3s infinite ease-in-out}@keyframes rotation-6a783ccb{0%{transform:rotate(0) scaleY(-1)}to{transform:rotate(1440deg) scaleY(-1)}}@keyframes fadeIn-6a783ccb{0%{opacity:.3}to{opacity:var(--opacity)}}.log[data-v-6a783ccb]{--opacity: 1;opacity:var(--opacity);animation-name:fadeIn-6a783ccb;animation-duration:var(--transition-duration-fast);animation-fill-mode:forwards;animation-timing-function:ease-out;text-indent:1rem hanging;font-size:8px}@media (min-width: 576px){.log[data-v-6a783ccb]{font-size:.875em}}.log-warn[data-v-6a783ccb]{color:var(--bs-warning)}.log-error[data-v-6a783ccb],.log-fatal[data-v-6a783ccb]{color:var(--bs-danger)}.log-debug[data-v-6a783ccb]{--opacity: .7}.log-trace[data-v-6a783ccb]{--opacity: .5}\n/*$vite$:1*/",document.head.appendChild(e);class q extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M22 4v19.172l-8-8L11.171 18 24 30.828 36.829 18 34 15.172l-8 8V4z"/><path d="M8 44h32c2.206 0 4-1.794 4-4V30h-4v10H8V30H4v10c0 2.206 1.794 4 4 4z"/></svg>'}}window.customElements.define("shopicon-regular-download",q);const $=a({name:"Play",mixins:[l]},[["render",function(t,e,a,l,i,c){return n(),o("svg",{style:r(t.svgStyle),viewBox:"0 0 24 24"},e[0]||(e[0]=[s("path",{fill:"currentColor",d:"M8 17.175V6.825q0-.425.3-.713t.7-.287q.125 0 .263.037t.262.113l8.15 5.175q.225.15.338.375t.112.475t-.112.475t-.338.375l-8.15 5.175q-.125.075-.262.113T9 18.175q-.4 0-.7-.288t-.3-.712m2-1.825L15.25 12L10 8.65z"},null,-1)]),4)}]]),k=a({name:"Record",mixins:[l]},[["render",function(t,e,a,l,i,c){return n(),o("svg",{style:r(t.svgStyle),viewBox:"0 0 24 24"},e[0]||(e[0]=[s("path",{fill:"currentColor",d:"M12 17q-2.075 0-3.537-1.463T7 12t1.463-3.537T12 7t3.538 1.463T17 12t-1.463 3.538T12 17m8-5q0-1.05-.25-2.025t-.725-1.85q-.2-.375-.162-.8t.387-.675t.775-.15t.625.45q.65 1.125 1 2.388T22 12t-.363 2.675t-1.012 2.4q-.2.35-.612.438t-.763-.163t-.4-.675t.15-.8q.475-.875.738-1.838T20 12m-8-8q-1.075 0-2.037.263T8.125 5q-.375.2-.8.15t-.675-.4t-.162-.763t.437-.612q1.125-.65 2.4-1.012T12 2t2.675.363t2.4 1.012q.375.2.463.613t-.163.762t-.675.4t-.8-.15q-.875-.475-1.85-.737T12 4m-8 8q0 1.075.263 2.038T5 15.875q.2.375.15.8t-.4.675t-.763.163t-.612-.438q-.65-1.125-1.012-2.4T2 12t.35-2.662t1-2.388q.2-.35.625-.45t.775.15t.388.675t-.163.8Q4.5 9 4.25 9.975T4 12m8 8q1.05 0 2.025-.25t1.85-.725q.375-.2.788-.15t.662.4t.163.763t-.438.612q-1.125.65-2.387 1T12 22t-2.662-.35t-2.388-1q-.35-.2-.45-.625t.15-.775t.675-.387t.8.162q.875.475 1.85.725T12 20"},null,-1)]),4)}]]),A=["fatal","error","warn","info","debug","trace"],I="debug",M=new RegExp(`\\[.*?\\] (${A.map((t=>t.toUpperCase())).join("|")})`),S={class:"root safe-area-inset"},C={class:"container d-flex h-100 flex-column px-0 pb-4"},H={class:"logs d-flex flex-column overflow-hidden flex-grow-1 px-4 mx-2 mx-sm-4"},F={class:"flex-grow-0 row py-4"},V={class:"col-6 col-lg-3 mb-4 mb-lg-0 d-flex gap-2"},j={class:"btn-group w-100 w-lg-auto d-flex"},B={class:"text-nowrap text-truncate"},E=["aria-label","href"],U={class:"col-6 offset-lg-1 col-lg-4 mb-4 mb-lg-0"},z=["placeholder"],R={class:"filterLevel col-6 col-lg-2"},O=["aria-label","value"],P=["value"],Q={class:"filterAreas col-6 col-lg-2"},_={key:0,class:"my-2"},N={key:1,class:"d-block evcc-default-text flex-grow-1","data-testid":"log-content"},Y={key:2,class:"my-4"};t("default",a({name:"Log",components:{TopHeader:T,Play:$,Record:k,MultiSelect:L},props:{areas:{type:Array,default:()=>[]},level:{type:String,default:I}},data:()=>({lines:[],availableAreas:[],search:"",timeout:null,levels:A,busy:!1}),computed:{filteredLines(){return this.lines.filter((t=>!this.search||t.toLowerCase().includes(this.search.toLocaleLowerCase())))},lineEntries(){const t=new Map;return this.filteredLines.map((e=>{let a=e.substring(0,50);const l=t.get(a)||0;return t.set(a,l+1),a=`${a}-${l+1}`,{key:a,className:`log log-${M.exec(e)?.[1].toLowerCase()||"none"}`,line:e}}))},areaOptions(){return this.availableAreas.map((t=>({name:t,value:t})))},areasLabel(){return 0===this.areas.length?this.$t("log.areas"):1===this.areas.length?this.areas[0]:this.$t("log.nAreas",{count:this.areas.length})},showMoreButton(){return 1e3===this.lines.length},updateInterval:()=>1e3*(y.state?.interval||10),downloadUrl(){const t=new URLSearchParams;return this.level&&t.append("level",this.level),this.areas.forEach((e=>{t.append("area",e)})),t.append("format","txt"),`./api/system/log?${t.toString()}`},autoFollow(){return null!==this.timeout}},watch:{areas(){this.updateLogs()},level(){this.updateLogs()}},mounted(){this.startInterval(),this.updateAreas()},unmounted(){this.stopInterval()},methods:{async updateLogs(t){if(!this.busy){try{this.busy=!0;const e=await b.get("/system/log",{params:{level:this.level||null,area:this.areas.length?this.areas:null,count:t?null:1e3}});this.lines=e.data?.result||[],this.$nextTick((()=>{t?this.scrollToTop():this.scrollToBottom()}))}catch(e){console.error(e)}this.busy=!1}},startInterval(){this.stopInterval(),this.updateLogs(),this.timeout=setInterval((()=>{this.updateLogs()}),this.updateInterval)},stopInterval(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},async updateAreas(){try{const t=await b.get("/system/log/areas");this.availableAreas=t.data?.result||[]}catch(t){console.error(t)}},onScroll(t){this.autoFollow&&t.target.scrollTop+t.target.clientHeight<t.target.scrollHeight&&this.stopInterval()},scrollToTop(){this.$refs.log.scrollTop=0},scrollToBottom(){this.$refs.log.scrollTop=this.$refs.log.scrollHeight},toggleAutoFollow(){this.autoFollow?this.stopInterval():(this.scrollToBottom(),this.startInterval())},updateQuery({level:t,areas:e}){let a=t||this.level,l=e||this.areas;a===I&&(a=void 0),l=l.length?l.join(","):void 0,this.$router.push({query:{level:a,areas:l}})},changeLevel(t){this.updateQuery({level:t.target.value})},changeAreas(t){this.updateQuery({areas:t})}}},[["render",function(t,e,a,l,b,y){const T=w("TopHeader"),L=w("Record"),q=w("Play"),$=w("MultiSelect");return n(),o("div",S,[s("div",C,[i(T,{title:t.$t("log.title"),class:"mx-4"},null,8,["title"]),s("div",H,[s("div",F,[s("div",V,[s("div",j,[s("button",{type:"button",class:c(["btn text-nowrap d-flex gap-2 flex-grow-1 text-nowrap text-truncate",y.autoFollow?"btn-secondary":"btn-outline-secondary"]),onClick:e[0]||(e[0]=(...t)=>y.toggleAutoFollow&&y.toggleAutoFollow(...t))},[s("span",B,u(t.$t("log.update")),1),y.autoFollow?(n(),d(L,{key:0,ref:"spin",class:"spin flex-shrink-0",style:r({animationDuration:`${y.updateInterval}ms`})},null,8,["style"])):(n(),d(q,{key:1,class:"flex-shrink-0 play"}))],2),s("a",{class:"btn btn-outline-secondary flex-grow-0","aria-label":t.$t("log.download"),href:y.downloadUrl,download:""},e[6]||(e[6]=[s("shopicon-regular-download",{size:"s",class:"icon"},null,-1)]),8,E)])]),s("div",U,[h(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>b.search=t),type:"search",class:"form-control search",placeholder:t.$t("log.search"),"data-testid":"log-search"},null,8,z),[[g,b.search]])]),s("div",R,[s("select",{class:"form-select","aria-label":t.$t("log.levelLabel"),value:a.level,onInput:e[2]||(e[2]=(...t)=>y.changeLevel&&y.changeLevel(...t))},[(n(!0),o(p,null,v(b.levels,(t=>(n(),o("option",{key:t,value:t},u(t.toUpperCase()),9,P)))),128))],40,O)]),s("div",Q,[i($,{id:"logAreasSelect",modelValue:a.areas,options:y.areaOptions,selectAllLabel:t.$t("log.selectAll"),"onUpdate:modelValue":y.changeAreas,onOpen:e[3]||(e[3]=t=>y.updateAreas())},{default:m((()=>[x(u(y.areasLabel),1)])),_:1},8,["modelValue","options","selectAllLabel","onUpdate:modelValue"])])]),e[7]||(e[7]=s("hr",{class:"my-0"},null,-1)),s("div",{ref:"log",class:"overflow-y-scroll pt-2 pb-4 flex-grow-1 d-flex flex-column",onScroll:e[5]||(e[5]=(...t)=>y.onScroll&&y.onScroll(...t))},[y.showMoreButton?(n(),o("div",_,[s("button",{class:"btn btn-link btn-sm evcc-default-text px-0",type:"button",onClick:e[4]||(e[4]=t=>y.updateLogs(!0))},u(t.$t("log.showAll")),1)])):f("",!0),y.filteredLines.length?(n(),o("code",N,[(n(!0),o(p,null,v(y.lineEntries,(({line:t,className:e,key:a})=>(n(),o("div",{key:a,class:c(e)},u(t),3)))),128))])):(n(),o("p",Y,u(t.$t("log.noResults")),1))],544)])])])}],["__scopeId","data-v-6a783ccb"]]))}}}));
